[Nm] {1} The present document has been developed within the 3rd Generation Partnership Project (3GPP TM) and may be further elaborated for the purposes of 3GPP.
The present document has not been subject to any approval process by the 3GPP Organisational Partners and shall not be implemented.
This Specification is provided for future development work within 3GPP only. The Organisational Partners accept no liability for any use of this Specification.
Specifications and reports for implementation of the 3GPP TM system should be obtained via the 3GPP Organisational Partners' Publications Offices.


[H1] {2} 
Foreword


[Nm] {3} This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).


[Nm] {4} The contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:


	[B1] {5} Version x.y.z


	[B1] {6} where:


		[B2] {7} x	the first digit:


			[B3] {8} 1	presented to TSG for information;


			[B3] {9} 2	presented to TSG for approval;


			[B3] {10} 3	or greater indicates TSG approved document under change control.


		[B2] {11} y	the second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.


		[B2] {12} z	the third digit is incremented when editorial only changes have been incorporated in the document.


[H1] {13} 
1	Scope


[Nm] {14} The present document specifies the procedures used by the protocols for mobility management and session management between User Equipment (UE) and Mobility Management Entity (MME) in the Evolved Packet System (EPS). These protocols belong to the non-access stratum (NAS).


[Nm] {15} The EPS Mobility Management (EMM) protocol defined in the present document provides procedures for the control of mobility when the User Equipment (UE) is using the Evolved UMTS Terrestrial Radio Access Network (E-UTRAN). The EMM protocol also provides control of security for the NAS protocols.


[Nm] {16} The EPS Session Management (ESM) protocol defined in the present document provides procedures for the handling of EPS bearer contexts. Together with the bearer control provided by the access stratum, this protocol is used for the control of user plane bearers.


[Nm] {17} For both NAS protocols the present document specifies procedures for the support of inter-system mobility between EUTRAN and other 3GPP or non-3GPP access networks:


	[B1] {18} -	For inter-system mobility between E-UTRAN and GERAN, UTRAN or NG-RAN, this includes rules for a mapping between parameters and procedures used by the NAS protocols defined in the present document and the NAS protocols specified in 3GPP TS 24.008 [13] for GERAN and UTRAN, and 3GPP TS 24.501 [54] for NG-RAN.


	[B1] {19} -	For inter-system mobility between E-UTRAN and generic non-3GPP access networks, this includes specific NAS procedures to maintain IP connectivity to the PDN Gateway and to provide parameters needed by the UE when using mobility management based on Dual-Stack Mobile IPv6 (see 3GPP TS 24.303 [14]) or MIPv4 (see 3GPP TS 24.304 [15]).


[Nm] {20} The present document is applicable to the UE and to the Mobility Management Entity (MME) in the EPS.


[Nm] {21} The present document is also applicable to the relay node in the EPS (see 3GPP TS 23.401 [10]).


[Nm] {22} The present document also specifies NAS signalling enhancement for the support of efficient transport of IP, non-IP, Ethernet and SMS data of CIoT capable devices.


[H1] {23} 2	References


[Nm] {24} The following documents contain provisions which, through reference in this text, constitute provisions of the present document.


	[B1] {25} -	References are either specific (identified by date of publication, edition number, version number, etc.) or nonspecific.


	[B1] {26} -	For a specific reference, subsequent revisions do not apply.


	[B1] {27} -	For a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.


[H1] {28} 3	Definitions and abbreviations


[H2] {29} 3.1	Definitions


[Nm] {30} For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].


[Nm] {31} The term "mobile station" (MS) in the present document is synonymous with the term "user equipment" (UE) as defined in 3GPP TR 21.905 [1].


[Nm] {32} 1x CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to cdma2000® 1x access network if the UE is served by EUTRAN when a CS service is requested.


[Nm] {33} 5G-EA: 5GS encryption algorithms. The term 5G-EA, 5G-EA0, 128-5G-EA1-3 and 5G-EA4-7 used in the present document corresponds to the term NEA, NEA0, NEA1-3 and NEA4-7 defined in 3GPP TS 33.501 [56].


[Nm] {34} 5G-IA: 5GS integrity algorithms. The term 5G-IA, 5G-IA0, 128-5G-IA1-3 and 5G-IA4-7 used in the present document corresponds to the term NIA, NIA0, NIA1-3 and NIA4-7 defined in 3GPP TS 33.501 [56].


[Nm] {35} Aggregate maximum bit rate: The maximum bit rate that limits the aggregate bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP TS 23.401 [10].


[Nm] {36} APN based congestion control: Congestion control in session management where the network can reject session management requests from UEs or deactivate PDN connections when the associated APN is congested.


[Nm] {37} Attached for emergency bearer services: A UE is attached for emergency bearer services if it has only a PDN connection for emergency bearer services established.


[Nm] {38} Attached for access to RLOS: A UE is attached for access to RLOS if the UE requested access to RLOS during the attach procedure and has a PDN connection for RLOS established after completion of attach procedure.


[Nm] {39} Chosen PLMN: The same as selected PLMN as specified in 3GPP TS 23.122 [6].


[Nm] {40} Control plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP, Ethernet or SMS) over control plane via the MME including optional header compression of IP data. 


[Nm] {41} User plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP or Ethernet) over the user plane.


[Nm] {42} UE supporting CIoT EPS optimizations: A UE that supports control plane CIoT EPS optimization or user plane CIoT EPS optimization and one or more other CIoT EPS optimizations when the UE is in S1 mode.


[Nm] {43} Attached for EPS services with CP-CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and control plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.


[Nm] {44} Attached for EPS services with User plane CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and user plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.


[Nm] {45} Attached for EPS services with CIoT EPS optimization: A UE is attached for EPS services with CP-CIoT EPS optimization or attached for EPS services with user plane CIoT EPS optimization.


[Nm] {46} CS fallback cancellation request: A request received from the MM sublayer to cancel a mobile originating CS fallback.


[Nm] {47} CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to A/Gb or Iu mode if the UE is served by EUTRAN when a CS service is requested.


[Nm] {48} CSG cell: A cell in which only members of the CSG can get normal service. Depending on local regulation, the CSG cell can provide emergency bearer services also to subscribers who are not member of the CSG. Definition derived from 3GPP TS 23.401 [10].


[Nm] {49} CSG ID: A CSG ID is a unique identifier within the scope of one PLMN defined in 3GPP TS 23.003 [2] which identifies a Closed Subscriber Group (CSG) in the PLMN associated with a cell or group of cells to which access is restricted to members of the CSG.


[Nm] {50} CSG selection: A UE supporting CSG selection selects CSG cell either automatically based on the list of allowed CSG identities or manually based on user selection of CSG on indication of list of available CSGs. Definition derived from 3GPP TS 23.122 [6].


[Nm] {51} Dedicated bearer: An EPS bearer that is associated with uplink packet filters in the UE and downlink packet filters in the PDN GW where the filters only match certain packets. Definition derived from 3GPP TS 23.401 [10].


[Nm] {52} Default bearer: An EPS bearer that gets established with every new PDN connection. Its context remains established throughout the lifetime of that PDN connection. A default EPS bearer is a non-GBR bearer. Definition derived from 3GPP TS 23.401 [10].


[Nm] {53} Emergency EPS bearer context: A default EPS bearer context which was activated with request type "emergency" or "handover of emergency bearer services", or any dedicated EPS bearer context associated to this default EPS bearer context.


[Nm] {54} EMM context: An EMM context is established in the UE and the MME when an attach procedure is successfully completed.


[Nm] {55} EMM-CONNECTED mode: A UE is in EMM-CONNECTED mode when a NAS signalling connection between UE and network is established. The term EMM-CONNECTED mode used in the present document corresponds to the term ECM-CONNECTED state used in 3GPP TS 23.401 [10].


[Nm] {56} EMM-IDLE mode: A UE is in EMM-IDLE mode when no NAS signalling connection between UE and network exists or when RRC connection suspend has been indicated by lower layers. The term EMM-IDLE mode used in the present document corresponds to the term ECM-IDLE state used in 3GPP TS 23.401 [10].


[Nm] {57} EPS security context: In the present specification, EPS security context is used as a synonym for EPS NAS security context specified in 3GPP TS 33.401 [19].


[Nm] {58} EPS services: Services provided by PS domain. Within the context of this specification, EPS services is used as a synonym for GPRS services in 3GPP TS 24.008 [13].


[Nm] {59} Evolved packet core network: The successor to the 3GPP Release 7 packet-switched core network, developed by 3GPP within the framework of the 3GPP System Architecture Evolution (SAE).


[Nm] {60} Evolved packet system: The evolved packet system (EPS) or evolved 3GPP packet-switched domain consists of the evolved packet core network and the evolved universal terrestrial radio access network. Definition derived from 3GPP TS 23.401 [10].


[Nm] {61} GBR bearer: An EPS bearer that uses dedicated network resources related to a guaranteed bit rate (GBR) value, which are permanently allocated at EPS bearer establishment/modification. Definition derived from 3GPP TS 23.401 [10].


[Nm] {62} General NAS level mobility management congestion control: The type of congestion control that is applied at a general overload or congestion situation in the network, e.g. lack of processing resources.


[Nm] {63} Group specific session management congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs belonging to a particular group when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met.


[Nm] {64} Highest ranked ACDC category: The ACDC category with the lowest value as defined in 3GPP TS 24.105 [35].


[Nm] {65} Initial NAS message: A NAS message is considered as an initial NAS message, if this NAS message can trigger the establishment of a NAS signalling connection. For instance, the ATTACH REQUEST message is an initial NAS message.


[Nm] {66} IPv4v6 capability: Capability of the IP stack associated with a UE to support a dual stack configuration with both an IPv4 address and an IPv6 address allocated.


[Nm] {67} Kilobit: 1000 bits.


[Nm] {68} Last Visited Registered TAI: A TAI which is contained in the TAI list that the UE registered to the network and which identifies the tracking area last visited by the UE.


[Nm] {69} Linked Bearer Identity: This identity indicates to which default bearer the additional bearer resource is linked.


[Nm] {70} LIPA PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use LIPA. The network authorizes an APN for using LIPA based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a LIPA PDN connection.


[Nm] {71} Lower layer failure: A failure reported by the AS to the NAS that cannot be corrected on AS level. When the AS indicates a lower layer failure to NAS, the NAS signalling connection is not available.


[Nm] {72} Mapped EPS security context: A mapped security context to be used in EPS. Definition derived from 3GPP TS 33.401 [19].


[Nm] {73} Mapped GUTI: A GUTI which is mapped from a P-TMSI and an RAI allocated previously by an SGSN. Mapping rules are defined in 3GPP TS 23.003 [2]. Definition derived from 3GPP TS 23.401 [10].


[Nm] {74} Megabit: 1,000,000 bits.


[Nm] {75} Message header: A standard L3 message header as defined in 3GPP TS 24.007 [12].


[Nm] {76} MME area: An area containing tracking areas served by an MME.


[Nm] {77} MO MMTEL voice call is started: the MO-MMTEL-voice-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-voice-started indication, the MO-MMTEL-voice-ended indication has not been received.


[Nm] {78} MO MMTEL video call is started: the MO-MMTEL-video-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-video-started indication, the MO-MMTEL-video-ended indication has not been received.


[Nm] {79} MO SMSoIP is started: the MO-SMSoIP-attempt-started indication was received from upper layers (see 3GPP TS 24.341 [15D]) and after reception of the MO-SMSoIP-attempt-started indication, the MO-SMSoIP-attempt-ended indication has not been received.


[Nm] {80} NAS level mobility management congestion control: Congestion control mechanism in the network in mobility management. "NAS level mobility management congestion control" consists of "subscribed APN based congestion control" and "general NAS level mobility management congestion control".


[Nm] {81} NAS signalling connection: A peer to peer S1 mode connection between UE and MME. A NAS signalling connection consists of the concatenation of an RRC connection via the "LTE-Uu" interface and an S1AP connection via the S1 interface. Additionally, for the purpose of optimized handover or idle mode mobility from cdma2000® HRPD access to EUTRAN (see 3GPP TS 23.402 [11]), the NAS signalling connection can consist of a concatenation of an S101AP connection and a signalling tunnel over a cdma2000® HRPD access network.


[Nm] {82} NAS signalling connection recovery: A mechanism initiated by the NAS to restore the NAS signalling connection on indication of "RRC connection failure" by the lower layers.


[Nm] {83} Native GUTI: A GUTI previously allocated by an MME. Definition derived from 3GPP TS 23.401 [10].


[Nm] {84} Non-access stratum protocols: The protocols between UE and MSC or SGSN that are not terminated in the UTRAN, and the protocols between UE and MME that are not terminated in the E-UTRAN. Definition derived from 3GPP TR 21.905 [1].


[Nm] {85} Non-emergency EPS bearer context: Any EPS bearer context which is not an emergency EPS bearer context.


[Nm] {86} Non-EPS services: Services provided by CS domain. Within the context of this specification, non-EPS services is used as a synonym for non-GPRS services in 3GPP TS 24.008 [13]. A UE which camps on E-UTRAN can attach to both EPS services and non-EPS services.


[Nm] {87} Non-GBR bearer: An EPS bearer that uses network resources that are not related to a guaranteed bit rate (GBR) value. Definition derived from 3GPP TS 23.401 [10].


[Nm] {88} PDN address: An IP address assigned to the UE by the Packet Data Network Gateway (PDN GW).


[Nm] {89} PDN connection for emergency bearer services: A PDN connection for which the default EPS bearer context or default PDP context was activated with request type "emergency" or "handover of emergency bearer services".


[Nm] {90} PDN connection for RLOS: A PDN connection for which the default EPS bearer context was activated with request type "RLOS".


[Nm] {91} Plain NAS message: A NAS message with a header including neither a message authentication code nor a sequence number.


[Nm] {92} Persistent EPS bearer context: either a non-emergency EPS bearer context representing a GBR bearer with QoS equivalent to QoS of teleservice 11 and where there is a radio bearer associated with that context, or an emergency EPS bearer context where there is a radio bearer associated with that context.


[Nm] {93} Procedure Transaction Identity: An identity which is dynamically allocated by the UE for the UE requested ESM procedures. The procedure transaction identity is released when the procedure is completed.


[Nm] {94} RAT-related TMSI: When the UE is camping on an E-UTRAN cell, the RAT-related TMSI is the GUTI; when it is camping on a GERAN or UTRAN cell, the RAT-related TMSI is the P-TMSI.


[Nm] {95} Registered PLMN: The PLMN on which the UE is registered. The identity of the registered PLMN is provided to the UE within the GUTI.


[Nm] {96} Relay node: A network element in the E-UTRAN, wirelessly connected to an eNode B and providing relaying function to UEs served by the E-UTRAN. Definition derived from 3GPP TS 23.401 [10].


[Nm] {97} Removal of eCall only mode restriction: All the limitations as described in 3GPP TS 22.101 [46] for the eCall only mode do not apply any more.


[Nm] {98} RLOS EPS bearer context: A default RLOS EPS bearer context which was activated with request type "RLOS", or any dedicated EPS bearer context associated to this default EPS bearer context.


[Nm] {99} The label (S1 mode only) indicates that this subclause or paragraph applies only to a system which operates in S1 mode, i.e. with a functional division that is in accordance with the use of an S1 interface between the radio access network and the core network. The S1 mode includes WB-S1 mode and NB-S1 mode. In a multi-access system this case is determined by the current serving radio access network.


[Nm] {100} In NB-S1 mode: Indicates this paragraph applies only to a system which operates in NB-S1 mode. For a multi-access system this case applies if the current serving radio access network provides access to network services via E-UTRA by NB-IoT (see 3GPP TS 36.300 [20], 3GPP TS 36.331 [22], 3GPP TS 36.306 [44]).


[Nm] {101} In WB-S1 mode: Indicates this paragraph applies only to a system which operates in WB-S1 mode. For a multi-access system this case applies if the system operates in S1 mode, but not in NB-S1 mode.


[Nm] {102} In WB-S1/CE mode: Indicates this paragraph applies only when a UE, which is a CE mode B capable UE (see 3GPP TS 36.306 [44]), is operating in CE mode A or B in WB-S1 mode.


[Nm] {103} SCEF PDN Connection: A PDN connection established between the UE and the Service Capability Exposure Function (SCEF) for transmitting the UE's non-IP data related to a specific application.


[Nm] {104} SGi PDN Connection: A PDN connection established between the UE and the Packet Gateway (P-GW) for transmitting the UE's IP, non-IP or Ethernet data related to a specific application.


[Nm] {105} S101 mode: Applies to a system that operates with a functional division that is in accordance with the use of an S101 interface. For the definition of the S101 reference point, see 3GPP TS 23.402 [11].


[Nm] {106} SIPTO at the local network PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use SIPTO at the local network and it was activated such that the traffic of the PDN connection will be using an L-GW. The network authorizes an APN for using SIPTO at the local network based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a SIPTO at the local network PDN connection. SIPTO at the local network PDN connection can be of IP, non-IP or Ethernet PDN type.


[Nm] {107} SIPTO at the local network PDN connection with a collocated L-GW: A SIPTO at the local network PDN connection which is established to a L-GW function collocated with the (H)(e)NodeB. The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a collocated L-GW is used when the PDN connection is established.


[Nm] {108} SIPTO at the local network PDN connection with a stand-alone GW: A SIPTO at the local network PDN connection which is established to a stand-alone GW (with collocated L-GW and S-GW). The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a stand-alone GW is used when the PDN connection is established.


[Nm] {109} "SMS only": A subset of services which includes only Short Message Service. A UE camping on E-UTRAN can attach to both EPS services and "SMS only".


[Nm] {110} SMS over NAS: refers to SMS in MME or SMS over SGs. 


[Nm] {111} SMS over S102: refers to SMS which uses 1xCS procedures in EPS as defined in 3GPP TS 23.272 [9].


[Nm] {112} Subscribed APN based congestion control: Congestion control in mobility management where the network can reject attach requests from UEs with a certain APN in the subscription.


[Nm] {113} TAI list: A list of TAIs that identify the tracking areas that the UE can enter without performing a tracking area updating procedure. The TAIs in a TAI list assigned by an MME to a UE pertain to the same MME area.


[Nm] {114} Traffic flow aggregate: A temporary aggregate of packet filters that are included in a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure and that is inserted into a traffic flow template (TFT) for an EPS bearer context by the network once the UE requested bearer resource allocation procedure or UE requested bearer resource modification procedure is completed.


[Nm] {115} UE configured for dual priority: A UE which provides dual priority support is configured for NAS signalling low priority and also configured to override the NAS signalling low priority indicator (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]).


[Nm] {116} UE configured to use AC11 – 15 in selected PLMN: A UE configured with at least one access class in the range 11-15 on the USIM, and the access class is applicable in the selected PLMN according to 3GPP TS 22.011 [1A].


[Nm] {117} UE's availability for voice calls in the IMS: The indication of this availability or non-availability is provided by the upper layers of the UE as specified in 3GPP TS 24.229 [13D] in the annex relevant to the IP-Connectivity Access Network in use or determined in the NAS layer, as specified in subclause 4.3.1. If availability is indicated, the UE uses the IM CN Subsystem and can terminate or originate requests for SIP sessions including an audio component with codecs suited for voice.


[Nm] {118} UE's usage setting: This is a UE setting that indicates whether the UE has preference for voice services over data services or vice-versa. If a UE has preference for voice services, then the UE's usage setting is "voice centric". If a UE has preference for data services, then the UE's usage setting is "data centric". A UE whose setting is "data centric" may still require access to voice services. A UE whose setting is "voice centric" may still require access to data services. This definition is derived from 3GPP TS 23.221 [8A] and it applies to voice capable UEs. If the UE is capable of both S1 mode and N1 mode, there is a single UE's usage setting which applies to both 5GS and EPS (see 3GPP TS 24.501 [54]).


[Nm] {119} UE using EPS services with control plane CIoT EPS optimization: A UE that is attached for EPS services with the control plane CIOT EPS optimization accepted by the network.


[Nm] {120} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.221 [8A] apply:


[Nm] {121} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.401 [10] apply:


[Nm] {122} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.272 [9] apply:


[Nm] {123} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.682 [11A] apply:


[Nm] {124} For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.008 [13] apply:


[Nm] {125} For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.102 [18] apply:


[Nm] {126} For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.401 [19] apply:


[Nm] {127} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [6] apply:


[Nm] {128} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.216 [8] apply:


[Nm] {129} For the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 [1A] apply:


[Nm] {130} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.003 [10] apply:


[Nm] {131} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.303 [31] apply:


[Nm] {132} For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.161 [36] apply:


[Nm] {133} For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.167 [45] apply:


[Nm] {134} For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.501 [54] apply:


[H2] {135} 3.2	Abbreviations


[Nm] {136} For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].


[H1] {137} 4	General


[H2] {138} 4.1	Overview


[Nm] {139} The non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and MME at the radio interface (reference point "LTE-Uu"; see 3GPP TS 23.401 [10]).


[Nm] {140} Main functions of the protocols that are part of the NAS are:


	[B1] {141} -	the support of mobility of the user equipment (UE); and


	[B1] {142} -	the support of session management procedures to establish and maintain IP connectivity between the UE and a packet data network gateway (PDN GW).


[Nm] {143} NAS security is an additional function of the NAS providing services to the NAS protocols, e.g. integrity protection and ciphering of NAS signalling messages.


[Nm] {144} For the support of the above functions, the following procedures are supplied within this specification:


	[B1] {145} -	elementary procedures for EPS mobility management in clause 5; and


	[B1] {146} -	elementary procedures for EPS session management in clause 6.


[Nm] {147} Complete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP TS 23.401 [10].


[Nm] {148} The NAS for EPS follows the protocol architecture model for layer 3 as described in 3GPP TS 24.007 [12]; however, due to the objective of EPS to provide the subscriber with a "ready-to-use" IP connectivity and an "always-on" experience, the protocol supports a linkage between mobility management and session management procedures during the attach procedure (see subclause 4.2).


[Nm] {149} Signalling procedures for the control of NAS security are described as part of the EPS mobility management in clause 5. In addition to that, principles for the handing of EPS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in subclause 4.4.


[H2] {150} 4.2	Linkage between the protocols for EPS mobility management and EPS session management


[Nm] {151} During the EPS attach procedure, the network can activate a default EPS bearer context (i.e. if the UE requests PDN connectivity in the attach request). Additionally, the network can activate one or several dedicated EPS bearer contexts in parallel for PDN connections of IP or Ethernet PDN type. To this purpose the EPS session management messages for the default EPS bearer context activation can be transmitted in an information element in the EPS mobility management messages. In this case, the UE and the network execute the attach procedure, the default EPS bearer context activation procedure, and the dedicated EPS bearer context activation procedure in parallel. The UE and network shall complete the combined default EPS bearer context activation procedure and the attach procedure before the dedicated EPS bearer context activation procedure is completed. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the success of the attach procedure is dependent on the success of the default EPS bearer context activation procedure. If the attach procedure fails, then the ESM procedures also fail.


[Nm] {152} A UE using EPS services with control plane CIoT EPS optimization can initiate transport of user data via the control plane. For this purpose a UE in EMM-IDLE mode can initiate the service request procedure and transmit the ESM DATA TRANSPORT message in an information element in the CONTROL PLANE SERVICE REQUEST message.


[Nm] {153} Except for the attach procedure and the service request procedure, during EMM procedures the MME shall suspend the transmission of ESM messages. During the service request procedure the MME may suspend the transmission of ESM messages.


[Nm] {154} Except for the attach procedure and the service request procedure for UE initiated transport of user data via the control plane, during EMM procedures the UE shall suspend the transmission of ESM messages.


[H2] {155} 4.2A	Handling of NAS signalling low priority indication


[Nm] {156} A UE configured for NAS signalling low priority (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]) indicates this by including the Device properties IE in the appropriate NAS message and setting the low priority indicator to "MS is configured for NAS signalling low priority", except for the following cases in which the UE shall set the low priority indicator to "MS is not configured for NAS signalling low priority":


	[B1] {157} -	the UE is performing an attach for emergency bearer services;


	[B1] {158} -	the UE has a PDN connection for emergency bearer services established and is performing EPS mobility management procedures, or is establishing a PDN connection for emergency bearer services;


	[B1] {159} -	the UE configured for dual priority is requested by the upper layers to establish a PDN connection with the low priority indicator set to "MS is not configured for NAS signalling low priority";


	[B1] {160} -	the UE configured for dual priority is performing EPS session management procedures related to the PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority";


	[B1] {161} -	the UE configured for dual priority has a PDN connection established by setting the low priority indicator to "MS is not configured for NAS signalling low priority" and is performing EPS mobility management procedures;


	[B1] {162} -	the UE is performing a service request procedure for a CS fallback emergency call or 1xCS fallback emergency call;


	[B1] {163} -	the UE is a UE configured to use AC11 – 15 in selected PLMN; or


	[B1] {164} -	the UE is responding to paging.


[Nm] {165} The network may use the NAS signalling low priority indication for NAS level mobility management congestion control and APN based congestion control.


[Nm] {166} If the NAS signalling low priority indication is provided in a PDN CONNECTIVITY REQUEST message, the MME stores the NAS signalling low priority indication within the default EPS bearer context activated due to the PDN connectivity request procedure.


[H2] {167} 4.3	UE mode of operation


[H3] {168} 4.3.1	General


[Nm] {169} A UE attached for EPS services shall operate in one of the following operation modes:


	[B1] {170} -	PS mode 1 of operation: the UE registers only to EPS services, and UE's usage setting is "voice centric";


	[B1] {171} -	PS mode 2 of operation: the UE registers only to EPS services, and UE's usage setting is "data centric";


	[B1] {172} -	CS/PS mode 1 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "voice centric"; and


	[B1] {173} -	CS/PS mode 2 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "data centric".


[Nm] {174} A UE configured to use CS fallback, shall operate in CS/PS mode 1 or CS/PS mode 2. Such UE may also be configured to use IMS, in which case the voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] shall be used for the selection of the domain for originating voice communication services.


[Nm] {175} Upon request from upper layers to establish a CS emergency call:


	[B1] {176} -	if the UE needs to initiate a CS fallback emergency call but it is unable to perform CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology, and a UE with "IMS voice not available" should disable the E-UTRA capability (see subclause 4.5) to allow a potential callback, and then progress the CS emergency call establishment;


	[B1] {177} -	if the UE needs to initiate a 1xCS fallback emergency call but it is unable to perform 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology to establish the call.


[Nm] {178} A UE configured to use SMS over SGs shall operate in CS/PS mode 1 or CS/PS mode 2.


[Nm] {179} The behaviour of the UE in CS/PS mode 1 of operation, upon failure to access the CS domain or upon reception of a "CS fallback not preferred" or "SMS only" indication, will depend on the availability of voice over IMS. In the present document, "IMS voice not available" refers to one of the following conditions:


	[B1] {180} a)	the UE is not configured to use IMS;


	[B1] {181} b)	the UE is not configured to use IMS voice, i.e. when the voice domain preference for E-UTRAN, as defined in 3GPP TS 24.167 [13B], indicates that voice communication services are allowed to be invoked only over the CS domain;


	[B1] {182} c)	the UE is configured to use IMS voice, but the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are not supported; or


	[B1] {183} d)	the UE is configured to use IMS voice, the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are supported, but the upper layers:


		[B2] {184} -	provide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or


		[B2] {185} -	indicate that the UE is not available for voice calls in the IMS.


[Nm] {186} Other conditions may exist but these are implementation specific.


[Nm] {187} In the present document, "IMS voice available" refers to the conditions a, b, c and d, and other implementation specific conditions for "IMS voice not available" evaluate to false.


[H3] {188} 4.3.2	Change of UE mode of operation


[H4] {189} 4.3.2.1	General


[Nm] {190} The UE mode of operation can change as a result of e.g.:


	[B1] {191} -	a change of UE's usage setting for a CS voice capable UE;


	[B1] {192} -	a change of voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] for a CS voice capable UE;


	[B1] {193} -	a change in the UE's availability for voice calls in the IMS; or


	[B1] {194} -	a change in UE configuration regarding the use of SMS as defined in 3GPP TS 24.167 [13B].


[Nm] {195} Figure 4.3.2.1.1 and figure 4.3.2.1.2 illustrate the transitions between different UE mode of operations when UE's usage settings, voice domain preference for E-UTRAN or configuration regarding SMS changes.


[H4] {196} 4.3.2.2	Change of UE's usage setting


[Nm] {197} Whenever the UE's usage setting changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.2.1 and table 4.3.2.2.2:


	[B1] {198} a)	The UE is operating in PS mode 1 or PS mode 2


	[B1] {199} b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2


[H4] {200} 4.3.2.3	Change of voice domain preference for E-UTRAN


[Nm] {201} Whenever the voice domain preference for E-UTRAN changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.3.1 and table 4.3.2.3.2:


	[B1] {202} a)	The UE is operating in PS mode 1 or PS mode 2


	[B1] {203} b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2


[H4] {204} 4.3.2.4	Change or determination of IMS registration status


[Nm] {205} Whenever the UE's availability for voice calls in the IMS is determined or changes (e.g. whenever the IMS registration status is determined or changes), the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.4.1, 4.3.2.4.2 or 4.3.2.4.3:


	[B1] {206} a)	The UE is operating in PS mode 1


	[B1] {207} b)	The UE is operating in PS mode 2


	[B1] {208} c)	The UE is operating in CS/PS mode 1


[H4] {209} 4.3.2.5	Change of configuration regarding the use of SMS.


[Nm] {210} Whenever the UE's configuration on use of SMS changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.5.1 and table 4.3.2.5.2:


	[B1] {211} a)	The UE is operating in PS mode 1 or PS mode 2


	[B1] {212} b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2


[H2] {213} 4.4	NAS security


[H3] {214} 4.4.1	General


[Nm] {215} This clause describes the principles for the handling of EPS security contexts in the UE and in the MME and the procedures used for the security protection of EPS NAS messages between UE and MME. Security protection involves integrity protection and ciphering of the EMM and ESM NAS messages.


[Nm] {216} The signalling procedures for the control of NAS security are part of the EMM protocol and are described in detail in clause 5.


[H3] {217} 4.4.2	Handling of EPS security contexts


[H4] {218} 4.4.2.1	General


[Nm] {219} The security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP TS 33.401 [19].


[Nm] {220} Before security can be activated, the MME and the UE need to establish an EPS security context. Usually, the EPS security context is created as the result of an EPS authentication procedure between MME and UE. Alternatively:


	[B1] {221} -	during inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode; or


	[B1] {222} -	during CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a CS UMTS security context that has been established while the UE was in A/Gb mode or Iu mode.


[Nm] {223} The EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context. This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.


[Nm] {224} The key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. When the EPS security context is a native EPS security context, the eKSI has the value of KSIASME, and when the current EPS security context is of type mapped, the eKSI has the value of KSISGSN.


[Nm] {225} The EPS security context which is indicated by an eKSI can be taken into use to establish the secure exchange of NAS messages when a new NAS signalling connection is established without executing a new EPS authentication procedure (see subclause 4.4.2.3) or when the MME initiates a security mode control procedure. For this purpose the initial NAS messages (i.e. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST, EXTENDED SERVICE REQUEST, and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message.


[Nm] {226} In the present document, when the UE is required to delete an eKSI, the UE shall set the eKSI to the value "no key is available" and consider also the associated keys KASME or K'ASME, EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid).


[Nm] {227} The UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since:


	[B1] {228} -	after an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non-current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and


	[B1] {229} -	after an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.


[Nm] {230} The number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements:


	[B1] {231} -	After a successful EPS (re-)authentication, which creates a new partial native EPS security context, the MME and the UE shall delete the non-current EPS security context, if any.


	[B1] {232} -	When a partial native EPS security context is taken into use through a security mode control procedure, the MME and the UE shall delete the previously current EPS security context.


	[B1] {233} -	When the MME and the UE create an EPS security context using null integrity and null ciphering algorithm during an attach procedure for emergency bearer services, or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services (see subclause 5.4.3.2), the MME and the UE shall delete the previous current EPS security context.


	[B1] {234} -	When a new mapped EPS security context or EPS security context created using null integrity and null ciphering algorithm is taken into use during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall not delete the previously current native EPS security context, if any. Instead, the previously current native EPS security context shall become a non-current native EPS security context, and the MME and the UE shall delete any partial native EPS security context.


	[B1] {235} 	If no previously current native EPS security context exists, the MME and the UE shall not delete the partial native EPS security context, if any.


	[B1] {236} -	When the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall delete any existing current mapped EPS security context.


	[B1] {237} -	When a non-current full native EPS security context is taken into use by a security mode control procedure, then the MME and the UE shall delete the previously current mapped EPS security context.


	[B1] {238} -	When the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the non-current EPS security context shall become the current EPS security context. Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context.


[Nm] {239} The UE shall mark the EPS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an attach procedure as described in subclause 5.5.1 or when the UE leaves state EMM-DEREGISTERED for any other state except EMM-NULL.


[Nm] {240} The UE shall store the current native EPS security context as specified in annex C and mark it as valid only when the UE enters state EMM-DEREGISTERED from any other state except EMM-NULL or when the UE aborts the attach procedure without having left EMM-DEREGISTERED.


[H4] {241} 4.4.2.2	Establishment of a mapped EPS security context during intersystem handover


[Nm] {242} In order for the UE to derive a mapped EPS security context for an inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall generate a KSISGSN, create a nonceMME and generate the K'ASME using the created nonceMME as indicated in 3GPP TS 33.401 [19]. The MME shall include the selected NAS algorithms, nonceMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.


[Nm] {243} When the UE receives the command to perform handover to E-UTRAN, the UE shall derive K'ASME, as indicated in 3GPP TS 33.401 [19], using the nonceMME received in the NAS security transparent container. Furthermore, the UE shall associate the derived K'ASME with the received KSISGSN and derive the EPS NAS keys from K'ASME.


[Nm] {244} When the UE has a PDN connection for emergency bearer services and has no current UMTS security context, the MME shall set EIA0 and EEA0 as the selected NAS security algorithms in the NAS security transparent container for handover to E-UTRAN. The MME shall create a locally generated K'ASME. The MME shall set the KSI value of the associated security context to "000" and the type of security context flag to "mapped security context" in the NAS security transparent container for handover to E-UTRAN.


[Nm] {245} When the UE receives the command to perform handover to E-UTRAN and has a PDN connection for emergency bearer services, if EIA0 and EEA0 as the selected NAS security algorithms are included in the NAS security transparent container for handover to E-UTRAN, the UE shall create a locally generated K'ASME. The UE shall set the KSI value of the associated security context to the KSI value received.


[Nm] {246} If the inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode is not completed successfully, the MME and the UE shall delete the new mapped EPS security context.


[Nm] {247} The establishment of a mapped EPS security context during inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode is specified in 3GPP TS 24.501 [54] subclause 4.4.2.4.


[H4] {248} 4.4.2.3	Establishment of secure exchange of NAS messages


[Nm] {249} Secure exchange of NAS messages via a NAS signalling connection is usually established by the MME during the attach procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected using the current EPS security algorithms, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the current EPS security algorithms.


[Nm] {250} During inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, secure exchange of NAS messages is established between the MME and the UE by:


	[B1] {251} -	the transmission of NAS security related parameters encapsulated in the AS signalling from the MME to the UE triggering the inter-system handover (see 3GPP TS 33.401 [19]). The UE uses these parameters to generate the mapped EPS security context; and,


	[B1] {252} -	after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.


[Nm] {253} During inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, secure exchange of NAS messages is established between the MME and the UE by:


	[B1] {254} -	the transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system handover (see 3GPP TS 33.501 [56]). The UE uses these parameters to generate the mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 [56]); and


	[B1] {255} -	after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.


[Nm] {256} During inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE is operating in the single-registration mode and:


	[B1] {257} 1)	if the tracking area updating procedure is initiated as specified in 3GPP TS 24.501 [54], the UE shall transmit a TRACKING AREA UPDATE REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the TRACKING AREA UPDATE REQUEST message.


	[B1] {258} 	After receiving the TRACKING AREA UPDATE REQUEST message including the eKSI, the MME forwards the TRACKING AREA UPDATE REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:


		[B2] {259} -	replying with a TRACKING AREA UPDATE ACCEPT message that is integrity protected and ciphered using the mapped EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or


		[B2] {260} -	initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or


	[B1] {261} 2)	if the attach procedure is initiated as specified in 3GPP TS 24.501 [54] and:


		[B2] {262} a)	if the UE has received an "interworking without N26 interface not supported" indication from the network and the UE has a valid 5G NAS security context, the UE shall send an ATTACH REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the ATTACH REQUEST message.


		[B2] {263} 	After receiving the ATTACH REQUEST message including the eKSI, the MME forwards the ATTACH REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:


			[B3] {264} -	replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the mapped EPS NAS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or


			[B3] {265} -	initiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or


		[B2] {266} b)	otherwise:


			[B3] {267} i)	if the UE has a valid native EPS security context, the UE shall send an ATTACH REQUEST message integrity protected with the native EPS security context. The UE shall include the eKSI indicating the native EPS security context value in the ATTACH REQUEST message.


			[B3] {268} 	After receiving the ATTACH REQUEST message including the eKSI, the MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME re-establishes the secure exchange of NAS messages by either:


				[B4] {269} -	replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or


				[B4] {270} -	initiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or


			[B3] {271} ii)	if the UE has no valid native EPS security context, the UE shall send an ATTACH REQUEST message without integrity protection and encryption.


[Nm] {272} The secure exchange of NAS messages shall be continued after S1 mode to S1 mode handover. It is terminated after inter-system handover from S1 mode to A/Gb mode or Iu mode or when the NAS signalling connection is released.


[Nm] {273} When a UE in EMM-IDLE mode establishes a new NAS signalling connection and has a valid current EPS security context, secure exchange of NAS messages can be re-established in the following ways:


	[B1] {274} 1)	Except for the cases described in items 3 and 4 below, the UE shall transmit the initial NAS message integrity protected with the current EPS security context, but unciphered. The UE shall include the eKSI indicating the current EPS security context value in the initial NAS message. The MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME may re-establish the secure exchange of NAS messages:


		[B2] {275} -	by replying with a NAS message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or


		[B2] {276} -	by initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or


	[B1] {277} 2)	If the initial NAS message was a SERVICE REQUEST message or EXTENDED SERVICE REQUEST message, secure exchange of NAS messages is triggered by the indication from the lower layers that the user plane radio bearers are successfully set up. After successful completion of the procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered.


	[B1] {278} 3)	If the UE has no current EPS security context and performs a tracking area updating procedure after an inter-system change in idle mode from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE shall send the TRACKING AREA UPDATE REQUEST message without integrity protection and encryption. The UE shall include a nonce and a GPRS ciphering key sequence number for creation of a mapped EPS security context. The MME creates a fresh mapped EPS security context and takes this context into use by initiating a security mode control procedure and this context becomes the current EPS security context in both the UE and the MME. This re-establishes the secure exchange of NAS messages.


	[B1] {279} 4)	If the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, the UE shall send the message integrity protected. If an ESM message container information element or a NAS message container information element is included the message shall be sent partially ciphered (see subclause 4.4.5) , otherwise the message shall be sent unciphered. Secure exchange of NAS messages is re-established in the UE:


		[B2] {280} -	by the indication from the lower layers that the user plane radio bearers are successfully set up;


		[B2] {281} -	upon receipt of a NAS message (e.g. a SERVICE ACCEPT message or ESM DATA TRANSPORT message) that is integrity protected and ciphered using the current EPS security context; or


		[B2] {282} -	upon receipt of a SECURITY MODE COMMAND message that has successfully passed the integrity check.


[H4] {283} 4.4.2.4	Change of security keys


[Nm] {284} When the MME initiates a re-authentication to create a new EPS security context, the messages exchanged during the authentication procedure are integrity protected and ciphered using the current EPS security context, if any.


[Nm] {285} Both UE and MME shall continue to use the current EPS security context, until the MME initiates a security mode control procedure. The SECURITY MODE COMMAND message sent by the MME includes the eKSI of the new EPS security context to be used. The MME shall send the SECURITY MODE COMMAND message integrity protected with the new EPS security context, but unciphered. When the UE responds with a SECURITY MODE COMPLETE, it shall send the message integrity protected and ciphered with the new EPS security context.


[Nm] {286} The MME can also modify the current EPS security context or take the non-current native EPS security context, if any, into use, by sending a SECURITY MODE COMMAND message including the eKSI of the EPS security context to be modified and including a new set of selected NAS security algorithms. In this case the MME shall send the SECURITY MODE COMMAND message integrity protected with the modified EPS security context, but unciphered. When the UE replies with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the modified EPS security context.


[H4] {287} 4.4.2.5	Derivation of keys at CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode


[Nm] {288} At change from A/Gb mode to S1 mode or from Iu mode to S1 mode due to CS to PS SRVCC handover (see 3GPP TS 23.216 [8]), the UE shall derive a mapped EPS security context for the PS domain from the UMTS security context for the CS domain.


[Nm] {289} At change from A/Gb mode to S1 mode due to CS to PS SRVCC handover, ciphering may be started and integrity protection shall be started (see 3GPP TS 36.331 [22]) without any new authentication procedure.


[Nm] {290} In order to derive a mapped EPS security context for a CS to PS SRVCC handover from A/Gb mode or Iu mode to S1 mode, the MSC creates a NONCEMSC and generates the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the created NONCEMSC as specified in annex B.6 in 3GPP TS 33.102 [18]. The MSC associates the CK'PS and IK'PS with a KSI'PS. The KSI'PS is set to the value of the KSICS associated with the CS UMTS integrity key and the CS UMTS ciphering key. The MSC transfers the CK'PS, IK'PS and the KSI'PS to the MME. The MME shall create a mapped EPS security context by setting the K'ASME to the concatenation of the CK'PS and IK'PS received from the MSC (i.e. CK'PS || IK'PS). The MME shall associate the K'ASME with a KSISGSN. The MME shall set KSISGSN to the value of the KSI'PS received from the MSC. The MME shall include the selected NAS algorithms, NONCEMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for the handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.


[Nm] {291} When the UE receives the command to perform CS to PS SRVCC handover to S1 mode, the ME shall generate the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the received NONCEMSC value in the transparent container in the CS to PS SRVCC handover command as specified in annex B.6 in 3GPP TS 33.102 [18]. The ME shall ignore the NONCEMME value received in the NAS Security Transparent Container in the CS to PS SRVCC handover command.


[Nm] {292} The ME shall create the key K'ASME by concatenating the derived CK'PS and IK'PS (i.e. CK'PS || IK'PS.). The ME shall associate the derived key K'ASME with a KSISGSN.The ME shall set the KSISGSN associated to K'ASME to the KSISGSN value received in the NAS Security Transparent Container from the network.


[Nm] {293} The ME shall derive the EPS NAS keys (CK' and IK') from the K'ASME as specified in 3GPP TS 33.401 [19]. The ME shall apply these derived EPS NAS security keys (CK' and IK'), reset the uplink and downlink NAS COUNT values for the mapped EPS security context (i.e. to the value 0), and replace an already established mapped EPS security context for the PS domain, if any, in the ME, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the ME.


[Nm] {294} The network shall replace an already established mapped EPS security context for the PS domain, if any, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the MME.


[Nm] {295} If the CS to PS SRVCC handover from A/Gb mode or Iu mode has not been completed successfully, the UE and the network shall delete the new derived mapped EPS security context for the PS domain. Additionally, the network shall delete an already established mapped EPS security context for the PS domain, if any, if the eKSI of the already established EPS security context is equal to the KSISGSN of the new derived EPS security context for the PS domain.


[H3] {296} 4.4.3	Handling of NAS COUNT and NAS sequence number


[H4] {297} 4.4.3.1	General


[Nm] {298} Each EPS security context shall be associated with two separate counters NAS COUNT: one related to uplink NAS messages and one related to downlink NAS messages. The NAS COUNT counters use 24 bit internal representation and are independently maintained by UE and MME. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).


[Nm] {299} When NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits.


[Nm] {300} The value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the value that shall be used in the next NAS message.


[Nm] {301} The value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.


[Nm] {302} The NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the MME as part of the NAS signalling. After each new or retransmitted outbound security protected NAS message, the sender shall increase the NAS COUNT number by one, except for the initial NAS messages if the lower layers indicated the failure to establish the RRC connection (see 3GPP TS 36.331 [22]). Specifically, on the sender side, the NAS sequence number shall be increased by one, and if the result is zero (due to wrap around), the NAS overflow counter shall also be incremented by one (see subclause 4.4.3.5). The receiving side shall estimate the NAS COUNT used by the sending side. Specifically, if the estimated NAS sequence number wraps around, the NAS overflow counter shall be incremented by one.


[Nm] {303} After the derivation of a NAS token due to an inter-system change from S1mode to A/Gb mode or Iu mode in idle mode as specified in 3GPP TS 24.008 [13], the UE shall increase the uplink NAS COUNT by one.


[Nm] {304} When the MME receives a NAS token via SGSN during an idle mode inter-system change from S1 mode to A/Gb mode or Iu mode, the MME shall check the NAS token as specified in 3GPP TS 33.401 [19], subclause 9.1.1, and update its uplink NAS COUNT with the uplink NAS COUNT value used for the successful check of the NAS token.


[Nm] {305} During the handover from UTRAN/GERAN to E-UTRAN, when a mapped EPS security context is derived and taken into use, the MME shall set both the uplink and downlink NAS COUNT counters of this EPS security context to zero. The UE shall set both the uplink and downlink NAS COUNT counters to zero.


[Nm] {306} When a mapped EPS security context is derived as specified in 3GPP TS 33.501 [56] and taken into use during the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode, the MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively.


[Nm] {307} When a mapped EPS security context is derived as specified in 3GPP TS 33.501 [56] and taken into use during the inter-system change from N1 mode to S1 mode in EMM-IDLE mode for the UE operating in single-registration mode in a network supporting N26 interface, the MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively.


[Nm] {308} During the handover from E-UTRAN to UTRAN/GERAN the MME signals the current downlink NAS COUNT value in a NAS security transparent container (see subclause 9.9.2.6).


[Nm] {309} During handover to or from E-UTRAN, the MME shall increment downlink NAS COUNT by one after it has created a NAS security transparent container (see subclause 9.9.2.6 and 9.9.2.7).


[Nm] {310} In some NAS messages only 5 of the 8 NAS sequence number bits are transmitted. When this is the case, the receiver shall estimate the remaining 3 most significant bits of the sequence number.


[H4] {311} 4.4.3.2	Replay protection


[Nm] {312} Replay protection shall be supported for received NAS messages both in the MME and the UE. However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation.


[Nm] {313} Replay protection must assure that one and the same NAS message is not accepted twice by the receiver. Specifically, for a given EPS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly.


[Nm] {314} Replay protection is not applicable when EIA0 is used.


[H4] {315} 4.4.3.3	Integrity protection and verification


[Nm] {316} The sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm.


[Nm] {317} The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.


[Nm] {318} The algorithm to calculate the integrity protection information is specified in 3GPP TS 33.401 [19], and the integrity protection shall include octet 6 to n of the security protected NAS message, i.e. the sequence number IE and the NAS message IE. The integrity protection of the SERVICE REQUEST message is defined in subclause 9.9.3.28. In addition to the data that is to be integrity protected, the constant BEARER ID, DIRECTION bit, NAS COUNT and NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP TS 33.401 [19].


[Nm] {319} After successful integrity protection validation, the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message.


[Nm] {320} Integrity verification is not applicable when EIA0 is used.


[H4] {321} 4.4.3.4	Ciphering and deciphering


[Nm] {322} The sender shall use its locally stored NAS COUNT as input to the ciphering algorithm.


[Nm] {323} The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the deciphering algorithm.


[Nm] {324} The input parameters to the NAS ciphering algorithm are the constant BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm. When an initial plain NAS message for transport of user data via control plane (i.e. CONTROL PLANE SERVICE REQUEST message) is to be partially ciphered, the length of the key stream is set to the length of the part of the initial plain NAS message (i.e. the value part of the ESM message container IE or the value part of the NAS message container) that is to be ciphered.


[H4] {325} 4.4.3.5	NAS COUNT wrap around


[Nm] {326} If, when increasing the NAS COUNT as specified above, the MME detects that either its downlink NAS COUNT or the UE's uplink NAS COUNT is "close" to wrap around, (close to 224), the MME shall take the following actions:


	[B1] {327} -	If there is no non-current native EPS security context with sufficiently low NAS COUNT values, the MME shall initiate a new AKA procedure with the UE, leading to a new established EPS security context and the NAS COUNT being reset to 0 in both the UE and the MME when the new EPS security context is activated;


	[B1] {328} -	Otherwise, the MME can activate a non-current native EPS security context with sufficiently low NAS COUNT values or initiate a new AKA procedure as specified above.


[Nm] {329} If for some reason a new KASME has not been established using AKA before the NAS COUNT wraps around, the node (MME or UE) in need of sending a NAS message shall instead release the NAS signalling connection. Prior to sending the next uplink NAS message, the UE shall delete the eKSI indicating the current EPS security context.


[Nm] {330} When the EIA0 is used as the NAS integrity algorithm, the UE and the MME shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the following requirements apply:


	[B1] {331} -	the UE and the MME shall continue to use the current security context;


	[B1] {332} -	the MME shall not initiate the EPS AKA procedure;


	[B1] {333} -	the MME shall not release the NAS signalling connection; and


	[B1] {334} -	the UE shall not perform a local release of the NAS signalling connection.


[H3] {335} 4.4.4	Integrity protection of NAS signalling messages


[H4] {336} 4.4.4.1	General


[Nm] {337} For the UE, integrity protected signalling is mandatory for the NAS messages once a valid EPS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the NAS messages once a secure exchange of NAS messages has been established for the NAS signalling connection. Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.


[Nm] {338} The use of "null integrity protection algorithm" EIA0 (see subclause 9.9.3.23) in the current security context is only allowed for an unauthenticated UE for which establishment of emergency bearer services or access to RLOS is allowed. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null integrity protection algorithm" or any other integrity protection algorithm is indicated in the security context.


[Nm] {339} If the "null integrity protection algorithm" EIA0 has been selected as a integrity protection algorithm, the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected.


[Nm] {340} Details of the integrity protection and verification of NAS signalling messages are specified in 3GPP TS 33.401 [19].


[Nm] {341} When a NAS message needs to be sent both ciphered and integrity protected, the NAS message is first ciphered and then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. The same applies when an initial NAS message needs to be sent partially ciphered and integrity protected.


[Nm] {342} When a NAS message needs to be sent only integrity protected and unciphered, the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.


[Nm] {343} When during the EPS attach procedure or service request procedure an ESM message is piggybacked in an EMM message, there is only one sequence number IE and one message authentication code IE, if any, for the combined NAS message.


[H4] {344} 4.4.4.2	Integrity checking of NAS signalling messages in the UE


[Nm] {345} Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the UE or forwarded to the ESM entity, unless the network has established secure exchange of NAS messages for the NAS signalling connection. The messages are:


	[B1] {346} -	EMM messages:


		[B2] {347} -	IDENTITY REQUEST (if requested identification parameter is IMSI);


		[B2] {348} -	AUTHENTICATION REQUEST;


		[B2] {349} -	AUTHENTICATION REJECT;


		[B2] {350} -	ATTACH REJECT (if the EMM cause is not #25);


		[B2] {351} -	DETACH ACCEPT (for non switch off);


		[B2] {352} -	TRACKING AREA UPDATE REJECT (if the EMM cause is not #25);


		[B2] {353} -	SERVICE REJECT (if the EMM cause is not #25).


[Nm] {354} All ESM messages are integrity protected.


[Nm] {355} Once the secure exchange of NAS messages has been established, the receiving EMM or ESM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in subclause 5.4.3.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.


[H4] {356} 4.4.4.3	Integrity checking of NAS signalling messages in the MME


[Nm] {357} Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the MME or forwarded to the ESM entity, unless the secure exchange of NAS messages has been established for the NAS signalling connection. The messages are:


	[B1] {358} -	EMM messages:


		[B2] {359} -	ATTACH REQUEST;


		[B2] {360} -	IDENTITY RESPONSE (if requested identification parameter is IMSI);


		[B2] {361} -	AUTHENTICATION RESPONSE;


		[B2] {362} -	AUTHENTICATION FAILURE;


		[B2] {363} -	SECURITY MODE REJECT;


		[B2] {364} -	DETACH REQUEST;


		[B2] {365} -	DETACH ACCEPT;


		[B2] {366} -	TRACKING AREA UPDATE REQUEST.


[Nm] {367} All ESM messages are integrity protected except a PDN CONNECTIVITY REQUEST message if it is sent piggybacked in ATTACH REQUEST message and NAS security is not activated.


[Nm] {368} Once a current EPS security context exists, until the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM entity in the MME shall process the following NAS signalling messages, even if the MAC included in the message fails the integrity check or cannot be verified, as the EPS security context is not available in the network:


		[B2] {369} -	ATTACH REQUEST;


		[B2] {370} -	IDENTITY RESPONSE (if requested identification parameter is IMSI);


		[B2] {371} -	AUTHENTICATION RESPONSE;


		[B2] {372} -	AUTHENTICATION FAILURE;


		[B2] {373} -	SECURITY MODE REJECT;


		[B2] {374} -	DETACH REQUEST;


		[B2] {375} -	DETACH ACCEPT;


		[B2] {376} -	TRACKING AREA UPDATE REQUEST;


		[B2] {377} -	SERVICE REQUEST;


		[B2] {378} -	EXTENDED SERVICE REQUEST;


		[B2] {379} -	CONTROL PLANE SERVICE REQUEST.


[Nm] {380} If an ATTACH REQUEST message is received without integrity protection or fails the integrity check and it is not an attach request for emergency bearer services and it is not an attach request for access to RLOS, the MME shall authenticate the subscriber before processing the attach request any further. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in subclause 5.4.3.2. For the case when the attach procedure is for emergency bearer services see subclause 5.5.1.2.3 and subclause 5.4.2.5.


[Nm] {381} If a DETACH REQUEST message fails the integrity check, the MME shall proceed as follows:


	[B1] {382} -	If it is not a detach request due to switch off, and the MME can initiate an authentication procedure, the MME should authenticate the subscriber before processing the detach request any further.


	[B1] {383} -	If it is a detach request due to switch off, or the MME does not initiate an authentication procedure for any other reason, the MME may ignore the detach request and remain in state EMM-REGISTERED.


[Nm] {384} If a TRACKING AREA UPDATE REQUEST message is received without integrity protection or fails the integrity check and the UE provided a nonceUE, GPRS ciphering key sequence number, P-TMSI and RAI in the TRACKING AREA UPDATE REQUEST message, the MME shall initiate a security mode control procedure to take a new mapped EPS security context into use; otherwise, if the UE has only a PDN connection for non-emergency bearer services established and the PDN connection is not for RLOS, the MME shall initiate an authentication procedure. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in subclause 5.4.3.2. For the case when the UE has a PDN connection for emergency bearer services or for RLOS see subclause 5.5.3.2.3 and subclause 5.4.2.5.


[Nm] {385} If a SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check and the UE has only PDN connections for non-emergency bearer services established and the PDN connections are not for RLOS, the MME shall send the SERVICE REJECT message with EMM cause #9 "UE identity cannot be derived by the network" and keep the EMM-context and EPS security context unchanged. For the case when the UE has a PDN connection for emergency bearer services or RLOS and integrity check fails, the MME may skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3. After successful completion of the service request procedure, the network shall deactivate all non-emergency EPS bearers locally which are not EPS bearers for RLOS. The emergency EPS bearers shall not be deactivated. The network may deactivate the EPS bearers for RLOS.


[Nm] {386} Once the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM or ESM entity in the MME shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If any NAS signalling message, having not successfully passed the integrity check, is received, then the NAS in the MME shall discard that message. If any NAS signalling message is received, as not integrity protected even though the secure exchange of NAS messages has been established, then the NAS shall discard this message.


[H3] {387} 4.4.5	Ciphering of NAS signalling messages


[Nm] {388} The use of ciphering in a network is an operator option subject to MME configuration. When operation of the network without ciphering is configured, the MME shall indicate the use of "null ciphering algorithm" EEA0 (see subclause 9.9.3.23) in the current security context for all UEs. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null ciphering algorithm" or any other ciphering algorithm is indicated in the security context.


[Nm] {389} When the UE establishes a new NAS signalling connection, it shall send the initial NAS message


	[B1] {390} -	partially ciphered, if it is a CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element; and


	[B1] {391} -	unciphered, if it is any other initial NAS message.


[Nm] {392} The UE shall partially cipher the CONTROL PLANE SERVICE REQUEST message by ciphering the value part of the ESM message container IE or the value part of the NAS message container, using the ciphering algorithm of the current EPS security context.


[Nm] {393} The UE shall send the ATTACH REQUEST message always unciphered.


[Nm] {394} The UE shall send the TRACKING AREA UPDATE REQUEST message always unciphered.


[Nm] {395} Except for the CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element, the UE shall start the ciphering and deciphering of NAS messages when the secure exchange of NAS messages has been established for a NAS signalling connection. From this time onward, unless explicitly defined, the UE shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.


[Nm] {396} The MME shall start ciphering and deciphering of NAS messages as described in subclause 4.4.2.3. From this time onward, except for the SECURITY MODE COMMAND message, the MME shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.


[Nm] {397} Once the encryption of NAS messages has been started between the MME and the UE, the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification. The MME shall discard any CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element which has not been partially ciphered according to the rules described above.


[Nm] {398} If the "null ciphering algorithm" EEA0 has been selected as a ciphering algorithm, the NAS messages with the security header indicating ciphering are regarded as ciphered.


[Nm] {399} Details of ciphering and deciphering of NAS signalling messages are specified in 3GPP TS 33.401 [19].


[H2] {400} 4.5	Disabling and re-enabling of UE's E-UTRA capability


[Nm] {401} The UE shall only disable the E-UTRA capability when in EMM-IDLE mode.


[Nm] {402} When the UE supports both N1 mode and S1 mode then the UE's capability to access the 5GCN via E-UTRA shall not be affected, if the UE's E-UTRA capability is disabled or enabled.


[Nm] {403} When the UE is disabling the E-UTRA capability not due to redirection to 5GCN required, it should proceed as follows:


	[B1] {404} a)	select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;


	[B1] {405} b)	if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN. If disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE may re-enable the E-UTRA capability for this PLMN selection; or


	[B1] {406} c)	if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the E-UTRA capability and remain registered for EPS services in E-UTRAN of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.


[Nm] {407} When the UE is disabling the E-UTRA capability upon receiving reject cause #31 "Redirection to 5GCN required" as specified in subclauses 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5, it should proceed as follows:


	[B1] {408} i)	If the UE is in NB-S1 mode:


		[B2] {409} 1)	if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable NB-IoT cell connected to 5GCN according to 3GPP TS 36.304 [21];


		[B2] {410} 2)	if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 [54] subclause 4.8.4A.1; or


		[B2] {411} 3)	if lower layers cannot find a suitable NB-IoT cell connected to 5GCN or there is no suitable NB-IoT cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE may re-enable the E-UTRA capability, and indicate to lower layers to remain camped in E-UTRA connected to EPC of the previously registered PLMN and proceed with the appropriate EMM procedure.


	[B1] {412} ii)	If the UE is in WB-S1 mode:


		[B2] {413} 1)	if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable E-UTRA cell connected to 5GCN according to 3GPP TS 36.304 [21];


		[B2] {414} 2)	if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 [54] subclause 4.8.4A.1; or


		[B2] {415} 3)	if lower layers cannot find a suitable E-UTRA cell connected to 5GCN or there is no suitable E-UTRA cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE may re-enable the E-UTRA capability, and indicate to lower layers to remain camped in E-UTRA connected to EPC of the previously registered PLMN and proceed with the appropriate EMM procedure.


[Nm] {416} The UE shall re-enable the E-UTRA capability when performing a PLMN selection unless:


	[B1] {417} -	the disabling of E-UTRA capability was due to UE initiated detach procedure for EPS services only; or


	[B1] {418} -	the UE has already re-enabled the E-UTRA capability when performing bullets b) or c) above.


[Nm] {419} If due to handover, the UE moves to a new PLMN in A/Gb, Iu, or N1 mode which is not in the list of equivalent PLMNs and not a PLMN memorized by the UE for which E-UTRA capability was disabled, and the disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE shall re-enable the E-UTRA capability after the RR/RRC connection is released.


[Nm] {420} If UE that has disabled its E-UTRA capability due to IMS voice not available and CS fallback not available re-enables it when PLMN selection is performed, then it should memorize the identity of the PLMNs where E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].


[Nm] {421} If the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled and if the UE receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "E-UTRAN not allowed", then the UE shall disable the E-UTRA capability, memorize the identity of the PLMN where the E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].


[Nm] {422} When the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, the UE shall disable the E-UTRA capability and:


	[B1] {423} -	The UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP TS 24.008 [13], subclause 10.5.1.7), the PS inter-RAT HO from GERAN to E-UTRAN S1 mode capability bit and the ISR support bit of the MS network capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN;


	[B1] {424} -	the UE shall use the same value of the EPC capability bit of the MS network capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message; and


	[B1] {425} -	the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.


[Nm] {426} When the UE supporting N1 mode together with S1 mode needs to stay in N1 mode, in order to prevent unwanted handover or cell reselection from NG-RAN to E-UTRAN, the UE shall disable the E-UTRA capability and:


	[B1] {427} -	the UE shall set the S1 mode bit to "S1 mode not supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message (see 3GPP TS 24.501 [54]);


	[B1] {428} -	the UE shall not include the S1 UE network capability IE in the REGISTRATION REQUEST message (see 3GPP TS 24.501 [54]); and


	[B1] {429} -	the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.


[Nm] {430} If the UE is disabling its E-UTRA capability before selecting to GERAN, UTRAN or NG-RAN radio access technology, the UE shall not perform the detach procedure of subclause 5.5.2.1.


[Nm] {431} If the UE is required to disable the E-UTRA capability and select GERAN, UTRAN or NG-RAN radio access technology, and the UE is in the EMM-CONNECTED mode:


	[B1] {432} -	if the UE has a persistent EPS bearer context and the ongoing prodedure is not a detach procedure, then the UE shall wait until the radio bearer associated with the persistent EPS bearer context has been released;


	[B1] {433} -	otherwise, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN, UTRAN or NG-RAN radio access technology.


[Nm] {434} If the E-UTRA capability was disabled due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see subclause 4.3.1), the criteria to enable the E-UTRA capability again is UE implementation specific.


[Nm] {435} If the E-UTRA capability was disabled due to the UE initiated detach procedure for EPS services only (see subclause 5.5.2.2.2), upon request of the upper layers to re-attach for EPS services the UE shall enable the E-UTRA capability again. If the E-UTRA capability was disabled due to receipt of EMM cause #14 "EPS services not allowed in this PLMN", then the UE shall enable the E-UTRA capability when the UE powers off and powers on again or the USIM is removed. If E-UTRA capability was disabled for any other reason, the UE shall enable the E-UTRA capability in:


	[B1] {436} -	the UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation;


	[B1] {437} -	the UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation; or


	[B1] {438} -	the UE powers off and powers on again or the USIM is removed;


[Nm] {439} As an implementation option, the UE may start a timer for enabling E-UTRA when the UE's attach attempt counter or tracking area updating attempt counter reaches 5 and the UE disables E-UTRA capability for cases described in subclauses 5.5.1.2.6, 5.5.1.3.4.3, 5.5.1.3.6, 5.5.3.2.6, 5.5.3.3.4.3 and 5.5.3.3.6. The UE should memorize the identity of the PLMNs where E-UTRA capability were disabled. On expiry of this timer:


	[B1] {440} -	if the UE is in Iu mode or A/Gb mode and is in idle mode as specified in 3GPP TS 24.008 [13] on expiry of the timer, the UE should enable the E-UTRA capability;


	[B1] {441} -	if the UE is in Iu mode or A/Gb mode and an RR connection exists, the UE shall delay enabling E-UTRA capability until the RR connection is released;


	[B1] {442} -	if the UE is in Iu mode and a PS signalling connection exists but no RR connection exists, the UE may abort the PS signalling connection before enabling E-UTRA capability;


	[B1] {443} -	if the UE is in N1 mode and is in 5GMM-IDLE mode as specified in 3GPP TS 24.501 [54], on expiry of the timer, the UE should enable the E-UTRA capability; and


	[B1] {444} -	if the UE is in N1 mode and is in 5GMM-CONNECTED mode as specified in 3GPP TS 24.501 [54], on expiry of the timer, the UE shall delay enabling the E-UTRA capability until the N1 NAS signalling connection is released.


[Nm] {445} If the UE attempts to establish an emergency bearer service in a PLMN where the E-UTRA capability was disabled due to the UE's attach attempt counter or tracking area updating attempt counter have reached 5, the UE may enable the E-UTRA capability for that PLMN memorized by the UE.


[Nm] {446} For other cases, it is up to the UE implementation when to enable the E-UTRA capability.


[H2] {447} 4.6	Applicability of procedures


[H3] {448} 4.6.1	Relay nodes


[Nm] {449} A relay node shall support all procedures that are mandatory for a UE supporting S1 mode only.


[Nm] {450} There is also functionality which is only applicable to a relay node, in which case the specification uses the term "relay node" instead of "UE".


[H2] {451} 4.7	EPS mobility management and EPS session management in NB-S1 mode


[Nm] {452} A UE in NB-S1 mode (see 3GPP TS 36.331 [22]) shall calculate the value of the applicable NAS timer:


	[B1] {453} -	indicated in table 10.2.1 plus 240s; and


	[B1] {454} -	indicated in table 10.3.1 plus 180s.


[Nm] {455} The timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.


[Nm] {456} When an MME that supports NB-S1 mode performs NAS signaling with a UE, which is using NB-S1 mode, the MME shall calculate the value of the applicable NAS timer:


	[B1] {457} -	indicated in table 10.2.2 plus 240s; and


	[B1] {458} -	indicated in table 10.3.2 plus 180s.


[Nm] {459} The timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.


[H2] {460} 4.8	EPS mobility management and EPS session management in WB-S1 mode for IoT


[Nm] {461} In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP TS 36.306 [44]). If a UE that supports CE mode B and operates in WB-S1 mode the UE's usage setting is not set to "voice centric" (see 3GPP TS 23.401 [10]), and the use of enhanced coverage is not restricted for the UE, the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.


[Nm] {462} In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP TS 36.306 [44]). If a UE that supports CE mode B and operates in WB-S1 mode the UE's usage setting is not set to "voice centric" (see 3GPP TS 23.401 [10]), and CE mode B is not restricted for the UE (see 3GPP TS 23.401 [10]), the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.


[Nm] {463} A UE that supports CE mode B and operates in WB-S1 mode shall not apply the value of the applicable NAS timer indicated in table 10.2.1 and table 10.3.1 for WB-S1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted as described in this subclause.


[Nm] {464} The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.


[Nm] {465} The support of CE mode B by a UE is indicated to the MME by lower layers and shall be stored by the MME. When an MME that supports WB-S1 mode performs NAS signaling with a UE, which supports CE mode B and operates in WB-S1 mode and the MME determines that


	[B1] {466} a)	the use of enhanced coverage is not restricted for the UE; or


	[B1] {467} b)	CE mode B is not restricted for the UE (see 3GPP TS 23.401 [10])


[Nm] {468} the MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.


[Nm] {469} The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.


[H2] {470} 4.9	Disabling and re-enabling of UE's NB-IoT capability


[Nm] {471} If the UE supports disabling and re-enabling of UE's NB-IoT capability and the UE in NB-S1 mode is disabling the NB-IoT capability, it should proceed as follows:


	[B1] {472} a)	select E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs;


	[B1] {473} b)	if E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;


	[B1] {474} c)	if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN; or


	[B1] {475} d)	if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the NB-IoT capability and remain registered for EPS services in NB-IoT of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.


[Nm] {476} If the the NB-IoT capability is disabled, the UE shall re-enable the NB-IoT capability when:


	[B1] {477} -	performing a PLMN selection unless the UE has already re-enabled the NB-IoT capability when performing bullets c) or d) above; or


	[B1] {478} -	the UE powers off and powers on again or the USIM is removed.


[Nm] {479} If the UE in NB-S1 mode receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "NB-IoT not allowed" after the UE requests access to the NB-IoT, in order to prevent unwanted cell reselection from GERAN, UTRAN, E-UTRAN or NG-RAN to NB-IoT, the UE may:


	[B1] {480} -	disable the NB-IoT capability:


	[B1] {481} -	indicate the access stratum layer(s) of disabling of the NB-IoT capability; and


	[B1] {482} -	memorize the identity of the PLMN where the NB-IoT capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].


[Nm] {483} If the UE in NB-S1 mode is required to disable the NB-IoT capability and select E-UTRAN radio access technology, and the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting E-UTRAN radio access technology.


[Nm] {484} As an implementation option, the UE may start a timer for enabling the NB-IoT capability. On expiry of this timer, the UE may enable the NB-IoT capability.


[H1] {485} 5	Elementary procedures for EPS mobility management 


[H2] {486} 5.1	Overview


[H3] {487} 5.1.1	General


[Nm] {488} This clause describes the procedures used for mobility management for EPS services (EMM) at the radio interface (reference point "LTE-Uu").


[Nm] {489} The main function of the mobility management sublayer is to support the mobility of a user equipment, such as informing the network of its present location and providing user identity confidentiality.


[Nm] {490} A further function of the mobility management sublayer is to provide connection management services to the session management (SM) sublayer and the short message services (SMS) entity of the connection management (CM) sublayer.


[Nm] {491} All the EMM procedures described in this clause can only be performed if a NAS signalling connection has been established between the UE and the network. Else, the EMM sublayer has to initiate the establishment of a NAS signalling connection (see 3GPP TS 36.331 [22]).


[H3] {492} 5.1.2	Types of EMM procedures


[Nm] {493} Depending on how they can be initiated, three types of EMM procedures can be distinguished:


	[B1] {494} 1)	EMM common procedures:


	[B1] {495} 	An EMM common procedure can always be initiated whilst a NAS signalling connection exists. The procedures belonging to this type are:


		[B2] {496} 	Initiated by the network:


				[B4] {497} -	GUTI reallocation;


				[B4] {498} -	authentication;


				[B4] {499} -	security mode control;


				[B4] {500} -	identification;


				[B4] {501} -	EMM information.


	[B1] {502} 2)	EMM specific procedures:


	[B1] {503} 	At any time only one UE initiated EMM specific procedure can be running. The procedures belonging to this type are:


		[B2] {504} 	Initiated by the UE and used to attach the IMSI in the network for EPS services and/or non-EPS services, and to establish an EMM context and if requested by the UE, a default bearer:


				[B4] {505} -	attach and combined attach.


		[B2] {506} 	Initiated by the UE and used to attach the IMSI or IMEI for emergency bearer services, and to establish an EMM context and a default bearer to a PDN that provides emergency bearer services:


				[B4] {507} -	attach.


		[B2] {508} 	Initiated by the UE and used to attach the IMSI or IMEI for access to RLOS, and to establish an EMM context and a default bearer to a PDN connection for RLOS:


				[B4] {509} -	attach.


		[B2] {510} 	Initiated by the UE or the network and used to detach the IMSI in the network for EPS services and/or non-EPS services and to release an EMM context and all bearers, if any:


				[B4] {511} -	detach and combined detach.


		[B2] {512} 	Initiated by the UE and used to detach the IMSI in the network for EPS services or non-EPS services and to release an EMM context and all bearers, if any:


				[B4] {513} -	eCall inactivity procedure.


		[B2] {514} 	Initiated by the UE when an EMM context has been established:


				[B4] {515} -	normal tracking area updating and combined tracking area updating (S1 mode only);


				[B4] {516} -	periodic tracking area updating (S1 mode only).


		[B2] {517} 	The tracking area updating procedure can be used to request also the resource reservation for sending data.


	[B1] {518} 3)	EMM connection management procedures (S1 mode only):


		[B2] {519} 	Initiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both:


				[B4] {520} -	service request.


		[B2] {521} 	The service request procedure can only be initiated if no UE initiated EMM specific procedure is ongoing.


		[B2] {522} 	Initiated by the network and used to request the establishment of a NAS signalling connection or to prompt the UE to re-attach if necessary as a result of a network failure:


				[B4] {523} -	paging procedure.


		[B2] {524} 	Initiated by the UE or the network and used to transport NAS messages:


				[B4] {525} -	transport of NAS messages;


				[B4] {526} -	generic transport of NAS messages.


		[B2] {527} 	The transport of NAS messages procedure and the generic transport of NAS messages procedure cannot be initiated while an EMM specific procedure or a service request procedure is ongoing.


[H3] {528} 5.1.3	EMM sublayer states


[H4] {529} 5.1.3.1	General


[Nm] {530} In the following subclauses, the EMM protocol of the UE and the network is described by means of two different state machines. In subclause 5.1.3.2, the states of the EMM entity in the UE are introduced. The behaviour of the UE depends on an EPS update status that is described in subclause 5.1.3.3. The states for the MME side are described in subclause 5.1.3.4.


[H4] {531} 5.1.3.2	EMM sublayer states in the UE


[H5] {532} 5.1.3.2.1	General


[Nm] {533} In the following subclauses, the possible EMM states of an EMM entity in the UE are described. Subclause 5.1.3.2.2 summarizes the main states of an EMM entity. The substates that have been defined are described in subclause 5.1.3.2.3 and subclause 5.1.3.2.4.


[Nm] {534} It should be noted, however, that this subclause does not include a description of the detailed behaviour of the UE in the single states and does not cover abnormal cases. A detailed description of the behaviour of the UE is given in subclause 5.2. For the behaviour of the UE in abnormal cases refer to the description of the elementary EMM procedures in subclauses 5.4, 5.5, 5.6 and 5.7.


[H5] {535} 5.1.3.2.2	Main states


[H6] {536} 5.1.3.2.2.1	EMM-NULL


[Nm] {537} EPS services are disabled in the UE. No EPS mobility management function shall be performed in this state. 


[H6] {538} 5.1.3.2.2.2	EMM-DEREGISTERED


[Nm] {539} In the state EMM-DEREGISTERED, no EMM context has been established and the UE location is unknown to an MME and hence it is unreachable by an MME. In order to establish an EMM context, the UE shall start the attach or combined attach procedure (see subclause 5.5.1).


[H6] {540} 5.1.3.2.2.3	EMM-REGISTERED-INITIATED


[Nm] {541} A UE enters the state EMM-REGISTERED-INITIATED after it has started the attach or the combined attach procedure and is waiting for a response from the MME (see subclause 5.5.1).


[H6] {542} 5.1.3.2.2.4	EMM-REGISTERED


[Nm] {543} In the state EMM-REGISTERED an EMM context has been established. Additionally a default EPS bearer context has been activated in the UE:


	[B1] {544} -	if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or


		[B2] {545} -	if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.


[Nm] {546} When the UE is in EMM-IDLE mode, the UE location is known to the MME with an accuracy of a list of tracking areas containing a certain number of tracking areas. When the UE is in EMM-CONNECTED mode, the UE location is known to the MME with an accuracy of a serving eNodeB. The UE may initiate sending and receiving user data and signalling information and reply to paging. Additionally, tracking area updating or combined tracking area updating procedure is performed (see subclause 5.5.3).


[H6] {547} 5.1.3.2.2.5	EMM-DEREGISTERED-INITIATED


[Nm] {548} A UE enters the state EMM-DEREGISTERED-INITIATED after it has requested release of the EMM context by starting the detach or combined detach procedure and is waiting for a response from the MME (see subclause 5.5.2).


[H6] {549} 5.1.3.2.2.6	EMM-TRACKING-AREA-UPDATING-INITIATED


[Nm] {550} A UE enters the state EMM-TRACKING-AREA-UPDATING-INITIATED after it has started the tracking area updating or combined tracking area updatingprocedure and is waiting for a response from the MME (see subclause 5.5.3).


[H6] {551} 5.1.3.2.2.7	EMM-SERVICE-REQUEST-INITIATED


[Nm] {552} A UE enters the state EMM-SERVICE-REQUEST-INITIATED after it has started the service request procedure and is waiting for a response from the MME (see subclause 5.6.1).


[H5] {553} 5.1.3.2.3	Substates of state EMM-DEREGISTERED


[H6] {554} 5.1.3.2.3.1	General


[Nm] {555} The state EMM-DEREGISTERED is subdivided into a number of substates as described in this subclause. Valid subscriber data are available for the UE before it enters the substates, except for the substate EMM-DEREGISTERED.NO-IMSI.


[H6] {556} 5.1.3.2.3.2	EMM-DEREGISTERED.NORMAL-SERVICE


[Nm] {557} The substate EMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a suitable cell has been found and the PLMN or tracking area is not in the forbidden list.


[H6] {558} 5.1.3.2.3.3	EMM-DEREGISTERED.LIMITED-SERVICE


[Nm] {559} The substate EMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is known that a selected cell is unable to provide normal service (e.g. the selected cell is in a forbidden PLMN, is in a forbidden tracking area or the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG List).


[H6] {560} 5.1.3.2.3.4	EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH


[Nm] {561} The substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH is chosen in the UE if the attach or combined attach procedure failed due to a missing response from the network or due to the circumstances described in subclauses 5.5.1.2.5, 5.5.1.2.6, 5.5.1.3.5 and 5.5.2.3.4.


[H6] {562} 5.1.3.2.3.5	EMM-DEREGISTERED.PLMN-SEARCH


[Nm] {563} The substate EMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).


[H6] {564} 5.1.3.2.3.6	EMM-DEREGISTERED.NO-IMSI


[Nm] {565} The substate EMM-DEREGISTERED.NO-IMSI is chosen in the UE, if the UE has no valid subscriber data available (SIM/USIM not available, or the SIM/USIM is considered invalid by the UE) and a cell has been selected.


[H6] {566} 5.1.3.2.3.7	EMM-DEREGISTERED.ATTACH-NEEDED


[Nm] {567} Valid subscriber data are available for the UE and for some reason an attach must be performed as soon as possible. This substate can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.


[H6] {568} 5.1.3.2.3.8	EMM-DEREGISTERED.NO-CELL-AVAILABLE


[Nm] {569} No E-UTRAN cell can be selected. This substate is entered after a first intensive search failed when in substate EMM-DEREGISTERED.PLMN-SEARCH. Cells are searched for at a low rhythm. No EPS services are offered. 


[H6] {570} 5.1.3.2.3.9	EMM-DEREGISTERED.eCALL-INACTIVE


[Nm] {571} The substate EMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:


	[B1] {572} -	the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17];


	[B1] {573} -	timer T3444 and timer T3445 have expired or are not running;


	[B1] {574} -	a PLMN has been selected as specified in 3GPP TS 23.122 [6];


	[B1] {575} -	the UE does not need to perform an eCall over IMS; and


	[B1] {576} -	the UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.


[Nm] {577} In this substate, the UE shall not initiate any signalling towards the network, except to originate an eCall over IMS, or a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.


[H5] {578} 5.1.3.2.4	Substates of state EMM-REGISTERED


[H6] {579} 5.1.3.2.4.1	General


[Nm] {580} The state EMM-REGISTERED is subdivided into a number of substates as described in this subclause.


[H6] {581} 5.1.3.2.4.2	EMM-REGISTERED.NORMAL-SERVICE


[Nm] {582} The substate EMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary substate when the UE enters the state EMM-REGISTERED.


[H6] {583} 5.1.3.2.4.3	EMM-REGISTERED.ATTEMPTING-TO-UPDATE


[Nm] {584} The substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE is chosen by the UE if the tracking area updating or combined tracking area updating procedure failed due to a missing response from the network or due to the circumstances described in subclauses 5.3.9, 5.5.3.2.5, 5.5.3.2.6, 5.5.3.3.5, 5.6.1.5 and 5.6.1.6. No EMM procedure except the tracking area updating or combined tracking area updating procedure shall be initiated by the UE in this substate. No data shall be sent or received.


[H6] {585} 5.1.3.2.4.4	EMM-REGISTERED.LIMITED-SERVICE


[Nm] {586} The substate EMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell the UE selected is known not to be able to provide normal service.


[H6] {587} 5.1.3.2.4.5	EMM-REGISTERED.PLMN-SEARCH


[Nm] {588} The substate EMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is searching for PLMNs.


[H6] {589} 5.1.3.2.4.6	EMM-REGISTERED.UPDATE-NEEDED


[Nm] {590} The UE has to perform a tracking area updating or combined tracking area updating procedure, but access to the current cell is barred. This state can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.


[Nm] {591} Except tracking area updating, combined tracking area updating, or service request as a response to paging, no EMM procedure shall be initiated by the UE in this substate.


[H6] {592} 5.1.3.2.4.7	EMM-REGISTERED.NO-CELL-AVAILABLE


[Nm] {593} E-UTRAN coverage has been lost or PSM is active in the UE. If PSM is active, the UE can deactivate PSM at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. Otherwise, the UE shall not initiate any EMM procedure except for cell and PLMN reselection.


[H6] {594} 5.1.3.2.4.8	EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM


[Nm] {595} A combined attach procedure or a combined tracking area updating procedure was successful for EPS services only. User data and signalling information may be sent and received.


[H6] {596} 5.1.3.2.4.9	EMM-REGISTERED.IMSI-DETACH-INITIATED


[Nm] {597} The UE performs a combined detach procedure for non-EPS services only (detach type "IMSI detach"). This substate is entered if the UE is attached for EPS and non-EPS services and wants to detach for non-EPS services only. User data and signalling information may be sent and received.


[H4] {598} 5.1.3.3	EPS update status


[Nm] {599} In order to describe the detailed UE behaviour, the EPS update (EU) status pertaining to a specific subscriber is defined.


[Nm] {600} The EPS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex C.


[Nm] {601} The EPS update status value is changed only after the execution of an attach or combined attach, network initiated detach, authentication, tracking area update or combined tracking area update, service request or paging for EPS services using IMSI procedure or due to change in TAI which is not part of TAI list while timer T3346 is running.


	[B1] {602} EU1: UPDATED


	[B1] {603} 	The last attach or tracking area updating attempt was successful.


	[B1] {604} EU2: NOT UPDATED


	[B1] {605} 	The last attach, service request or tracking area updating attempt failed procedurally, e.g. no response or reject message was received from the MME.


	[B1] {606} EU3: ROAMING NOT ALLOWED


	[B1] {607} 	The last attach, service request or tracking area updating attempt was correctly performed, but the answer from the MME was negative (because of roaming or subscription restrictions).


[H4] {608} 5.1.3.4	EMM sublayer states in the MME


[H5] {609} 5.1.3.4.1	EMM-DEREGISTERED


[Nm] {610} In the state EMM-DEREGISTERED, the MME has no EMM context or the EMM Context is marked as detached. The UE is detached. The MME may answer to an attach or a combined attach procedure initiated by the UE (see subclause 5.5.1). The MME may also answer to a tracking area updating procedure or combined tracking area updating procedure initiated by a UE if the EMM context is marked as detached. The MME may also answer to a detach procedure initiated by the UE (see subclause 5.5.1.2.7).


[Nm] {611} If ISR is not activated or ISR is deactivated during a routing area updating or combined routing area updating procedure or an inter-system handover to A/Gb mode or Iu mode, the MME enters the state EMM-DEREGISTERED after the successful completion of the procedure.


[H5] {612} 5.1.3.4.2	EMM-COMMON-PROCEDURE-INITIATED


[Nm] {613} The MME enters the state EMM-COMMON-PROCEDURE-INITIATED, after it has started a common EMM procedure (see subclause 5.4) and is waiting for a response from the UE.


[H5] {614} 5.1.3.4.3	EMM-REGISTERED


[Nm] {615} In the state EMM-REGISTERED, an EMM context has been established. Additionally a default EPS bearer context has been activated in the MME:


	[B1] {616} -	if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or


	[B1] {617} -	if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.


[H5] {618} 5.1.3.4.4	EMM-DEREGISTERED-INITIATED


[Nm] {619} The MME enters the state EMM-DEREGISTERED-INITIATED after it has started a detach procedure and is waiting for a response from the UE (see subclause 5.5.2).


[H3] {620} 5.1.4	Coordination between EMM and GMM


[Nm] {621} If GMM and EMM are both enabled, a UE capable of S1 mode and A/Gb mode or Iu mode or both shall maintain one common registration for GMM and EMM indicating whether the UE is registered for packet services or not.


[Nm] {622} A UE that is not registered shall be in state GMM-DEREGISTERED and in state EMM-DEREGISTERED.


[Nm] {623} If the UE performs a successful attach or combined attach procedure in S1 mode, it shall enter substates GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).


[Nm] {624} If the UE performs a successful GPRS attach or combined GPRS attach procedure in A/Gb or Iu mode, it shall enter substates GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).


[Nm] {625} At intersystem change from A/Gb or Iu mode to S1 mode when no PDP context is active, if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall move to state EMM-DEREGISTERED and state GMM-DEREGISTERED and then initiate an attach procedure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and GMM-REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area updating procedure.


[Nm] {626} After successful completion of routing area updating or combined routing area updating and tracking area updating or combined tracking area updating procedures in both S1 mode and A/Gb or Iu mode, if the network has indicated that ISR is activated, the UE shall maintain registration and related periodic update timers in both GMM and EMM.


[H3] {627} 5.1.5	Coordination between EMM and MM


[Nm] {628} UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation shall use the combined EPS/IMSI attach procedure in order to attach to both EPS and non-EPS services.


[Nm] {629} UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall use the combined tracking area updating and periodic tracking area updating procedures.


[Nm] {630} UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall perform a combined detach procedure in order to detach for non-EPS services.


[Nm] {631} UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation should not use any MM timers related to MM specific procedures (e.g. T3210, T3211, T3212, T3213) while camped on E-UTRAN, unless the re-activation of these timers is explicitly described. If the MM timers are already running, the UE should not react on the expiration of the timers.


[Nm] {632} If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] and moves from GERAN/UTRAN to E-UTRAN, the UE shall:


	[B1] {633} -	if timer T3242 is running, start timer T3444 with the time left on T3242 and stop timer T3242;


	[B1] {634} -	if timer T3243 is running, start timer T3445 with the time left on T3243 and stop timer T3243;


	[B1] {635} -	if the UE is attached for both EPS services and non-EPS services and timer T3242 or timer T3243 is running, perform a combined tracking area updating procedure; and


	[B1] {636} -	if the UE is attached for non-EPS services only and timer T3242 or timer T3243 is running, perform a combined attach procedure.


[H2] {637} 5.2	Behaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED


[H3] {638} 5.2.1	General


[Nm] {639} In this subclause, the detailed behaviour of the UE in the states EMM-DEREGISTERED and EMM-REGISTERED is described.


[H3] {640} 5.2.2	UE behaviour in state EMM-DEREGISTERED


[H4] {641} 5.2.2.1	General


[Nm] {642} The state EMM-DEREGISTERED is entered in the UE, when:


	[B1] {643} -	the detach or combined detach is performed either by the UE or by the MME (see subclause 5.5.2);


	[B1] {644} -	the attach request is rejected by the MME (see subclause 5.5.1);


	[B1] {645} -	the tracking area update request is rejected by the MME (see subclause 5.5.3);


	[B1] {646} -	the service request procedure is rejected by the MME (see subclause 5.6.1);


	[B1] {647} -	the UE deactivates all EPS bearer contexts locally (see subclause 6.4.4.6);


	[B1] {648} -	the UE is switched on;


	[B1] {649} -	an inter-system change from S1 mode to non3GPP access is completed and the non3GPP access network provides PDN connectivity to the same EPC; or


	[B1] {650} -	the UE attached for emergency bearer services is in EMM-IDLE mode and its periodic tracking area update timer expires (see subclause 5.3.5).


[Nm] {651} In state EMM-DEREGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.2.3.


[H4] {652} 5.2.2.2	Primary substate selection


[H5] {653} 5.2.2.2.1	Selection of the substate after power on


[Nm] {654} For a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17], timers T3444 and T3445 are considered to have expired at power on. When the UE is switched on, the substate shall be PLMN-SEARCH if the USIM is available and valid. See 3GPP TS 23.122 [6] for further details.


[Nm] {655} The substate chosen after PLMN-SEARCH, following power on is:


	[B1] {656} -	if no cell can be selected, the substate shall be NO-CELL-AVAILABLE;


	[B1] {657} -	if no USIM is present, the substate shall be NO-IMSI;


	[B1] {658} -	if a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, then the substate shall be NORMAL-SERVICE;


	[B1] {659} -	if the selected cell is known not to be able to provide normal service, then the UE shall enter the substate LIMITED-SERVICE;


	[B1] {660} -	if the UE is in manual network selection mode and no cell of the selected PLMN has been found, the UE shall enter the substate NO-CELL-AVAILABLE;


	[B1] {661} -	if the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and


	[B1] {662} -	if the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the substate shall be eCALL-INACTIVE.


[H4] {663} 5.2.2.3	Detailed description of UE behaviour in state EMM-DEREGISTERED


[H5] {664} 5.2.2.3.1	NORMAL-SERVICE


[Nm] {665} The UE shall initiate an attach or combined attach procedure if timer T3346 is not running. If timer T3346 is running, the UE shall initiate an attach or combined attach procedure on the expiry of timer T3346.


[Nm] {666} The UE may initiate attach for emergency bearer services even if timer T3346 is running.


[H5] {667} 5.2.2.3.2	LIMITED-SERVICE


[Nm] {668} The UE shall initiate an attach or combined attach procedure when entering a cell which provides normal service.


[Nm] {669} The UE may initiate attach for emergency bearer services.


[Nm] {670} The UE may initiate attach for access to RLOS.


[H5] {671} 5.2.2.3.3	ATTEMPTING-TO-ATTACH


[Nm] {672} The UE:


	[B1] {673} -	shall initiate an attach or combined attach procedure on the expiry of timers T3411, T3402 or T3346 (see 3GPP TS 24.008 [13]);


	[B1] {674} -	may initiate an attach for emergency bearer services even if timer T3346 is running;


	[B1] {675} -	shall initiate an attach or combined attach procedure when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;


	[B1] {676} -	shall initiate an attach or combined attach procedure when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area of the new cell is not in one of the lists of forbidden tracking areas;


	[B1] {677} -	shall use requests for non-EPS services for non-emergency call from CM layers to trigger a combined attach procedure, if timer T3346 is not running (see subclause 5.5.1.3), or to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;


	[B1] {678} -	shall use requests for non-EPS services for emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;


	[B1] {679} -	may initiate an attach procedure upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running;


	[B1] {680} -	may initiate an attach procedure upon request of the upper layers to establish a PDN connection for emergency bearer services; and


	[B1] {681} -	may initiate an attach procedure upon request of the upper layers to establish a PDN connection for RLOS, if timer T3346 is not running.


[H5] {682} 5.2.2.3.4	PLMN-SEARCH


[Nm] {683} The UE shall perform PLMN selection. If a new PLMN is selected, the UE shall reset the attach attempt counter and initiate the attach or combined attach procedure (see subclause 5.5.1).


[Nm] {684} If the selected cell is known not to be able to provide normal service:


	[B1] {685} -	the UE may initiate attach for emergency bearer services; or


		[B2] {686} -	the UE may initiate attach for access to RLOS.


[H5] {687} 5.2.2.3.5	NO-IMSI


[Nm] {688} The UE shall perform cell selection according to 3GPP TS 36.304 [21].


[Nm] {689} The UE may initiate attach for emergency bearer services.


[Nm] {690} The UE may initiate attach for access to RLOS.


[H5] {691} 5.2.2.3.6	ATTACH-NEEDED


[Nm] {692} The UE shall initiate the attach or combined attach procedure, if still needed, as soon as the access is allowed in the selected cell for one of the access classes of the UE.


[Nm] {693} The UE may initiate attach for emergency bearer services.


[Nm] {694} The UE may initiate attach for access to RLOS.


[H5] {695} 5.2.2.3.7	NO-CELL-AVAILABLE


[Nm] {696} The UE shall perform cell selection according to 3GPP TS 36.304 [21] and choose an appropriate substate when a cell is found. When the lower layers indicate to prepare for an S101 mode to S1 mode handover and the PLMN identity of the target cell provided with this indication is not in one of forbidden PLMN lists, the UE shall enter substate NORMAL-SERVICE.


[H5] {697} 5.2.2.3.8	eCALL-INACTIVE


[Nm] {698} The UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP TS 23.122 [6] but initiates no EMM signalling with the network and ignores any paging requests.


[Nm] {699} The UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state only when one of the following events occur:


	[B1] {700} -	if the USIM is removed, the UE enters substate EMM-DEREGISTERED.NO-IMSI;


	[B1] {701} -	if coverage is lost, the UE enters substate EMM-DEREGISTERED.PLMN-SEARCH;


	[B1] {702} -	if the UE is deactivated (e.g. powered off) by the user, the UE enters state EMM-NULL;


	[B1] {703} -	if the UE receives a request from upper layers to establish an eCall over IMS, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. The UE then uses the relevant EMM and ESM procedures to establish the eCall over IMS at the earliest opportunity; or


	[B1] {704} -	if the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. Once the attach procedure is completed, the UE uses the relevant EMM and ESM procedures to establish the non-emergency call.


[H4] {705} 5.2.2.4	Substate when back to state EMM-DEREGISTERED from another EMM state


[Nm] {706} When returning to state EMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP TS 36.304 [21].


[Nm] {707} The substate depends on the result of the cell selection procedure, the outcome of the previously performed EMM specific procedures, on the EPS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to EMM-DEREGISTERED:


	[B1] {708} -	If no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found.


	[B1] {709} -	If no USIM is present or if the inserted USIM is considered invalid by the UE, the substate shall be NO-IMSI.


	[B1] {710} -	If a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, the substate shall be NORMAL-SERVICE.


	[B1] {711} -	If an attach shall be performed (e.g. network requested re-attach), the substate shall be ATTEMPTING-TO-ATTACH.


	[B1] {712} -	If a PLMN reselection (according to 3GPP TS 23.122 [6]) is needed, the substate shall be PLMN-SEARCH.


	[B1] {713} -	If the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE;


	[B1] {714} -	If the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and


	[B1] {715} -	If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], T3444 and T3445 have expired or are not running, and substate PLMN-SEARCH is not required, the substate shall be eCALL-INACTIVE.


[H3] {716} 5.2.3	UE behaviour in state EMM-REGISTERED


[H4] {717} 5.2.3.1	General


[Nm] {718} The state EMM-REGISTERED is entered at the UE, when:


	[B1] {719} -	the attach or combined attach procedure is performed by the UE (see subclause 5.5.1).


[Nm] {720} In state EMM-REGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.3.2.


[H4] {721} 5.2.3.2	Detailed description of UE behaviour in state EMM-REGISTERED


[H5] {722} 5.2.3.2.1	NORMAL-SERVICE


[Nm] {723} The UE:


	[B1] {724} -	shall initiate normal and combined tracking area updating (according to conditions given in subclause 5.5.3);


	[B1] {725} -	shall perform periodic tracking area updating (see subclause 5.5.3) except when attached for emergency bearer services (see subclause 5.3.5);


	[B1] {726} -	shall initiate a tracking area updating on the expiry of timer T3411;


	[B1] {727} -	shall respond to paging; and


	[B1] {728} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


[H5] {729} 5.2.3.2.2	ATTEMPTING-TO-UPDATE


[Nm] {730} The UE:


	[B1] {731} -	shall not send any user data;


	[B1] {732} -	shall initiate tracking area updating on the expiry of timers T3411, T3402 or T3346;


	[B1] {733} -	shall initiate tracking area updating when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists, and the tracking area is not in one of the lists of forbidden tracking areas;


	[B1] {734} -	shall initiate tracking area updating when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;


	[B1] {735} -	may initiate a tracking area updating procedure upon request of the upper layers to establish a PDN connection for emergency bearer services;


	[B1] {736} -	shall initiate tracking area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in subclause 5.5.3.2.6, item l), if timer T3346 is running due to a NAS request message (TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority"and timer T3402 and timer T3411 are not running;


	[B1] {737} -	may detach locally and initiate an attach for emergency bearer services even if timer T3346 is running;


	[B1] {738} -	shall use requests for non-EPS services from CM layers to trigger a combined tracking area updating procedure, if timer T3346 is not running (see subclause 5.5.3.3), or to attempt to select GERAN, UTRAN or cdma2000® 1xRTT radio access technology and proceed with the appropriate MM and CC specific procedures;


	[B1] {739} -	may use requests for an MMTEL voice call or MMTEL video call from the upper layers to initiate tracking area updating, if timer T3346 is not running;


	[B1] {740} -	shall initiate tracking area updating in response to paging with S-TMSI or paging with IMSI and domain indicator set to ″CS″;


	[B1] {741} -	shall initiate tracking area updating if the EPS update status is set to EU2 NOT UPDATED, and timers T3411, T3402 and T3346 are not running;


	[B1] {742} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4);


	[B1] {743} -	may initiate tracking area updating upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running; and


	[B1] {744} -	shall not initiate the detach signalling procedure unless timer T3346 is running and the current TAI is part of the TAI list.


[H5] {745} 5.2.3.2.3	LIMITED-SERVICE


[Nm] {746} The UE:


	[B1] {747} -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21]; 


	[B1] {748} -	may respond to paging (with IMSI);


	[B1] {749} -	may detach locally and initiate attach for emergency bearer services;


	[B1] {750} -	may detach locally and may initiate attach for access to RLOS; and


	[B1] {751} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


[H5] {752} 5.2.3.2.4	PLMN-SEARCH


[Nm] {753} The UE may enter this substate when it is in automatic network selection mode and the maximum allowed number of subsequently unsuccessful tracking area updating have been performed. The UE may also enter this substate as a result of a tracking area update rejected by the network (see subclause 5.5.3) or as a result of a service request rejected by the network (see subclause 5.6.1). If a new PLMN is selected, the UE shall reset the tracking area updating attempt counter and initiate the tracking area updating or combined tracking area updating procedure (see subclause 5.5.3).


[Nm] {754} If the selected cell is known not to be able to provide normal service:


	[B1] {755} -	the UE may detach locally and initiate attach for emergency bearer services; or


	[B1] {756} -	the UE may detach locally and initiate attach for access to RLOS.


[H5] {757} 5.2.3.2.5	UPDATE-NEEDED


[Nm] {758} The UE:


	[B1] {759} -	shall not send any user data;


	[B1] {760} -	shall not send signalling information, unless it is a service request as a response to paging or a tracking area updating or combined tracking area updating procedure upon request by the upper layers to establish a PDN connection for emergency bearer services or upon a request from the upper layers for an MMTEL voice call, MMTEL video call, SMSoIP, SMS over NAS or SMS over S102;


	[B1] {761} -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21];


	[B1] {762} -	shall enter the appropriate new substate as soon as the access is allowed in the selected cell for one of the access classes of the UE; and


	[B1] {763} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


[H5] {764} 5.2.3.2.6	NO-CELL-AVAILABLE


[Nm] {765} The UE shall perform cell selection/reselection according to 3GPP TS 36.304 [21].


[H5] {766} 5.2.3.2.7	ATTEMPTING-TO-UPDATE-MM


[Nm] {767} The UE:


	[B1] {768} -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21];


	[B1] {769} -	shall be able to receive and transmit user data and signalling information;


	[B1] {770} -	shall initiate combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" on the expiry of timers T3411 or T3402 or when the UE enters a tracking area not in the list of registered tracking areas and not in one of the lists of forbidden tracking areas;


	[B1] {771} -	shall respond to paging with IMSI or S-TMSI for the PS domain;


	[B1] {772} -	shall use requests for non-EPS services from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, unless T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion";


	[B1] {773} -	shall use requests for non-EPS services due to emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, even if T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion"; and


	[B1] {774} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


[H5] {775} 5.2.3.2.8	IMSI-DETACH-INITIATED


[Nm] {776} The UE:


	[B1] {777} -	shall be able to receive and transmit user data and signalling information;


	[B1] {778} -	shall initiate combined tracking area updating procedure (according to conditions given in subclause 5.5.3.3 or subclause 5.5.2.2.4); and


	[B1] {779} -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


[H2] {780} 5.3	General on elementary EMM procedures


[H3] {781} 5.3.1	EMM modes and NAS signalling connection


[H4] {782} 5.3.1.1	Establishment of the NAS signalling connection


[Nm] {783} When the UE is in EMM-IDLE mode without suspend indication and needs to transmit an initial NAS message, the UE shall request the lower layer to establish a RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type as specified in annex D of this specification and, for the case specified in subclause 5.6.1.2.2, shall also provide the initial NAS message, otherwise NAS may also provide the initial NAS message.


[Nm] {784} Initial NAS messages are:


	[B1] {785} -	ATTACH REQUEST;


	[B1] {786} -	DETACH REQUEST;


	[B1] {787} -	TRACKING AREA UPDATE REQUEST;


	[B1] {788} -	SERVICE REQUEST;


	[B1] {789} -	EXTENDED SERVICE REQUEST; and


	[B1] {790} -	CONTROL PLANE SERVICE REQUEST.


[Nm] {791} When the UE is in EMM-IDLE mode with suspend indication, the UE shall proceed the behaviour as specified in subclauses 5.3.1.3.


[Nm] {792} For the routing of the initial NAS message to the appropriate MME, the UE NAS provides the lower layers with either the S-TMSI, the registered globally unique MME identifier (GUMMEI) that consists of the PLMN ID, the MME group ID, and the MME code (see 3GPP TS 23.003 [2]), or none of them according to the following rules:


	[B1] {793} -	If the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network, the UE holds a valid 5G-GUTI and:


		[B2] {794} a)	the UE performs an initial EPS attach procedure or tracking area updating procedure following an inter-system change from N1 mode to S1 mode; or


		[B2] {795} b)	the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED, performs an initial EPS attach procedure,


	[B1] {796} 	then the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the 5G-GUTI as specified in 3GPP TS 23.003 [4], an indication that the identifier is a native GUMMEI and an indication that the identifier is mapped from 5GS;


	[B1] {797} -	If the TIN indicates "GUTI" or "RAT-related TMSI", or the TIN is not available, and the UE holds a valid GUTI:


		[B2] {798} a)	When the UE in EMM-IDLE mode initiates a tracking area updating or combined tracking area updating procedure for load balancing purposes, the UE NAS shall provide the lower layers with neither S-TMSI nor registered MME identifier;


		[B2] {799} b)	When the tracking area of the current cell is in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the S-TMSI, but shall not provide the registered MME identifier to the lower layers; or


		[B2] {800} c)	When the tracking area of the current cell is not in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the MME identifier part of the valid GUTI with an indication that the identifier is a native GUMMEI.


	[B1] {801} -	If the TIN indicates "P-TMSI", or the TIN is not available, and the UE holds a valid P-TMSI and RAI, the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the P-TMSI and RAI with an indication that the identifier is a mapped GUMMEI; or


	[B1] {802} -	Otherwise, the UE NAS does not provide the lower layers with the S-TMSI, the registered GUMMEI and the mapped GUMMEI.


[Nm] {803} The UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP TS 36.331 [22]). In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6].


[Nm] {804} When an ATTACH REQUEST message, or a TRACKING AREA UPDATE REQUEST message when the TAI of the current cell is not included in the TAI list, is sent to establish a signalling connection, the UE NAS also provides the lower layers with the DCN-ID according to the following rules:


	[B1] {805} a)	if a DCN-ID for the PLMN code of the selected PLMN is available in the UE, the UE NAS shall provide this DCN-ID to the lower layers; or


	[B1] {806} b)	if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is avaialble in the UE, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], the UE NAS shall provide this DCN-ID to the lower layers.


[Nm] {807} If a relay node is attaching for relay node operation (see 3GPP TS 23.401 [10]), the NAS in the relay node shall indicate to the lower layers that the establishment of the NAS signalling connection is for a relay node.


[Nm] {808} In S1 mode, when the RRC connection has been established successfully, the UE shall enter EMM-CONNECTED mode and consider the NAS signalling connection established.


[Nm] {809} In S101 mode, when the cdma2000® HRPD access network resources are available for tunnelled NAS signalling, the UE shall enter EMM-CONNECTED mode and consider the S101 mode NAS signalling connection established.


[H4] {810} 5.3.1.2	Release of the NAS signalling connection


[H5] {811} 5.3.1.2.1	General


[Nm] {812} The signalling procedure for the release of the NAS signalling connection is initiated by the network.


[Nm] {813} In S1 mode, when the RRC connection has been released, the UE shall enter EMM-IDLE mode and consider the NAS signalling connection released.


[Nm] {814} If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] then:


	[B1] {815} -	if the NAS signalling connection that was released had been established for eCall over IMS, the UE shall start timer T3444; and


	[B1] {816} -	if the NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE shall start timer T3445.


[Nm] {817} The UE shall start the SGC timer T3447 with the service gap time value available in the UE when the NAS signalling connection is released if:


	[B1] {818} -	the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and


	[B1] {819} -	the NAS signalling connection that was released had been established for mobile originated request for transfer of uplink data.


[Nm] {820} If the UE receives the "Extended wait time" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, the UE shall ignore the "Extended wait time".


[Nm] {821} To allow the network to release the NAS signalling connection, the UE:


	[B1] {822} a)	shall start the timer T3440 if the UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15, #25, #31 or #35;


	[B1] {823} b)	shall start the timer T3440 if:


		[B2] {824} -	the UE receives a TRACKING AREA UPDATE ACCEPT message which does not include a UE radio capability ID deletion indication IE;


		[B2] {825} -	the UE has not set the "active" flag in the TRACKING AREA UPDATE REQUEST message;


		[B2] {826} -	the UE has not set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message;


		[B2] {827} -	the tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode; and


		[B2] {828} -	the user plane radio bearers have not been set up;


	[B1] {829} c)	shall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to "IMSI detach" in the DETACH REQUEST message and user plane radio bearers have not been set up;


	[B1] {830} d)	shall start the timer T3440 if the UE receives a TRACKING AREA UPDATE REJECT message indicating:


		[B2] {831} -	any of the EMM cause values #9 or #10 and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; or


		[B2] {832} -	the EMM cause values #40, the TRACKING AREA UPDATE message was not triggered due to receiving a paging for CS fallback or a paging for 1xCS fallback, and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending;


	[B1] {833} e)	shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating any of the EMM cause values #9, #10 or #40 as a response to a SERVICE REQUEST message CONTROL PLANE SERVICE REQUEST message, or an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1";


	[B1] {834} f)	may start the timer T3440 if the UE receives any of the EMM cause values #3, #6, #7 or #8 or if it receives an AUTHENTICATION REJECT message;


	[B1] {835} g)	shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating the EMM cause value #39 and the UE has initiated EXTENDED SERVICE REQUEST in EMM-IDLE and the user plane radio bearers have not been set up; or


	[B1] {836} h)	shall start the timer T3440 if the UE receives a SERVICE REJECT, SERVICE ACCEPT, ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message with control plane data back-off timer.


[Nm] {837} Upon expiry of T3440,


	[B1] {838} -	in cases a, b, c, f and h, the UE shall locally release the established NAS signalling connection; or


	[B1] {839} -	in cases d and e, the UE shall locally release the established NAS signalling connection and the UE shall initiate the attach procedure as described in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.


[Nm] {840} In cases b, c and g,


	[B1] {841} -	upon an indication from the lower layers that the user plane radio bearers are set up, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, the UE shall send the uplink signalling via the existing NAS signalling connection; or


	[B1] {842} -	upon receipt of a DETACH REQUEST message, the UE shall stop timer T3440 and respond to the network initiated detach as specified in subclause 5.5.2.3.


[Nm] {843} In case b,


	[B1] {844} -	upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; 


	[B1] {845} -	upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1;


	[B1] {846} -	upon receipt of ESM DATA TRANSPORT message, as an implementation option, the UE may reset and restart timer T3440;


	[B1] {847} -	upon receipt of a DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, the UE which is in EMM-REGISTERED without PDN connections shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection; or


	[B1] {848} -	upon receipt of an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST, DEACTIVATE EPS BEARER CONTEXT REQUEST, DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, if the UE is using control plane CIoT EPS optimization, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection.


[Nm] {849} In case c,


	[B1] {850} -	upon receiving a request from upper layers to send NAS signalling not associated with establishing a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or


	[B1] {851} -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1.


[Nm] {852} In cases d and e,


	[B1] {853} -	upon an indication from the lower layers that the RRC connection has been released, the UE shall stop timer T3440 and perform a new attach procedure as specified in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; or


	[B1] {854} -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1.


[Nm] {855} In cases a and f,


	[B1] {856} -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1.


[Nm] {857} In case g,


	[B1] {858} -	upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or


	[B1] {859} -	upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1.


[Nm] {860} In case h,


	[B1] {861} -	upon an indication from the lower layers that the user plane radio bearers are set up or upon receiving a request from upper layers to send NAS signalling not associated with ESM DATA TRANSPORT, the UE shall stop timer T3440; or


	[B1] {862} -	the UE shall not send ESM DATA TRANSPORT message until expiry of timer T3440 or times T3440 being stopped.


[Nm] {863} In EMM-CONNECTED mode, if the UE moves to EMM-SERVICE-REQUEST-INITIATED state upon receipt of a CS SERVICE NOTIFICATION message, the UE shall stop timer T3440.


[Nm] {864} In S101 mode, when the cdma2000® HRPD radio access connection has been released, the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released.


[H5] {865} 5.3.1.2.2	UE is using EPS services with control plane CIoT EPS optimization


[Nm] {866} Upon receipt of the indication from the ESM layer to release the NAS signalling connection (see subclause 6.6.4.2), unless the MME has additional downlink user data or signalling pending, the MME shall initiate release of the NAS signalling connection.


[H4] {867} 5.3.1.3	Suspend and resume of the NAS signalling connection


[Nm] {868} Suspend of the NAS signalling connection can be initiated by the network in EMM-CONNECTED mode when user plane CIoT EPS optimization is used. Resume of the suspended NAS signalling connection is initiated by the UE.


[Nm] {869} In the UE, when user plane CIoT EPS optimization is used:


	[B1] {870} -	Upon indication from the lower layers that the RRC connection has been suspended, the UE shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated (see subclause 4.4.2.3 and 4.4.5). Based on further indications provided by the lower layers, the UE shall update the status of the suspend indication for the EMM-IDLE mode;


	[B1] {871} -	Upon trigger of a procedure using an initial NAS message when in EMM-IDLE mode with suspend indication, the UE shall:


		[B2] {872} i)	if the initial NAS message is a TRACKING AREA UPDATE REQUEST message which includes a UE radio capability information update needed IE, enter EMM-IDLE mode without suspend indication and proceed with the tracking area updating procedure; and


		[B2] {873} ii)	otherwise, request the lower layer to resume the RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type according to annex D of this document;


	[B1] {874} -	Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-CONNECTED mode. If the pending NAS message is:


		[B2] {875} i)	a SERVICE REQUEST message;


		[B2] {876} ii)	a CONTROL PLANE SERVICE REQUEST message, and the UE did not include any ESM message container, NAS message container or EPS bearer context status information elements; or


		[B2] {877} iii)	an EXTENDED SERVICE REQUEST message, and the Service type information element indicates "packet services via S1" and the UE did not include any EPS bearer context status information element,


	[B1] {878} 	the message shall not be sent. Otherwise the UE shall cipher the message as specified in subclause 4.4.5 and send the pending initial NAS message upon entering EMM-CONNECTED mode;


	[B1] {879} -	Upon fallback indication from the lower layers at RRC connection resume when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-IDLE mode without suspend indication, send any pending initial NAS message and proceed as if RRC connection establishment had been requested;


	[B1] {880} -	Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is suspended, the UE shall enter EMM-IDLE mode with suspend indication and restart the ongoing NAS procedure if required; and


	[B1] {881} -	Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is not suspended, the UE shall enter EMM-IDLE mode without suspend indication and restart the ongoing NAS procedure if required.


[Nm] {882} In the network, when user plane CIoT EPS optimization is used:


	[B1] {883} -	Upon indication from the lower layers that the RRC connection has been suspended, the network shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated; and


	[B1] {884} -	Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the network shall enter EMM-CONNECTED mode.


	[B1] {885} For the case that not all suspended bearers are resumed, see subclause 6.4.4.6.


[H3] {886} 5.3.2	Lists of forbidden tracking areas


[Nm] {887} The UE shall store a list of "forbidden tracking areas for roaming", as well as a list of "forbidden tracking areas for regional provision of service". These lists shall be erased when the UE is switched off or when the UICC containing the USIM is removed, and periodically (with a period in the range 12 to 24 hours). When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21]. One or more tracking areas is removed from the list of "forbidden tracking areas for roaming" in the UE, as well as the list of "forbidden tracking areas for regional provision of service" if, after a subsequent procedure e.g. attach procedure, tracking area updating procedure and GUTI reallocation procedure, one or more tracking areas in the lists is received from the network. If the UE has only one PDN connection established which is for emergency bearer services, the tracking areas shall not be removed from these lists if one or more tracking areas in the lists are received from the network.


[Nm] {888} In S1 mode, the UE shall update the suitable list whenever an ATTACH REJECT, TRACKING AREA UPDATE REJECT, SERVICE REJECT or DETACH REQUEST message is received with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area".


[Nm] {889} Each list shall accommodate 40 or more TAIs. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.


[H3] {890} 5.3.3	List of forbidden PLMNs for attach in S101 mode


[Nm] {891} A UE supporting S101 mode shall store a list of "forbidden PLMNs for attach in S101 mode". The UE shall erase this list when the UE is switched off or when the USIM is removed.


[Nm] {892} In S101 mode, the UE shall add to the "forbidden PLMNs for attach in S101 mode" list the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover whenever an ATTACH REJECT message is received with the EMM cause #11 "PLMN not allowed", #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", #14 "EPS services not allowed in this PLMN", #15 "no suitable cells in tracking area", or #35 "Requested service option not authorized in this PLMN" as specified in subclause 5.5.1.2.5.


[Nm] {893} The maximum number of possible entries in the "forbidden PLMNs for attach in S101 mode" list is implementation dependent, but the list shall accommodate at least one PLMN identity. When the list is full and a new PLMN identity has to be inserted, the UE shall delete the oldest PLMN identity.


[H3] {894} 5.3.3a	Forbidden PLMNs for EPS services


[Nm] {895} The forbidden PLMNs for EPS services are contained in the "forbidden PLMNs for GPRS service" list, as defined in 3GPP TS 24.008 [13]. The UE updates this list as part of the attach procedure, tracking area updating procedure and network initiated detach procedure as described respectively in subclauses 5.5.1, 5.5.3 and 5.5.2.3.2.


[H3] {896} 5.3.4	Equivalent PLMNs list


[Nm] {897} The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by EMM, GMM and MM.


[Nm] {898} The UE shall update or delete this list at the end of each attach or combined attach or tracking area updating or combined tracking area updating procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. When the UE is switched off, it shall keep the stored list so that it can be used for PLMN selection after switch on. The UE shall delete the stored list if the USIM is removed or when the UE attached for emergency bearer services or access to RLOS enters the state EMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.


[H3] {899} 5.3.5	Handling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)


[Nm] {900} The periodic tracking area updating procedure is used to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by timer T3412. The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE until a new value is received.


[Nm] {901} If timer T3412 received by the UE in an ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, then timer T3412 is deactivated and the UE shall not perform the periodic tracking area updating procedure.


[Nm] {902} Timer T3412 is reset and started with its initial value, when the UE changes from EMM-CONNECTED to EMM-IDLE mode. Timer T3412 is stopped when the UE enters EMM-CONNECTED mode or the EMM-DEREGISTERED state.


[Nm] {903} If the UE is attached for emergency bearer services, and timer T3412 expires, the UE shall not initiate a periodic tracking area updating procedure, but shall locally detach from the network. When the UE is camping on a suitable cell, it may re-attach to regain normal service.


[Nm] {904} When a UE is not attached for emergency bearer services, and timer T3412 expires, the periodic tracking area updating procedure shall be started and the timer shall be set to its initial value for the next start.


[Nm] {905} If the UE is not attached for emergency bearer services, and is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3412 expires, the periodic tracking area updating procedure is delayed until the UE returns to EMM-REGISTERED.NORMAL-SERVICE.


[Nm] {906} If ISR is activated, the UE shall keep both timer T3412 and timer T3312. The two separate timers run in the UE for updating MME and SGSN independently. The UE shall start timer T3423, if timer T3412 expires, and timer T3346 is running or the UE is in:


	[B1] {907} -	EMM-REGISTERED.NO-CELL-AVAILABLE;


	[B1] {908} -	EMM-REGISTERED.PLMN-SEARCH;


	[B1] {909} -	EMM-REGISTERED.UPDATE-NEEDED; or


	[B1] {910} -	EMM-REGISTERED.LIMITED-SERVICE.


[Nm] {911} The UE shall initiate the tracking area updating procedure and stop timer T3423 when it enters state EMM-REGISTERED.NORMAL-SERVICE before timer T3423 expires. After expiry of timer T3423 the UE shall set its TIN to "P-TMSI".


[Nm] {912} If timer T3423 expires the UE shall memorize that it has to initiate a tracking area updating procedure when it returns to state EMM-REGISTERED.NORMAL-SERVICE.


[Nm] {913} If the UE is attached to both EPS and non-EPS services, and if timer T3412 expires or timer T3423 expires when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, then the UE shall initiate the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" when the UE returns to EMM-REGISTERED.NORMAL-SERVICE state.


[Nm] {914} When the network includes T3412 extended value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, the network uses timer T3412 extended value IE as the value of timer T3412.


[Nm] {915} The network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer.


[Nm] {916} If the UE is not attached for emergency bearer services, the mobile reachable timer shall be longer than T3412. In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3412.


[Nm] {917} If ISR is not activated, the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.


[Nm] {918} If the UE is attached for emergency bearer services, the MME shall set the mobile reachable timer with a value equal to timer T3412. When the mobile reachable timer expires, the MME shall locally detach the UE.


[Nm] {919} The mobile reachable timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.


[Nm] {920} Upon expiry of the mobile reachable timer the network shall start the implicit detach timer. The value of the implicit detach timer is network dependent. If ISR is activated, the default value of the implicit detach timer is 4 minutes greater than timer T3423. If the implicit detach timer expires before the UE contacts the network, the network shall implicitly detach the UE. If the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or the SERVICE REJECT message and timer T3346 is greater than timer T3412, the MME sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346.


[Nm] {921} If the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message,and if the UE is not attached for emergency bearer services and has no PDN connection for emergency bearer services the MME shall set the active timer to a value equal to the value of timer T3324.


[Nm] {922} If the UE has established a PDN connection for emergency services after receiving the timer T3324 value IE in the ATTACH ACCEPT message or the last TRACKING AREA UPDATE ACCEPT message, the active timer shall not be started.


[Nm] {923} The active timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The active timer shall be stopped when an NAS signalling connection is established for the UE.


[Nm] {924} The network behaviour upon expiry of the active timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.


[Nm] {925} The implicit detach timer shall be stopped when a NAS signalling connection is established for the UE.


[H3] {926} 5.3.6	Handling of timer T3402


[Nm] {927} The value of timer T3402 can be sent by the network to the UE in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. If the value is different from "deactivated", the UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.


[Nm] {928} The value of timer T3402 can be sent by the network to the UE in the ATTACH REJECT message. If an ATTACH REJECT message including timer T3402 value different from "deactivated", was received integrity protected, the UE shall apply this value until a new value is received with integrity protection or a new PLMN is selected. Otherwise, the default value of this timer is used.


[Nm] {929} The default value of T3402 is also used by the UE if:


	[B1] {930} -	ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message is received without a value specified;


	[B1] {931} -	the network indicates that the timer is "deactivated";


	[B1] {932} -	the UE does not have a stored value for this timer;


	[B1] {933} -	a new PLMN which is not in the list of equivalent PLMNs has been entered, the tracking area updating fails and the tracking area updating attempt counter is equal to 5; or


	[B1] {934} -	a new PLMN which is not in the list of equivalent PLMNs has been entered, the attach procedure fails, the attach attempt counter is equal to 5 and no ATTACH REJECT message was received from the new PLMN.


[H3] {935} 5.3.7	Handling of the Local Emergency Numbers List and the Extended Local Emergency Numbers List


[Nm] {936} The Local Emergency Numbers List and the Extended Local Emergency Numbers list contain additional local emergency numbers used by the serving network. These lists can be downloaded by the network to the UE at successful registration and subsequent registration updates. There is only one Local Emergency Numbers List and only one Extended Local Emergency Numbers list in the UE. The Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode, with GMM and MM procedures if the UE is in A/Gb or Iu mode, and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode. The Extended Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode.


[Nm] {937} The UE shall use the stored Local Emergency Numbers List and the stored Extended Local Emergency Numbers List received from the network in addition to the emergency numbers stored on the USIM or user equipment to detect that the number dialled is an emergency number.


[Nm] {938} If the UE determines that the number dialled is an emergency number, the procedures specified in 3GPP TS 23.167 [45] and 3GPP TS 24.229 [13D] are utilised to select a domain for the emergency session attempt.


[Nm] {939} If the domain selected for the emergency session attempt is the PS domain, then the UE shall perform the session establishment procedures specified in 3GPP TS 24.229 [13D] to initiate an emergency session.


[Nm] {940} If the domain selected for the emergency session attempt is the CS domain (e.g. the UE has selected GERAN or UTRAN radio access technology), then the UE shall use the stored Local Emergency Numbers List, in addition to the emergency numbers stored on the USIM and the ME, to determine if:


	[B1] {941} -	the UE is to send an EXTENDED SERVICE REQUEST message:


		[B2] {942} 1)	for CS fallback, indicating "mobile originating CS fallback or 1xCS fallback"; or


		[B2] {943} 2)	for CS fallback for emergency call, indicating "mobile originating CS fallback emergency call or 1xCS fallback emergency call"; and


	[B1] {944} -	the call control entity of the UE specified in 3GPP TS 24.008 [13] is to send an EMERGENCY SETUP message or a SETUP message to the network.


[Nm] {945} The network may send a Local Emergency Numbers List or an Extended Local Emergency Numbers List or both, in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT messages, by including the Emergency number list IE and the Extended emergency number list IE, respectively. The user equipment shall store the Local Emergency Numbers List and the Extended Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Emergency number list IE. The Extended Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Extended emergency number list IE. The received Local Emergency Numbers List or the received Extended Local Emergency Numbers list or both shall be provided to the upper layers.


[Nm] {946} The emergency number(s) received in the Emergency number list IE are valid only in networks in the same country as the PLMN from which this IE is received. If no Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, then the stored Local Emergency Numbers List in the user equipment shall be kept, except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.


[Nm] {947} The emergency number(s) received in the Extended emergency number list IE are valid only in:


	[B1] {948} -	networks in the same country as the PLMN from which this IE is received, if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received"; and


	[B1] {949} -	 the PLMN from which this IE is received, if the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received".


[Nm] {950} If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, and the registered PLMN has not changed, then the stored Extended Local Emergency Numbers List in the user equipment shall be kept. If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, but the registered PLMN has changed, then:


	[B1] {951} -	if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received", the stored Extended Local Emergency Numbers List in the user equipment shall be deleted; and


	[B1] {952} -	if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received" the list shall be kept except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.


[Nm] {953} The Local Emergency Numbers List and the Extended Local Emergency Numbers List shall be deleted at switch off and removal of the USIM. The user equipment shall be able to store up to ten entries in the Local Emergency Numbers List and up to twenty entries in the Extended Local Emergency Numbers List, received from the network.


[H3] {954} 5.3.7a	Specific requirements for UE configured to use timer T3245


[Nm] {955} The following requirement applies for an UE that is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]):


[Nm] {956} When the UE adds a PLMN identity to the "forbidden PLMN list", the "forbidden PLMNs for attach in S101 mode" list, or the "forbidden PLMNs for GPRS service" list or sets the USIM as invalid for non-EPS services or EPS services or both, and timer T3245 (see 3GPP TS 24.008 [13]) is not running, the UE shall start timer T3245 as specified in 3GPP TS 24.008 [13], subclause 4.1.1.6.


[Nm] {957} Upon expiry of the timer T3245, the UE shall erase the "forbidden PLMN list", the "forbidden PLMNs for GPRS service" list, and the "forbidden PLMNs for attach in S101 mode" list and set the USIM to valid for non-EPS and EPS services. When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21].


[Nm] {958} If the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:


	[B1] {959} -	let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.


[H3] {960} 5.3.7b	Specific requirements for UE when receiving non-integrity protected reject messages


[Nm] {961} This subclause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific EMM causes.


[Nm] {962} The UE may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters (see 3GPP TS 24.008 [13]). The maximum number of possible entries in each list is implementation dependent.


[Nm] {963} Additionally, the UE may maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events and one counter for "SIM/USIM considered invalid for GPRS services" events (see 3GPP TS 24.008 [13]).


[Nm] {964} If the UE receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with EMM cause value #3, #6, #7, #8, #11, #12, #13, #14, #15, #31 or #35 before the network has established secure exchange of NAS messages for the NAS signalling connection, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running. Additionally, the UE shall take the following actions:


	[B1] {965} 1)	if the EMM cause value received is #3, #6, #7 or #8, and


		[B2] {966} a)	if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, the UE shall:


			[B3] {967} i)	set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI;


			[B3] {968} -	delete the list of equivalent PLMNs;


			[B3] {969} -	increment the counter for "SIM/USIM considered invalid for GPRS services" events;


			[B3] {970} -	if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation-specific maximum value, increment the counter;


			[B3] {971} -	if an attach or tracking area updating procedure was performed, reset the attach attempt counter or the tracking area updating attempt counter, respectively;


			[B3] {972} -	if A/Gb mode or Iu mode is supported by the UE, handle the GMM parameters GPRS attach attempt counter or routing area updating attempt counter, GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the GPRS attach or routing area updating procedure is rejected with the GMM cause of the same value in a NAS message without integrity protection;


			[B3] {973} -	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, TAI list, ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection.


			[B3] {974} -	store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and


			[B3] {975} -	search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21]; or


			[B3] {976} ii)	proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1;


			[B3] {977} -	increment the counter for "SIM/USIM considered invalid for GPRS services" events; and


			[B3] {978} -	if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation specific maximum value, increment the counter; and


		[B2] {979} b)	else the UE shall proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1;


	[B1] {980} 2)	if the EMM cause value received is #12, #13 or #15, the UE shall additionally proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1;


	[B1] {981} 3)	if the EMM cause value received is #11, #14 or #35 and the UE is in its HPLMN or EHPLMN,


		[B2] {982} -	the UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs. Additionally, if an attach or tracking area updating procedure was performed, the UE shall reset the attach attempt counter or the tracking area updating attempt counter, respectively.


		[B2] {983} -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the procedure is rejected with the GMM cause with the same value in a NAS message without integrity protection; 


		[B2] {984} -	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, TAI list, ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection.


		[B2] {985} -	the UE shall store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and


		[B2] {986} -	the UE shall search for a suitable cell in another tracking area or in another location area in the same PLMN according to 3GPP TS 36.304 [21];


	[B1] {987} 4)	if the EMM cause value received is #11 or #35 and the UE is not in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause 5.5.1, 5.5.3 and 5.6.1,


		[B2] {988} 	if the UE maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for the PLMN; and


	[B1] {989} 5)	if the EMM cause value received is #14 and the UE is not roaming in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause5.5.1, 5.5.3 and 5.6.1,


		[B2] {990} 	if the UE maintains a list of PLMN-specific PS-attempt counter and the PLMN-specific PS-attempt counter of the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PS-attempt counter of the PLMN.


	[B1] {991} 6)	if the EMM cause value received is #31 for a UE that has indicated support for CIoT optimizations, the UE may discard the message or alternatively the UE should:


		[B2] {992} -	set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3);


		[B2] {993} -	store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message; and


		[B2] {994} -	search for a suitable cell in another tracking area according to 3GPP TS 36.304 [21].


[Nm] {995} Upon expiry of timer T3247, the UE shall


	[B1] {996} -	remove all tracking areas from the list of "forbidden tracking areas for regional provision of service" and the list of "forbidden tracking areas for roaming", which were stored in these lists for non-integrity protected NAS reject message;


	[B1] {997} -	set the USIM to valid for EPS services, if


		[B2] {998} -	the UE does not maintain a counter for "SIM/USIM considered invalid for GPRS services" events; or


		[B2] {999} -	the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;


	[B1] {1000} -	set the USIM to valid for non-EPS services, if


		[B2] {1001} -	the UE does not maintain a counter for "SIM/USIM considered invalid for non-GPRS services" events; or


		[B2] {1002} -	the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;


	[B1] {1003} -	if the UE maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list;


	[B1] {1004} -	if the UE maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than a UE implementation-specifc maximum value, remove the respective PLMN from the "forbidden PLMNs for GPRS service" list. If the resulting "forbidden PLMNs for GPRS service" list is empty, the UE shall re-enable the E-UTRA capability (see subclause 4.5);


	[B1] {1005} -	if the UE is supporting A/Gb mode or Iu mode, handle the list of "forbidden location areas for regional provision of service" and the list of "forbidden location areas for roaming" as specified in 3GPP TS 24.008 [13] for the case when timer T3247 expires;


	[B1] {1006} -	if the UE is supporting A/Gb mode or Iu mode and maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", handle these lists as specified in 3GPP TS 24.008 [13] for the case when timer T3247 expires; and


	[B1] {1007} -	initiate an EPS attach procedure or tracking area updating procedure, if still needed, dependent on EMM state and EPS update status, or perform PLMN selection according to 3GPP TS 23.122 [6].


[Nm] {1008} If the UE maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the UE is switched off, the UE shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the USIM is removed, the UE should perform this action.


[Nm] {1009} The PLMN-specific attempt counter and the PLMN-specific PS-attempt counter shall be reset when the UICC containing the USIM is removed or the PLMN is added to a list of "forbidden PLMNs" in the USIM as specified in 3GPP TS 23.122 [6].


[H3] {1010} 5.3.8	Abnormal cases in the UE


[Nm] {1011} The following abnormal case can be identified:


	[B1] {1012} a)	EMM uplink message transmission failure indication by lower layers


	[B1] {1013} 	When it is specified in the relevant procedure that it is up to the UE implementation to rerun the ongoing procedure that triggered that procedure, the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.


[H3] {1014} 5.3.9	Handling of NAS level mobility management congestion control


[Nm] {1015} The network may detect EMM signalling congestion and perform NAS level mobility management congestion control. NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control.


[Nm] {1016} Under general overload conditions the network may reject mobility management signalling requests from UEs as specified in 3GPP TS 23.401 [10]. The network should not reject the following requests:


	[B1] {1017} -	requests for emergency bearer services;


	[B1] {1018} -	DETACH REQUEST message;


	[B1] {1019} -	service request or tracking area update request triggered by paging ;


	[B1] {1020} -	requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 – 15"; and


	[B1] {1021} -	requests for CS fallback emergency call or 1xCS fallback emergency call.


[Nm] {1022} When subscribed APN based mobility management congestion control is active for a particular APN, the network may reject attach requests from UEs with a subscription to this APN.


[Nm] {1023} In mobility management the network may detect NAS signalling congestion and start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:


	[B1] {1024} -	rate of mobility management NAS messages from a group of UEs with a subscription to a particular APN exceeds or falls below certain thresholds; and/or


	[B1] {1025} -	setting in network management.


[Nm] {1026} When the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3346 in the reject messages. The UE starts the timer T3346 with the value received in the mobility management reject messages. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised.


[Nm] {1027} For subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.


[Nm] {1028} If the timer T3346 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3346 is kept running until it expires or it is stopped.


[Nm] {1029} If the UE is switched off when the timer T3346 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:


	[B1] {1030} -	let t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1; and


	[B1] {1031} -	if prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority", then if timer T3346 is restarted at switch on, the UE configured for dual priority shall handle mobility management requests as indicated in subclauses 5.5.1.2.6, 5.5.3.2.6 and 5.6.1.6.


[Nm] {1032} If the UE enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the UE shall stop timer T3346 when initiating mobility management procedures in the new PLMN.


[Nm] {1033} After change in TAI which is not part of TAI list, if the timer T3346 is running and EMM update status is EU1 UPDATED then UE shall set the EMM update status to EU2 NOT UPDATED and enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


[H3] {1034} 5.3.9A	Handling of congestion control for transport of user data via the control plane


[Nm] {1035} The network may activate congestion control for transport of user data via the control plane, as specified in 3GPP TS 23.401 [10].


[Nm] {1036} If the congestion control for transport of user data via the control plane is active and if the UE has indicated support for the control plane data back-off timer, the network shall include a value for the control plane data back-off timer T3448 in ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, and shall store an control plane data back-off time on a per UE basis. The UE starts the timer T3448 with the value informed in the message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised.


[Nm] {1037} The network sends TRACKING AREA UPDATE ACCEPT message or SERVICE ACCEPT message without T3448 value IE to stop the timer T3448 running in the UE as specified in subclause 5.5.3.2.4 and subclause 5.6.1.4.2.


[Nm] {1038} Based on the stored control plane data back-off time for the UE, the network may reject the transfer of user data via the control plane initiated by the UE.


[Nm] {1039} While the timer T3448 is running, the UE in EMM-IDLE mode shall not initiate the transport of user data via the control plane procedure (see subclause 6.6.4), except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and the user data is related to an exceptional event. 


[Nm] {1040} Upon entering the state EMM-DEREGISTERED or a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, or upon being switched off while the timer T3448 is running, the UE shall stop the timer T3448. For further criteria to stop of timer T3448, refer to subclause 5.5.3.2.4 and subclause 5.6.1.4.2.


[H3] {1041} 5.3.10	Access class control


[Nm] {1042} The network can restrict the access for certain groups of UEs by means of barring their access class.


[Nm] {1043} The UE shall evaluate the access control information as specified in 3GPP TS 36.331 [22] for:


	[B1] {1044} -	Access Class Barring; 


	[B1] {1045} -	Access Control for CSFB and Extended Access Barring (EAB); 


	[B1] {1046} -	Access Control for Application specific Congestion control for Data Communication (ACDC), if the UE supports ACDC; and


	[B1] {1047} -	Access Barring.


[H3] {1048} 5.3.11	Power saving mode


[Nm] {1049} The UE can request the use of power saving mode (PSM) during an attach or tracking area updating procedure (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of PSM during:


	[B1] {1050} -	an attach for emergency bearer services procedure;


	[B1] {1051} -	an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach"; 


	[B1] {1052} -	a tracking area updating procedure for initiating a PDN connection for emergency bearer services;


	[B1] {1053} -	a tracking area updating procedure when the UE has a PDN connection established for emergency bearer services; or


	[B1] {1054} -	an attach for access to RLOS.


[Nm] {1055} The network accepts the use of PSM by providing a specific value for timer T3324 when accepting the attach or tracking area updating procedure. The UE may use PSM only if the network has provided the T3324 value IE during the last attach or tracking area updating procedure with a value different from "deactivated".


[Nm] {1056} Upon expiry of the timer T3324 or if the T3324 value provided by the network is zero, the UE may deactivate the AS layer and activate PSM by entering the state EMM-REGISTERED.NO-CELL-AVAILABLE if:


	[B1] {1057} a)	the UE is not attached for emergency bearer services;


	[B1] {1058} b)	the UE has no PDN connection for emergency bearer services;


	[B1] {1059} c)	the UE is in EMM-IDLE mode;


	[B1] {1060} d)	in the EMM-REGISTERED.NORMAL-SERVICE state; and


	[B1] {1061} e)	the UE is not attached for access to RLOS.


[Nm] {1062} If conditions a, b, c and e are fulfilled, but the UE is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3324 expires, the UE may activate PSM when the MS returns to state EMM-REGISTERED.NORMAL-SERVICE.


[Nm] {1063} A UE that has already been allocated timer T3324 with a value different from "deactivated" and the timer T3324 has expired, may activate PSM if it receives an "Extended wait time" from lower layers.


[Nm] {1064} When PSM is activated all NAS timers are stopped and associated procedures aborted except for T3412, T3346, T3396, T3447, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs (see 3GPP TS 23.122 [6]).


[Nm] {1065} If the UE is attached for emergency bearer services or has a PDN connection for emergency bearer services, the UE shall not activate PSM.


[Nm] {1066} If the UE is attached for access to RLOS, the UE shall not activate PSM.


[Nm] {1067} The UE may deactivate PSM and activate the AS layer at any time. Upon deactivating PSM, the UE may initiate EMM procedures (e.g. for the transfer of mobile originated signalling or user data).


[H3] {1068} 5.3.12	Extended idle-mode DRX cycle


[Nm] {1069} The UE may request the use of extended idle-mode DRX cycle (eDRX) during an attach or tracking area updating procedure by including the extended DRX parameters IE (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of eDRX during:


	[B1] {1070} -	an attach for emergency bearer services procedure;


	[B1] {1071} -	a tracking area updating procedure for the UE attached for emergency bearer services; or


	[B1] {1072} -	an attach for access to RLOS.


[Nm] {1073} The UE and the network may negotiate eDRX parameters during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services.


[Nm] {1074} The network accepts the request to use the eDRX by providing the extended DRX parameters IE when accepting the attach or the tracking area updating procedure. The UE shall use eDRX only if it received the extended DRX parameters IE during the last attach or tracking area updating procedure and the UE does not have a PDN connection for emergency bearer services.


[Nm] {1075} If the UE received the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the UE shall resume eDRX.


[Nm] {1076} If the network has provided the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the network shall resume eDRX.


[Nm] {1077} If the UE or the network locally releases the PDN connection for emergency bearer service, the UE or the network shall not use eDRX until the UE receives eDRX parameters during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure.


[Nm] {1078} If the UE did not receive the extended eDRX parameters IE, or if the UE has a PDN connection for emergency bearer services, the UE shall use the stored UE specific DRX parameter, if available.


[Nm] {1079} If the network did not accept the request to use eDRX, or if the UE has a PDN connection for emergency bearer services, the network shall use the stored UE specific DRX parameter, if available.


[Nm] {1080} If the network provided the extended DRX parameters IE which was different from the one requested by the UE and also assigned a new GUTI for the UE as described in subclause 5.5.3.2.4 during the last tracking area updating procedure, the network shall use the stored UE specific DRX parameter, if available, with the old GUTI and use the eDRX provided by the network with the new GUTI until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4).


[H3] {1081} 5.3.13	Interaction between power saving mode and extended idle mode DRX cycle


[Nm] {1082} The UE can request the use of both PSM and eDRX during an attach or tracking area updating procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]).


[Nm] {1083} If the network accepts the use of both PSM (see subclause 5.3.11) and eDRX (see subclause 5.3.12), the extended DRX parameters IE provided to the UE should allow for multiple paging occasions before the active timer expires.


[H3] {1084} 5.3.14	Dedicated core network


[Nm] {1085} The network may reject mobility management signalling requests from UEs due to dedicated core network as specified in 3GPP TS 23.401 [10]. When the network rejects mobility management signalling requests due to dedicated core network, the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 shall be followed.


[H3] {1086} 5.3.15	CIoT EPS optimizations


[Nm] {1087} CIoT EPS optimizations provide improved support of small data and SMS transfer. A UE supporting CIoT EPS optimizations can indicate the CIoT network behaviour the UE can support and prefers to use during attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE may indicate the support for control plane CIoT EPS optimization, user plane CIoT EPS optimization, EMM-REGISTERED without PDN connection, S1-U data transfer and header compression (see subclause 9.9.3.34). The UE may also request to use SMS transfer without combined attach procedure during the attach procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization (see subclause 9.9.3.0B). The indication of preference is also considered as the request to use. A UE supporting CIoT 5GS optimizations can also indicate the 5GS CIoT network behaviour the UE can support during attach or tracking area updating procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization.


[Nm] {1088} The UE can be in NB-S1 mode or WB-S1 mode when requesting the use of CIoT EPS optimizations during an attach or tracking area updating procedure. A UE in NB-S1 mode always indicates support for control plane CIoT EPS optimization. A UE in NB-S1 mode can also request SMS transfer without combined procedure by using the normal attach or tracking area updating procedure (see subclause 5.5.1 and 5.5.3).


[Nm] {1089} In NB-S1 mode, the UE, when requesting the use of CIoT EPS optimization, does not:


	[B1] {1090} -	request an attach for emergency bearer services procedure;


	[B1] {1091} -	request an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach";


	[B1] {1092} -	indicate voice domain preference and UE's usage setting; or


	[B1] {1093} -	request an attach for access to RLOS.


[Nm] {1094} The network does not indicate to the UE support of emergency bearer services when the UE is in NB-S1 mode (see subclause 5.5.1.2.4 and 5.5.3.2.4).


[Nm] {1095} The control plane CIoT EPS optimization enables support of efficient transport of user data (IP, non-IP, Ethernet) or SMS messages over control plane via the MME without triggering data radio bearer establishment. The support of control plane CIoT EPS optimization is mandatory for the network in NB-S1 mode and optional in WB-S1 mode. Optional header compression of IP data can be applied to IP PDN type PDN connections that are configured to support header compression.


[Nm] {1096} The user plane CIoT EPS optimization enables support for change from EMM-IDLE mode to EMM-CONNECTED mode without the need for using the service request procedure (see subclause 5.3.1.3).


[Nm] {1097} If the UE indicates support of EMM-REGISTERED without PDN connection in the attach request, the UE may include an ESM DUMMY MESSAGE instead of a PDN CONNECTIVITY REQUEST message as part of the attach procedure. If the EMM-REGISTERED without PDN connection is supported by the network, the UE and the network can at any time release all the PDN connections and the UE still remains EPS attached.


[Nm] {1098} In NB-S1 mode, if the UE indicates "SMS only" during a normal attach or tracking area updating procedure, the MME supporting CIoT EPS optimisations provides SMS so that the UE is not required to perform a combined attach or tracking area updating procedure.


[Nm] {1099} If the UE supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.


[Nm] {1100} If the UE indicates support of one or more CIoT EPS optimizations and the network supports one or more CIoT EPS optimizations and decides to accept the attach or tracking area update request, the network indicates the supported CIoT EPS optimizations to the UE per TAI list when accepting the UE request. Network indication of support is interpreted by the UE as the acceptance to use the respective feature. After completion of the attach or tracking area updating procedure, the UE and the network can then use the accepted CIoT EPS optimizations for the transfer of user data (IP, non-IP, Ethernet and SMS).


[Nm] {1101} The UE supporting control plane CIoT EPS optimization may indicate support for control plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports control plane MT-EDT and for which the network has accepted the use of control plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for control plane MT-EDT as specified in 3GPP TS 23.401 [10].


[Nm] {1102} The UE supporting user plane CIoT EPS optimization may indicate support for user plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports user plane MT-EDT and for which the network has accepted the use of user plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for user plane MT-EDT as specified in 3GPP TS 23.401 [10].


[Nm] {1103} If the UE and the network support both the control plane CIoT EPS optimization and S1-U data transfer, then when receiving the UE's request for a PDN connection, the MME decides whether the PDN connection should be SCEF PDN connection or SGi PDN connection as specified in 3GPP TS 23.401 [10]:


	[B1] {1104} -	if SCEF PDN connection is to be established for non-IP data type, the MME shall include Control plane only indication for the requested PDN connection; 


	[B1] {1105} -	if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established with Control plane only indication, the MME shall include Control plane only indication for the newly requested SGi PDN connection;


	[B1] {1106} -	if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established without Control plane only indication, the MME shall not include Control plane only indication for the newly requested SGi PDN connection; and


	[B1] {1107} -	if SGi PDN connection is to be established and no SGi PDN connection for this UE exists, the MME determine whether to include Control plane only indication for the requested SGi PDN connection based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour.


[Nm] {1108} If the network supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.


[Nm] {1109} Broadcast system information may provide information about support of CIoT EPS optimizations (see 3GPP TS 36.331 [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT EPS optimizations are supported in the cell.


[Nm] {1110} The UE shall not attempt to use CIoT EPS optimizations which are indicated as not supported.


[Nm] {1111} In NB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. If the UE requests the use of S1-U data transfer without user plane CIoT optimization, then the UE shall also pass an indication of user plane CIoT EPS optimization to lower layers.


[Nm] {1112} In WB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection, control plane CIoT EPS optimization or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers.


[H3] {1113} 5.3.16	Restriction on use of enhanced coverage


[Nm] {1114} In order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP TS 23.401 [10]). When in NB-S1 mode, the UE shall indicate support for restriction on use of enhanced coverage. When in WB-S1 mode, the UE supporting either CE mode A or CE mode B shall indicate support for restriction on use of enhanced coverage. The UE supporting restriction on use of enhanced coverage indicates its support for restriction on use of enhanced coverage in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports restriction on use of enhanced coverage, the MME indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). If the use of enhanced coverage is restricted, the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.


[Nm] {1115} If the UE supports CE mode B and the network determines that


	[B1] {1116} -	the use of enhanced coverage is not restricted for the UE; or


	[B1] {1117} -	CE mode B is not restricted for the UE;


[Nm] {1118} the applicable NAS timer values shall be calculated by the network as described in subclause 4.8.


[H3] {1119} 5.3.17	Service Gap Control


[Nm] {1120} The network may control the frequency UEs can transit from EMM-IDLE mode to EMM-CONNECTED mode via the service gap control (SGC) as specified in 3GPP TS 23.401 [10]. If the network supports service gap control (SGC) feature and the service gap time value is available in the EMM context of the UE, the MME shall consider SGC as active for the UE.


[Nm] {1121} The UE and the network negotiate usage of the service gap control (SGC) feature during the attach and tracking area updating procedures: 


	[B1] {1122} -	the UE supporting service gap control indicates its support for service gap control in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports service gap control and the the SGC is active for the UE, the MME shall include service gap timer T3447 value in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). The UE shall store the service gap time value; and


	[B1] {1123} -	for UEs that do not support the optional SGC feature when the network rejects mobility management signalling requests due to service gap control is active in the network, the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 applies.


[Nm] {1124} The UE shall start the SGC timer T3447 when the NAS signalling connection is released and if:


	[B1] {1125} -	the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and


	[B1] {1126} -	the NAS signalling connection released was not established for:


		[B2] {1127} -	paging;


		[B2] {1128} -	attach requests without PDN connection request; or


		[B2] {1129} -	tracking area update requests without "active" or "signalling active" flag set.


[Nm] {1130} If the SGC is active in the network, after the UE transitions from EMM-CONNECTED mode to EMM-IDLE mode except when the UE was in EMM-CONNECTED mode due to:


	[B1] {1131} -	paging;


	[B1] {1132} -	attach requests without PDN connection request; or


	[B1] {1133} -	tracking area update requests without "active" or "signalling active" flag set,


[Nm] {1134} the network shall start the SGC timer T3447:


	[B1] {1135} -	with the service gap time value available in the EMM context minus 4 minutes, if the UE supports SGC feature and the service gap time value has been sent to the UE with a non-zero value; or


	[B1] {1136} -	with the service gap time value available in the EMM context if the UE does not support SGC feature.


[Nm] {1137} When the SGC timer T3447 is running, the network allows:


	[B1] {1138} -	requests for emergency bearer services;


	[B1] {1139} -	requests for exception data reporting;-	attach requests without PDN connection request;


	[B1] {1140} -	tracking area update requests without "active" or "signalling active" flag set;


	[B1] {1141} -	requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 – 15"; and


	[B1] {1142} -	mobile terminated service requests triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters EMM-IDLE mode.


[Nm] {1143} If the MME determines that the UE operating in single-registration mode has performed an inter-system change from S1 mode to N1 mode and the timer T3447 is running in the MME, the MME stops the T3447.


[Nm] {1144} Upon inter-system change from N1 mode to S1 mode, if the UE supports service gap control, T3447 is running in the UE, and the T3447 value is included in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message received from the MME (see subclause 5.5.1.2 and subclause 5.5.3.2), the UE shall keep T3447 running. Additionally, the UE shall store and replace the currently stored T3447 value with the received T3447 value. Upon expiry of the running T3447 timer, the UE shall use the new value when starting T3447 again.


[Nm] {1145} The UE or the network with a running service gap timer shall keep the timer running when the UE transits from EMM-IDLE mode to EMM-CONNECTED mode.


[Nm] {1146} If the timer T3447 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3447 is kept running until it expires.


[Nm] {1147} If the UE is switched off when the timer T3447 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:


	[B1] {1148} -	let t1 be the time remaining for T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.


[H3] {1149} 5.3.18	Restricted local operator services


[Nm] {1150} Restricted local operator services (RLOS) is an optional feature that enables operators to offer access to restricted local operator services to the unauthenticated UEs in limited service state (see 3GPP TS 23.401 [10]). Authenticated UEs in limited service state may also be able to access restricted local operator services. The UE requests access to RLOS during the attach procedure by setting the attach type to "EPS RLOS attach" in the ATTACH REQUEST message. Subject to regulation and local operator policy, if the MME is configured to support access to RLOS, the MME accepts the UE's attach request regardless of the authentication result or skips the authentication procedure.


[Nm] {1151} When the UE requests the lower layer to establish an RRC connection for access to RLOS, the UE indicates in the RRC signalling that the RRC connection is for access to RLOS to the lower layers.


[Nm] {1152} Broadcast system information may provide information about support of access to RLOS (see 3GPP TS 36.331 [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine the PLMN is configured to support access to RLOS. The UE shall not attempt to request access to RLOS if the serving PLMN does not support access to RLOS. If the serving PLMN supports access to RLOS and the UE is in limited service state, the UE shall verify that the MCC of the PLMN ID of the serving PLMN is present in the list of access to RLOS allowed MCCs configured in the UE before requesting access to RLOS. If the UE has a valid USIM, the UE shall additionally verify that the MCC part of the IMSI configured in the USIM is present in the list of RLOS allowed MCCs before requesting access to RLOS.


[Nm] {1153} For UE attached for access to RLOS, only UE originated access to RLOS requests are supported. Mobile terminated access to RLOS request and network triggered service request are not allowed. The UE is not allowed to initiate UE requested PDN connectivity for any additional PDN connection. In addition, intersystem change to other RAT including GERAN and UTRAN and handover between 3GPP and non-3GPP accesses are not supported.


[Nm] {1154} Access to RLOS is applicable to the UEs in WB-S1 mode only. The UEs in NB-S1 mode shall not request access to RLOS.


[Nm] {1155} Location service does not apply to access to RLOS.


[Nm] {1156} If a UE attached for access to RLOS needs to initiate an emergency call, the UE shall first perform a local detach prior to initiating an attach procedure for emergency bearer services.


[H3] {1157} 5.3.19	Core Network selection and redirection for UEs using CIoT optimizations


[H4] {1158} 5.3.19.1	Core network selection


[Nm] {1159} A UE that supports CIoT optimizations performs core network selection as specified in subclause 4.8.4A.1 of 3GPP TS 24.501 [54].


[H4] {1160} 5.3.19.2	Redirection of the UE by the core network


[Nm] {1161} The network that supports CIoT optimizations can redirect a UE between EPC and 5GCN as specified in subclause 5.31.3 of 3GPP TS 23.501 [58]. The network can take into account the UE’s N1 mode capability or S1 mode capability, the CIoT network behaviour supported and preferred by the UE or the CIoT network behaviour supported by the network to determine the redirection.


[Nm] {1162} The network redirects the UE to 5GCN by rejecting the attach request, or tracking area update request, or service request with the EMM cause #31 "Redirection to 5GCN required" as specified in subclause 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5. Upon receipt of reject message, the UE disables the E-UTRA capability as specified in subclause 4.5 and enables the N1 mode capability if it was disabled in order to move to 5GCN.


[Nm] {1163} The network that supports CIoT optimizations can also redirect a UE from 5GCN to EPC as specified in subclause 4.8.4A.2 of 3GPP TS 24.501 [54].


[H3] {1164} 5.3.20	UE radio capability signalling optimisation


[Nm] {1165} UE radio capability signalling optimisation (RACS) is a feature that is optional at both the UE and the network and which aims to optimise the transmission of UE radio capability over the radio interface (see 3GPP TS 23.401 [10]). RACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called the UE radio capability ID. A UE radio capability ID can be either manufacturer-assigned or network-assigned. The UE radio capability ID is an alternative to the signalling of the radio capabilities container over the radio interface.


[Nm] {1166} In this release of the specification, RACS is not applicable to NB-S1 mode.


[Nm] {1167} If the UE supports RACS:


	[B1] {1168} -	the UE shall indicate support for RACS by setting the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST messages;


	[B1] {1169} -	if the UE performs an attach procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to "UE radio capability ID available";


	[B1] {1170} -	if the UE performs a tracking area updating procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to "UE radio capability ID available";


	[B1] {1171} -	If the UE is requested to provide its UE radio capability ID by the network during a security mode control procedure, the UE shall include its UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message. If both a network-assigned UE radio capability ID and a manufacturer-assigned UE radio capability ID are applicable, the UE shall include the network-assigned UE radio capability ID in the SECURITY MODE COMPLETE message;


	[B1] {1172} -	if the radio configuration at the UE changes (for instance because the UE has disabled a specific radio capability) then:


		[B2] {1173} a)	if the UE has an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure, include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message and include a UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message. If both a network-assigned UE radio capability ID and a manufacturer-assigned UE Radio Capability ID are applicable, the UE shall include the network-assigned UE radio capability ID in the TRACKING AREA UPDATE REQUEST message; and


		[B2] {1174} b)	if the UE does not have an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure and shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message;


	[B1] {1175} -	upon receiving a network-assigned UE radio capability ID in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message, the UE shall store the network-assigned UE radio capability ID and the PLMN ID of the serving network along with a mapping to the current UE radio configuration in its non-volatile memory as specified in annex C. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs with the associated PLMN ID and the mapping to the corresponding UE radio configuration;


	[B1] {1176} -	the UE shall not use a network-assigned UE radio capability ID in PLMNs equivalent to the PLMN which assigned it; and


	[B1] {1177} -	upon receiving a UE radio capability ID deletion indication IE set to "delete network-assigned UE radio capability IDs" in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message, the UE shall delete all network-assigned UE radio capability IDs stored at the UE for the serving network and initiate a tracking area updating procedure. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include a UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message. 


[Nm] {1178} If the network supports RACS:


	[B1] {1179} -	if the UE has included the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to "UE radio capability ID available", the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;


	[B1] {1180} -	if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to "UE radio capability ID available", the network may initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;


	[B1] {1181} -	if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message, set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE and no UE radio capability ID is available in the UE context in the MME, the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;


	[B1] {1182} -	the network may assign a network-assigned UE radio capability ID to a UE which supports RACS by including a UE radio capability ID IE in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message; and


	[B1] {1183} -	the network may trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving network by including a UE radio capability ID deletion indication IE set to "delete network-assigned UE radio capability IDs" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message.


[H3] {1184} 5.3.21	Wake-up signal assistance


[Nm] {1185} A UE supporting wake-up signal (WUS) assistance can indicate its WUS assistance capability during attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE supporting WUS assistance may include its UE paging probability information in the Requested WUS assistance information IEduring an attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE shall not include its UE paging probability information during:


	[B1] {1186} -	an attach for emergency bearer services procedure; or


	[B1] {1187} -	a tracking area updating procedure for the UE attached for emergency bearer services.


[Nm] {1188} The UE is not attached for emergency bearer services and the network may negotiate the UE paging probability information during an attach or tracking area updating procedure when the UE is not attached for emergency bearer services. The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP TS 23.401 [10], 3GPP TS 36.300 [20]).


[Nm] {1189} If the UE is not attached for emergency bearer services and the network accepts the use of the WUS assistance for the UE, the network determines the negotiated UE paging probability information for the UE based on the requested UE paging probability information, if any, local configuration or previous statistical information for the UE, and then indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE when accepting the attach or the tracking area updating procedure. The network shall store the negotiated UE paging probability information in the EMM context of the UE for paging.


[Nm] {1190} The UE shall use WUS assistance only if it received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure. If the UE did not receive the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE shall not use WUS assistance.


[Nm] {1191} If the network did not accept the request to use WUS assistance, the network shall delete the stored negotiated UE paging probability information for the UE, if available.


[Nm] {1192} When a PDN connection for emergency bearer service is successfully established after the UE received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE and the network shall not use WUS assistance information until:


	[B1] {1193} -	the successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, or


	[B1] {1194} -	the UE receives WUS assistance information during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure, if the UE or the network locally releases the PDN connection for emergency bearer service.


[H2] {1195} 5.4	EMM common procedures


[H3] {1196} 5.4.1	GUTI reallocation procedure


[H4] {1197} 5.4.1.1	General


[Nm] {1198} The purpose of the GUTI reallocation procedure is to allocate a GUTI and optionally to provide one or more of the following to a particular UE:


	[B1] {1199} -	a new TAI list;


	[B1] {1200} -	a new DCN-ID; and


	[B1] {1201} -	in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.


[Nm] {1202} The reallocation of a GUTI is performed by the unique procedure defined in this subclause. This procedure can only be initiated by the MME in state EMM-REGISTERED.


[Nm] {1203} The GUTI can also be implicitly reallocated at attach or tracking area updating procedures. The implicit reallocation of a GUTI is described in the subclauses which specify these procedures (see subclause 5.5.1 and 5.5.3).


[Nm] {1204} The PLMN identity in the GUTI indicates the current registered PLMN.


[H4] {1205} 5.4.1.2	GUTI reallocation initiation by the network


[Nm] {1206} The MME shall initiate the GUTI reallocation procedure by sending a GUTI REALLOCATION COMMAND message to the UE and starting the timer T3450 (see example in figure 5.4.1.2.1).


[Nm] {1207} The GUTI REALLOCATION COMMAND message shall include a GUTI and may include one or more of the following:


	[B1] {1208} -	a TAI list;


	[B1] {1209} -	a DCN-ID; and


	[B1] {1210} -	in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.


[H4] {1211} 5.4.1.3	GUTI reallocation completion by the UE


[Nm] {1212} Upon receipt of the GUTI REALLOCATION COMMAND message, the UE shall:


	[B1] {1213} -	store the GUTI;


	[B1] {1214} -	store the TAI list, if provided;


	[B1] {1215} -	store the DCN-ID, if provided;


	[B1] {1216} -	in WB-S1 mode, if the UE supports RACS and the GUTI REALLOCATION COMMAND message includes:


		[B2] {1217} a)	a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing GUTI reallocation procedure, initiate a tracking area updating procedure as specified in subclause 5.5.3. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, the UE shall include the UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message; and


		[B2] {1218} b)	a UE radio capability ID IE, store the UE radio capability ID as specified in annex C; and


	[B1] {1219} -	send a GUTI REALLOCATION COMPLETE message to the MME.


[Nm] {1220} The UE considers the new GUTI as valid and the old GUTI as invalid. If the UE receives a new TAI list in the GUTI REALLOCATION COMMAND message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.


[Nm] {1221} If the GUTI REALLOCATION COMMAND message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.


[H4] {1222} 5.4.1.4	GUTI reallocation completion by the network


[Nm] {1223} Upon receipt of the GUTI REALLOCATION COMPLETE message, the MME shall stop the timer T3450 and consider the new GUTI as valid and the old GUTI as invalid. If a new TAI list is provided in the GUTI REALLOCATION COMMAND message, the MME shall consider the new TAI list as valid and the old TAI list as invalid.


[H4] {1224} 5.4.1.5	Abnormal cases in the UE


[Nm] {1225} The following abnormal cases can be identified:


	[B1] {1226} a)	Transmission failure of GUTI REALLOCATION COMPLETE message indication with TAI change from lower layers


	[B1] {1227} 	If the current TAI is not in the TAI list, the GUTI reallocation procedure shall be aborted and a tracking area updating procedure shall be initiated.


	[B1] {1228} 	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.


	[B1] {1229} b)	Transmission failure of GUTI REALLOCATION COMPLETE message indication without TAI change from lower layers


	[B1] {1230} 	It is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.


[H4] {1231} 5.4.1.6	Abnormal cases on the network side


[Nm] {1232} The following abnormal cases can be identified:


	[B1] {1233} a)	Lower layer failure


	[B1] {1234} 	If a lower layer failure is detected before the GUTI REALLOCATION COMPLETE message is received, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network. If a new TAI list was provided in the GUTI REALLOCATION COMMAND message, the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the network.


	[B1] {1235} 	During this period the network:


		[B2] {1236} -	may first use the old S-TMSI from the old GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. If a new TAI list was provided with old GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list should also be used for paging. Upon response from the UE, the network may re-initiate the GUTI reallocation. If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the GUTI reallocation. If no response is received to the paging attempts, the network may use the new S-TMSI from the new GUTI for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new GUTI in the GUTI REALLOCAITON COMMAND message, the new TAI list shall be used instead of the old TAI list. Upon response from the UE the network shall consider the new GUTI as valid and the old GUTI as invalid. If no response is received to the paging attempts, the network may use the IMSI for paging for an implementation dependent number of paging attempts;


		[B2] {1237} -	shall consider the new GUTI as valid if it is used by the UE and, additionally, the new TAI list as valid if it was provided with this GUTI in the GUTI REALLOCATION COMMAND message;


		[B2] {1238} -	may use the identification procedure followed by a new GUTI reallocation if the UE uses the old GUTI; and


		[B2] {1239} -	if the network accepted to use eDRX for the UE, may determine the next paging window from both old GUTI and new GUTI, and may first use the S-TMSI from the GUTI which led the first eDRX for paging. If no response is received to the paging attempts for the first eDRX, the network may use the other S-TMSI from the other GUTI which led the second eDRX for paging. For this paging procedure, the network shall start timer T3415 long enough to care the paging attempts for both eDRXs.


	[B1] {1240} b)	Expiry of timer T3450


	[B1] {1241} 	The GUTI reallocation procedure is supervised by the timer T3450. The network shall, on the first expiry of timer T3450, reset and restart timer T3450 and shall retransmit the GUTI REALLOCATION COMMAND. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the network shall abort the reallocation procedure and shall follow the rules described for case a above.


	[B1] {1242} c)	GUTI reallocation and attach procedure collision


	[B1] {1243} 	If the network receives an ATTACH REQUEST message before the ongoing GUTI reallocation procedure has been completed the network shall proceed with the attach procedure after deletion of the EMM context.


	[B1] {1244} d)	GUTI reallocation and UE initiated detach procedure collision


	[B1] {1245} 	If the network receives a DETACH REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the detach procedure.


	[B1] {1246} e)	GUTI reallocation and tracking area updating procedure collision


	[B1] {1247} 	If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the tracking area updating procedure. The network may then perform a new GUTI reallocation.


	[B1] {1248} f)	GUTI reallocation and service request procedure collision


	[B1] {1249} 	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing GUTI reallocation procedure has been completed, the network shall progress both procedures.


	[B1] {1250} g)	Lower layer indication of non-delivered NAS PDU due to handover


	[B1] {1251} 	If the GUTI REALLOCATION COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the GUTI REALLOCATION COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the GUTI REALLOCATION COMMAND message.


[Nm] {1252} If there is a different new GUTI and optionally a new TAI list included in a subsequent GUTI REALLOCATION COMMAND message, the UE always regards the newest GUTI and the newest TAI list as valid for the recovery time.


[H3] {1253} 5.4.2	Authentication procedure


[H4] {1254} 5.4.2.1	General


[Nm] {1255} The purpose of the EPS authentication and key agreement (AKA) procedure is to provide mutual authentication between the user and the network and to agree on a key KASME (see 3GPP TS 33.401 [19]). The cases when the EPS AKA procedure should be used are defined in 3GPP TS 33.401 [19].


[Nm] {1256} The EPS AKA procedure is always initiated and controlled by the network. However, the UE can reject the EPS authentication challenge sent by the network.


[Nm] {1257} The UE shall proceed with an EPS authentication challenge only if a USIM is present.


[Nm] {1258} A partial native EPS security context is established in the UE and the network when an EPS authentication is successfully performed. During a successful EPS authentication procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute a new key, KASME. KASME is stored in the EPS security contexts (see 3GPP TS 33.401 [19]) of both the network and in the volatile memory of the ME while attached to the network, and is the root for the EPS integrity protection and ciphering key hierarchy.


[H4] {1259} 5.4.2.2	Authentication initiation by the network


[Nm] {1260} When a NAS signalling connection exists, the network can initiate an authentication procedure at any time. For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3.


[Nm] {1261} The network initiates the authentication procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3460 (see example in figure 5.4.2.2.1). The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the authentication response (see 3GPP TS 33.401 [19]).


[Nm] {1262} If an eKSI is contained in an initial NAS message during an EMM procedure, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates an authentication procedure.


[H4] {1263} 5.4.2.3	Authentication response by the UE


[Nm] {1264} The UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in subclauses 5.4.2.6 and 5.4.2.7 case k, the UE shall process the authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.


[Nm] {1265} Upon a successful EPS authentication challenge, the UE shall determine the PLMN identity to be used for the calculation of the new KASME from the authentication challenge data according to the following rules:


	[B1] {1266} a)	When the UE moves from EMM-IDLE mode to EMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and


	[B1] {1267} b)	After handover or inter-system handover to S1 mode,


		[B2] {1268} -	if the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;


		[B2] {1269} -	if the target cell is a shared network cell and the UE has a valid GUTI, the UE shall use the PLMN identity that is part of the GUTI; and


		[B2] {1270} -	if the target cell is a shared network cell, the UE does not have a valid GUTI and,


			[B3] {1271} -	the EPS authentication challenge is performed after inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode and the UE has a valid P-TMSI and RAI, the UE shall use the PLMN identity that is part of the RAI; or


			[B3] {1272} -	the EPS authentication challenge is performed after inter-system handover from N1 mode to S1 mode and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI.


[Nm] {1273} Upon a successful EPS authentication challenge, the new KASME calculated from the authentication challenge data shall be stored in a new EPS security context in the volatile memory of the ME.


[Nm] {1274} The USIM will compute the authentication response (RES) using the authentication challenge data received from the ME, and pass RES to the ME.


[Nm] {1275} In order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES returned from the USIM in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3416.


[Nm] {1276} The RAND and RES values stored in the ME shall be deleted and timer T3416, if running, shall be stopped:


	[B1] {1277} -	upon receipt of a


		[B2] {1278} -	SECURITY MODE COMMAND,


		[B2] {1279} -	SERVICE REJECT,


		[B2] {1280} -	SERVICE ACCEPT,


		[B2] {1281} -	TRACKING AREA UPDATE REJECT,


		[B2] {1282} -	TRACKING AREA UPDATE ACCEPT, or


		[B2] {1283} -	AUTHENTICATION REJECT message;


	[B1] {1284} -	upon expiry of timer T3416;


	[B1] {1285} -	if the UE enters the EMM state EMM-DEREGISTERED or EMM-NULL; or


	[B1] {1286} -	if the UE enters EMM-IDLE mode.


[H4] {1287} 5.4.2.4	Authentication completion by the network


[Nm] {1288} Upon receipt of an AUTHENTICATION RESPONSE message, the network stops the timer T3460 and checks the correctness of RES (see 3GPP TS 33.401 [19]).


[Nm] {1289} If the authentication procedure has been completed successfully and the related eKSI is stored in the EPS security context of the network, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates a new authentication procedure.


[Nm] {1290} Upon receipt of an AUTHENTICATION FAILURE message, the network stops the timer T3460. In the case where the EMM cause #21 "synch failure" is received, the core network may renegotiate with the HSS/AuC and provide the UE with new authentication parameters.


[H4] {1291} 5.4.2.5	Authentication not accepted by the network


[Nm] {1292} If the authentication response (RES) returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:


	[B1] {1293} -	if the GUTI was used; or


	[B1] {1294} -	if the IMSI was used.


[Nm] {1295} If the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should send an AUTHENTICATION REJECT message to the UE.


[Nm] {1296} If the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE.


[Nm] {1297} Upon receipt of an AUTHENTICATION REJECT message,


	[B1] {1298} a)	if the message has been successfully integrity checked by the NAS, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {1299} 	If A/Gb or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the authentication and ciphering procedure is not accepted by the network; and


	[B1] {1300} b)	if the message is received without integrity protection, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause 5.3.7b). Additionally, the UE shall:


		[B2] {1301} -	if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, proceed as specified in subclause 5.3.7b, list item 1a for the case that the EMM cause value received is #3; and


		[B2] {1302} -	otherwise proceed as specified under list item a above for the case that the message has been successfully integrity checked.


[Nm] {1303} If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the retransmission timers that are running (e.g. T3410, T3416, T3417, T3430, T3421, T3418 or T3420) and enter state EMM-DEREGISTERED.


[Nm] {1304} Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure in the present subclause. The MME may continue a current EMM specific procedure or PDN connectivity request procedure. Upon completion of the authentication procedure, if not initiated as part of another procedure, or upon completion of the EMM procedure or PDN connectivity request procedure, the MME shall deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure. The network shall consider the UE to be attached for emergency bearer services only.


[Nm] {1305} Depending on local regulation and operator policy, if the UE is requesting attach for access to RLOS, the MME need not follow the procedures specified for the authentication failure in the present subclause. The MME may continue a current EMM specific procedure.


[H4] {1306} 5.4.2.6	Authentication not accepted by the UE


[Nm] {1307} In an EPS authentication challenge, the UE shall check the authenticity of the core network by means of the AUTN parameter received in the AUTHENTICATION REQUEST message. This enables the UE to detect a false network.


[Nm] {1308} During an EPS authentication procedure, the UE may reject the core network due to an incorrect AUTN parameter (see 3GPP TS 33.401 [19]). This parameter contains three possible causes for authentication failure:


	[B1] {1309} a)	MAC code failure:


		[B2] {1310} 	If the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #20 "MAC failure". The UE shall then follow the procedure described in subclause 5.4.2.7, item c.


	[B1] {1311} b)	Non-EPS authentication unacceptable:


		[B2] {1312} 	If the UE finds that the "separation bit" in the AMF field of AUTN supplied by the core network is 0, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #26 "non-EPS authentication unacceptable" (see subclause 6.1.1 in 3GPP TS 33.401 [19]). The UE shall then follow the procedure described in subclause 5.4.2.7, item d.


	[B1] {1313} c)	SQN failure:


		[B2] {1314} 	If the UE finds the SQN (supplied by the core network in the AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #21 "synch failure" and a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102 [18]). The UE shall then follow the procedure described in subclause 5.4.2.7, item e.


[Nm] {1315} If the UE returns an AUTHENTICATION FAILURE message to the network, the UE shall delete any previously stored RAND and RES and shall stop timer T3416, if running.


[Nm] {1316} If the UE has a PDN connection for emergency bearer services established or is establishing such a PDN connection, additional UE requirements are specified in subclause 5.4.2.7, under "for items c, d, e".


[Nm] {1317} If the UE is attached for access to RLOS and has a PDN connection for RLOS established or is establishing such a PDN connection, additional UE requirements are specified in subclause 5.4.2.7, under "for items c, d, e".


[H4] {1318} 5.4.2.7	Abnormal cases


	[B1] {1319} a)	Lower layer failure:


	[B1] {1320} 	Upon detection of lower layer failure before the AUTHENTICATION RESPONSE message is received, the network shall abort the procedure.


	[B1] {1321} b)	Expiry of timer T3460:


	[B1] {1322} 	The network shall, on the first expiry of the timer T3460, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the network shall abort the authentication procedure and any ongoing EMM specific procedure and release the NAS signalling connection.


	[B1] {1323} c)	Authentication failure (EMM cause #20 "MAC failure"):


	[B1] {1324} 	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #20 "MAC failure" according to subclause 5.4.2.6, to the network and start timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 "MAC failure", the network may initiate the identification procedure described in subclause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.


	[B1] {1325} 	If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5).


	[B1] {1326} 	If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.


	[B1] {1327} 	If the UE receives the second AUTHENTICATION REQUEST message while T3418 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in this subclause, item c, starting again from the beginning, or if the message contains a UMTS authentication challenge, the UE shall follow the procedure specified in item d. If the SQN is invalid, the UE shall proceed as specified in item e.


	[B1] {1328} 	It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the UE) if any of the following occur:


		[B2] {1329} -	the timer T3418 expires;


		[B2] {1330} -	the UE detects any combination of the authentication failures: EMM causes #20 "MAC failure", #21 "synch failure" or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the UE, while the timer T3418 or T3420 started after the previous authentication failure is running.


	[B1] {1331} 	The UE shall stop timer T3418, if the timer is running and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode or Iu mode.


	[B1] {1332} 	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.


	[B1] {1333} d)	Authentication failure (EMM cause #26 "non-EPS authentication unacceptable"):


	[B1] {1334} 	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #26 "non-EPS authentication unacceptable", to the network and start the timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 "non-EPS authentication unacceptable", the network may initiate the identification procedure described in subclause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.


	[B1] {1335} 	If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5).


	[B1] {1336} 	It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the UE) if any of the following occur:


		[B2] {1337} -	the timer T3418 expires;


		[B2] {1338} -	the UE detects any combination of the authentication failures: EMM causes #20 "MAC failure", #21 "synch failure" or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the UE, while the timer T3418 or T3420 started after the previous authentication failure is running.


	[B1] {1339} 	The UE shall stop timer T3420, if the timer is running and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode or Iu mode.


	[B1] {1340} 	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.


	[B1] {1341} e)	Authentication failure (EMM cause #21 "synch failure"):


	[B1] {1342} 	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #21 "synch failure", to the network and start the timer T3420 (see example in figure 5.4.2.7.2). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with the EMM cause #21 "synch failure", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the MME to delete all unused authentication vectors for that IMSI and obtain new vectors from the HSS. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer T3420, if running.


	[B1] {1343} 	If the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3420 is running, the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.


	[B1] {1344} 	If the UE receives the second AUTHENTICATION REQUEST message while T3420 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in item c or if the message contains a UMTS authentication challenge, the UE shall proceed as specified in item d; if the SQN is invalid, the UE shall follow the procedure specified in this subclause, item e, starting again from the beginning.


	[B1] {1345} 	The UE shall deem that the network has failed the authentication check and proceed as described in item f if any of the following occurs:


		[B2] {1346} -	the timer T3420 expires;


		[B2] {1347} -	the UE detects any combination of the authentication failures: EMM cause #20 "MAC failure", #21 "synch failure", or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only if the authentication challenges causing the second and third authentication failure are received by the UE while the timer T3418 or T3420 started after the previous authentication failure is running.


	[B1] {1348} 	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.


	[B1] {1349} 	Upon receipt of an AUTHENTICATION REJECT message, the UE shall perform the actions as specified in subclause 5.4.2.5.


	[B1] {1350} f)	Network failing the authentication check:


	[B1] {1351} 	If the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP TS 36.304 [21]). The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing the authentication failure.


	[B1] {1352} g)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the authentication procedure is triggered by a tracking area updating procedure)


	[B1] {1353} 	The UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the tracking area updating procedure.


	[B1] {1354} h)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)


	[B1] {1355} 	The UE shall stop any of the timers T3418 and T3420, if running.


	[B1] {1356} 	If the current TAI is not in the TAI list, the authentication procedure shall be aborted and a tracking area updating procedure shall be initiated.


	[B1] {1357} 	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.


	[B1] {1358} i)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)


	[B1] {1359} 	The UE shall stop any of the timers T3418 and T3420, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.


	[B1] {1360} j)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {1361} 	If the AUTHENTICATION REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the AUTHENTICATION REQUEST message.


	[B1] {1362} k)	Change of cell into a new tracking area 


	[B1] {1363} 	If a cell change into a new tracking area that is not in the TAI list occurs before the AUTHENTICATION RESPONSE message is sent, the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of tracking area updating procedure as described in subclause 5.5.3.


[Nm] {1364} For items c, d, and e:


	[B1] {1365} 1)	Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure specified in the present subclause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The MME shall deactivate all non-emergency EPS bearer contexts, if any, by initiating an EPS bearer context deactivation procedure. If there is an ongoing PDN connectivity procedure, the MME shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The network shall consider the UE to be attached for emergency bearer services only.


	[B1] {1366} 	If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.


	[B1] {1367} 	If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any, deactivate all non-emergency EPS bearer contexts, if any, by initiating UE requested PDN disconnect procedure. If there is an ongoing PDN connectivity procedure, the UE shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:


		[B2] {1368} -	they were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure;


		[B2] {1369} -	the procedures associated with these timers have not yet been completed.


		[B2] {1370} The UE shall consider itself to be attached for emergency bearer services only.


	[B1] {1371} 2)	Depending on local regulation and operator policy, if the UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS, the MME need not follow the procedures specified for the authentication failure specified in the present subclause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The network shall consider the UE to be attached for access to RLOS.


	[B1] {1372} 	If a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.


	[B1] {1373} 	If a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any. The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:


		[B2] {1374} -	they were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure;


		[B2] {1375} -	the procedures associated with these timers have not yet been completed.


	[B1] {1376} 	The UE shall consider itself to be attached for access to RLOS.


[H3] {1377} 5.4.3	Security mode control procedure


[H4] {1378} 5.4.3.1	General


[Nm] {1379} The purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.


[Nm] {1380} Furthermore, the network may also initiate the security mode control procedure:


	[B1] {1381} -	in order to change the NAS security algorithms for a current EPS security context already in use;


	[B1] {1382} -	in order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP TS 33.401 [19], subclause 7.2.9.2; and


	[B1] {1383} -	in order to request the UE radio capability ID from the UE.


[Nm] {1384} For restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP TS 33.401 [19], subclause 7.2.10.


[H4] {1385} 5.4.3.2	NAS security mode control initiation by the network


[Nm] {1386} The MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure 5.4.3.2.1).


[Nm] {1387} The MME shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:


	[B1] {1388} -	to take into use the EPS security context created after a successful execution of the EPS authentication procedure;


	[B1] {1389} -	upon receipt of TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME wishes to create a mapped EPS security context (i.e. the type of security context flag is set to "mapped security context" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message).


[Nm] {1390} The MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".


[Nm] {1391} The MME shall create a locally generated KASME and send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:


	[B1] {1392} -	during an attach procedure for emergency bearer services if no shared EPS security context is available;


	[B1] {1393} -	during an attach procedure for access to RLOS if no valid EPS security context is available;


	[B1] {1394} -	during a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;


	[B1] {1395} -	during a tracking area updating procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;


	[B1] {1396} -	during a service request procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;


	[B1] {1397} -	during a service request procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;


	[B1] {1398} -	after a failed authentication procedure for a UE that has a PDN connection for emergency bearer services or that is establishing a PDN connection for emergency bearer services, if continued usage of a shared security context is not possible; or


	[B1] {1399} -	after a failed authentication procedure for a UE that has a PDN connection for access to RLOS or that is establishing a PDN connection for access to RLOS, if continued usage of a valid security context is not possible.


[Nm] {1400} The UE shall process a SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms and, if accepted, create a locally generated KASME when the security mode control procedure is initiated:


	[B1] {1401} -	during an attach procedure for emergency bearer services;


	[B1] {1402} -	during an attach procedure for access to RLOS;


	[B1] {1403} -	during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services;


	[B1] {1404} -	during a tracking area updating procedure when the UE has a PDN connection for access to RLOS;


	[B1] {1405} -	during a service request procedure when the UE has a PDN connection for emergency bearer services;


	[B1] {1406} -	during a service request procedure when the UE has a PDN connection for access to RLOS;


	[B1] {1407} -	after an authentication procedure when the UE has a PDN connection for emergency bearer services or is establishing a PDN connection for emergency bearer services; or


	[B1] {1408} -	after an authentication procedure when the UE has a PDN connection for access to RLOS or is establishing a PDN connection for access to RLOS.


[Nm] {1409} Upon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall either:


	[B1] {1410} -	indicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to "mapped security context" and the KSI value related to the security context of the source system; or


	[B1] {1411} -	set the KSI value "000" in the NAS key set identifier IE if the MME sets EIA0 and EEA0 as the selected NAS security algorithms for a UE that has a PDN connection for emergency bearer services.


[Nm] {1412} While having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message.


[Nm] {1413} The MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network), the replayed nonceUE when creating a mapped EPS security context and if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI). If the MME supports handling of UE additional security capabilities and the UE included a UE additional security capability IE in the message to the network, the MME shall include the replayed additional security capabilities of the UE.


[Nm] {1414} The MME shall include both the nonceMME and the nonceUE when creating a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode.


[Nm] {1415} The MME may initiate a SECURITY MODE COMMAND in order to change the NAS security algorithms for a current EPS security context already in use. The MME re-derives the NAS keys from KASME with the new NAS algorithm identities as input and provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".


[Nm] {1416} If, during an ongoing attach or tracking area updating procedure, the MME is initiating a SECURITY MODE COMMAND (i.e. after receiving the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, but before sending a response to that message) and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message is received without integrity protection or does not successfully pass the integrity check at the MME, the MME shall calculate the HASHMME of the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message as described in 3GPP TS 33.401 [19] and shall include the HASHMME in the SECURITY MODE COMMAND message.


[Nm] {1417} Additionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.


[Nm] {1418} If:


	[B1] {1419} -	the NAS security mode control procedure is initiated during an ongoing attach procedure in WB-S1 mode;


	[B1] {1420} -	the network supports RACS;


	[B1] {1421} -	the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; and


	[B1] {1422} -	the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message,


[Nm] {1423} then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.


[Nm] {1424} If:


	[B1] {1425} -	the NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;


	[B1] {1426} -	the network supports RACS;


	[B1] {1427} -	the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UDPATE REQUEST message; and


	[B1] {1428} -	the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message,


[Nm] {1429} then the MME may request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.


[Nm] {1430} If:


	[B1] {1431} -	the NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;


	[B1] {1432} -	the network supports RACS;


	[B1] {1433} -	the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UDPATE REQUEST message; 


	[B1] {1434} -	the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message; and


	[B1] {1435} -	no UE radio capability ID is available in the UE context in the MME,


[Nm] {1436} then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.


[H4] {1437} 5.4.3.3	NAS security mode command accepted by the UE


[Nm] {1438} Upon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities, the received replayed UE additional security capabilities, if included in the SECURITY MODE COMMAND message, and the received nonceUE have not been altered compared to the latest values that the UE sent to the network. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). When the UE has a PDN connection for emergency bearer services established or the UE is establishing a PDN connection for emergency bearer services or the UE is requesting attach for access to RLOS, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value "000" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms).


[Nm] {1439} The UE shall accept a SECURITY MODE COMMAND message indicating the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm only if the message is received for a UE that has a PDN connection for emergency bearer services established, or a UE that is attached for access to RLOS, or a UE that is establishing a PDN connection for emergency bearer services or a UE that is requesting attach for access to RLOS.


[Nm] {1440} If the type of security context flag included in the SECURITY MODE COMMAND message is set to "native security context" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.


[Nm] {1441} If the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:


	[B1] {1442} -	the SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;


	[B1] {1443} -	the SECURITY MODE COMMAND message received includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.


[Nm] {1444} If the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm, the UE shall:


	[B1] {1445} -	if the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;


	[B1] {1446} -	otherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.


[Nm] {1447} If the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K'ASME if the type of security context flag is set to "mapped security context" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:


	[B1] {1448} -	generate K'ASME from both the nonceMME and the nonceUE as indicated in 3GPP TS 33.401 [19];or


	[B1] {1449} -	check whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K'ASME.


[Nm] {1450} Furthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K'ASME indicated by the eKSI. The UE shall set the security header type of the message to "integrity protected and ciphered with new EPS security context".


[Nm] {1451} From this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.


[Nm] {1452} If the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.


[Nm] {1453} In WB-S1 mode, if the MME indicated in the SECURITY MODE COMMAND message that the UE radio capability ID is requested, the UE shall:


	[B1] {1454} -	if the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message; and


	[B1] {1455} -	if the UE:


		[B2] {1456} a)	does not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN; and


		[B2] {1457} b)	has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,


	[B1] {1458} 	include the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message.


[Nm] {1459} If, during an ongoing attach or tracking area updating procedure, the SECURITY MODE COMMAND message includes a HASHMME, the UE shall compare HASHMME with a hash value locally calculated as described in 3GPP TS 33.401 [19] from the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message that the UE had sent to initiate the procedure. If HASHMME and the locally calculated hash value are different, the UE shall include the complete ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message which the UE had previously sent in the Replayed NAS message container IE of the SECURITY MODE COMPLETE message.


[H4] {1460} 5.4.3.4	NAS security mode control completion by the network


[Nm] {1461} The MME shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3460. From this time onward the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms.


[Nm] {1462} If the SECURITY MODE COMPLETE message contains a Replayed NAS container message IE with an ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, the MME shall complete the ongoing attach or tracking area updating procedure by considering the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message contained in the Replayed NAS message container IE as the message that triggered the procedure.


[H4] {1463} 5.4.3.5	NAS security mode command not accepted by the UE


[Nm] {1464} If the security mode command cannot be accepted, the UE shall send a SECURITY MODE REJECT message. The SECURITY MODE REJECT message contains an EMM cause that typically indicates 


	[B1] {1465} #23:	UE security capabilities mismatch;


	[B1] {1466} #24:	security mode rejected, unspecified.


[Nm] {1467} Upon receipt of the SECURITY MODE REJECT message, the MME shall stop timer T3460. The MME shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure.


[Nm] {1468} Both the UE and the MME shall apply the EPS security context in use before the initiation of the security mode control procedure, if any, to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in subclauses 4.4.4 and 4.4.5.


[H4] {1469} 5.4.3.6	Abnormal cases in the UE


[Nm] {1470} The following abnormal cases can be identified:


	[B1] {1471} a)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers (if the security mode control procedure is triggered by a tracking area updating procedure)


	[B1] {1472} 	The UE shall abort the security mode control procedure and re-initiate the tracking area updating procedure.


	[B1] {1473} b)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)


	[B1] {1474} 	If the current TAI is not in the TAI list, the security mode control procedure shall be aborted and a tracking area updating procedure shall be initiated.


	[B1] {1475} 	If the current TAI is still part of the TAI list, the security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.


	[B1] {1476} c)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)


	[B1] {1477} 	The security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.


[H4] {1478} 5.4.3.7	Abnormal cases on the network side


[Nm] {1479} The following abnormal cases can be identified:


	[B1] {1480} a)	Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received


	[B1] {1481} 	The network shall abort the security mode control procedure.


	[B1] {1482} b)	Expiry of timer T3460


	[B1] {1483} 	The network shall, on the first expiry of the timer T3460, retransmit the SECURITY MODE COMMAND message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the procedure shall be aborted.


	[B1] {1484} c)	Collision between security mode control procedure and attach, service request, tracking area updating procedure or detach procedure not indicating switch off


	[B1] {1485} 	The network shall abort the security mode control procedure and proceed with the UE initiated procedure.


	[B1] {1486} d)	Collision between security mode control procedure and other EMM procedures than in item c


	[B1] {1487} 	The network shall progress both procedures.


	[B1] {1488} e)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {1489} 	If the SECURITY MODE COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the SECURITY MODE COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the SECURITY MODE COMMAND message.


[H3] {1490} 5.4.4	Identification procedure


[H4] {1491} 5.4.4.1	General


[Nm] {1492} The identification procedure is used by the network to request a particular UE to provide specific identification parameters, e.g. the International Mobile Subscriber Identity (IMSI) or the International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in 3GPP TS 23.003 [2].


[Nm] {1493} For mobile device supporting both 3GPP access and cdma2000® access a single IMEI is used to identify the device as specified in 3GPP TS 22.278 [1C].


[H4] {1494} 5.4.4.2	Identification initiation by the network


[Nm] {1495} The network initiates the identification procedure by sending an IDENTITY REQUEST message to the UE and starting the timer T3470 (see example in figure 5.4.4.2.1). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.


[H4] {1496} 5.4.4.3	Identification response by the UE


[Nm] {1497} A UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in EMM-CONNECTED mode.


[Nm] {1498} Upon receipt of the IDENTITY REQUEST message the UE shall send an IDENTITY RESPONSE message to the network. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.


[H4] {1499} 5.4.4.4	Identification completion by the network


[Nm] {1500} Upon receipt of the IDENTITY RESPONSE the network shall stop the timer T3470.


[H4] {1501} 5.4.4.5	Abnormal cases in the UE


[Nm] {1502} The following abnormal cases can be identified:


	[B1] {1503} a)	Requested identity is not available


	[B1] {1504} 	If the UE cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid USIM is available, then it shall encode the identity type as "no identity".


	[B1] {1505} b)	Transmission failure of IDENTITY RESPONSE message indication from lower layers (if the identification procedure is triggered by a tracking area updating procedure)


	[B1] {1506} 	The UE shall abort the identification procedure and re-initiate the tracking area updating procedure.


	[B1] {1507} c)	Transmission failure of IDENTITY RESPONSE message indication with TAI change from lower layers (if the identification procedure is triggered by a service request procedure)


	[B1] {1508} 	If the current TAI is not in the TAI list, the identification procedure shall be aborted and a tracking area updating procedure shall be initiated.


	[B1] {1509} 	If the current TAI is still part of the TAI list, the identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.


	[B1] {1510} d)	Transmission failure of IDENTITY RESPONSE message indication without TAI change from lower layers (if the identification procedure is triggered by a service request procedure)


	[B1] {1511} 	The identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.


[H4] {1512} 5.4.4.6	Abnormal cases on the network side


[Nm] {1513} The following abnormal cases can be identified:


	[B1] {1514} a)	Lower layer failure


	[B1] {1515} 	Upon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing EMM procedure.


	[B1] {1516} b)	Expiry of timer T3470


	[B1] {1517} 	The identification procedure is supervised by the network by the timer T3470. The network shall, on the first expiry of the timer T3470, retransmit the IDENTITY REQUEST message and reset and restart the timer T3470. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3470, the network shall abort the identification procedure and any ongoing EMM procedure.


	[B1] {1518} c)	Collision of an identification procedure with an attach procedure


	[B1] {1519} 	If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and no attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message), the network shall proceed with the attach procedure.


	[B1] {1520} d)	Collision of an identification procedure with an attach procedure when the identification procedure has been caused by an attach procedure


	[B1] {1521} 	If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and an attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message), then:


		[B2] {1522} -	If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the network shall proceed with the new attach procedure; or


		[B2] {1523} -	If the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST.


	[B1] {1524} e)	Collision of an identification procedure with a UE initiated detach procedure


	[B1] {1525} 	Detach containing cause "switch off" within the Detach type IE:


		[B2] {1526} 	If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the detach procedure.


	[B1] {1527} 	Detach containing other causes than "switch off" within the Detach type IE:


		[B2] {1528} 	If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall complete the identification procedure and shall respond to the detach procedure as described in subclause 5.5.2.


	[B1] {1529} f)	Collision of an identification procedure with a tracking area updating procedure


	[B1] {1530} 	If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.


	[B1] {1531} g)	Collision of an identification procedure with a service request procedure


	[B1] {1532} 	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing identification procedure has been completed, the network shall progress both procedures.


	[B1] {1533} h)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {1534} 	If the IDENTITY REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the IDENTITY REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the IDENTITY REQUEST message.


[H3] {1535} 5.4.5	EMM information procedure 


[H4] {1536} 5.4.5.1	General


[Nm] {1537} The purpose of sending the EMM INFORMATION message is to allow the network to provide information to the UE. The message implementation is optional in the network. The UE may use the received information if the UE supports implementing this message.


[Nm] {1538} The EMM information procedure may be invoked by the network at any time during an established EMM context.


[H4] {1539} 5.4.5.2	EMM information procedure initiation by the network


[Nm] {1540} The EMM information procedure consists only of the EMM INFORMATION message sent from the network to the UE (see example in figure 5.4.5.2.1). During an established EMM context, the network may send none, one, or more EMM INFORMATION messages to the UE. If more than one EMM INFORMATION message is sent, the messages need not have the same content.


[H4] {1541} 5.4.5.3	EMM information procedure in the UE


[Nm] {1542} When the UE (supporting the EMM information message) receives an EMM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the UE.


[Nm] {1543} If the UE does not support the EMM information message the UE shall ignore the contents of the message and return an EMM STATUS message with EMM cause #97 "message type non-existent or not implemented".


[H4] {1544} 5.4.5.4	Abnormal cases on the network side


[Nm] {1545} The following abnormal case can be identified:


	[B1] {1546} a)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {1547} 	If the EMM INFORMATION message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the EMM INFORMATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the EMM INFORMATION message.


[H2] {1548} 5.5	EMM specific procedures


[H3] {1549} 5.5.1	Attach procedure


[H4] {1550} 5.5.1.1	General


[Nm] {1551} The attach procedure is used to attach to an EPC for packet services in EPS.


[Nm] {1552} The attach procedure is used for the following purposes:


	[B1] {1553} -	by a UE in PS mode of operation to attach for EPS services only;


	[B1] {1554} -	by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services;


	[B1] {1555} -	by a UE supporting NB-S1 mode only in PS mode of operation to attach for EPS services and "SMS only";


	[B1] {1556} -	to attach for emergency bearer services; or


	[B1] {1557} -	an attach for access to RLOS.


[Nm] {1558} The lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP TS 36.331 [22]). This information is taken into account when deciding whether to initiate attach for emergency bearer services in WB-S1 mode.


[Nm] {1559} If the MME does not support an attach for emergency bearer services, the MME shall reject any request to attach with an attach type set to "EPS emergency attach".


[Nm] {1560} The lower layers may indicate to NAS whether the network supports access to RLOS (3GPP TS 36.331 [22]). This information is taken into account when deciding whether to initiate attach for access to RLOS in WB-S1 mode.


[Nm] {1561} With a successful attach procedure, a context is established for the UE in the MME. Furthermore, if the UE requested PDN connectivity, a default bearer is established between the UE and the PDN GW, thus enabling always-on IP connectivity to the UE. In WB-S1 mode, the network may also initiate the activation of dedicated bearers as part of the attach procedure. In NB-S1 mode the network shall not initiate the activation of dedicated bearers.


[Nm] {1562} With a successful attach procedure in NB-S1 mode, a context is established for the UE in the MME. If the attach request included information to request PDN connectivity, a default bearer is also established between the UE and the PDN.


[Nm] {1563} If EMM-REGISTERED without PDN connection is supported by the UE and the MME, a default bearer need not be requested by the UE during the attach procedure. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the UE shall request establishment of a default bearer.


[Nm] {1564} During the attach procedure with default bearer establishment, the UE may also obtain the home agent IPv4 or IPv6 address or both.


[Nm] {1565} In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity as part of the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever an ATTACH REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever an ATTACH REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area", the constructed TAI shall be stored in the suitable list.


[Nm] {1566} An attach attempt counter is used to limit the number of subsequently rejected attach attempts. The attach attempt counter shall be incremented as specified in subclause 5.5.1.2.6. Depending on the value of the attach attempt counter, specific actions shall be performed. The attach attempt counter shall be reset when:


	[B1] {1567} -	the UE is powered on;


	[B1] {1568} -	a USIM is inserted;


	[B1] {1569} -	an attach or combined attach procedure is successfully completed;


	[B1] {1570} -	a GPRS attach or combined GPRS attach procedure is successfully completed in A/Gb or Iu mode;


	[B1] {1571} -	a registration procedure for initial registration performed over 3GPP access is successfully completed in N1 mode and the UE is operating in single-registration mode;


	[B1] {1572} -	a combined attach procedure is completed for EPS services only with cause #2, #16, #17, #18 or #22;


	[B1] {1573} -	an attach or combined attach procedure is rejected with cause #11, #12, #13, #14, #15, #25 or #35:


	[B1] {1574} -	a network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or


	[B1] {1575} -	a new PLMN is selected.


[Nm] {1576} Additionally the attach attempt counter shall be reset when the UE is in substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and:


	[B1] {1577} -	a new tracking area is entered;


	[B1] {1578} -	timer T3402 expires; or


	[B1] {1579} -	timer T3346 is started.


[H4] {1580} 5.5.1.2	Attach procedure for EPS services


[H5] {1581} 5.5.1.2.1	General


[Nm] {1582} This procedure can be used by a UE to attach for:


	[B1] {1583} -	EPS services only; or


	[B1] {1584} -	EPS services and "SMS only" if the UE supports NB-S1 mode only.


[Nm] {1585} When the UE initiates the attach procedure for normal service, the UE shall indicate "EPS attach" in the EPS attach type IE.


[Nm] {1586} When the UE initiates the attach procedure for emergency bearer services, the UE shall indicate "EPS emergency attach" in the EPS attach type IE. The attach procedure for emergency bearer services is not applicable for NB-S1 mode (see 3GPP TS 23.401 [10]).


[Nm] {1587} This procedure can also be used by a UE in limited service state to attach for access to RLOS.


[Nm] {1588} When the UE initiates the attach procedure for access to RLOS, the UE shall indicate "EPS RLOS attach" in the EPS attach type IE. The attach procedure for access to RLOS is not applicable for NB-S1 mode (see 3GPP TS 23.401 [10]).


[H5] {1589} 5.5.1.2.2	Attach procedure initiation


[Nm] {1590} In state EMM-DEREGISTERED, the UE initiates the attach procedure by sending an ATTACH REQUEST message to the MME, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. 


[Nm] {1591} The UE shall include the IMSI in the EPS mobile identity IE in the ATTACH REQUEST message if the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs and:


	[B1] {1592} a)	the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]; or


	[B1] {1593} b)	the UE is in NB-S1 mode.


[Nm] {1594} For all other cases, the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message as follows:


	[B1] {1595} a)	if the UE operating in the single-registration mode is performing an inter-system change from N1 mode to S1 mode or the UE was previously registered in N1 mode before entering state 5GMM-DEREGISTERED and:


		[B2] {1596} 1)	the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface supported" from the network and:


			[B3] {1597} i)	if the UE holds a valid GUTI, the UE shall include the valid GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state" if the UE is in 5GMM-REGISTERED state; or


			[B3] {1598} i)	if the UE holds a valid GUTI, the UE shall include the valid GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-DEREGISTERED state" if the UE is in 5GMM-DEREGISTERED state; or


			[B3] {1599} ii)	if the UE does not hold a valid GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or


		[B2] {1600} 2)	the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network and:


			[B3] {1601} i)	if the UE holds a valid 5G-GUTI, the UE shall include a GUTI, mapped from 5G-GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-DEREGISTERED state";


			[B3] {1602} ii)	if the UE holds a valid GUTI and does not hold a valid 5G-GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE and include Old GUTI type IE with GUTI type set to "native GUTI"; or


			[B3] {1603} iii)	if the UE holds neither a valid GUTI nor a vaild 5G-GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or


	[B1] {1604} b)	otherwise:


		[B2] {1605} 1)	if the UE supports neither A/Gb mode nor Iu mode, the UE shall include in the ATTACH REQUEST message a valid GUTI together with the last visited registered TAI, if available. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI". If there is no valid GUTI available, the UE shall include the IMSI in the ATTACH REQUEST message; or


		[B2] {1606} 2)	If the UE supports A/Gb mode or Iu mode or both and:


			[B3] {1607} i)	if the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE;


			[B3] {1608} ii)	if the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";


			[B3] {1609} iii)	if the TIN is deleted and:


				[B4] {1610} -	the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";


				[B4] {1611} -	the UE does not hold a valid GUTI but holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE; or


				[B4] {1612} -	the UE does not hold a valid GUTI, P-TMSI or RAI, the UE shall include the IMSI in the EPS mobile identity IE; or


			[B3] {1613} iv)	otherwise the UE shall include the IMSI in the EPS mobile identity IE.


[Nm] {1614} If the UE is operating in the dual-registration mode and it is in 5GMM state 5GMM-REGISTERED, the UE shall include the UE status IE with the 5GMM registration status set to "UE is in 5GMM-REGISTERED state".


[Nm] {1615} If the UE is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.


[Nm] {1616} If the UE in limited service state is attaching for access to RLOS and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.


[Nm] {1617} If the UE supports A/Gb mode or Iu mode or if the UE needs to indicate its UE specific DRX parameter to the network, the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message.If the UE in NB-S1 mode needs to indicate the UE specific DRX parameter in NB-S1 mode to the network, it shall include the UE specific DRX parameter in NB-S1 mode in the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.


[Nm] {1618} If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the ATTACH REQUEST message.


[Nm] {1619} If the UE supports WUS assistance, then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE of the ATTACH REQUEST message.


[Nm] {1620} If the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".


[Nm] {1621} If the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the ATTACH REQUEST message.


[Nm] {1622} If the UE supports PSM and requests the use of PSM, then the UE shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.


[Nm] {1623} If the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1624} If the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1625} If the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1626} If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, or if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the UE shall support the extended protocol configuration options IE.


[Nm] {1627} If the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1628} If the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1629} If the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "back-off timer for transport of user data via the control plane supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1630} If the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the ATTACH REQUEST message.


[Nm] {1631} If the UE is in NB-S1 mode, supports NB-S1 mode only, and requests to attach for EPS services and "SMS only", the UE shall indicate the SMS only requested bit to "SMS only" in the additional update type IE and shall set the EPS attach type IE to "EPS attach" in the ATTACH REQUEST message.


[Nm] {1632} If the UE supports CIoT EPS optimizations, it shall indicate in the UE network capability IE of the ATTACH REQUEST message whether it supports EMM-REGISTERED without PDN connection.


[Nm] {1633} If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1634} If the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1635} If the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1636} If the UE supports V2X communication over E-UTRA-PC5, then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRA-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1637} If the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1638} If the UE supports service gap control, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1639} If the UE supports dual connectivity with New Radio (NR), then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.


[Nm] {1640} If the UE supports N1 mode, the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.


[Nm] {1641} If the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the ATTACH REQUEST message.


[Nm] {1642} If the UE supports ciphered broadcast assistance data and needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the ATTACH REQUEST message.


[Nm] {1643} If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, or if the UE wants to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container IE.


[Nm] {1644} If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE does not want to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.


[Nm] {1645} In WB-S1 mode, if the UE supports RACS, the UE shall:


	[B1] {1646} a)	set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; and


	[B1] {1647} b)	if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message.


[Nm] {1648} If the attach procedure is initiated following an inter-system change from N1 mode to S1 mode in EMM-IDLE mode or the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED initiates the attach procedure:


	[B1] {1649} a)	if the UE has received an "interworking without N26 interface not supported" indication from the network and a valid 5G NAS security context exists in the UE, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the 5G NAS security context;


	[B1] {1650} b)	otherwise:


		[B2] {1651} 1)	if a valid EPS security context exists, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the EPS security context; or


		[B2] {1652} 2)	if the UE does not have a valid EPS security context, the ATTACH REQUEST message combined with the message included in the ESM message container IE is not integrity protected.


[H5] {1653} 5.5.1.2.3	EMM common procedure initiation


[Nm] {1654} The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures during the attach procedure, depending on the information received in the ATTACH REQUEST message (e.g. IMSI, GUTI and KSI).


[Nm] {1655} If the network receives an ATTACH REQUEST message containing the Old GUTI type IE and the EPS mobile identity IE with type of identity indicating "GUTI", and the network does not follow the use of the most significant bit of the <MME group id> as specified in 3GPP TS 23.003 [2], subclause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the EPS mobile identity IE is a native GUTI or a mapped GUTI.


[Nm] {1656} During an attach for emergency bearer services or an attach for access to RLOS, the MME may choose to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3.


[H5] {1657} 5.5.1.2.4	Attach accepted by the network


[Nm] {1658} During an attach for emergency bearer services, if not restricted by local regulations, the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.


[Nm] {1659} During an attach for access to RLOS, the MME shall not check for access restrictions, regional restrictions and subscription restrictions when processing the ATTACH REQUEST message.


[Nm] {1660} If the attach request is accepted by the network, the MME shall send an ATTACH ACCEPT message to the UE and start timer T3450. 


[Nm] {1661} If the attach request included the PDN CONNECTIVITY REQUEST message in the ESM message container information element to request PDN connectivity, the MME when accepting the attach request shall:


	[B1] {1662} -	send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element and discard the ESM message container information element included in the attach request if:


		[B2] {1663} -	the UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message;


		[B2] {1664} -	the MME supports EMM-REGISTERED without PDN connection and PDN connection is restricted according to the user's subscription data;


		[B2] {1665} -	the attach type is not set to "EPS emergency attach" or "EPS RLOS attach"; and 


		[B2] {1666} -	the request type of the UE requested PDN connection is not set to "emergency" or "RLOS";


	[B1] {1667} -	otherwise, send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see subclause 6.4.1). In WB-S1 mode, the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see subclause 6.4.2). In NB-S1 mode the network shall not initiate the activation of dedicated bearers.


[Nm] {1668} If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.


[Nm] {1669} If the attach request is accepted by the network, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.


[Nm] {1670} In NB-S1 mode, if the attach request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.


[Nm] {1671} If the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.


[Nm] {1672} If the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the MME shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode.


[Nm] {1673} In NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the ATTACH REQUEST message, the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.


[Nm] {1674} In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the attach request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS attach result IE to "EPS only" in the ATTACH ACCEPT message.


[Nm] {1675} The MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of eDRX.


[Nm] {1676} If


	[B1] {1677} -	the UE supports WUS assistance; and


	[B1] {1678} -	the MME supports and accepts the use of WUS assistance,


[Nm] {1679} then the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE in the ATTACH ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.


[Nm] {1680} The MME shall assign and include the TAI list the UE is registered to in the ATTACH ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. The UE, upon receiving an ATTACH ACCEPT message, shall delete its old TAI list and store the received TAI list. 


[Nm] {1681} The MME may include T3412 extended value IE in the ATTACH ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message.


[Nm] {1682} The MME shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM.


[Nm] {1683} If the MME supports and accepts the use of PSM, and the UE included the T3412 extended value IE in the ATTACH REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message.


[Nm] {1684} If the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate support for EMM-REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.


[Nm] {1685} If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the attach request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.


[Nm] {1686} If the MME supports NB-S1 mode, Non-IP or Ethernet PDN type, inter-system change with 5GS or the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the MME shall support the extended protocol configuration options IE.


[Nm] {1687} If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the ATTACH ACCEPT message.


[Nm] {1688} If the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.


[Nm] {1689} If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the ATTACH ACCEPT message.


[Nm] {1690} If the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.


[Nm] {1691} If the UE indicates support for N1 mode in the ATTACH REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to "interworking without N26 interface not supported" if the MME supports N26 interface in the EPS network feature support IE in the ATTACH ACCEPT message.


[Nm] {1692} If the UE indicates support for N1 mode in the ATTACH REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to "interworking without N26 interface supported" if the MME does not support N26 interface in the EPS network feature support IE in the ATTACH ACCEPT message.


[Nm] {1693} If the UE requests ciphering keys for ciphered broadcast assistance data in the ATTACH REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the ATTACH ACCEPT message.


[Nm] {1694} If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message.


[Nm] {1695} The MME may include the T3447 value IE set to the service gap time value in the ATTACH ACCEPT message if:


	[B1] {1696} -	the UE has indicated support for service gap control; and


	[B1] {1697} -	a service gap time value is available in the EMM context.


[Nm] {1698} If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the ATTACH REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the ATTACH ACCEPT message.


[Nm] {1699} Upon receiving the ATTACH ACCEPT message, the UE shall stop timer T3410.


[Nm] {1700} The GUTI reallocation may be part of the attach procedure. When the ATTACH REQUEST message includes the IMSI or IMEI, or the MME considers the GUTI provided by the UE is invalid, or the GUTI provided by the UE was assigned by another MME, the MME shall allocate a new GUTI to the UE. The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1.


[Nm] {1701} For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).


[Nm] {1702} If the ATTACH ACCEPT message contains a GUTI, the UE shall use this GUTI as the new temporary identity. The UE shall delete its old GUTI and store the new assigned GUTI. If no GUTI has been included by the MME in the ATTACH ACCEPT message, the old GUTI, if any available, shall be kept. 


[Nm] {1703} If A/Gb mode or Iu mode is supported in the UE, the UE shall set its TIN to "GUTI" when receiving the ATTACH ACCEPT message.


[Nm] {1704} If the ATTACH ACCEPT message contains the T3412 extended value IE, then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). If the ATTACH ACCEPT message does not contain T3412 extended value IE, then the UE shall use the value in T3412 value IE as periodic tracking area update timer (T3412).


[Nm] {1705} If the ATTACH ACCEPT message contains the T3324 value IE, then the UE shall use the included timer value for T3324 as specified in 3GPP TS 24.008 [13], subclause 4.7.2.8.


[Nm] {1706} If the ATTACH ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.


[Nm] {1707} The MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the attach procedure is neither for emergency bearer services nor for access to RLOS, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. If the ATTACH ACCEPT message does not contain a list, then the UE shall delete the stored list.


[Nm] {1708} If the attach procedure is neither for emergency bearer services nor for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).


[Nm] {1709} The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], subclause 7.2a and subclause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].


[Nm] {1710} If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.


[Nm] {1711} The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:


	[B1] {1712} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;


	[B1] {1713} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or


	[B1] {1714} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.


[Nm] {1715} The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].


[Nm] {1716} If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the ATTACH ACCEPT message, the UE shall set the network policy for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when:


	[B1] {1717} -	the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;


	[B1] {1718} -	the UE is switched on; or


	[B1] {1719} -	the UICC containing the USIM is removed.


[Nm] {1720} If the UE has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message; and the UE sent the ATTACH REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.


[Nm] {1721} When the UE receives the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network.


[Nm] {1722} Additionally, the UE shall reset the attach attempt counter, enter state EMM-REGISTERED, and set the EPS update status to EU1 UPDATED.


[Nm] {1723} If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network.


[Nm] {1724} If the UE receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.


[Nm] {1725} When the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) after successful completion of the attach procedure.


[Nm] {1726} If the attach procedure was initiated in S101 mode, the lower layers are informed about the successful completion of the procedure.


[Nm] {1727} Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the GUTI sent in the ATTACH ACCEPT message as valid.


[Nm] {1728} If the T3448 value IE is present in the received ATTACH ACCEPT message, the UE shall:


	[B1] {1729} -	stop timer T3448 if it is running; and


	[B1] {1730} -	start timer T3448 with the value provided in the T3448 value IE.


[Nm] {1731} If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the ATTACH ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.


[Nm] {1732} If the UE has indicated "service gap control supported" in the ATTACH REQUEST message and:


	[B1] {1733} -	the ATTACH ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or


	[B1] {1734} -	the ATTACH ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.


[Nm] {1735} In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the ATTACH ACCEPT message.


[Nm] {1736} In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message and the ATTACH ACCCEPT message includes:


	[B1] {1737} -	a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing attach procedure, initiate a tracking area updating procedure as specified in subclause 5.5.3 over the existing NAS signalling connection; and


	[B1] {1738} -	a UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex C.


[H5] {1739} 5.5.1.2.4A	Attach successful for EPS services and not accepted for SMS services


[Nm] {1740} Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for SMS services applies.


[Nm] {1741} In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the attach request for EPS services only and:


	[B1] {1742} -	the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or


	[B1] {1743} -	the MME decides to not accept the attach request for "SMS only",


[Nm] {1744} the MME shall set the EPS attach result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the ATTACH ACCEPT message and shall include an appropriate SMS services status value.


[Nm] {1745} The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:


	[B1] {1746} "SMS services not available"


		[B2] {1747} 	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.


	[B1] {1748} "SMS services not available in this PLMN"


		[B2] {1749} 	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.


		[B2] {1750} 	The UE may provide a notification to the user or the upper layers that the SMS services are not available.


		[B2] {1751} 	The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {1752} "Network failure"


		[B2] {1753} 	The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.


		[B2] {1754} 	If the tracking area updating attempt counter is less than 5:


			[B3] {1755} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


		[B2] {1756} 	If the tracking area updating attempt counter is equal to 5:


			[B3] {1757} -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


	[B1] {1758} "Congestion"


		[B2] {1759} 	The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


[Nm] {1760} Other values and the case that no SMS services status IE was received are considered as abnormal cases. The attach procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6A.


[H5] {1761} 5.5.1.2.5	Attach not accepted by the network


[Nm] {1762} If the attach request cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value.


[Nm] {1763} If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, the attach procedure fails due to:


	[B1] {1764} -	a default EPS bearer setup failure;


	[B1] {1765} -	an ESM procedure failure; or


	[B1] {1766} -	operator determined barring is applied on default EPS bearer context activation during attach procedure,


[Nm] {1767} the MME shall:


	[B1] {1768} -	combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 "ESM failure"; or


	[B1] {1769} -	send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".


[Nm] {1770} If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {1771} In NB-S1 mode, if the attach request is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {1772} If the attach request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.


[Nm] {1773} If the attach request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported". 


[Nm] {1774} Based on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required". 


[Nm] {1775} Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410.


[Nm] {1776} If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.


[Nm] {1777} The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.


	[B1] {1778} #3	(Illegal UE);


	[B1] {1779} #6	(Illegal ME); or


	[B1] {1780} #8	(EPS services and non-EPS services not allowed);


	[B1] {1781} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {1782} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1783} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1784} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {1785} #7	(EPS services not allowed);


	[B1] {1786} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall enter state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {1787} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1788} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1789} #11	(PLMN not allowed); or


	[B1] {1790} #35	(Requested service option not authorized in this PLMN);


	[B1] {1791} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.


	[B1] {1792} 	In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMN list" and enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {1793} 	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.


	[B1] {1794} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause value #11and no RR connection exists.


	[B1] {1795} 	For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1796} 	For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {1797} #12	(Tracking area not allowed);


	[B1] {1798} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.


	[B1] {1799} 	In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE. If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.


	[B1] {1800} 	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.


	[B1] {1801} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1802} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1803} #13	(Roaming not allowed in this tracking area);


	[B1] {1804} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.


	[B1] {1805} 	In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH. If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] subclause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {1806} 	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.


	[B1] {1807} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1808} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1809} #14	(EPS services not allowed in this PLMN);


	[B1] {1810} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.


	[B1] {1811} 	In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list. Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {1812} 	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.


	[B1] {1813} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1814} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {1815} #15	(No suitable cells in tracking area);


	[B1] {1816} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.


	[B1] {1817} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE and:


		[B2] {1818} -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in GERAN, UTRAN or NG-RAN radio access technology;


		[B2] {1819} -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;


		[B2] {1820} -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {1821} 	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.


	[B1] {1822} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1823} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1824} #22	(Congestion);


	[B1] {1825} 	If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.2.6.


	[B1] {1826} 	The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.


	[B1] {1827} 	The UE shall stop timer T3346 if it is running.


	[B1] {1828} 	If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.


	[B1] {1829} 	If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].


	[B1] {1830} 	The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.


	[B1] {1831} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1832} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {1833} #25	(Not authorized for this CSG);


	[B1] {1834} 	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.6.


	[B1] {1835} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {1836} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {1837} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {1838} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {1839} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.


	[B1] {1840} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


	[B1] {1841} #42	(Severe network failure);


	[B1] {1842} 	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {1843} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.


	[B1] {1844} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {1845} #31	(Redirection to 5GCN required);


	[B1] {1846} 	EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.6. 


	[B1] {1847} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.


	[B1] {1848} 	The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see subclause 4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.


	[B1] {1849} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


[Nm] {1850} Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6.


[H5] {1851} 5.5.1.2.5A	Attach for emergency bearer services not accepted by the network


[Nm] {1852} If the attach request for emergency bearer services cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #5 "IMEI not accepted" or one of the EMM cause values as described in subclause 5.5.1.2.5.


[Nm] {1853} Upon receiving the ATTACH REJECT message including EMM cause #5, the UE shall enter the state EMM-DEREGISTERED.NO-IMSI.


[Nm] {1854} Upon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in subclause 5.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure.


[Nm] {1855} If the attach request for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and inform the upper layers of the failure to access the network.


[Nm] {1856} If the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 with the following addition: the UE shall inform the upper layers of the failure of the procedure.


[Nm] {1857} In a shared network, upon receiving the ATTACH REJECT message, the UE shall perform the actions as described in subclause 5.5.1.2.5, and shall:


	[B1] {1858} a)	inform the upper layers of the failure of the procedure; or


	[B1] {1859} b)	attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:


		[B2] {1860} -	did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or


		[B2] {1861} -	did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and: 


			[B3] {1862} i)	the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and


			[B3] {1863} ii)	the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.


[Nm] {1864} In a shared network, if the attach request for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and shall:


	[B1] {1865} a)	inform the upper layers of the failure to access the network; or


	[B1] {1866} b)	attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:


		[B2] {1867} -	did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or


		[B2] {1868} -	did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and: 


			[B3] {1869} i)	the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and


			[B3] {1870} ii)	the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.


[Nm] {1871} In a shared network, if the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6, and shall:


	[B1] {1872} a)	inform the upper layers of the failure of the procedure; or


	[B1] {1873} b)	attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message 


		[B2] {1874} -	did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or


		[B2] {1875} -	did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and: 


			[B3] {1876} i)	the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and


			[B3] {1877} ii)	the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.


[H5] {1878} 5.5.1.2.5B	Attach for initiating a PDN connection for emergency bearer services not accepted by the network


[Nm] {1879} If the network cannot accept an attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "emergency", the UE shall perform the procedures as described in subclause 5.5.1.2.5. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:


	[B1] {1880} a)	inform the upper layers of the failure of the procedure; or


	[B1] {1881} b)	attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.


[Nm] {1882} If the network cannot accept an attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", the UE shall perform the procedures as described in subclause 5.5.1.2.5. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.


[Nm] {1883} If the attach request with attach type not set to "EPS emergency attach" for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and inform the upper layers of the failure to access the network.


[Nm] {1884} If the attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "emergency" fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the procedures as described in subclause 5.5.1.2.6. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:


	[B1] {1885} a)	inform the upper layers of the failure of the procedure; or


	[B1] {1886} b)	attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.


[Nm] {1887} If the attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services"fails due to abnormal cases b), c), d) or o) in subclause 5.5.1.2.6, the UE shall perform the procedures as described in subclause 5.5.1.2.6. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.


[H5] {1888} 5.5.1.2.5B1	Attach by a UE transferring an emergency PDU session using a standalone PDN CONNECTIVITY REQUEST message


[Nm] {1889} If the network cannot accept attach request including a PDN CONNECTIVITY REQUEST message with request type set to "handover" and the UE also intends to transfer an emergency PDU session, the UE shall attempt EPS attach for emergency bearer services including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.


[Nm] {1890} If the attach request, including a PDN CONNECTIVITY REQUEST message with request type set "handover", fails due to abnormal case a) in subclause 5.5.1.2.6 and the UE intends to transfer an emergency PDU session, the UE shall attempt EPS attach including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.


[Nm] {1891} If the attach request including a PDN CONNECTIVITY REQUEST message with request type set "handover" fails due to abnormal cases b), c), d) or o) in subclause 5.5.1.2.6, the UE intends to transfer an emergency PDU session:


	[B1] {1892} -	if an EMM cause set to #19 "ESM failure" is received, the UE shall attempt EPS attach; and


	[B1] {1893} -	otherwise, the UE shall attempt EPS attach for emergency bearer services,


[Nm] {1894} with the ATTACH REQUEST message including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.


[H5] {1895} 5.5.1.2.5C	Attach for access to RLOS not accepted by the network


[Nm] {1896} If the attach request for access to RLOS is received by the network and the UE requesting attach is not in limited service state, the MME shall reject the UE's attach request. 


[Nm] {1897} If the attach request for access to RLOS cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #35 "Requested service option not authorized in this PLMN" or one of the EMM cause values as described in subclause 5.5.1.2.5.


[Nm] {1898} Upon receiving the ATTACH REJECT message including EMM cause #35, the UE shall enter the state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[Nm] {1899} Upon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in subclause 5.5.1.2.5. along with the following conditions:


	[B1] {1900} a)	if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to attach for access to RLOS in the new tracking area, if found; and


	[B1] {1901} b)	if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRA capability, the UE shall skip the action for as long as access to RLOS is still needed.


[Nm] {1902} Then if the UE is in the same selected PLMN where the last attach procedure was attempted and rejected and if timer T3346 is not running, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[Nm] {1903} If the attach request for access to RLOS fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the procedures as described in subclause 5.5.1.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling the E-UTRA capability, for as long as access to RLOS is still needed.


[H5] {1904} 5.5.1.2.6	Abnormal cases in the UE


[Nm] {1905} The following abnormal cases can be identified:


	[B1] {1906} a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers


	[B1] {1907} 	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started as soon as possible, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.


	[B1] {1908} 	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the attach procedure is started again after an implementation dependent time.


	[B1] {1909} 	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the attach procedure shall be started.


	[B1] {1910} 	If access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 [22]), ACDC is applicable to the request from the upper layers and the UE supports ACDC, then the attach procedure shall be started.


	[B1] {1911} 	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), a request with a higher ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.


	[B1] {1912} 	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), a request with a certain ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.


	[B1] {1913} b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the ATTACH ACCEPT or ATTACH REJECT message is received


	[B1] {1914} 	The attach procedure shall be aborted, and the UE shall proceed as described below.


	[B1] {1915} c)	T3410 timeout


	[B1] {1916} 	The UE shall abort the attach procedure and proceed as described below. The NAS signalling connection, if any, shall be released locally.


	[B1] {1917} d)	ATTACH REJECT, other EMM cause values than those treated in subclause 5.5.1.2.5, and cases of EMM cause values #22, #25 and #31, if considered as abnormal cases according to subclause 5.5.1.2.5


	[B1] {1918} 	Upon reception of the EMM cause #19 "ESM failure", if the UE is not configured for NAS signalling low priority and the ESM cause value received in the PDN CONNECTIVITY REJECT message is not #54 "PDN connection does not exist", the UE may set the attach attempt counter to 5. Subsequently, if the UE needs to retransmit the ATTACH REQUEST message to request PDN connectivity towards a different APN, the UE may stop T3411 or T3402, if running, and send the ATTACH REQUEST message. If the UE needs to attempt EPS attach to request transfer of a PDN connection for emergency bearer services by including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", the UE shall stop T3411 or T3402, if running, and send the ATTACH REQUEST message.


	[B1] {1919} 	If the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the attach attempt counter to 5.


	[B1] {1920} 	The UE shall proceed as described below.


	[B1] {1921} e)	Change of cell into a new tracking area


	[B1] {1922} 	If a cell change into a new tracking area occurs before the attach procedure is completed, the attach procedure shall be aborted and re-initiated immediately. If a tracking area border is crossed when the ATTACH ACCEPT message has been received but before an ATTACH COMPLETE message is sent, the attach procedure shall be re-initiated. If a GUTI was allocated during the attach procedure, this GUTI shall be used in the attach procedure.


	[B1] {1923} f)	Mobile originated detach required


	[B1] {1924} 	The attach procedure shall be aborted, and the UE initiated detach procedure shall be performed.


	[B1] {1925} g)	Detach procedure collision


	[B1] {1926} 	If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the detach procedure shall be progressed and the attach procedure shall be aborted. If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach required", the detach procedure shall be progressed and the UE shall locally release the NAS signalling connection, before re-initiating the attach procedure. Otherwise the attach procedure shall be progressed and the DETACH REQUEST message shall be ignored.


	[B1] {1927} h)	Transmission failure of ATTACH REQUEST message indication from lower layers


	[B1] {1928} 	The UE shall restart the attach procedure immediately.


	[B1] {1929} i)	Transmission failure of ATTACH COMPLETE message indication from lower layers


	[B1] {1930} 	If the current TAI is not in the TAI list, the UE shall restart the attach procedure.


	[B1] {1931} 	If the current TAI is still in the TAI list, it is up to the UE implementation how to re-run the ongoing procedure. The EMM sublayer notifies the ESM sublayer that the ESM message in the ESM message container IE of the ATTACH COMPLETE has failed to be transmitted.


	[B1] {1932} j)	If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall initiate the detach procedure by sending a DETACH REQUEST message to the network. Further UE behaviour is implementation specific.


	[B1] {1933} 	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall either send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT contained in the ESM message container information element to the network or initiate the detach procedure by sending a DETACH REQUEST message. Further UE behaviour is implementation specific.


	[B1] {1934} k)	Indication from the lower layers that an S101 mode to S1 mode handover has been cancelled (S101 mode only)


	[B1] {1935} 	The UE shall abort the attach procedure and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.


	[B1] {1936} l)	"Extended wait time" from the lower layers


	[B1] {1937} 	If the ATTACH REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.


	[B1] {1938} 	If the ATTACH REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.


	[B1] {1939} 	In other cases the UE shall ignore the "Extended wait time".


	[B1] {1940} 	The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.


	[B1] {1941} 	The UE shall proceed as described below.


	[B1] {1942} la)	"Extended wait time CP data" from the lower layers


	[B1] {1943} 	If the UE is operating in NB-S1 mode, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the attach attempt counter.


	[B1] {1944} 	In other cases the UE shall ignore the "Extended wait time CP data".


	[B1] {1945} 	The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.


	[B1] {1946} 	The UE shall proceed as described below.


	[B1] {1947} m)	Timer T3346 is running


	[B1] {1948} 	The UE shall not start the attach procedure unless:


		[B2] {1949} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {1950} -	the UE needs to attach for emergency bearer services;


		[B2] {1951} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and


			[B3] {1952} i)	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and


			[B3] {1953} ii)	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data"; or


		[B2] {1954} -	the UE needs to attach without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".


	[B1] {1955} 	The UE stays in the current serving cell and applies the normal cell reselection process.


	[B1] {1956} 	The UE shall proceed as described below.


	[B1] {1957} n)	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, an ESM DUMMY MESSAGE is included in the ESM message container information element of the ATTACH REQUEST message and the UE receives the ATTACH ACCEPT message combined with a PDN CONNECTIVITY REJECT message, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. Further UE behaviour is implementation specific.


	[B1] {1958} o)	Timer T3447 is running


	[B1] {1959} 	The UE shall not start the attach procedure unless:


		[B2] {1960} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {1961} -	the UE attempts to attach for emergency bearer services; or


		[B2] {1962} -	the UE attempts to attach without PDN connection request.


	[B1] {1963} 	The UE stays in the current serving cell and applies the normal cell reselection process. The attach request procedure is started, if still necessary, when timer T3447 expires.


[Nm] {1964} For the cases b, c, d, l, la and m:


	[B1] {1965} -	Timer T3410 shall be stopped if still running.


	[B1] {1966} -	For the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignored, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", the attach attempt counter shall be incremented, unless it was already set to 5.


	[B1] {1967} -	If the attach attempt counter is less than 5:


		[B2] {1968} -	for the cases l, la and m, the attach procedure is started, if still necessary, when timer T3346 expires or is stopped;


		[B2] {1969} -	for the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignore, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", timer T3411 is started and the state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. When timer T3411 expires the attach procedure shall be restarted, if still required by ESM sublayer.


	[B1] {1970} -	If the attach attempt counter is equal to 5:


		[B2] {1971} -	the UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and KSI, shall set the update status to EU2 NOT UPDATED, and shall start timer T3402. The state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH or optionally to EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and


		[B2] {1972} -	if A/Gb mode, Iu mode or N1 mode is supported by the UE:


			[B3] {1973} -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal attach procedure fails and the attach attempt counter is equal to 5;


			[B3] {1974} -	if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the abnormal case when an initial registration procedure performed over 3GPP access fails and the registration attempt counter is equal to 5; and


			[B3] {1975} -	the UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.


[H5] {1976} 5.5.1.2.6A	Abnormal cases in the UE, SMS services not accepted


[Nm] {1977} The UE shall proceed as follows:


		[B2] {1978} 1)	if the attach was successful for EPS services only and the ATTACH ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.1.2.4A or the SMS services status IE is not included in the message, the UE shall proceed as follows:


		[B2] {1979} a)	The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;


		[B2] {1980} b)	If the tracking area updating attempt counter is less than 5:


			[B3] {1981} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;


		[B2] {1982} c)	If the tracking area updating attempt counter is equal to 5:


			[B3] {1983} -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and


	[B1] {1984} 2)	otherwise, the abnormal cases specified in subclause 5.5.1.2.6 apply.


[H5] {1985} 5.5.1.2.7	Abnormal cases on the network side


[Nm] {1986} The following abnormal cases can be identified:


	[B1] {1987} a)	Lower layer failure


	[B1] {1988} 	If a lower layer failure occurs before the message ATTACH COMPLETE has been received from the UE, the network shall locally abort the attach procedure, enter state EMM-DEREGISTERED and shall not resend the message ATTACH ACCEPT. If a new GUTI was assigned to the UE in the attach procedure, the MME shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released.


	[B1] {1989} 	If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI. If the old GUTI is used by the UE in a subsequent attach message, the network may use the identification procedure to request the UE's IMSI.


	[B1] {1990} b)	Protocol error


	[B1] {1991} 	If the ATTACH REQUEST message is received with a protocol error, the network shall return an ATTACH REJECT message with one of the following EMM cause values:


	[B1] {1992} 	#96:	invalid mandatory information;


	[B1] {1993} 	#99:	information element non-existent or not implemented;


	[B1] {1994} 	#100:	conditional IE error; or


	[B1] {1995} 	#111:	protocol error, unspecified.


	[B1] {1996} c)	T3450 time-out


	[B1] {1997} 	On the first expiry of the timer, the network shall retransmit the ATTACH ACCEPT message and shall reset and restart timer T3450. 


	[B1] {1998} 	This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the attach procedure shall be aborted and the MME enters state EMM-DEREGISTERED. If a new GUTI was allocated in the ATTACH ACCEPT message, the network shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released. If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI. 


	[B1] {1999} 	If the old GUTI is used by the UE in a subsequent attach message, the network acts as specified for case a above.


	[B1] {2000} d)	ATTACH REQUEST received after the ATTACH ACCEPT message has been sent and before the ATTACH COMPLETE message is received


		[B2] {2001} -	If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted if the ATTACH COMPLETE message has not been received and the new attach procedure shall be progressed; or


		[B2] {2002} -	If the information elements do not differ, then the ATTACH ACCEPT message shall be resent and the timer T3450 shall be restarted if an ATTACH COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.


	[B1] {2003} e)	More than one ATTACH REQUEST received and no ATTACH ACCEPT or ATTACH REJECT message has been sent


		[B2] {2004} -	If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted and the new attach procedure shall be executed;


		[B2] {2005} -	If the information elements do not differ, then the network shall continue with the previous attach procedure and shall ignore the second ATTACH REQUEST message.


	[B1] {2006} f)	ATTACH REQUEST received in state EMM-REGISTERED


	[B1] {2007} 	If an ATTACH REQUEST message is received in state EMM-REGISTERED the network may initiate the EMM common procedures; if it turned out that the ATTACH REQUEST message was sent by a genuine UE that has already been attached, the EMM context, EPS bearer contexts, if any, are deleted and the new ATTACH REQUEST is progressed.


	[B1] {2008} g)	TRACKING AREA UPDATE REQUEST message received before ATTACH COMPLETE message.


	[B1] {2009} 	Timer T3450 shall be stopped. The allocated GUTI in the attach procedure shall be considered as valid and the tracking area updating procedure shall be rejected with the EMM cause #10 "implicitly detached" as described in subclause 5.5.3.2.5.


	[B1] {2010} h)	DETACH REQUEST message received before ATTACH COMPLETE message.


	[B1] {2011} 	The network shall abort the attach procedure and shall progress the detach procedure as described in subclause 5.5.2.2.


	[B1] {2012} i)	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME receives an ATTACH REQUEST message with an ESM message included in the ESM message container information element, and the ESM sublayer in the MME detects a message error according to clause 7, the MME may decide to proceed with the attach procedure or to reject it. When sending the ATTACH ACCEPT or ATTACH REJECT message to the UE, the MME shall include the ESM message provide by the ESM layer in the ESM message container information element.


	[B1] {2013} j)	UE security capabilities invalid or unacceptable


	[B1] {2014} 	If the ATTACH REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no EPS encryption algorithms (all bits zero), no EPS integrity algorithms (all bits zero), mandatory EPS encryption algorithms not supported or mandatory EPS integrity algorithms not supported, etc.), the MME shall return an ATTACH REJECT message.


[H4] {2015} 5.5.1.3	Combined attach procedure for EPS services and non-EPS services (S1 mode only)


[H5] {2016} 5.5.1.3.1	General


[Nm] {2017} The combined attach procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services, or both EPS services and "SMS only".


[Nm] {2018} The combined attach procedure is also used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for EPS services if it is already IMSI attached for non-EPS services.


[Nm] {2019} When the UE initiates a combined attach procedure, the UE shall indicate "combined EPS/IMSI attach" in the EPS attach type IE.


[Nm] {2020} The combined attach procedure follows the attach procedure for EPS described in subclause 5.5.1.2 with exception of subclause 5.5.1.2.4A and subclause 5.5.1.2.6A.


[H5] {2021} 5.5.1.3.2	Combined attach procedure initiation


[Nm] {2022} If the UE is in EMM state EMM-DEREGISTERED, the UE initiates the combined attach procedure by sending an ATTACH REQUEST message to the network, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1).


[Nm] {2023} The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the ATTACH REQUEST message.


[Nm] {2024} If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the ATTACH REQUEST message.


[Nm] {2025} If the UE initiates a combined attach procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE.


[H5] {2026} 5.5.1.3.3	EMM common procedure initiation


[Nm] {2027} The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures, depending on the received information such as IMSI, GUTI and KSI.


[H5] {2028} 5.5.1.3.4	Combined attach accepted by the network


[H6] {2029} 5.5.1.3.4.1	General


[Nm] {2030} Depending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, the following different cases can be distinguished:


	[B1] {2031} 1)	The EPS attach result IE value indicates "combined EPS/IMSI attach": attach for EPS and non-EPS services, or for EPS services and "SMS only" have been successful.


	[B1] {2032} 2)	The EPS attach result IE value indicates "EPS only": attach for EPS services has been successful but attach for non-EPS services or "SMS only" has failed.


[H6] {2033} 5.5.1.3.4.2	Combined attach successful


[Nm] {2034} The description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or "SMS only" applies.


[Nm] {2035} The TMSI reallocation may be part of the combined attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message, together with the location area identification (LAI). In this case the MME shall start timer T3450 as described in subclause 5.4.1.4, and enter state EMM-COMMON-PROCEDURE-INITIATED. If the MME does not indicate "SMS only" in the ATTACH ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.


[Nm] {2036} For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].


[Nm] {2037} The UE, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3410, resets the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the UE is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the UE shall use this TMSI as the new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept.


[Nm] {2038} If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), then the UE shall reset this counter.


[Nm] {2039} If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined attach for EPS and non-EPS services, but the network decides to accept the attach request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall provide a non-broadcast LAI in the ATTACH ACCEPT message. If a TMSI has to be allocated, then the network shall also provide a TMSI value which cannot cause any ambiguity with assigned TMSI values.


[Nm] {2040} If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.


[Nm] {2041} As an implementation option, if the ATTACH ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signaling low priority then the UE may stop timer T3246 if running.


[Nm] {2042} If the ATTACH ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.


[Nm] {2043} If the LAI contained in the ATTACH ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.


[Nm] {2044} If the PLMN identity for the CS domain which is provided as part of the LAI contained in the ATTACH ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the ATTACH ACCEPT message.


[Nm] {2045} The UE, when having requested PDN connectivity as contained in the ATTACH REQUEST and on receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network.


[Nm] {2046} Upon transmission of the ATTACH COMPLETE message the UE shall enter state EMM-REGISTERED and MM state MM-IDLE and set the EPS update status to EU1 UPDATED.


[Nm] {2047} If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).


[Nm] {2048} Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED.


[Nm] {2049} After the UE performs intersystem change from N1 mode to S1 mode, if:


	[B1] {2050} -	the network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 [8]);


	[B1] {2051} -	the UE has an emergency PDN connection;


	[B1] {2052} -	the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and


	[B1] {2053} -	the MME has neither an IMEI nor an IMEISV for the UE;


[Nm] {2054} then the MME shall initiate the identification procedure (see subclause 5.4.4) or the security mode control procedure (see subclause 5.4.3) with the UE.


[H6] {2055} 5.5.1.3.4.3	Combined attach successful for EPS services only


[Nm] {2056} Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.


[Nm] {2057} If, due to emergency services fallback (see 3GPP TS 23.502 [59], subclause 4.13.4), there is a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported", then the UE shall skip the requirements defined below in the present subclause for the receipt of an ATTACH ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in subclause 5.3.7, proceed with appropriate MM specific procedures, and send the setup message.


[Nm] {2058} The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:


	[B1] {2059} #2	(IMSI unknown in HSS)


		[B2] {2060} 	The UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.or the timer T3245 expires as described in subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


		[B2] {2061} 	If, due to emergency services fallback (see 3GPP TS 23.502 [59]), there is a request for CS fallback call pending (see subclause 5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.


	[B1] {2062} #16	(MSC temporarily not reachable); or


	[B1] {2063} #17	(Network failure)


		[B2] {2064} 	The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.


		[B2] {2065} 	If the tracking area updating attempt counter is less than 5:


			[B3] {2066} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered.


		[B2] {2067} 	If the tracking area updating attempt counter is equal to 5:


			[B3] {2068} -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;


			[B3] {2069} -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5).


	[B1] {2070} #18	(CS domain not available)


		[B2] {2071} 	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.


		[B2] {2072} 	The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.


		[B2] {2073} 	A UE in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).


		[B2] {2074} 	A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.


		[B2] {2075} 	The UE shall not attempt combined attach or combined tracking area updating procedures with current PLMN until switching off the UE or the UICC containing the USIM is removed.


	[B1] {2076} #22	(Congestion)


		[B2] {2077} 	The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and shall enter state MM IDLE.


[Nm] {2078} Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6.


[H5] {2079} 5.5.1.3.5	Combined attach not accepted by the network


[Nm] {2080} If the attach request can neither be accepted by the network for EPS nor for non-EPS services, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, and the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure or operator determined barring, the MME shall:


	[B1] {2081} -	combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, "ESM failure"; or


	[B1] {2082} -	send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area" ,if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".


[Nm] {2083} If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.


[Nm] {2084} If the attach request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.


[Nm] {2085} Based on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required". 


[Nm] {2086} Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410 and enter MM state MM IDLE.


[Nm] {2087} If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.


[Nm] {2088} The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.


	[B1] {2089} #3	(Illegal UE);


	[B1] {2090} #6	(Illegal ME); or


	[B1] {2091} #8	(EPS services and non-EPS services not allowed);


	[B1] {2092} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI.


	[B1] {2093} 	The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2094} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2095} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2096} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2097} #7	(EPS services not allowed);


	[B1] {2098} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2099} 	A UE which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.


	[B1] {2100} 	The UE shall attempt to select GERAN or UTRAN radio access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.


	[B1] {2101} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2102} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2103} #11	(PLMN not allowed); or


	[B1] {2104} #35	(Requested service option not authorized in this PLMN);


	[B1] {2105} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2106} 	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2107} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2108} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause value #11 and no RR connection exists.


	[B1] {2109} 	For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2110} 	For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2111} #12	(Tracking area not allowed);


	[B1] {2112} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2113} 	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.


	[B1] {2114} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2115} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2116} #13	(Roaming not allowed in this tracking area);


	[B1] {2117} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. Additionally the UE enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2118} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.


	[B1] {2119} 	If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] subclause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2120} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2121} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2122} #14	(EPS services not allowed in this PLMN);


	[B1] {2123} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2124} 	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2125} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED. 


	[B1] {2126} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).


	[B1] {2127} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2128} 	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2129} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2130} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2131} #15	(No suitable cells in tracking area);


	[B1] {2132} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2133} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall proceed as follows:


		[B2] {2134} -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled, then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;


		[B2] {2135} -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;


		[B2] {2136} -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {2137} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2138} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2139} #22	(Congestion);


	[B1] {2140} 	If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.3.6.


	[B1] {2141} 	The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.


	[B1] {2142} 	The UE shall stop timer T3346 if it is running.


	[B1] {2143} 	If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.


	[B1] {2144} 	If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].


	[B1] {2145} 	The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.


	[B1] {2146} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2147} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {2148} #25	(Not authorized for this CSG);


	[B1] {2149} 	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.6.


	[B1] {2150} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2151} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {2152} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {2153} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {2154} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.


	[B1] {2155} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


	[B1] {2156} #42	(Severe network failure);


	[B1] {2157} 	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2158} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED signature, RAI and GPRS ciphering key sequence number TMSI and ciphering key sequence number.


	[B1] {2159} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2160} #31	(Redirection to 5GCN required);


	[B1] {2161} 	EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.6.


	[B1] {2162} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.


	[B1] {2163} 	The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see subclause 4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.


	[B1] {2164} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


[Nm] {2165} Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6.


[H5] {2166} 5.5.1.3.6	Abnormal cases in the UE


[Nm] {2167} The UE shall proceed as follows:


	[B1] {2168} 1)	if the UE requested the combined attach for EPS services and "SMS only" and the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, the UE shall behave as if the combined attach was successful for EPS services and "SMS only";


	[B1] {2169} 2)	if the combined attach was successful for EPS services only and the ATTACH ACCEPT message contained an EMM cause value not treated in subclause 5.5.1.3.4.3 or the EMM cause IE is not included in the message, the UE shall proceed as follows:


		[B2] {2170} a)	The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;


		[B2] {2171} b)	If the tracking area updating attempt counter is less than 5:


			[B3] {2172} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;


		[B2] {2173} c)	If the tracking area updating attempt counter is equal to 5:


			[B3] {2174} -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; and


			[B3] {2175} -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5); and


		[B2] {2176} d)	If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and


	[B1] {2177} 3)	otherwise, the abnormal cases specified in subclause 5.5.1.2.6 apply with the following modification.


	[B1] {2178} 	If the attach attempt counter is incremented according to subclause 5.5.1.2.6 the next actions depend on the value of the attach attempt counter:


		[B2] {2179} -	if the attach attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; or


		[B2] {2180} -	if the attach attempt counter is equal to 5, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.


	[B1] {2181} 	If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


[H5] {2182} 5.5.1.3.7	Abnormal cases on the network side


[Nm] {2183} The abnormal cases specified in subclause 5.5.1.2.7 apply.


[H3] {2184} 5.5.2	Detach procedure


[H4] {2185} 5.5.2.1	General


[Nm] {2186} The detach procedure is used:


	[B1] {2187} -	by the UE to detach for EPS services only;


	[B1] {2188} -	by the UE to disconnect from the last remaining PDN it is connected to if EMM-REGISTERED without PDN connection is not supported by the UE or the MME;


	[B1] {2189} -	by the UE in CS/PS mode 1 or CS/PS mode 2 of operation to detach for both EPS services and non-EPS services or for non-EPS services only via a combined detach procedure;


	[B1] {2190} -	by the network to inform the UE that it is detached for EPS services or non-EPS services or both;


	[B1] {2191} -	by the network to disconnect the UE from the last remaining PDN to which it is connected if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; and


	[B1] {2192} -	by the network to inform the UE to re-attach to the network and re-establish all PDN connections.


[Nm] {2193} The detach procedure also applies to the UE which is IMSI attached for "SMS only".


[Nm] {2194} The detach procedure with appropriate detach type shall be invoked by the UE if the UE is switched off, the USIM card is removed from the UE, the UE wishes to detach for EPS services, the UE wishes to detach for non-EPS services or as part of the eCall inactivity procedure defined in subclause 5.5.4.


[Nm] {2195} If the detach procedure is triggered due to USIM removal, the UE shall indicate "switch off" in the detach type IE.


[Nm] {2196} When upper layers indicates that emergency bearer services are no longer required, the UE if still attached for emergency bearer services, may perform a detach followed by a re-attach to regain normal services, if the UE is in or moves to a suitable cell.


[Nm] {2197} If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall not send a DETACH REQUEST message to the UE, and shall follow the procedures in subclause 6.4.4.1 for a UE that has bearers for emergency services.


[Nm] {2198} If the detach procedure for EPS services is performed, the EPS bearer context(s), if any, for this particular UE are deactivated locally without peer-to-peer signalling between the UE and the MME.


[Nm] {2199} If the UE supports A/Gb mode or Iu mode or both, the UE shall store the TIN in the non-volatile memory in the ME, as described in annex C, for a subsequent attach procedure.


[Nm] {2200} The UE is allowed to initiate the detach procedure even if the timer T3346 is running.


[Nm] {2201} The network proceeds with the detach procedure even if NAS level mobility management congestion control is active.


[H4] {2202} 5.5.2.2	UE initiated detach procedure


[H5] {2203} 5.5.2.2.1	UE initiated detach procedure initiation


[Nm] {2204} The detach procedure is initiated by the UE by sending a DETACH REQUEST message (see example in figure 5.5.2.2.1.1). The Detach type IE included in the message indicates whether detach is due to a "switch off" or not. The Detach type IE also indicates whether the detach is for EPS services only, for non-EPS services only, or for both. If the UE has a mapped EPS security context as the current EPS security context, the UE shall set the type of security context flag to "mapped security context". Otherwise, the UE shall set the type of security context flag to "native security context".


[Nm] {2205} If the UE has a valid GUTI, the UE shall populate the EPS mobile identity IE with the valid GUTI. If the UE does not have a valid GUTI, the UE shall populate the EPS mobile identity IE with its IMSI.


[Nm] {2206} If the UE does not have a valid GUTI and it does not have a valid IMSI, then the UE shall populate the EPS mobile identity IE with its IMEI.


[Nm] {2207} If the detach is not due to switch off and the UE is in the state EMM-REGISTERED or EMM-REGISTERED-INITIATED, timer T3421 shall be started in the UE after the DETACH REQUEST message has been sent. If the detach type indicates that the detach is for non-EPS services only the UE shall enter the state EMM-REGISTERED.IMSI-DETACH-INITIATED, otherwise the UE shall enter the state EMM-DEREGISTERED-INITIATED. If the detach type indicates that the detach is for non-EPS services or both EPS and non-EPS services, the UE shall enter the state MM IMSI DETACH PENDING.


[Nm] {2208} If the UE to be switched off is not operating in NB-S1 mode and not operating in WB-S1 mode in any enhanced coverage CE mode, the UE shall try for a period of 5 seconds to send the DETACH REQUEST message. If the UE to be switched off:-


	[B1] {2209} -	is operating in NB-S1 mode, then the UE should try for at least a period of 85 seconds to send the DETACH REQUEST; or


	[B1] {2210} -	is operating in WB-S1 mode in any enhanced coverage CE mode, then the UE should try for at least a period of 14 seconds to send the DETACH REQUEST.


[Nm] {2211} During this period, the UE may be switched off as soon as the DETACH REQUEST message has been sent.


[Nm] {2212} After the last DETACH REQUEST message is sent, the UE shall proceed as follows:


	[B1] {2213} -	if the current EPS security context is a native EPS security context, then the UE shall store the current EPS security context as specified in annex C and mark it as valid;


	[B1] {2214} -	else if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the UE shall store the non-current EPS security context as specified in annex C and mark it as valid, and finally the UE shall delete any mapped EPS security context or partial native EPS security context.


[H5] {2215} 5.5.2.2.2	UE initiated detach procedure completion for EPS services only


[Nm] {2216} When the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.


[Nm] {2217} The network and the UE shall deactivate the EPS bearer context(s), if any, for this UE locally without peer-to-peer signalling between the UE and the MME.


[Nm] {2218} The UE is marked as inactive in the network for EPS services. The network shall enter the state EMM-DEREGISTERED.


[Nm] {2219} The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421. Furthermore, if the UE is operating in PS mode of operation, or is operating in CS/PS mode of operation and supports S1 mode only then:


	[B1] {2220} -	If the detach procedure was performed due to disabling of EPS services, then the UE shall enter the EMM-NULL state.


	[B1] {2221} -	Otherwise, the UE shall enter the EMM-DEREGISTERED state.


[Nm] {2222} The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, and supporting A/Gb mode or Iu mode, shall further set the update status to U2 NOT UPDATED, disable the EUTRA capability (see subclause 4.5) and attempt to select GERAN or UTRAN access technology.


[H5] {2223} 5.5.2.2.3	UE initiated combined detach procedure completion


[Nm] {2224} When the DETACH REQUEST message is received by the network, a DETACH ACCEPT message shall be sent to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.


[Nm] {2225} Depending on the value of the Detach type IE the following applies:


	[B1] {2226} -	combined EPS/IMSI detach:


	[B1] {2227} 	The network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME. The UE is marked as inactive in the network for EPS and for non-EPS services. The states EMM-DEREGISTERED and MM-NULL are entered in both the UE and the network.


	[B1] {2228} -	IMSI detach:


	[B1] {2229} 	The UE is marked as inactive in the network for non-EPS services. The states MM-NULL and EMM-REGISTERED are entered in both the UE and the network.


[Nm] {2230} The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421.


[H5] {2231} 5.5.2.2.4	Abnormal cases in the UE


[Nm] {2232} The following abnormal cases can be identified:


	[B1] {2233} a)	Access barred because of access class barring, EAB or NAS signalling connection establishment rejected by the network


	[B1] {2234} 	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The detach signalling procedure is started as soon as possible and if still necessary, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted. The UE may perform a local detach either immediately or after an implementation dependent time.


	[B1] {2235} 	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the detach signalling procedure is started again after an implementation dependent time.


	[B1] {2236} b)	Lower layer failure or release of the NAS signalling connection before reception of DETACH ACCEPT message


	[B1] {2237} 	The detach procedure shall be aborted and the UE proceeds as follows:


		[B2] {2238} -	if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;


		[B2] {2239} -	if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;


		[B2] {2240} -	if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or


		[B2] {2241} -	if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.


	[B1] {2242} c)	T3421 timeout


	[B1] {2243} 	On the first four expiries of the timer, the UE shall retransmit the DETACH REQUEST message and shall reset and restart timer T3421. On the fifth expiry of timer T3421, the detach procedure shall be aborted and the UE proceeds as follows:


		[B2] {2244} -	if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;


		[B2] {2245} -	if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;


		[B2] {2246} -	if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or


		[B2] {2247} -	if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.


	[B1] {2248} d)	Detach procedure collision


	[B1] {2249} 	Detach containing cause "switch off" within the Detach type IE:


		[B2] {2250} -	If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, this message shall be ignored and the UE initiated detach procedure shall continue.


	[B1] {2251} 	Detach containing other causes than "switch off" within the Detach type IE:


		[B2] {2252} -	If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, it shall treat the message as specified in subclause 5.5.2.3.2 with the following modifications:


			[B3] {2253} -	If the DETACH REQUEST message received by the UE contains detach type "re-attach required", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE need not initiate the attach or combined attach procedure.


			[B3] {2254} -	If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "IMSI detach", the UE need not re-attach to non-EPS services.


			[B3] {2255} -	If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE shall progress both procedures. The UE need not re-attach to non-EPS services.


	[B1] {2256} e)	Detach and EMM common procedure collision


	[B1] {2257} 	Detach containing cause "switch off":


		[B2] {2258} -	If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, this message shall be ignored and the detach procedure shall continue.


	[B1] {2259} 	Detach containing other causes than "switch off" and containing detach type "IMSI detach":


		[B2] {2260} -	If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, both the EMM common procedure and the detach procedure shall continue.


	[B1] {2261} 	Detach containing other causes than "switch off" and containing other detach types than "IMSI detach":


		[B2] {2262} -	If the UE receives a GUTI REALLOCATION COMMAND, an EMM STATUS or an EMM INFORMATION message before the detach procedure is completed, this message shall be ignored and the detach procedure shall continue.


		[B2] {2263} -	If the UE receives an AUTHENTICATION REQUEST, SECURITY MODE COMMAND or IDENTITY REQUEST message before the detach procedure has been completed, the UE shall respond to it as described in subclause 5.4.2, 5.4.3 and 5.4.4 respectively and the detach procedure shall continue.


	[B1] {2264} f)	Change of cell into a new tracking area


	[B1] {2265} 	If a cell change into a new tracking area that is not in the stored TAI list occurs before the UE initiated detach procedure is completed, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure. If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure and enter the state EMM-DEREGISTERED.


	[B1] {2266} g)	Transmission failure of DETACH REQUEST message indication with TAI change from lower layers


	[B1] {2267} 	If the current TAI is not in the TAI list, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure. If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure and enter the state EMM-DEREGISTERED.


	[B1] {2268} 	If the current TAI is still part of the TAI list, the UE shall restart the detach procedure.


	[B1] {2269} h)	Transmission failure of DETACH REQUEST message indication without TAI change from lower layers


	[B1] {2270} 	The UE shall restart the detach procedure.


	[B1] {2271} i)	Detach and paging procedure collision


	[B1] {2272} 	If the UE receives a CS SERVICE NOTIFICATION message before the UE initiated combined detach procedure with detach type "IMSI detach" or "combined EPS/IMSI detach" has been completed, then this message shall be ignored and the UE initiated combined detach procedure shall continue.


[Nm] {2273} For the cases b, f and g:


	[B1] {2274} -	Timer T3421 shall be stopped if still running.


[H5] {2275} 5.5.2.2.5	Abnormal cases on the network side


[Nm] {2276} The following abnormal cases can be identified:


	[B1] {2277} a)	Detach request received in a CSG cell for which the UE has no valid CSG subscription


	[B1] {2278} 	If the UE initiates a detach procedure in a CSG cell the CSG ID of which is not valid for the UE, and the detach procedure is not due to "switch off", the network shall proceed as follows:


		[B2] {2279} -	if the detach type is "IMSI detach" and the UE has a PDN connection for emergency bearer services active, the MME shall send a DETACH ACCEPT message and deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure;


		[B2] {2280} -	otherwise, the network shall initiate the detach procedure. The MME shall send a DETACH REQUEST message including the EMM cause #25,"not authorized for this CSG".


	[B1] {2281} b)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {2282} 	If the DETACH ACCEPT message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH ACCEPT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH ACCEPT message.


[H4] {2283} 5.5.2.3	Network initiated detach procedure


[H5] {2284} 5.5.2.3.1	Network initiated detach procedure initiation


[Nm] {2285} The network initiates the detach procedure by sending a DETACH REQUEST message to the UE (see example in figure 5.5.2.3.1).


[Nm] {2286} The network may include an EMM cause IE to specify the reason for the detach request. The network shall start timer T3422. If the Detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", or if the MME performs a local detach, the MME shall either store the current EPS security context if it is a native EPS security context, or the MME shall delete the current EPS security context if it is a mapped EPS security context. If the detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the network shall deactivate the EPS bearer context(s), if any, for the UE locally and enter state EMM-DEREGISTERED-INITIATED.


[H5] {2287} 5.5.2.3.2	Network initiated detach procedure completion by the UE


[Nm] {2288} When receiving the DETACH REQUEST message and the detach type indicates "re-attach required", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall stop the timer T3346, if it is running. The UE shall also stop timer(s) T3396, if it is running. The UE shall send a DETACH ACCEPT message to the network and enter the state EMM-DEREGISTERED. Furthermore, the UE shall, after the completion of the detach procedure, and the release of the existing NAS signalling connection, initiate an attach or combined attach procedure. The UE should also re-establish any previously established PDN connection(s).


[Nm] {2289} A UE which receives a DETACH REQUEST message with detach type indicating "re-attach required" or "re-attach not required" and no EMM cause IE, is detached only for EPS services.


[Nm] {2290} When receiving the DETACH REQUEST message and the detach type indicates "IMSI detach", the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. The UE shall set the MM update status to U2 NOT UPDATED. A UE may send a DETACH ACCEPT message to the network, and shall re-attach to non-EPS services by performing the combined tracking area updating procedure according to subclause 5.5.3.3, sending a TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "combined TA/LA updating with IMSI attach".


[Nm] {2291} If the UE is attached for EPS and non-EPS services, then the UE shall set the update status to U2 NOT UPDATED if:


	[B1] {2292} -	the Detach type IE indicates "re-attach required"; or


	[B1] {2293} -	the Detach type IE indicates "re-attach not required" and no EMM cause IE is included.


[Nm] {2294} When receiving the DETACH REQUEST message and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall then send a DETACH ACCEPT message to the network and enter state EMM-DEREGISTERED.


[Nm] {2295} If the detach type indicates "IMSI detach" or "re-attach required", then the UE shall ignore the EMM cause IE if received.


[Nm] {2296} If the detach type indicates "re-attach not required", the UE shall take the following actions depending on the received EMM cause value:


	[B1] {2297} #2	(IMSI unknown in HSS);


	[B1] {2298} 	The UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2299} 	The UE is still attached for EPS services in the network. 


	[B1] {2300} #3	(Illegal UE);


	[B1] {2301} #6	(Illegal ME); or


	[B1] {2302} #8	(EPS services and non-EPS services not allowed);


	[B1] {2303} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2304} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall also be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.


	[B1] {2305} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2306} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2307} #7	(EPS services not allowed);


	[B1] {2308} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2309} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2310} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.


	[B1] {2311} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2312} #11	(PLMN not allowed);


	[B1] {2313} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2314} 	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2315} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2316} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2317} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2318} #12	(Tracking area not allowed);


	[B1] {2319} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2320} 	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".


	[B1] {2321} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2322} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2323} #13	(Roaming not allowed in this tracking area);


	[B1] {2324} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, reset the attach attempt counter and shall change to state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2325} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".


	[B1] {2326} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]


	[B1] {2327} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter and as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2328} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2329} #14	(EPS services not allowed in this PLMN);


	[B1] {2330} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2331} 	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2332} 	A UE in PS mode 1 or PS mode 2 of operation shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2333} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.


	[B1] {2334} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).


	[B1] {2335} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2336} 	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6]. 


	[B1] {2337} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2338} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2339} #15	(No suitable cells in tracking area);


	[B1] {2340} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2341} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".


	[B1] {2342} 	The UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {2343} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2344} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".


	[B1] {2345} #25	(Not authorized for this CSG);


	[B1] {2346} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2347} 	If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {2348} 	If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {2349} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {2350} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".


	[B1] {2351} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


[Nm] {2352} Other EMM cause values or if no EMM cause IE is included is considered as abnormal cases. The behaviour of the UE in those cases is described in subclause 5.5.2.3.4.


[H5] {2353} 5.5.2.3.3	Network initiated detach procedure completion by the network


[Nm] {2354} The network shall stop timer T3422 upon receipt of the DETACH ACCEPT message. If the Detach type IE indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall enter state EMM-DEREGISTERED.


[H5] {2355} 5.5.2.3.4	Abnormal cases in the UE


[Nm] {2356} The following abnormal cases can be identified:


	[B1] {2357} a)	Transmission failure of DETACH ACCEPT message indication from lower layers


	[B1] {2358} 	The detach procedure shall be progressed and the UE shall send the DETACH ACCEPT message.


	[B1] {2359} b)	DETACH REQUEST, other EMM cause values than those treated in subclause 5.5.2.3.2 or no EMM cause IE is included, and the Detach type IE indicates "re-attach not required"


	[B1] {2360} 	The UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI, shall set the update status to EU2 NOT UPDATED and shall start timer T3402.


	[B1] {2361} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.


	[B1] {2362} -	A UE not supporting A/Gb mode or Iu mode, or operating in PS mode of operation may enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; otherwise the UE shall enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.


	[B1] {2363} 	A UE supporting A/Gb mode or Iu mode and operating in CS/PS mode 1 of operation or CS/PS mode 2 of operation shall


		[B2] {2364} -	enter the state EMM-DEREGISTERED and attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM or GMM specific procedures. In this case, the UE may disable the E-UTRA capability (see subclause 4.5); or


		[B2] {2365} -	enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2366} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall set the GPRS update status to GU2 NOT UPDATED and shall delete the GMM parameters P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and shall enter the state GMM-DEREGISTERED.


	[B1] {2367} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


[H5] {2368} 5.5.2.3.5	Abnormal cases on the network side


[Nm] {2369} The following abnormal cases can be identified:


	[B1] {2370} a)	T3422 time-out


	[B1] {2371} 	On the first expiry of the timer, the network shall retransmit the DETACH REQUEST message and shall start timer T3422. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3422, the detach procedure shall be aborted. If the detach type is "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.


	[B1] {2372} b)	Lower layer failure


	[B1] {2373} 	The detach procedure is aborted. If the detach type indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.


	[B1] {2374} c)	Detach procedure collision


	[B1] {2375} 	If the network receives a DETACH REQUEST message with "switch off" indication, before the network initiated detach procedure has been completed, both procedures shall be considered completed.


	[B1] {2376} 	If the network receives a DETACH REQUEST message without "switch off" indication, before the network initiated detach procedure has been completed, the network shall send a DETACH ACCEPT message to the UE.


	[B1] {2377} d)	Detach and attach procedure collision


	[B1] {2378} 	If the network receives an ATTACH REQUEST message before the network initiated detach procedure with detach type "re-attach not required" with no EMM cause IE, or "re-attach not required" and the EMM cause value not #2 "IMSI unknown in HSS", has been completed, the network shall ignore the ATTACH REQUEST message. If the Detach type IE, sent in the DETACH REQUEST message, indicates "re-attach required" the detach procedure is aborted and the attach procedure shall be progressed after the EPS bearer context(s) have been deleted. If the Detach type IE, sent in DETACH REQUEST message, indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the detach procedure is aborted and the attach procedure shall be progressed.


	[B1] {2379} e)	Detach and tracking area updating procedure collision


	[B1] {2380} 	If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with no EMM cause IE, or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or indicates "re-attach required", and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the detach procedure shall be progressed, i.e. the TRACKING AREA UPDATE REQUEST message shall be ignored.


	[B1] {2381} 	If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or indicates "IMSI detach" and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the network shall abort the detach procedure, shall stop T3422 and shall progress the tracking area updating procedure.


	[B1] {2382} f)	Detach and service request procedure collision


	[B1] {2383} 	If the network receives a SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures. If the DETACH REQUEST message contains detach type "re-attach not required" with no EMM cause IE, or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or detach type "re-attach required", the network shall progress the detach procedure.


	[B1] {2384} 	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback, but not for CS fallback for emergency call, before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall ignore the EXTENDED SERVICE REQUEST message and progress the detach procedure.


	[B1] {2385} 	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback for emergency call before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures.


	[B1] {2386} g)	Lower layers indication of non-delivered NAS PDU due to handover


	[B1] {2387} 	If the DETACH REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH REQUEST message.


[H3] {2388} 5.5.3	Tracking area updating procedure (S1 mode only)


[H4] {2389} 5.5.3.1	General


[Nm] {2390} The tracking area updating procedure is always initiated by the UE and is used for the following purposes:


	[B1] {2391} -	normal tracking area updating to update the registration of the actual tracking area of a UE in the network;


	[B1] {2392} -	combined tracking area updating to update the registration of the actual tracking area for a UE in CS/PS mode 1 or CS/PS mode 2 of operation;


	[B1] {2393} -	periodic tracking area updating to periodically notify the availability of the UE to the network;


	[B1] {2394} -	IMSI attach for non-EPS services when the UE is attached for EPS services. This procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation;


	[B1] {2395} -	in various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode;


	[B1] {2396} -	in various cases of inter-system change from N1 mode to S1 mode if the UE operates in single-registration mode and as described in 3GPP TS 24.501 [54];


	[B1] {2397} -	S101 mode to S1 mode inter-system change;


	[B1] {2398} -	MME load balancing;


	[B1] {2399} -	to update certain UE specific parameters in the network;


	[B1] {2400} -	recovery from certain error cases;


	[B1] {2401} -	to indicate that the UE enters S1 mode after CS fallback or 1xCS fallback;


	[B1] {2402} -	to indicate to the network that the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;


	[B1] {2403} -	to indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions; and


	[B1] {2404} -	to indicate to the network that the UE has locally released EPS bearer context(s).


[Nm] {2405} Details on the conditions for the UE to initiate the tracking area updating procedure are specified in subclause 5.5.3.2.2 and subclause 5.5.3.3.2.


[Nm] {2406} While a UE has a PDN connection for emergency bearer services, the UE shall not perform manual CSG selection.


[Nm] {2407} If control plane CIoT EPS optimization is not used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts during the procedure. If control plane CIoT EPS optimization is used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without control plane only indication during the procedure.


[Nm] {2408} In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity on the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service". Whenever a TRACKING AREA UPDATE REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking Area", the constructed TAI shall be stored in the suitable list.


[Nm] {2409} In a shared network, if TRACKING AREA UPDATE REJECT is received as a response to a tracking area updating procedure initiated in EMM-CONNECTED mode, the UE need not update forbidden lists.


[Nm] {2410} A tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in subclause 5.5.3.2.6. Depending on the value of the tracking area updating attempt counter, specific actions shall be performed. The tracking area updating attempt counter shall be reset when:


	[B1] {2411} -	a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;


	[B1] {2412} -	a normal or periodic tracking area updating or a combined tracking area updating procedure is rejected with EMM cause #11, #12, #13, #14, #15, #25 or #35:


	[B1] {2413} -	a combined attach procedure or a combined tracking area updating procedure is completed for EPS services only with cause #2 or #18;or


	[B1] {2414} -	a new PLMN is selected.


[Nm] {2415} Additionally the tracking area updating attempt counter shall be reset when the UE is in substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and:


	[B1] {2416} -	a new tracking area is entered;


	[B1] {2417} -	timer T3402 expires; or


	[B1] {2418} -	timer T3346 is started.


[H4] {2419} 5.5.3.2	Normal and periodic tracking area updating procedure


[H5] {2420} 5.5.3.2.1	General


[Nm] {2421} The periodic tracking area updating procedure is controlled in the UE by timer T3412. When timer T3412 expires, the periodic tracking area updating procedure is started. Start and reset of timer T3412 is described in subclause 5.3.5.


[H5] {2422} 5.5.3.2.2	Normal and periodic tracking area updating procedure initiation


[Nm] {2423} The UE in state EMM-REGISTERED shall initiate the tracking area updating procedure by sending a TRACKING AREA UPDATE REQUEST message to the MME,


	[B1] {2424} a)	when the UE detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;


	[B1] {2425} b)	when the periodic tracking area updating timer T3412 expires;


	[B1] {2426} c)	when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates "P-TMSI";


	[B1] {2427} d)	when the UE performs an inter-system change from S101 mode to S1 mode and has no user data pending;


	[B1] {2428} e)	when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";


	[B1] {2429} f)	when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it could not establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message with detach type is "EPS detach" or "combined EPS/IMSI detach" is pending to be sent by the UE;


	[B1] {2430} g)	when the UE changes the UE network capability information or the MS network capability information or both;


	[B1] {2431} h)	when the UE changes the UE specific DRX parameter (in WB-S1 mode or NB-S1 mode);


	[B1] {2432} i)	when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery);


	[B1] {2433} j)	when the UE enters S1 mode after 1xCS fallback or 1xSRVCC;


	[B1] {2434} k)	when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;


	[B1] {2435} l)	when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;


	[B1] {2436} m)	when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;


	[B1] {2437} n)	when the UE changes the radio capability for GERAN, or cdma2000® or both;


	[B1] {2438} o)	when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;


	[B1] {2439} NOTE 1:	For the change of UE's usage setting or the voice domain preference for E-UTRAN which results in disabling UE's E-UTRA capability, the UE can skip sending TRACKING AREA UPDATE REQUEST message and directly perform disabling of UE's E-UTRA capability.


	[B1] {2440} p)	when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates "RAT-related TMSI";


	[B1] {2441} q)	when the UE performs an inter-system change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;


	[B1] {2442} r)	upon reception of a paging indication using S-TMSI and the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE;


	[B1] {2443} s)	when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A;


	[B1] {2444} t)	when the UE needs to request the use of PSM or needs to stop the use of PSM;


	[B1] {2445} u)	when the UE needs to request the use of eDRX or needs to stop the use of eDRX;


	[B1] {2446} v)	when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;


	[B1] {2447} w)	when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;


	[B1] {2448} x)	when the CIoT EPS optimizations the UE needs to use, change in the UE;


	[B1] {2449} y)	when the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];


	[B1] {2450} z)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;


	[B1] {2451} za)	when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;


	[B1] {2452} zb)	when the UE needs to request new ciphering keys for ciphered broadcast assistance data;


	[B1] {2453} zc)	when the UE in EMM-IDLE mode changes the radio capability for NG-RAN;


	[B1] {2454} zd)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;


	[B1] {2455} ze)	in WB-S1 mode, when the applicable UE radio capability ID for the current UE radio configuration changes due to a revocation of the network-assigned UE radio capability IDs by the serving PLMN; or


	[B1] {2456} zf)	when the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance.


[Nm] {2457} For all cases except case b, the UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating". For case b, the UE shall set the EPS update type IE to "periodic updating".


[Nm] {2458} For cases n, za and zc, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2459} If the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2460} For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the tracking area updating procedure.


[Nm] {2461} For case r, the "active" flag in the EPS update type IE shall be set to 1. If a UE is only using EPS services with control plane CIoT EPS optimization, the "signalling active" flag in the Additional update type IE shall be set to 1.


[Nm] {2462} If the UE is using only control plane CIoT EPS optimization, the case i only applies to the case that the UE has indicated to the network that subsequent to the uplink data transmission a downlink data transmission is expected during the transport of uplink user data via the control plane procedure (see subclause 6.6.4).


[Nm] {2463} If the UE has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2464} If the UE does not have any established PDN connection, and the inter-system change from N1 mode to S1 mode is not due to emergency services fallback, the "active" flag in the EPS update type IE shall be set to 0.


[Nm] {2465} When the UE has user data pending and performs an inter-system change from S101 mode to S1 mode to a tracking area included in the TAI list stored in the UE, the UE shall perform a service request procedure instead of a tracking area updating procedure.


[Nm] {2466} When initiating a tracking area updating procedure while in S1 mode, the UE shall use the current EPS NAS integrity key to integrity protect the TRACKING AREA UPDATE REQUEST message, unless the UE is performing inter-system change from N1 mode to S1 mode.


[Nm] {2467} In order to indicate its UE specific DRX parameter for WB-S1 mode while in E-UTRAN coverage, the UE shall send the TRACKING AREA UPDATE REQUEST message containing the UE specific DRX parameter in the DRX parameter IE to the network, with the exception of the case if the UE had indicated its DRX parameter for WB-S1 mode (3GPP TS 24.008 [13]) to the network while in GERAN or UTRAN coverage. In this case, when the UE enters E-UTRAN coverage and initiates a tracking area updating procedure, the UE shall not include the UE specific DRX parameter in the DRX parameter IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2468} In NB-S1 mode, a UE that wishes to use or change a UE specific DRX parameter in NB-S1 mode shall include its requested value in every TRACKING AREA UPDATE REQUEST message except when initiating the periodic tracking area updating procedure.


[Nm] {2469} If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2470} If the UE supports PSM and requests the use of PSM, the UE shall include the T3324 value IE with a requested timer value in the TRACKING AREA UPDATE REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.


[Nm] {2471} If a UE supporting CIoT EPS optimizations in NB-S1 mode initiates the tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE and shall set the EPS update type IE to "TA updating".


[Nm] {2472} If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2473} If the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2474} If the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2475} If the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2476} If the UE has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2477} After sending the TRACKING AREA UPDATE REQUEST message to the MME, the UE shall start timer T3430 and enter state EMM-TRACKING-AREA-UPDATING-INITIATED (see example in figure 5.5.3.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. If timer T3442 is currently running, the UE shall stop timer T3442.


[Nm] {2478} For all cases except cases z and zd:


	[B1] {2479} 1)	if the UE supports neither A/Gb mode nor Iu mode, the UE shall include a valid GUTI in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI"; or


	[B1] {2480} 2)	if the UE supports A/Gb mode or Iu mode or both, the UE shall handle the Old GUTI IE as follows:


		[B2] {2481} -	If the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.


		[B2] {2482} -	If the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "native GUTI".


[Nm] {2483} If a UE has established PDN connection(s) and uplink user data pending to be sent via user plane when it initiates the tracking area updating procedure, or uplink signalling not related to the tracking area updating procedure when the UE does not support control plane CIoT EPS optimization, it may set the "active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to establish the user plane to the network and to keep the NAS signalling connection after the completion of the tracking area updating procedure.


[Nm] {2484} If a UE is using EPS services with control plane CIoT EPS optimization and has user data pending to be sent via control plane over MME but no user data pending to be sent via user plane, or uplink signalling not related to the tracking area updating procedure, the UE may set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to keep the NAS signalling connection after the completion of the tracking area updating procedure.


[Nm] {2485} For all cases except cases z and zd, if the UE has a current EPS security context, the UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. Otherwise, the UE shall set the NAS Key Set Identifier IE to the value "no key is available". If the UE has a current EPS security context, the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context. Otherwise the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message.


[Nm] {2486} When the tracking area updating procedure is initiated in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the TIN is set to "P-TMSI", the UE shall include the GPRS ciphering key sequence number applicable for A/Gb mode or Iu mode and a nonceUE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2487} When the tracking area updating procedure is initiated in EMM-CONNECTED mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode, the UE shall derive the EPS NAS keys from the mapped K'ASME using the selected NAS algorithms, nonceMME and KSISGSN (to be associated with the mapped K'ASME) provided by lower layers as indicated in 3GPP TS 33.401 [19]. The UE shall reset both the uplink and downlink NAS COUNT counters of the mapped EPS security context which shall be taken into use. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE and its associated GUTI, as specified above, either in the Old GUTI IE or in the Additional GUTI IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".


[Nm] {2488} For the case z, if upper layers have indicated that IMS signalling or IMS emergency signalling was already ongoing in N1 mode before performing the inter-system change from N1 mode to S1 mode, or if the inter-system change from N1 mode to S1 mode is due to emergency services fallback, the "active" flag in the EPS update type IE shall be set to 1.


[Nm] {2489} For the case z, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the 5G NAS security context available in the UE. The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [58] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.


[Nm] {2490} For the case zd, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the mapped EPS security context as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [58] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".


[Nm] {2491} When the tracking area updating procedure is initiated in EMM-IDLE mode, the UE may also include an EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message, indicating which EPS bearer contexts are active in the UE. The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:


	[B1] {2492} a)	for the case f;


	[B1] {2493} b)	for the case s; 


	[B1] {2494} c)	for the case z;


	[B1] {2495} d)	if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; and


	[B1] {2496} e)	if the UE:


		[B2] {2497} 1)	locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;


		[B2] {2498} 2)	locally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.4.2.1); or


		[B2] {2499} 3)	locally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.5.0).


[Nm] {2500} If the UE initiates the first tracking area updating procedure following an attach in A/Gb mode or Iu mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2501} If the UE initiates the first tracking area updating procedure following an initial registration in N1 mode and the UE is operating in the single-registration mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2502} For all cases except case b, if the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".


[Nm] {2503} For all cases except case b, if the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit in the UE network capability IE to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2504} For all cases except case b, if the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2505} For all cases except case b, if the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2506} For all cases except case b, if the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2507} If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, or if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the UE shall support the extended protocol configuration options IE.


[Nm] {2508} For all cases except case b, if the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2509} For all cases except case b, if the UE supports V2X communication over E-UTRAN-PC5, then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRAN-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2510} For all cases except case b, if the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2511} For all cases except case b, if the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2512} For all cases except case b, if the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "backoff timer for transport of user data via the control plane supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2513} For all cases except case b, if the UE supports dual connectivity with NR, then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2514} For all cases except case b, if the UE supports SGC, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2515} For all cases except case b, if the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2516} For all cases except cases b and zb, if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2517} For case ee, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2518} For case a, if the UE supports ciphered broadcast assistance data and the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2519} For case b, if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3412, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2520} For all cases except case b, if the UE supports N1 mode, the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2521} For all cases except case b, in WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2522} For cases n, za and zc, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2523} For all cases except cases b, n, za and zc, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {2524} For all cases except case b, if the UE supports WUS assistance, then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE in the TRACKING AREA UPDATE REQUEST message.


[H5] {2525} 5.5.3.2.3	EMM common procedure initiation


[Nm] {2526} If the network receives a TRACKING AREA UPDATE REQUEST message containing the Old GUTI type IE, and the network does not follow the use of the most significant bit of the <MME group id> to distinguish the node type as specified in 3GPP TS 23.003 [2], subclause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the Old GUTI IE is a native GUTI or a mapped GUTI.


[Nm] {2527} During the tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures.


[Nm] {2528} The MME may be configured to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3, during a tracking area updating procedure for a UE that has only a PDN connection for emergency bearer services or for RLOS.


[Nm] {2529} The MME shall not initiate an EMM authentication procedure before completion of the tracking area updating procedure, if the following conditions apply:


	[B1] {2530} a)	the UE initiated the tracking area updating procedure after handover or inter-system handover to S1 mode;


	[B1] {2531} b)	the target cell is a shared network cell; and


		[B2] {2532} -	the UE has provided its GUTI in the Old GUTI IE or the Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the GUTI is different from the selected PLMN identity of the target cell; or


		[B2] {2533} -	the UE has mapped the P-TMSI and RAI into the Old GUTI IE and not included an Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the RAI is different from the selected PLMN identity of the target cell.


[H5] {2534} 5.5.3.2.4	Normal and periodic tracking area updating procedure accepted by the network


[Nm] {2535} If the tracking area update request has been accepted by the network, the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. If the MME assigns a new GUTI for the UE, a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. In this case, the MME shall start timer T3450 and enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1. The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode.


[Nm] {2536} If the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.


[Nm] {2537} In NB-S1 mode, if the tracking area update request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.


[Nm] {2538} If a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.


[Nm] {2539} If the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode. 


[Nm] {2540} In NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the TRACKING AREA UPDATE REQUEST message, the the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.


[Nm] {2541} NOTE 4:	In NB-S1 mode, if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message, then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP TS 36.304 [21]). If the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message, but did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, or if the Negotiated DRX parameter in NB-S1 mode IE was not included in the TRACKING AREA UPDATE ACCEPT message, then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP TS 36.304 [21]). If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.


[Nm] {2542} In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the tracking area update request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS update type IE to "TA updating" in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2543} The MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of eDRX.


[Nm] {2544} If:


	[B1] {2545} -	the UE supports WUS assistance; and


		[B2] {2546} -	the MME supports and accepts the use of WUS assistance,


[Nm] {2547} then the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE in the TRACKING AREA UPDATE ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.


[Nm] {2548} If the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.


[Nm] {2549} If an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.


[Nm] {2550} If the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side.


[Nm] {2551} If the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating", and the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.


[Nm] {2552} The MME shall indicate "combined TA/LA updated" or "combined TA/LA updated and ISR activated" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, if the following conditions apply:


	[B1] {2553} -	the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating" and the UE was previously successfully attached for EPS and non-EPS services; and


	[B1] {2554} -	location area updating for non-EPS services as specified in 3GPP TS 29.118 [16A] is successful.


[Nm] {2555} The MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {2556} The MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of PSM.


[Nm] {2557} If the MME supports and accepts the use of PSM, and the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2558} If the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, then the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.


[Nm] {2559} Also, during the tracking area updating procedure without the "active" flag set, if the MME has deactivated EPS bearer context(s) locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2560} Also, during the tracking area updating procedure with the "active" flag set, if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2561} If the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.


[Nm] {2562} If due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but it has a PDN connection for emergency bearer services established, the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure when the tracking area updating procedure is initiated in EMM-CONNECTED mode. When the tracking area updating procedure is initiated in EMM-IDLE mode, the MME locally deactivates all non-emergency EPS bearer contexts and informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not deactivate the emergency EPS bearer contexts. The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.


[Nm] {2563} If a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, and if:


	[B1] {2564} -	a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or


	[B1] {2565} -	no GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,


[Nm] {2566} then the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. Furthermore, the MME takes one of the following actions:


	[B1] {2567} -	if no active EPS bearer contexts remain for the UE, the MME shall not accept the tracking area update request as specified in subclause 5.5.3.2.5;


	[B1] {2568} -	if active EPS bearer contexts remain for the UE and the TRACKING AREA UPDATE REQUEST message is accepted, the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated.


[Nm] {2569} If a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, the following different cases can be distinguished:


	[B1] {2570} 1)	If the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:


		[B2] {2571} -	a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or


		[B2] {2572} -	no SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,


	[B1] {2573} 2)	If the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:


		[B2] {2574} -	a LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or


		[B2] {2575} -	no LHN-ID value is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,


[Nm] {2576} then the MME takes one of the following actions:


	[B1] {2577} -	if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type "re-attach required" (see subclause 5.5.2.3.1);


	[B1] {2578} -	if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, then the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of the SIPTO at the local network PDN connection (see subclause 6.4.4.2); and


	[B1] {2579} -	if a PDN connection remains that is not SIPTO at the local network PDN connection, the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2);


[Nm] {2580} For a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP TS 23.401 [10], subclause 4.3.5.6.


[Nm] {2581} For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).


[Nm] {2582} If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication.


[Nm] {2583} If the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure.


[Nm] {2584} If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling. If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling.


[Nm] {2585} If the MME supports NB-S1 mode, Non-IP or Ethernet PDN type, inter-system change with 5GS, or the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the MME shall support the extended protocol configuration options IE.


[Nm] {2586} If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2587} If the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2588} The MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.


[Nm] {2589} If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2590} If the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2591} If the UE indicates support for N1 mode in the TRACKING AREA UPDATE REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:


	[B1] {2592} -	"interworking without N26 interface not supported" if the MME supports N26 interface; or


	[B1] {2593} -	"interworking without N26 interface supported" if the MME does not support N26 interface


[Nm] {2594} in the EPS network feature support IE in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2595} If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2596} If the UE has indicated support for service gap control, a service gap time value is available in the EMM context, the MME may include the T3447 value IE set to the service gap time value in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2597} If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the TRACKING AREA UPDATE REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2598} If the UE requests ciphering keys for ciphered broadcast assistance data in the TRACKING AREA UPDATE REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2599} Upon receiving a TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3430, reset the service request attempt counter, tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED. If the message contains a GUTI, the UE shall use this GUTI as new temporary identity for EPS services and shall store the new GUTI. If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, the old GUTI shall be used. If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.


[Nm] {2600} If the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.


[Nm] {2601} If the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, then the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, but not T3412 extended value IE, then the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). If neither T3412 value IE nor T3412 extended value IE is included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message.


[Nm] {2602} If the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, then the UE shall use the timer value for T3324 as specified in 3GPP TS 24.008 [13], subclause 4.7.2.8.


[Nm] {2603} If the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the nonceUE was included in the TRACKING AREA UPDATE REQUEST message, the UE shall delete the nonceUE upon receipt of the TRACKING AREA UPDATE ACCEPT message.


[Nm] {2604} If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.


[Nm] {2605} If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE.


[Nm] {2606} The MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no PDN connection for emergency bearer services or PDN connection for RLOS established, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". If the UE is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of "forbidden PLMNs for GPRS service" when the PDN connection for emergency bearer services is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. If the TRACKING AREA UPDATE ACCEPT message does not contain a list, then the UE shall delete the stored list.


[Nm] {2607} If the UE is neither attached for emergency bearer services nor attached for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).


[Nm] {2608} The network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. If the UE is attached for emergency bearer services, the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. If the TRACKING AREA UPDATE ACCEPT message contains:


	[B1] {2609} i)	no indication that ISR is activated, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;


	[B1] {2610} ii)	an indication that ISR is activated, then:


		[B2] {2611} -	if the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.5, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;


		[B2] {2612} -	if the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;


		[B2] {2613} -	if the UE had initiated the tracking area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running; or


		[B2] {2614} -	the UE shall regard a previously assigned P-TMSI and RAI as valid and registered with the network. If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 is running or is deactivated, the UE shall set the TIN to "RAT-related TMSI". If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 has already expired, the UE shall set the TIN to "GUTI".


[Nm] {2615} The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], subclause 7.2a and subclause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, then the UE shall not locally release any persistent EPS bearer context. When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, then the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].


[Nm] {2616} If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.


[Nm] {2617} The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:


	[B1] {2618} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;


	[B1] {2619} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or


	[B1] {2620} -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.


[Nm] {2621} The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].


[Nm] {2622} If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when:


	[B1] {2623} -	the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;


	[B1] {2624} -	the UE is switched on; or


	[B1] {2625} -	the UICC containing the USIM is removed.


[Nm] {2626} If the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, and the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.


[Nm] {2627} If the TRACKING AREA UPDATE ACCEPT message contained a GUTI, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI.


[Nm] {2628} If the UE which was previously successfully attached for EPS and non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating "combined TA/LA updated" or "combined TA/LA updated and ISR activated" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating", the UE shall behave as follows:


	[B1] {2629} -	If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.


	[B1] {2630} -	If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. 


	[B1] {2631} -	If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.


[Nm] {2632} If the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation for which the MME indicated that the header compression configuration is not used.


[Nm] {2633} If the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3448 if it is running, and start timer T3448 with the value provided in the T3448 value IE.


[Nm] {2634} If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.


	[B1] {2635} If the UE in EMM-IDLE mode initiated the tracking area updating procedure and the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.


[Nm] {2636} If the UE has indicated "service gap control supported" in the TRACKING AREA UPDATE REQUEST message and:


	[B1] {2637} -	the TRACKING AREA UPDATE ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the the new T3447 value with the T3447 timer next time it is started; or


	[B1] {2638} -	the TRACKING AREA UPDATE ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.


[Nm] {2639} Upon receiving a TRACKING AREA UPDATE COMPLETE message, the MME shall stop timer T3450 and change to state EMM-REGISTERED. The GUTI, if sent in the TRACKING AREA UPDATE ACCEPT message, shall be considered as valid.


[Nm] {2640} For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take one of the following actions:


	[B1] {2641} -	if the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context and integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context;


	[B1] {2642} -	if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, and if the UE has included a valid GPRS ciphering key sequence number, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2); or


	[B1] {2643} -	if the UE has not included an Additional GUTI IE, the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, i.e. as if it cannot retrieve the current EPS security context.


[Nm] {2644} For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2).


[Nm] {2645} For inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a 5G NAS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take actions as specified in subclause 4.4.2.3.


[Nm] {2646} For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:


	[B1] {2647} -	if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or


	[B1] {2648} -	if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.


[Nm] {2649} For inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:


	[B1] {2650} -	if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or


	[B1] {2651} -	if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.


[Nm] {2652} In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the TRACKING AREA UPDATE ACCEPT message. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1.


[Nm] {2653} In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and the TRACKING AREA UPDATE ACCEPT message includes:


	[B1] {2654} -	a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall:


		[B2] {2655} a)	delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE;


		[B2] {2656} b)	send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID deletion indication IE; and


		[B2] {2657} c)	after the completion of the ongoing tracking area updating procedure, initiate a tracking area updating procedure as specified in subclause 5.5.3 over the existing NAS signalling connection; and


	[B1] {2658} -	a UE radio capability ID IE, the UE shall:


		[B2] {2659} a)	store the UE radio capability ID as specified in annex C; and


		[B2] {2660} b)	send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID IE.


[H5] {2661} 5.5.3.2.4A	Tracking area updating successful for EPS services and not accepted for SMS services


[Nm] {2662} Apart from the actions on the tracking area updating attempt counter, the description for tracking area update for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for tracking area updating for SMS services applies.


[Nm] {2663} In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the tracking area update request for EPS services only and:


	[B1] {2664} -	the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or


	[B1] {2665} -	the MME decides to not accept the tracking area update request for "SMS only",


[Nm] {2666} the MME shall set the EPS update result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the TRACKING AREA UPDATE ACCEPT message and shall include an appropriate SMS services status value.


[Nm] {2667} The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:


	[B1] {2668} "SMS services not available"


		[B2] {2669} 	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.


	[B1] {2670} "SMS services not available in this PLMN"


		[B2] {2671} 	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.


		[B2] {2672} 	The UE may provide a notification to the user or the upper layers that the SMS services are not available.


		[B2] {2673} 	The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2674} "Network failure"


		[B2] {2675} 	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.


		[B2] {2676} 	If the tracking area updating attempt counter is less than 5:


			[B3] {2677} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


		[B2] {2678} 	If the tracking area updating attempt counter is equal to 5:


			[B3] {2679} -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


	[B1] {2680} "Congestion"


		[B2] {2681} 	The UE shall stop the timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.


[Nm] {2682} Other values and the case that no SMS services status IE was received are considered as abnormal cases. The tracking area updating procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.2.6A.


[H5] {2683} 5.5.3.2.5	Normal and periodic tracking area updating procedure not accepted by the network


[Nm] {2684} If the tracking area updating cannot be accepted by the network, the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.


[Nm] {2685} If a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in subclause 5.5.3.2.4, the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached".


[Nm] {2686} If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {2687} In NB-S1 mode, if the tracking area update request is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {2688} If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.


[Nm] {2689} If the tracking area update request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported". 


[Nm] {2690} Based on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required". 


[Nm] {2691} If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".


[Nm] {2692} Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430 and stop any transmission of user data.


[Nm] {2693} If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.


[Nm] {2694} The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.


	[B1] {2695} #3	(Illegal UE);


	[B1] {2696} #6	(Illegal ME); or


	[B1] {2697} #8	(EPS services and non-EPS services not allowed);


	[B1] {2698} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2699} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2700} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2701} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2702} #7	(EPS services not allowed);


	[B1] {2703} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {2704} 	If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and shall proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect EUTRAN radio access technology until switching off or the UICC containing the USIM is removed.


	[B1] {2705} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2706} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2707} #9	(UE identity cannot be derived by the network);


	[B1] {2708} 	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.


	[B1] {2709} 	If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.


	[B1] {2710} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2711} 	If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2712} #10	(Implicitly detached);


	[B1] {2713} 	If the EPS update type is "periodic updating", a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.


	[B1] {2714} 	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.


	[B1] {2715} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2716} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2717} #11	(PLMN not allowed); or


	[B1] {2718} #35	(Requested service option not authorized in this PLMN);


	[B1] {2719} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2720} 	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2721} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2722} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.


	[B1] {2723} 	For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2724} 	For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2725} #12	(Tracking area not allowed);


	[B1] {2726} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {2727} 	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.


	[B1] {2728} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2729} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2730} #13	(Roaming not allowed in this tracking area);


	[B1] {2731} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.


	[B1] {2732} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.


	[B1] {2733} 	If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] subclause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2734} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2735} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2736} #14	(EPS services not allowed in this PLMN);


	[B1] {2737} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {2738} 	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {2739} 	If the EPS update type is "TA updating", or the EPS update type is "periodic updating" and the UE is in PS mode 1 or PS mode 2 of operation, the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. In this case, the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure.


	[B1] {2740} 	If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services and shall proceed as follows:


		[B2] {2741} -	a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED;


		[B2] {2742} -	a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5);


		[B2] {2743} -	a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6];


		[B2] {2744} -	a UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2745} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2746} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2747} #15	(No suitable cells in tracking area);


	[B1] {2748} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {2749} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:


		[B2] {2750} -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;


		[B2] {2751} -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;


		[B2] {2752} -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {2753} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2754} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2755} #22	(Congestion);


	[B1] {2756} 	If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.2.6.


	[B1] {2757} 	The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {2758} 	The UE shall stop timer T3346 if it is running.


	[B1] {2759} 	If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.


	[B1] {2760} 	If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].


	[B1] {2761} 	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.


	[B1] {2762} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2763} 	If the tracking area updating procedure was initiated for and MO MMTEL voice call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.


	[B1] {2764} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {2765} #25	(Not authorized for this CSG);


	[B1] {2766} 	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.2.6.


	[B1] {2767} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {2768} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {2769} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {2770} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {2771} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {2772} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


	[B1] {2773} #40	(No EPS bearer context activated);


	[B1] {2774} 	The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall perform a new attach procedure.


	[B1] {2775} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".


	[B1] {2776} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.


	[B1] {2777} #42	(Severe network failure);


	[B1] {2778} 	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area update counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {2779} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.


	[B1] {2780} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {2781} #31	(Redirection to 5GCN required);


	[B1] {2782} 	EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.2.6. 


	[B1] {2783} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {2784} 	The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see subclause 4.5).


	[B1] {2785} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


[Nm] {2786} Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.5.3.2.6.


[H5] {2787} 5.5.3.2.5A	Tracking area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network


[Nm] {2788} If the tracking area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.5.3.2.5. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall: 


	[B1] {2789} a)	inform the upper layers of the failure of the procedure; or


	[B1] {2790} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


[Nm] {2791} If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.5.3.2.6, the UE shall perform the actions as described in subclause 5.5.3.2.6 and inform the upper layers of the failure to access the network.


[Nm] {2792} If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.3.2.6, the UE shall perform the procedures as described in subclause 5.5.3.2.6. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall: 


	[B1] {2793} a)	inform the upper layers of the failure of the procedure; or


	[B1] {2794} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


[H5] {2795} 5.5.3.2.5B	Tracking area updating for access to RLOS not accepted by the network


[Nm] {2796} If the tracking area updating request for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.5.3.2.5 along with the following conditions:


	[B1] {2797} a)	if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to perform a tracking area updating procedure or an attach procedure for access to RLOS in the new tracking area, if found, depending on the EMM state. 


	[B1] {2798} b)	if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRAN capability, the UE shall skip the action for as long as access to RLOS is still needed.


[Nm] {2799} Then if 


	[B1] {2800} a)	the UE is in the same selected PLMN where the last tracking area updating procedure was attempted and rejected;


	[B1] {2801} b)	the tracking area updating procedure was rejected with an EMM cause value other than #9, #10 and #40; and


	[B1] {2802} c)	timer T3346 is not running,


[Nm] {2803} the UE shall:


	[B1] {2804} a)	detach locally, if not detached already, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[Nm] {2805} If the tracking area updating request for access to RLOS fails due to abnormal case a) in subclause 5.5.3.2.6, the UE shall perform the actions as described in subclause 5.5.3.2.6 and inform the upper layers of the failure to access the network.


[Nm] {2806} If the tracking area updating request for access to RLOS fails due to abnormal cases b), c) or d) in subclause 5.5.3.2.6, the UE shall perform the procedures as described in subclause 5.5.3.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling of the E-UTRA capability, for as long as access to RLOS is still needed. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall: 


	[B1] {2807} a)	detach locally, if not detached already, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[H5] {2808} 5.5.3.2.6	Abnormal cases in the UE


[Nm] {2809} The following abnormal cases can be identified:


	[B1] {2810} a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers


	[B1] {2811} 	In WB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.


	[B1] {2812} 	In NB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access barring is not applicable.


	[B1] {2813} 	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started as soon as possible and if still necessary, e.g. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.


	[B1] {2814} 	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the tracking area updating procedure is started again after an implementation dependent time.


	[B1] {2815} 	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the tracking area updating procedure shall be started.


	[B1] {2816} 	The the tracking area updating procedure shall be started according to subclause 5.5.3.2.2, if access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 [22]) and if:


		[B2] {2817} -	one of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied;


		[B2] {2818} -	the upper layers request to send a mobile originated SMS over NAS or SMS over S102; or


		[B2] {2819} -	the upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.


	[B1] {2820} 	The call type used shall be per annex D of this document, if access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 [22]) and if:


		[B2] {2821} -	one of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied;


		[B2] {2822} -	the upper layers request to send a mobile originated SMS over NAS or SMS over S102; or


		[B2] {2823} -	the upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.


	[B1] {2824} 	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2.


	[B1] {2825} 	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2.


	[B1] {2826} 	If the trigger for the tracking area updating procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The tracking area updating procedure may be started if it is still necessary when access for "terminating calls" is granted or because of a cell change.


	[B1] {2827} b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message is received


	[B1] {2828} 	The tracking area updating procedure shall be aborted, and the UE shall proceed as described below.


	[B1] {2829} c)	T3430 timeout


	[B1] {2830} 	The UE shall abort the procedure and proceed as described below. The NAS signalling connection, if any, shall be released locally.


	[B1] {2831} d)	TRACKING AREA UPDATE REJECT, other causes than those treated in subclause 5.5.3.2.5, and cases of EMM cause values #22, #25 and #31, if considered as abnormal cases according to subclause 5.5.3.2.5


	[B1] {2832} 	If the tracking area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the tracking area updating attempt counter to 5.


	[B1] {2833} 	The UE shall proceed as described below.


	[B1] {2834} e)	Change of cell into a new tracking area


	[B1] {2835} 	If a cell change into a new tracking area occurs before the tracking area updating procedure is completed, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.


	[B1] {2836} 	The UE shall proceed as described below.


	[B1] {2837} f)	Tracking area updating and detach procedure collision


	[B1] {2838} 	EPS detach containing detach type "re-attach required" or "re-attach not required":


		[B2] {2839} 	If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the tracking area updating procedure shall be aborted and the detach procedure shall be progressed. If the DETACH REQUEST message contains detach type "re-attach not required" and EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".


	[B1] {2840} 	EPS detach containing detach type "IMSI detach":


		[B2] {2841} 	If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the DETACH REQUEST message shall be ignored and tracking area updating procedure shall be progressed.


	[B1] {2842} 	The UE shall proceed as described below.


	[B1] {2843} g)	Tracking area updating and GUTI reallocation procedure collision


	[B1] {2844} 	If the UE receives a GUTI REALLOCATION COMMAND message before the tracking area updating procedure has been completed, this message shall be ignored and the tracking area updating procedure shall be progressed.


	[B1] {2845} h)	Transmission failure of TRACKING AREA UPDATE REQUEST message indication from lower layers


	[B1] {2846} 	The tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.


	[B1] {2847} i)	Transmission failure of TRACKING AREA UPDATE COMPLETE message indication with TAI change from lower layers


	[B1] {2848} 	If the current TAI is not in the TAI list, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.


	[B1] {2849} 	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure.


	[B1] {2850} j)	Transmission failure of TRACKING AREA UPDATE COMPLETE message indication without TAI change from lower layers


	[B1] {2851} 	It is up to the UE implementation how to re-run the ongoing procedure.


	[B1] {2852} k)	"Extended wait time" from the lower layers


	[B1] {2853} 	If the TRACKING AREA UPDATE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.


	[B1] {2854} 	If the TRACKING AREA UPDATE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.


	[B1] {2855} 	In other cases the UE shall ignore the "Extended wait time".


	[B1] {2856} 	The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.


	[B1] {2857} 	If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.


	[B1] {2858} 	The UE shall proceed as described below.


	[B1] {2859} ka)	"Extended wait time CP data" from the lower layers


	[B1] {2860} 	If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the tracking area updating attempt counter.


	[B1] {2861} 	In other cases the UE shall ignore the "Extended wait time CP data".


	[B1] {2862} 	The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.


	[B1] {2863} 	If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.


	[B1] {2864} 	The UE shall proceed as described below.


	[B1] {2865} l)	Timer T3346 is running


	[B1] {2866} 	The UE shall not start the tracking area updating procedure unless:


		[B2] {2867} -	the UE is in EMM-CONNECTED mode;


		[B2] {2868} -	the UE received a paging;


		[B2] {2869} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {2870} -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;


		[B2] {2871} -	the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;


		[B2] {2872} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and


			[B3] {2873} i)	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and


			[B3] {2874} ii)	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data"; or


		[B2] {2875} -	the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication, the timer T3402 and the timer T3411 are not running and the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".


	[B1] {2876} 	The UE stays in the current serving cell and applies the normal cell reselection process.


	[B1] {2877} 	If the TAI of the current serving cell is not included in the TAI list or the TIN indicates "P-TMSI", the UE shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {2878} 	If the tracking area updating procedure needs to be initiated for an MO MMTEL voice call is started, then a notification that the procedure was not initiated due to network congestion shall be provided to upper layers.


	[B1] {2879} 	The UE shall proceed as described below.


	[B1] {2880} la)	Timer T3448 is running


	[B1] {2881} 	The UE shall not start the tracking area updating procedure with the "signalling active" flag set, unless:


		[B2] {2882} -	the UE is a UE configured to use AC11 – 15 in selected PLMN; 


		[B2] {2883} -	the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or


		[B2] {2884} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).


	[B1] {2885} 	The UE stays in the current serving cell and applies the normal cell reselection process.


	[B1] {2886} 	The UE shall proceed as described below.


	[B1] {2887} m)	Mobile originated detach required


	[B1] {2888} 	Detach due to removal of USIM or due to switch off:


		[B2] {2889} 	The tracking area updating procedure shall be aborted, and the UE initiated detach procedure shall be performed.


	[B1] {2890} 	Detach not due to removal of USIM and not due to switch off:


		[B2] {2891} 	The UE initiated detach procedure shall be initiated after successful completion of the tracking area updating procedure.


	[B1] {2892} o)	Timer T3447 is running


	[B1] {2893} 	The UE shall not start the tracking area updating procedure with the "signalling active" flag set or the "active" flag set, unless:


		[B2] {2894} -	the UE received a paging;


		[B2] {2895} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {2896} -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;


	[B1] {2897} 	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area update request procedure is started, if still necessary, when timer T3447 expires.


	[B1] {2898} p)	Tracking area updating and paging procedure collision


	[B1] {2899} 	If the UE receives a CS SERVICE NOTIFICATION message before the tracking area updating procedure has been completed, the UE shall progress the tracking area updating procedure and respond to the CS SERVICE NOTIFICATION upon successful completion of the tracking area updating procedure.


[Nm] {2900} For the cases b, c, d, e, f with detach type "re-attach required" or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS", k and ka, the UE shall stop any ongoing transmission of user data.


[Nm] {2901} For the cases b, c, d, k, ka, l and la, the UE shall proceed as follows:


	[B1] {2902} 	Timer T3430 shall be stopped if still running.


	[B1] {2903} 	For the cases b, c, d, la k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the tracking area updating attempt counter shall be incremented, unless it was already set to 5.


	[B1] {2904} 	If the tracking area updating attempt counter is less than 5, the TAI of the current serving cell is included in the TAI list, the EPS update status is equal to EU1 UPDATED, the TIN does not indicate "P-TMSI" and the tracking area updating procedure is performed not due to an inter-system change from N1 mode to S1 mode and the tracking area updating procedure is not performed due to cases g, m, n, za, zc in subclause 5.5.3.2.2:


		[B2] {2905} 	the UE shall keep the EPS update status to EU1 UPDATED and enter state EMM-REGISTERED.NORMAL-SERVICE. The UE shall start timer T3411.


		[B2] {2906} 	If in addition the TRACKING AREA UPDATE REQUEST indicated "periodic updating" or if tracking area updating procedure was initiated to recover NAS signalling connection due to "RRC Connection failure" from the lower layers, none of the other reasons for initiating the tracking area updating procedure listed in subclause 5.5.3.2.2 was applicable, and the TRACKING AREA UPDATE REQUEST message did not include T3324 value IE, T3412 extended value IE or Extended DRX parameters IE, the timer T3411 may be stopped when the UE enters EMM-CONNECTED mode.


		[B2] {2907} 	If timer T3411 expires the tracking area updating procedure is triggered again.


	[B1] {2908} 	If the tracking area updating attempt counter is less than 5, and the TAI of the current serving cell is not included in the TAI list or the EPS update status is different to EU1 UPDATED or the TIN indicates "P-TMSI" or the tracking area updating procedure is performed due to an inter-system change from N1 mode to S1 mode or if the tracking area updating procedure is performed due to cases g, m, n, za, zc in subclause 5.5.3.2.2:


		[B2] {2909} -	for the cases k and l, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.


		[B2] {2910} -	for the case ka, if timer T3346 is started, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.


		[B2] {2911} -	for the case ka, if timer T3448 is started and the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.


		[B2] {2912} -	for the case la, if the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.


		[B2] {2913} -	for the cases b, c, d, k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the UE shall start timer T3411, shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. When timer T3411 expires the tracking area updating procedure is triggered again.


		[B2] {2914} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is less than 5 and the GPRS update status is different from GU1 UPDATED.


		[B2] {2915} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 [54] for the abnormal cases when a registration procedure for mobility and periodic registration fails and the registration attempt counter is less than 5 and the 5GS update status is different from 5U1 UPDATED.


	[B1] {2916} 	If the tracking area updating attempt counter is equal to 5:


		[B2] {2917} -	the UE shall start timer T3402, shall set the EPS update status to EU2 NOT UPDATED;


		[B2] {2918} -	the UE shall delete the list of equivalent PLMNs and shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally to EMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and


		[B2] {2919} -	if A/Gb mode, Iu mode or N1 mode is supported by the UE:


			[B3] {2920} -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is equal to 5;


			[B3] {2921} -	if the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 [54] for the abnormal case when a registration procedure for mobility or periodic registration update performed over 3GPP access fails and the registration attempt counter is equal to 5; and


			[B3] {2922} -	if the UE does not change to state EMM-REGISTERED.PLMN-SEARCH, the UE shall attempt to select GERAN. UTRAN or NG-RAN radio access technology.


			[B3] {2923} 	If a GERAN or UTRAN cell is selected:


				[B4] {2924} -	a UE in PS mode 1 or PS mode 2 of operation shall proceed with appropriate GMM specific procedures; 


				[B4] {2925} -	a UE in CS/PS mode 1 or CS/PS mode 2 of operation shall proceed with appropriate MM or GMM specific procedures.


			[B3] {2926} 	If an NG-RAN cell is selected, the UE shall proceed with appropriate 5GMM specific procedures.


			[B3] {2927} 	Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.


[H5] {2928} 5.5.3.2.6A	Abnormal cases in the UE, SMS services not accepted


[Nm] {2929} The UE shall proceed as follows:


		[B2] {2930} 1)	if the tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.3.2.4A or the SMS services status IE is not included in the message, the UE shall proceed as follows:


		[B2] {2931} a)	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;


		[B2] {2932} b)	If the tracking area updating attempt counter is less than 5:


			[B3] {2933} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;


		[B2] {2934} c)	If the tracking area updating attempt counter is equal to 5:


			[B3] {2935} -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and


	[B1] {2936} 2)	otherwise, the abnormal cases specified in subclause 5.5.3.2.6 apply.


[H5] {2937} 5.5.3.2.7	Abnormal cases on the network side


[Nm] {2938} The following abnormal cases can be identified:


	[B1] {2939} a)	If a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE and a GUTI has been assigned, the network shall abort the procedure, enter EMM-IDLE mode and shall consider both, the old and new GUTI as valid until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). During this period the network may use the identification procedure followed by a GUTI reallocation procedure if the old GUTI is used by the UE in a subsequent message.


	[B1] {2940} 	The network may page with IMSI if paging with old and new S-TMSI fails. Paging with IMSI causes the UE to re-attach as described in subclause 5.6.2.2.2.


	[B1] {2941} b)	Protocol error


	[B1] {2942} 	If the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values:


	[B1] {2943} 	#96:	invalid mandatory information element error;


	[B1] {2944} 	#99:	information element non-existent or not implemented;


	[B1] {2945} 	#100:	conditional IE error; or


	[B1] {2946} 	#111:	protocol error, unspecified.


	[B1] {2947} c)	T3450 time-out


	[B1] {2948} 	On the first expiry of the timer, the network shall retransmit the TRACKING AREA UPDATE ACCEPT message and shall reset and restart timer T3450. The retransmission is performed four times, i.e. on the fifth expiry of timer T3450, the tracking area updating procedure is aborted. Both, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). During this period the network acts as described for case a above.


	[B1] {2949} d)	TRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent and before the TRACKING AREA UPDATE COMPLETE message is received


		[B2] {2950} -	If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted if the TRACKING AREA UPDATE COMPLETE message has not been received and the new tracking area updating procedure shall be progressed; or


		[B2] {2951} -	If the information elements do not differ, then the TRACKING AREA UPDATE ACCEPT message shall be resent and the timer T3450 shall be restarted if an TRACKING AREA UPDATE COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.


	[B1] {2952} e)	More than one TRACKING AREA UPDATE REQUEST received and no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent


		[B2] {2953} -	If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted and the new tracking area updating procedure shall be progressed;


		[B2] {2954} -	If the information elements do not differ, then the network shall continue with the previous tracking area updating procedure and shall not treat any further this TRACKING AREA UPDATE REQUEST message.


	[B1] {2955} f)	Lower layers indication of non-delivered NAS PDU due to handover


		[B2] {2956} 	If the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to an intra MME handover and the TAI of the target cell and the TAI of the source cell are the same, then upon successful completion of the intra MME handover the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message.


	[B1] {2957} g)	DETACH REQUEST message received before the TRACKING AREA UPDATE ACCEPT message is sent or before the TRACKING AREA UPDATE COMPLETE message (in case of GUTI and/or TMSI was allocated) is received.


	[B1] {2958} 	Detach containing cause "switch off":


		[B2] {2959} 	The network shall abort the signalling for the tracking area updating procedure towards the UE and shall progress the detach procedure as described in subclause 5.5.2.2.


	[B1] {2960} 	Detach containing other causes than "switch off":


		[B2] {2961} 	The network shall proceed with the tracking area updating procedure and shall progress the detach procedure after successful completion of the tracking area updating procedure.


	[B1] {2962} h)	If the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating" is received by the new MME which does not have the EMM context data related to the subscription, the new MME may send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached"


[H4] {2963} 5.5.3.3	Combined tracking area updating procedure


[H5] {2964} 5.5.3.3.1	General


[Nm] {2965} Within a combined tracking area updating procedure the messages TRACKING AREA UPDATE ACCEPT and TRACKING AREA UPDATE COMPLETE carry information for the tracking area updating and the location area updating.


[Nm] {2966} The combined tracking area updating procedure follows the normal tracking area updating procedure described in subclause 5.5.3.2 with exception of subclause 5.5.3.2.4A and subclause 5.5.3.2.6A.


[H5] {2967} 5.5.3.3.2	Combined tracking area updating procedure initiation


[Nm] {2968} The UE operating in CS/PS mode 1 or CS/PS mode 2, in state EMM-REGISTERED, shall initiate the combined tracking area updating procedure:


	[B1] {2969} a)	when the UE that is attached for both EPS and non-EPS services detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;


	[B1] {2970} b)	when the UE that is attached for EPS services wants to perform an attach for non-EPS services. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";


	[B1] {2971} c)	when the UE performs an intersystem change from A/Gb mode to S1 mode and the EPS services were previously suspended in A/Gb mode;


	[B1] {2972} d)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE previously either performed a combined GPRS attach procedure, an IMSI attach procedure, a location area updating procedure or a combined routing area updating procedure, in A/Gb or Iu mode, or moved to A/Gb or Iu mode from S1 mode through an SRVCC handover or moved to Iu mode from S1 mode through an vSRVCC handover. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";


	[B1] {2973} e)	when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates "P-TMSI";


	[B1] {2974} f)	when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";


	[B1] {2975} g)	when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it was not able or not allowed to establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message is pending to be sent by the UE;


	[B1] {2976} h)	when the UE changes the UE network capability information or the MS network capability information or both;


	[B1] {2977} i)	when the UE changes the UE specific DRX parameter;


	[B1] {2978} j)	when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery);


	[B1] {2979} k)	when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;


	[B1] {2980} l)	when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;


	[B1] {2981} m)	when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN, and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;


	[B1] {2982} n)	when the UE changes the radio capability for GERAN or cdma2000® or both;


	[B1] {2983} o)	when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;


	[B1] {2984} p)	when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates "RAT-related TMSI";


	[B1] {2985} q)	when the UE performs an intersystem change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;


	[B1] {2986} r)	upon reception of a paging indication, if the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE and the paging indication uses S-TMSI or it uses IMSI with domain indicator set to ″CS″;


	[B1] {2987} s)	when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A;


	[B1] {2988} t)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE has previously performed the MM connection establishment for CS fallback emergency calls (see 3GPP TS 24.008 [13], subclause 4.5.1.5a) without performing a location area updating procedure or combined routing area updating procedure while camping on a location area which is different from the stored location area. In this case, the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";


	[B1] {2989} u)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the MM update status is U2 NOT UPDATED. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";


	[B1] {2990} v)	when the UE needs to request the use of PSM or needs to stop the use of PSM;


	[B1] {2991} w)	when the UE needs to request the use of eDRX or needs to stop the use of eDRX;


	[B1] {2992} x)	when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;


	[B1] {2993} y)	when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;


	[B1] {2994} z)	when the CIoT EPS optimizations the UE needs to use, change in the UE;


	[B1] {2995} za)	when the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];


	[B1] {2996} zb)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;


	[B1] {2997} zc)	when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;


	[B1] {2998} zd)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;


	[B1] {2999} ze)	when the UE in EMM-IDLE mode changes the radio capability for NG-RAN;


	[B1] {3000} zf)	in WB-S1 mode, when the applicable UE radio capability ID for the current UE radio configuration changes due to a reselection to a new PLMN or a revocation of the network-assigned UE radio capability IDs by the serving PLMN; or


	[B1] {3001} zg)	when the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance.


[Nm] {3002} For case c, if the TIN indicates "RAT-related TMSI" and the EPS services were not resumed before returning to S1 mode, the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.


[Nm] {3003} For cases n, zc, ze and zf, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {3004} If the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the combined tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {3005} For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.


[Nm] {3006} For case r, the "active" flag in the EPS update type IE shall be set to 1. If the paging is received for CS fallback, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.


[Nm] {3007} To initiate a combined tracking area updating procedure the UE sends the message TRACKING AREA UPDATE REQUEST to the network, starts timer T3430 and changes to state EMM-TRACKING-AREA-UPDATING-INITIATED. The value of the EPS update type IE in the message shall indicate "combined TA/LA updating" unless explicitly specified otherwise.


[Nm] {3008} If the UE initiates the combined tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the additional update type IE.


[Nm] {3009} The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {3010} If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the TRACKING AREA UPDATE REQUEST message.


[Nm] {3011} The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:


	[B1] {3012} a)	for the case g;


	[B1] {3013} b)	for the case s; 


	[B1] {3014} c)	for the case zb;


	[B1] {3015} d)	if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; and


	[B1] {3016} e)	if the UE:


		[B2] {3017} 1)	locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;


		[B2] {3018} 2)	locally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.4.2.1); or


		[B2] {3019} 3)	locally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see subclause 6.5.0).


[Nm] {3020} In WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {3021} For cases n, zc and ze, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.


[Nm] {3022} For all cases except cases n, zc and ze, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.


[H5] {3023} 5.5.3.3.3	EMM common procedure initiation


[Nm] {3024} During the combined tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3.


[H5] {3025} 5.5.3.3.4	Combined tracking area updating procedure accepted by the network


[H6] {3026} 5.5.3.3.4.1	General


[Nm] {3027} Depending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, the following different cases can be distinguished:


	[B1] {3028} 1)	The EPS update result IE value indicates "combined TA/LA updated": Tracking and location area updating is successful for EPS and non-EPS services, or for EPS services and "SMS only";


	[B1] {3029} 2)	The EPS update result IE value indicates "TA updated": Tracking area updating is successful, but location area updating for non-EPS services or "SMS only" is not successful.


[Nm] {3030} A TRACKING AREA UPDATE COMPLETE message shall be returned to the network if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a TMSI or both.


[H6] {3031} 5.5.3.3.4.2	Combined tracking area updating successful


[Nm] {3032} The description for normal tracking area update as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.


[Nm] {3033} The TMSI reallocation may be part of the combined tracking area updating procedure. The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). In this case the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3450 as described in subclause 5.4.1. The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. If the MME does not indicate "SMS only" in the TRACKING AREA UPDATE ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area. 


[Nm] {3034} For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].


[Nm] {3035} The UE, receiving a TRACKING AREA UPDATE ACCEPT message, stores the received location area identification, resets the location update attempt counter, sets the update status to U1 UPDATED and enters MM state MM IDLE.


[Nm] {3036} If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), then the UE shall reset this counter.


[Nm] {3037} If the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.


[Nm] {3038} If the PLMN identity for the CS domain which is provided as part of the LAI contained in the TRACKING AREA UPDATE ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message.


[Nm] {3039} If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined tracking area updating for EPS and non-EPS services, but the network decides to accept the tracking area update request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall, in the TRACKING AREA UPDATE ACCEPT message, provide a non-broadcast LAI and may indicate in the EPS update result IE that ISR is activated. If a TMSI has to be allocated, then the network shall also provide a TMSI which cannot cause any ambiguity with assigned TMSI values.


[Nm] {3040} If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.


[Nm] {3041} As an implementation option, if the TRACKING AREA UPDATE ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signaling low priority then the UE may stop timer T3246 if running.


[Nm] {3042} If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.


[Nm] {3043} How to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message.


	[B1] {3044} -	If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.


	[B1] {3045} -	If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI. 


	[B1] {3046} -	If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.


[Nm] {3047} If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).


[Nm] {3048} The network receiving a TRACKING AREA UPDATE COMPLETE message stops timer T3450, changes to state EMM-REGISTERED.


[Nm] {3049} Unless the MME supporting N26 is in a deployment where it, after intersystem change from N1 mode to S1 mode, has an IMEI or an IMEISV for the UE, then after the UE performs intersystem change from N1 mode to S1 mode, if:


	[B1] {3050} -	the network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 [8]);


	[B1] {3051} -	the UE has an emergency PDN connection;


	[B1] {3052} -	the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and


	[B1] {3053} -	the MME has neither an IMEI nor an IMEISV for the UE;


[Nm] {3054} then the MME shall initiate the identification procedure (see subclause 5.4.4) or the security mode control procedure (see subclause 5.4.3) with the UE.


[H6] {3055} 5.5.3.3.4.3	Combined tracking area updating successful for EPS services only


[Nm] {3056} Apart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.


[Nm] {3057} If, due to emergency services fallback (see 3GPP TS 23.502 [59], subclause 4.13.4), there is a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported", then the UE shall skip the requirements defined below in the present subclause for the receipt of a TRACKING AREA UPDATE ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in subclause 5.3.7, proceed with appropriate MM specific procedures, and send the setup message.


[Nm] {3058} The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:


	[B1] {3059} #2	(IMSI unknown in HSS)


		[B2] {3060} 	The UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


		[B2] {3061} 	If, due to emergency services fallback (see 3GPP TS 23.502 [59]), there is a request for CS fallback call pending (see subclause 5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.


	[B1] {3062} #16	(MSC temporarily not reachable); or


	[B1] {3063} #17	(Network failure)


		[B2] {3064} 	The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.


		[B2] {3065} 	If the tracking area updating attempt counter is less than 5:


			[B3] {3066} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again.


		[B2] {3067} 	If the tracking area updating attempt counter is equal to 5:


			[B3] {3068} -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;


			[B3] {3069} -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5);


			[B3] {3070} -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again. When the radio bearer associated with the persistent EPS bearer context has been released and the UE is registered for EPS services only, operating in CS/PS mode 1 of operation with "IMS voice not available", then the UE shall stop timer T3402, if already running, attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5).


	[B1] {3071} #18	(CS domain not available)


		[B2] {3072} 	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.


		[B2] {3073} 	The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.


		[B2] {3074} 	A UE in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see subclause 4.5).


		[B2] {3075} 	A UE in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see subclause 4.5).


		[B2] {3076} 	A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.


		[B2] {3077} 	The UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.


	[B1] {3078} #22	(Congestion)


		[B2] {3079} 	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall enter state MM IDLE.


[Nm] {3080} Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.


[H5] {3081} 5.5.3.3.5	Combined tracking area updating procedure not accepted by the network


[Nm] {3082} If the combined tracking area updating cannot be accepted by the network, the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.


[Nm] {3083} If the MME locally deactivates EPS bearer contexts for the UE (see subclause 5.5.3.2.4) and no active EPS bearer contexts remain for the UE, the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 "implicitly detached".


[Nm] {3084} If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.


[Nm] {3085} If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".


[Nm] {3086} If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.


[Nm] {3087} Based on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required". 


[Nm] {3088} Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430, stop any transmission of user data and enter state MM IDLE.


[Nm] {3089} If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.


[Nm] {3090} The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.


	[B1] {3091} #3	(Illegal UE);


	[B1] {3092} #6	(Illegal ME); or


	[B1] {3093} #8	(EPS services and non-EPS services not allowed);


	[B1] {3094} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI.


	[B1] {3095} 	The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {3096} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3097} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3098} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.#7	(EPS services not allowed);


	[B1] {3099} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall consider then USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {3100} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3101} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.


	[B1] {3102} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3103} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure performed over 3GPP access and for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3104} #9	(UE identity cannot be derived by the network);


	[B1] {3105} 	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.


	[B1] {3106} 	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


	[B1] {3107} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3108} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3109} 	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.


	[B1] {3110} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3111} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3112} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3113} 	If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3114} #10	(Implicitly detached);


	[B1] {3115} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.


	[B1] {3116} 	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.


	[B1] {3117} 	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


	[B1] {3118} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3119} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3120} 	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.


	[B1] {3121} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3122} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3123} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3124} #11	(PLMN not allowed); or


	[B1] {3125} #35	(Requested service option not authorized in this PLMN);


	[B1] {3126} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {3127} 	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {3128} 	The UE shall then perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3129} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.


	[B1] {3130} 	For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3131} 	For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {3132} #12	(Tracking area not allowed);


	[B1] {3133} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {3134} 	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.


	[B1] {3135} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3136} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3137} #13	(Roaming not allowed in this tracking area);


	[B1] {3138} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.


	[B1] {3139} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.


	[B1] {3140} 	If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] subclause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3141} 	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure following the PLMN selection.


	[B1] {3142} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3143} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3144} #14	(EPS services not allowed in this PLMN);


	[B1] {3145} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {3146} 	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {3147} 	The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3148} 	The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3149} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).


	[B1] {3150} 	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3151} 	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3152} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3153} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {3154} #15	(No suitable cells in tracking area);


	[B1] {3155} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3156} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:


		[B2] {3157} -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;


		[B2] {3158} -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;


		[B2] {3159} -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {3160} 	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.


	[B1] {3161} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3162} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3163} #22	(Congestion);


	[B1] {3164} 	If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.3.6.


	[B1] {3165} 	The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3166} 	The UE shall stop timer T3346 if it is running.


	[B1] {3167} 	If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.


	[B1] {3168} 	If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].


	[B1] {3169} 	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3170} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3171} 	If the tracking area updating procedure was initiated for an MO MMTEL voice call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.


	[B1] {3172} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


	[B1] {3173} #25	(Not authorized for this CSG);


	[B1] {3174} 	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.3.6.


	[B1] {3175} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3176} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {3177} 	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {3178} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {3179} 	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.


	[B1] {3180} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.


	[B1] {3181} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


	[B1] {3182} #40	(No EPS bearer context activated);


	[B1] {3183} 	The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. 


	[B1] {3184} 	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


	[B1] {3185} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3186} 	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3187} 	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3188} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".


	[B1] {3189} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3190} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3191} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.


	[B1] {3192} #42	(Severe network failure);


	[B1] {3193} 	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area updating attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3194} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.


	[B1] {3195} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {3196} #31	(Redirection to 5GCN required);


	[B1] {3197} 	EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.3.6.


	[B1] {3198} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3199} 	The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see subclause 4.5).


	[B1] {3200} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.


[Nm] {3201} Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.


[H5] {3202} 5.5.3.3.6	Abnormal cases in the UE


[Nm] {3203} The UE shall proceed as follows:


	[B1] {3204} 1)	if the UE requested the combined tracking area update for EPS services and "SMS only" and the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and "SMS only";


	[B1] {3205} 2)	if the combined tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in subclause 5.5.3.3.4.3 or the EMM Cause IE is not included in the message, the UE shall proceed as follows:


		[B2] {3206} a)	The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;


		[B2] {3207} b)	If the tracking area updating attempt counter is less than 5:


			[B3] {3208} -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;


		[B2] {3209} c)	If the tracking area updating attempt counter is equal to 5:


			[B3] {3210} -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; and


			[B3] {3211} -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology, proceed with appropriate MM, GMM or 5GMM specific procedures and disable the E-UTRA capability (see subclause 4.5); and


		[B2] {3212} d)	If there is a CS fallback emergency call or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and


	[B1] {3213} 3)	otherwise, the abnormal cases specified in subclause 5.5.3.2.6 apply with the following modification.


	[B1] {3214} 	If the tracking area updating attempt counter is incremented according to subclause 5.5.3.2.6 the next actions depend on the value of the tracking area updating attempt counter.


		[B2] {3215} -	If the tracking area updating attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED, but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and additionally if the tracking area updating procedure was performed due to cases h, m, n, z, zc in subclause 5.5.3.3.2 the update status shall be changed to EU2; or


		[B2] {3216} -	if the tracking area updating attempt counter is equal to 5, the UE shall delete any LAI, TMSI and ciphering key sequence number and set the update status to U2 NOT UPDATED.


	[B1] {3217} 	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


[H5] {3218} 5.5.3.3.7	Abnormal cases on the network side


[Nm] {3219} The abnormal cases specified in subclause 5.5.3.2.7 apply.


[H3] {3220} 5.5.4	eCall inactivity procedure


[Nm] {3221} The eCall inactivity procedure is applicable only to a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17]. The procedure shall be started when:


		[B2] {3222} -	the UE is in any EMM-REGISTERED substate except substates EMM-REGISTERED.PLMN-SEARCH or EMM-REGISTERED.NO-CELL-AVAILABLE;


		[B2] {3223} -	the UE is in EMM-IDLE mode; and


		[B2] {3224} -	one of the following conditions applies:


			[B3] {3225} 1)	timer T3444 expires or is found to have already expired and timer T3445 is not running;


			[B3] {3226} 2)	timer T3445 expires or is found to have already expired and timer T3444 is not running; or


			[B3] {3227} 3)	timers T3444 and T3445 expire or are found to have already expired.


[Nm] {3228} The UE shall then perform the following actions:


	[B1] {3229} -	stop other running timers (e.g. T3411, T3412);


	[B1] {3230} -	if the UE is currently registered to EPS services only, perform a detach procedure for EPS services only;


	[B1] {3231} -	if the UE is currently registered for both EPS services and non-EPS services, perform a combined detach procedure for EPS services and non-EPS services;


	[B1] {3232} -	delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and eKSI; and


	[B1] {3233} -	enter EMM-DEREGISTERED.eCALL-INACTIVE state.


[H3] {3234} 5.5.5	Tracking area update request message (for N1 mode only)


[Nm] {3235} The tracking area updating procedure is used to construct a TRACKING AREA UPDATE REQUEST message for the inter-system change from S1 mode to N1 mode for further security verification by the MME.


[Nm] {3236} The TRACKING AREA UPDATE REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 [54].


[Nm] {3237} The TRACKING AREA UPDATE REQUEST message shall contain only mandatory information elements. 


[Nm] {3238} The UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating".


[Nm] {3239} The UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. The UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one. The UE shall set associated GUTI in the Old GUTI IE.


[Nm] {3240} When the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE substate and needs to construct the TRACKING AREA UPDATE REQUEST message for inter-system change from S1 mode to N1 mode, the UE shall consider that the tracking area updating procedure is not initiated and the UE shall remain in EMM-REGISTERED.NO-CELL-AVAILABLE state.


[H3] {3241} 5.5.6	Attach request message (for N1 mode only)


[Nm] {3242} The attach procedure is used to construct an ATTACH REQUEST message for a UE performing a registration procedure for initial registration when


	[B1] {3243} a)	the UE:


		[B2] {3244} 1)	previously was registered in S1 mode before entering state EMM-DEREGISTERED; and


		[B2] {3245} 2)	has received an "interworking without N26 interface not supported" indication from the network; and


	[B1] {3246} b)	EPS security context and a valid 4G-GUTI are available.


[Nm] {3247} The ATTACH REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 [54].


[Nm] {3248} The ATTACH REQUEST message shall contain only mandatory information elements. 


[Nm] {3249} The UE shall set the EPS attach type IE in the ATTACH REQUEST message to "EPS attach".


[Nm] {3250} The UE shall include the eKSI (KSIASME) in the NAS Key Set Identifier IE in the ATTACH REQUEST message. The UE shall integrity protect the ATTACH REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one.


[Nm] {3251} The UE shall set associated GUTI in the EPS mobile identity IE.


[Nm] {3252} The UE shall set the UE network capability IE according to its capabilities.


[Nm] {3253} The UE shall include an ESM DUMMY MESSAGE in the ESM message container IE.


[H2] {3254} 5.6	EMM connection management procedures (S1 mode only)


[H3] {3255} 5.6.1	Service request procedure


[H4] {3256} 5.6.1.1	General


[Nm] {3257} The purpose of the service request procedure is to transfer the EMM mode from EMM-IDLE to EMM-CONNECTED mode. If the UE is not using EPS services with control plane CIoT EPS optimization, this procedure is used to establish the radio and S1 bearers when user data or signalling is to be sent. If the UE is using EPS services with control plane CIoT EPS optimization, this procedure can be used for UE initiated transfer of user data via the control plane. Another purpose of this procedure is to invoke MO/MT CS fallback or 1xCS fallback procedures.


[Nm] {3258} This procedure is used when:


	[B1] {3259} -	the network has downlink signalling pending;


	[B1] {3260} -	the UE has uplink signalling pending;


	[B1] {3261} -	the UE or the network has user data pending and the UE is in EMM-IDLE mode;


	[B1] {3262} -	the UE is in EMM-CONNECTED mode and has a NAS signalling connection only; the UE is using EPS services with control plane CIoT EPS optimization, and it has user data pending which is to be transferred via user plane radio bearers;


	[B1] {3263} -	the UE in EMM-IDLE or EMM-CONNECTED mode has requested to perform mobile originating/terminating CS fallback or 1xCS fallback;


	[B1] {3264} -	the network has downlink cdma2000® signalling pending;


	[B1] {3265} -	the UE has uplink cdma2000® signalling pending;


	[B1] {3266} -	the UE has to request resources for ProSe direct discovery or Prose direct communication; or


	[B1] {3267} -	the UE has to request resources for V2X communication over PC5.


[Nm] {3268} The service request procedure is initiated by the UE, however, for the downlink transfer of signalling, cdma2000® signalling or user data in EMM-IDLE mode, the trigger is given by the network by means of the paging procedure (see subclause 5.6.2).


[Nm] {3269} The UE shall invoke the service request procedure when:


	[B1] {3270} a)	the UE in EMM-IDLE mode receives a paging request using S-TMSI with CN domain indicator set to "PS" from the network;


	[B1] {3271} b)	the UE, in EMM-IDLE mode, has pending user data to be sent;


	[B1] {3272} c)	the UE, in EMM-IDLE mode, has uplink signalling pending;


	[B1] {3273} d)	the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use CS fallback and has a mobile originating CS fallback request from the upper layer;


	[B1] {3274} e)	the UE in EMM-IDLE mode is configured to use CS fallback and receives a paging request with CN domain indicator set to "CS", or the UE in EMM-CONNECTED mode is configured to use CS fallback and receives a CS SERVICE NOTIFICATION message;


	[B1] {3275} f)	the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use 1xCS fallback and has a mobile originating 1xCS fallback request from the upper layer;


	[B1] {3276} g)	the UE in EMM-CONNECTED mode is configured to use 1xCS fallback and accepts cdma2000® signalling messages containing a 1xCS paging request received over E-UTRAN;


	[B1] {3277} h)	the UE, in EMM-IDLE mode, has uplink cdma2000® signalling pending to be transmitted over E-UTRAN;


	[B1] {3278} i)	the UE, in EMM-IDLE or EMM-CONNECTED mode, is configured to use 1xCS fallback, accepts cdma2000® signalling messages containing a 1xCS paging request received over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);


	[B1] {3279} j)	the UE, in EMM-IDLE or EMM-CONNECTED mode, has uplink cdma2000® signalling pending to be transmitted over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);


	[B1] {3280} k)	the UE performs an inter-system change from S101 mode to S1 mode and has user data pending;


	[B1] {3281} l)	the UE in EMM-IDLE mode has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]); or


	[B1] {3282} m)	the UE, in EMM-CONNECTED mode and has a NAS signalling connection only, is using EPS services with control plane CIoT EPS optimization and has pending user data to be sent via user plane radio bearers; or


	[B1] {3283} n)	the UE in EMM-IDLE mode has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]).


[Nm] {3284} If one of the above criteria to invoke the service request procedure is fulfilled, then the service request procedure may only be initiated by the UE when the following conditions are fulfilled:


	[B1] {3285} -	its EPS update status is EU1 UPDATED, and the TAI of the current serving cell is included in the TAI list; and


	[B1] {3286} -	no EMM specific procedure is ongoing.


[Nm] {3287} A service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in subclause 5.6.1.6.


[Nm] {3288} The service request attempt counter shall be reset when:


	[B1] {3289} -	a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;


	[B1] {3290} -	a service request procedure in order to obtain packet services is successfully completed; or


	[B1] {3291} -	the UE moves to EMM-DEREGISTERED state.


[H4] {3292} 5.6.1.2	Service request procedure initiation


[H5] {3293} 5.6.1.2.1	UE is not using EPS services with control plane CIoT EPS optimization


[Nm] {3294} For cases a, b, c, h, k and l in subclause 5.6.1.1:


	[B1] {3295} -	if the UE is not configured for NAS signalling low priority, the UE initiates the service request procedure by sending a SERVICE REQUEST message to the MME;


	[B1] {3296} -	if the UE is configured for NAS signalling low priority, and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network indicated that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall send an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1"; or


	[B1] {3297} -	if the UE is configured for NAS signalling low priority and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network did not indicate that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall instead send a SERVICE REQUEST message.


[Nm] {3298} For cases a, b, c, h, k and l in subclause 5.6.1.1, after sending the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message with service type set to "packet services via S1", the UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.


[Nm] {3299} For case d in subclause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext and enter the state EMM-SERVICE-REQUEST-INITIATED.


[Nm] {3300} For case e in subclause 5.6.1.1:


	[B1] {3301} -	if the UE is in EMM-IDLE mode, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED;


	[B1] {3302} -	if the UE is in EMM-CONNECTED mode and if the UE accepts the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback accepted by the UE", start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED; or


	[B1] {3303} -	if the UE is in EMM-CONNECTED mode and if the UE rejects the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback rejected by the UE" and enter the state EMM-REGISTERED.NORMAL-SERVICE. The network shall not initiate CS fallback procedures.


[Nm] {3304} For cases f, g, i and j in subclause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.


[H5] {3305} 5.6.1.2.2	UE is using EPS services with control plane CIoT EPS optimization


[Nm] {3306} The UE shall send a CONTROL PLANE SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.


[Nm] {3307} For case a in subclause 5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile terminating request". The UE may include the ESM DATA TRANSPORT message. The UE shall not include any ESM message other than ESM DATA TRANSPORT message.


[Nm] {3308} For case b in subclause 5.6.1.1, 


	[B1] {3309} -	if the UE has pending IP, non-IP or Ethernet user data that is to be sent via the control plane radio bearers, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile originating request". The UE shall include an ESM DATA TRANSPORT message in the ESM message container IE. If the UE supports the CP-EDT (see 3GPP TS 36.300 [20]), the UE shall provide the CONTROL PLANE SERVICE REQUEST message in the NAS request to the lower layer to establish a RRC connection as specified in subclause 5.3.1.1.


[Nm] {3310} For cases b and m in subclause 5.6.1.1, 


	[B1] {3311} -	if the UE has pending IP, non-IP or Ethernet user data that is to be sent via the user plane radio bearers, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request" and the "active" flag in the Control plane service type IE to 1. The UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.


[Nm] {3312} For case c in subclause 5.6.1.1, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request". If the CONTROL PLANE SERVICE REQUEST message is:


	[B1] {3313} -	for sending SMS , the UE shall include the SMS message in the NAS message container IE and shall not include any ESM message container IE in the CONTROL PLANE SERVICE REQUEST message ; and


	[B1] {3314} -	for sending signalling different from SMS, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.


[H4] {3315} 5.6.1.3	EMM common procedure initiation


[Nm] {3316} Upon receipt of the SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, the MME may initiate the EMM common procedures, e.g. the authentication procedure and security mode control procedure.


[H4] {3317} 5.6.1.4	Service request procedure accepted by the network


[H5] {3318} 5.6.1.4.1	UE is not using EPS services with control plane CIoT EPS optimization


[Nm] {3319} If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the MME has no active EPS bearer contexts for the UE, for cases a, b and c in subclause 5.6.1.1, upon receipt of the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, after completion of the EMM common procedures according to subclause 5.6.1.3, if any, the MME shall send a SERVICE ACCEPT message.


[Nm] {3320} If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the UE has no active EPS bearer contexts, for cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of a SERVICE ACCEPT message as successful completion of the procedure. Otherwise, for cases a, b, c, h, k and l in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearer is set up as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.


[Nm] {3321} If the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile terminating CS fallback or 1xCS fallback" and the CSFB response IE, if included, indicates "CS fallback accepted by the UE", or if the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile originating CS fallback or 1xCS fallback" or "mobile originating CS fallback emergency call or 1xCS fallback emergency call", the network initiates CS fallback or 1xCS fallback procedures.


[Nm] {3322} If the EPS bearer context status IE is included in the EXTENDED SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the EXTENDED SERVICE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.


[Nm] {3323} If the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, was sent in a CSG cell and the CSG subscription has expired or was removed for a UE, but the UE has a PDN connection for emergency bearer services established, the network shall accept the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services and deactivate all non-emergency EPS bearers locally. The emergency EPS bearers shall not be deactivated.


[Nm] {3324} For cases d in subclause 5.6.1.1, and for case e in subclause 5.6.1.1 when the CSFB response was set to "CS fallback accepted by the UE", the UE shall treat the indication from the lower layers that the inter-system change from S1 mode to A/Gb or Iu mode is completed as successful completion of the procedure. The EMM sublayer in the UE shall indicate to the MM sublayer that the CS fallback procedure has succeeded. The UE shall stop the timer T3417ext or T3417ext-mt, respectively, and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.


[Nm] {3325} If the service request procedure was initiated in EMM-IDLE mode and an EXTENDED SERVICE REQUEST message was sent in a CSG cell and the CSG subscription has expired or was removed for the UE, the network need not perform CSG access control if the service type information element indicates "mobile originating CS fallback emergency call or 1xCS fallback emergency call".


[Nm] {3326} For cases f and g in subclause 5.6.1.1:


	[B1] {3327} -	if the UE receives the indication from the lower layers that the signalling connection is released with the redirection indication to cdma2000® 1x access network or the indication from the lower layers that a change to cdma2000® 1x access network for 1xCS fallback has started (see 3GPP TS 36.331 [22]), the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE;


	[B1] {3328} -	if the UE receives the dual Rx/Tx redirection indication from the lower layers (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x access network for 1xCS fallback, consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE; and


	[B1] {3329} -	if the UE receives a cdma2000® signalling message indicating 1xCS fallback rejection by cdma2000® 1x access network, the UE shall abort the service request procedure, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE.


[Nm] {3330} For cases i and j in subclause 5.6.1.1, if the UE receives the indication from the lower layers that the signalling connection is released, the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.


[Nm] {3331} If the SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services was used, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon successful completion of the service request procedure.


[Nm] {3332} If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment takes place during the procedure, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon receiving a lower layer indication of radio bearer establishment. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.


[Nm] {3333} If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment does not take place during the procedure, the UE does not perform local deactivation of the EPS bearer context. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.


[Nm] {3334} If a service request is received from a UE with a LIPA PDN connection, and if:


	[B1] {3335} -	a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the LIPA PDN connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or


	[B1] {3336} -	no GW Transport Layer Address is provided together with the service request by the lower layer;


[Nm] {3337} then the MME shall locally deactivate all EPS bearer contexts associated with any LIPA PDN connection. Furthermore, if no active EPS bearer contexts remain for the UE, the MME shall not accept the service request as specified in subclause 5.6.1.5.


[Nm] {3338} If a service request is received from a UE with a SIPTO at the local network PDN connection, and if the PDN connection is a:


		[B2] {3339} 1)	SIPTO at the local network PDN connection with stand-alone GW, and if:


		[B2] {3340} -	a LHN-ID value is provided by the lower layer together with the service request, and the LHN-ID value stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or


		[B2] {3341} -	no LHN-ID value is provided together with the service request by the lower layer; or


		[B2] {3342} 2)	SIPTO at the local network PDN connection with collocated L-GW, and if:


		[B2] {3343} -	a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or


		[B2] {3344} -	no SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer;


[Nm] {3345} then, the MME takes one of the following actions:


		[B2] {3346} -	if all the remaining PDN connections are SIPTO at the local network PDN connections, the MME shall not accept the service request as specified in subclause 5.6.1.5; and


		[B2] {3347} -	if a PDN connection remains that is not SIPTO at the local network PDN connection and the network decides to set up the S1 and radio bearers, the MME shall upon completion of the setup of the S1 bearers initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested" for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2).


[Nm] {3348} When the E-UTRAN fails to establish radio bearers for one or more EPS bearer contexts, then the MME shall locally deactivate the EPS bearer contexts corresponding to the failed radio bearers based on the lower layer indication from the EUTRAN, without notifying the UE.


[Nm] {3349} If the UE is not using EPS services with control plane CIoT EPS optimization, the network shall consider the service request procedure successfully completed:


	[B1] {3350} -	when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required; 


[Nm] {3351} -	when it receives an indication from the lower layer that the UE has been redirected to the other RAT (GERAN or UTRAN in CS fallback, or cdma2000® 1x access network for 1xCS fallback).


[H5] {3352} 5.6.1.4.2	UE is using EPS services with control plane CIoT EPS optimization


[Nm] {3353} For case a in subclause 5.6.1.1, the MME shall send a SERVICE ACCEPT message,upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile terminating request", after completion of the EMM common procedures according to subclause 5.6.1.3: 


	[B1] {3354} 1)	if the MME needs to perform an EPS bearer context status synchronization


		[B2] {3355} -	for an EPS bearer context associated with Control plane only indication; or


		[B2] {3356} -	for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1; or


	[B1] {3357} 2)	if the control plane data back-off time for the UE is stored in MME and the MME decides to deactivate congestion control for transport of user data via the control plane,


[Nm] {3358} then the MME shall send a SERVICE ACCEPT message.


[Nm] {3359} Furthermore the MME may:


	[B1] {3360} 1)	initiate the transport of user data via the control plane procedure or any other NAS signalling procedure;


	[B1] {3361} 2)	if supported by the UE and required by the network, initiate the setup of the user plane radio bearer(s); or


	[B1] {3362} 3)	send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending.


[Nm] {3363} For case b in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request", after completion of the EMM common procedures according to subclause 5.6.1.3, if any, if the MME needs to perform an EPS bearer context status synchronization


	[B1] {3364} -	for an EPS bearer context associated with Control plane only indication; or


	[B1] {3365} -	for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1, 


[Nm] {3366} then the MME shall send a SERVICE ACCEPT message.


[Nm] {3367} Furthermore, the MME may:


	[B1] {3368} 1)	initiate release of the NAS signalling connection upon receipt of an indication from the ESM layer (see subclause 6.6.4.2), unless the MME has additional downlink user data or signalling pending;


	[B1] {3369} 2)	initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane or the UE has set the "active" flag in the Control plane service type IE to 1;


	[B1] {3370} 3)	send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane; 


	[B1] {3371} 4)	send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending; or


	[B1] {3372} 5)	send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 4 above.


[Nm] {3373} For case m in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and the "active" flag in the Control plane service type IE set to 1:


	[B1] {3374} 1)	if the MME accepts the request, the MME shall initiate the setup of the user plane radio bearer(s) for all active EPS bearer contexts of SGi PDN connections that are established without control plane only indication.


	[B1] {3375} 2)	if the MME does not accept the request, the MME shall send a SERVICE ACCEPT message to complete the service request procedure.


[Nm] {3376} For case c in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and without an ESM message container IE, after completion of the EMM common procedures according to subclause 5.6.1.3, if any, the MME proceeds as follows:


[Nm] {3377} If the MME needs to perform an EPS bearer context status synchronization


	[B1] {3378} -	for an EPS bearer context associated with Control plane only indication; or


	[B1] {3379} -	for an EPS bearer context not associated with Control plane only indication, and there is no downlink user data pending to be delivered via the user plane, 


[Nm] {3380} then the MME shall send a SERVICE ACCEPT message.


[Nm] {3381} Furthermore, the MME may:


	[B1] {3382} 1)	initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane;


	[B1] {3383} 2)	send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane; 


	[B1] {3384} 3)	send a NAS signalling message not related to an EMM common procedure to the UE, if downlink signalling is pending; or


	[B1] {3385} 4)	send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 3 above.


[Nm] {3386} In NB-S1 mode, for cases a, b, c and m in subclause 5.6.1.1, if the MME needs to initiate the setup of user plane radio bearer(s), the MME shall check if the UE can support the establishment of additional user plane radio bearer based on the multiple DRB support indicated by UE in the UE network capability IE.


[Nm] {3387} For cases a, b and c in subclause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the CONTROL PLANE SERVICE REQUEST message, and this default bearer is not associated with the last PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.


[Nm] {3388} If the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST and the MME decides to respond with a SERVICE ACCEPT message, the MME shall include an EPS bearer context status IE, indicating which EPS bearer contexts are active in the MME, except for the case when no EPS bearer context exists on the network side.


[Nm] {3389} If the MME needs to initiate an EPS bearer context status synchronization, the MME may include an EPS bearer context status IE in the SERVICE ACCEPT message also if no EPS bearer context status IE was included in the CONTROL PLANE SERVICE REQUEST message.


[Nm] {3390} The MME shall include the T3448 value IE in the SERVICE ACCEPT message, if the MME sends a SERVICE ACCEPT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:


	[B1] {3391} -	if the Release assistance indication IE is set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message;


	[B1] {3392} -	if the UE has indicated support for the control plane data back-off timer; and


	[B1] {3393} -	if the MME decides to activate the congestion control for transport of user data via the control plane,


[Nm] {3394} If the MME sends a SERVICE ACCEPT message and decides to deactivate congestion control for transport of user data via the control plane then the MME shall delete the stored control plane data back-off time for the UE and the MME shall not include timer T3448 value IE in SERVICE ACCEPT message.


[Nm] {3395} For cases a, b, c and m in subclause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message or the MME needs to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed when it sends the SERVICE ACCEPT message. If the EPS bearer context status IE is not included in the CONTROL PLANE SERVICE REQUEST message and the MME does not need to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed:


	[B1] {3396} -	when it successfully completes a NAS security mode control procedure;


	[B1] {3397} -	when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;


	[B1] {3398} -	upon receipt of the CONTROL PLANE SERVICE REQUEST message and completion of the EMM common procedures, if any, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME has downlink user data or signalling not related to an EMM common procedure pending; and


[Nm] {3399} -	with the transmission of a SERVICE ACCEPT message or with the decision to initiate release of the NAS signalling connection, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME does not have any downlink user data or signalling pending.


[Nm] {3400} If the MME considers the service request procedure successfully completed the MME shall:


	[B1] {3401} 1)	forward the contents of the ESM message container IE, if any, to the ESM layer; and


	[B1] {3402} 2)	forward the contents of the NAS message container IE, if any.


[Nm] {3403} For cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of a SECURITY MODE COMMAND message as successful completion of the procedure:


[Nm] {3404} For cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of a security protected EMM message different from a SERVICE REJECT message and not related to an EMM common procedure as successful completion of the procedure:


[Nm] {3405} For cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of a security protected ESM message as successful completion of the procedure:


[Nm] {3406} For cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of receipt of the indication from the lower layers that the user plane radio bearers are set up as successful completion of the procedure:


[Nm] {3407} Upon successful completion of the procedure, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.


[Nm] {3408} For case m in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearers are set up as successful completion of the procedure. The UE shall treat the receipt of a SERVICE ACCEPT message as completion of the procedure without the establishment of the user plane radio bearers. For both cases, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.


[Nm] {3409} For case b in subclause 5.6.1.1, the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.


[Nm] {3410} For cases a, c and m in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the RRC connection has been released as an abnormal case and shall follow the procedure described in subclause 5.6.1.6, item b.


[Nm] {3411} For cases a, b and c in subclause 5.6.1.1,


	[B1] {3412} -	if the MME needs to initiate an EPS bearer context status synchronization, the UE can receive a SERVICE ACCEPT message even after it received a SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up and determined successful completion of the service request procedure. Upon receipt of the SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up, the UE shall start timer T3449. If the UE receives a security protected ESM message or a security protected EMM message not related to an EMM common procedure, the UE shall stop the timer T3449. If the UE receives a SERVICE ACCEPT message while the timer T3449 is running, the UE shall treat the SERVICE ACCEPT message and stop the timer T3449. If the UE is not in state EMM-SERVICE-REQUEST-INITIATED and timer T3449 is not running, the receipt of the SERVICE ACCEPT message is considered as protocol error and the UE shall return EMM STATUS message as specified in subclause 7.4; otherwise the UE shall treat the SERVICE ACCEPT message; and


	[B1] {3413} -	if the UE treats the SERVICE ACCEPT message and an EPS bearer context status IE is included in the message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the SERVICE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME.


[Nm] {3414} If the T3448 value IE is present in the received SERVICE ACCEPT message, the UE shall:


	[B1] {3415} -	stop timer T3448 if it is running;


	[B1] {3416} -	consider the transport of user data via the control plane as successful; and


	[B1] {3417} -	start timer T3448 with the value provided in the T3448 value IE.


[Nm] {3418} If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the SERVICE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.


	[B1] {3419} If the UE in EMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message and the SERVICE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.


[H4] {3420} 5.6.1.5	Service request procedure not accepted by the network


[Nm] {3421} If the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value.


[Nm] {3422} Based on local policies or configurations in the MME, if the MME determines to change the periodic tracking area update timer (T3412), or if the MME determines to change the PSM usage or the value of timer T3324 in the UE for which PSM is allowed by the MME, the MME may return a SERVICE REJECT with the cause #10 "implicitly detached" to the UE.


[Nm] {3423} Based on operator policy, if the service request procedure is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required". 


[Nm] {3424} The MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 "CS service temporarily not available".


[Nm] {3425} The MME may further be configured for a certain area A' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, if:


	[B1] {3426} -	the service request is initiated in EMM-IDLE mode; and


	[B1] {3427} -	the UE indicated support of eNodeB-based access control for mobile originating CS fallback calls during an attach or tracking area updating procedure.


[Nm] {3428} When the EMM cause value is #39 "CS service temporarily not available", the MME shall include a value for timer T3442 in the SERVICE REJECT message. If a mobile terminating CS fallback call is aborted by the network during call establishment as specified in 3GPP TS 29.118 [16A], the MME shall include the EMM cause value #39 "CS service temporarily not available" and set the value of timer T3442 to zero.


[Nm] {3429} If a service request from a UE with only LIPA PDN connections is not accepted due to the reasons specified in subclause 5.6.1.4, depending on the service request received, the MME shall include the following EMM cause value in the SERVICE REJECT message:


	[B1] {3430} -	if the service request received is not due to CS fallback or 1xCS fallback, EMM cause value #10 "implicitly detached"; or


	[B1] {3431} -	if the service request received is due to CS fallback or 1xCS fallback, EMM cause value #40 "no EPS bearer context activated".


[Nm] {3432} If a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted due to the reasons specified in subclause 5.6.1.4, depending on the service request received, the MME shall:


	[B1] {3433} -	if the service request received is due to CS fallback or 1xCS fallback, include the EMM cause value #40 "no EPS bearer context activated" in the SERVICE REJECT message; or


	[B1] {3434} -	if the service request received is not due to CS fallback or 1xCS fallback, abort the service request procedure and send a DETACH REQUEST message to the UE with detach type "re-attach required" (see subclause 5.5.2.3.1).


[Nm] {3435} If the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {3436} In NB-S1 mode, if the service request for mobile originated services is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.


[Nm] {3437} If the service request for mobile originated services is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.


[Nm] {3438} If the MME sends a SERVICE REJECT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:


	[B1] {3439} -	if the Release assistance indication IE is not set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message;


	[B1] {3440} -	if the UE has indicated a support for the control plane data back-off timer; and


	[B1] {3441} -	if the MME decides to activate the congestion control for transport of user data via the control plane, 


[Nm] {3442} then the MME shall set the EMM cause value to #22 "congestion" and assign a value for control plane data back-off timer T3448.


[Nm] {3443} On receipt of the SERVICE REJECT message, if the UE is in state EMM-SERVICE-REQUEST-INITIATED and the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall reset the service request attempt counter, stop timer T3417, T3417ext or T3417ext-mt, if running.


[Nm] {3444} If the SERVICE REJECT message with EMM cause #25 or #31 was received without integrity protection, then the UE shall discard the message.


[Nm] {3445} The UE shall take the following actions depending on the received EMM cause value in the SERVICE REJECT message.


	[B1] {3446} #3	(Illegal UE);


	[B1] {3447} #6	(Illegal ME); or


	[B1] {3448} #8	(EPS services and non-EPS services not allowed);


	[B1] {3449} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {3450} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {3451} 	For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3452} 	For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {3453} #7	(EPS services not allowed);


	[B1] {3454} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.


	[B1] {3455} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3456} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.


	[B1] {3457} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3458} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3459} #9	(UE identity cannot be derived by the network);


	[B1] {3460} 	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.


	[B1] {3461} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3462} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3463} 	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3464} 	If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.


	[B1] {3465} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3466} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.


	[B1] {3467} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3468} 	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3469} #10	(Implicitly detached);


	[B1] {3470} 	A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.


	[B1] {3471} 	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.


	[B1] {3472} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3473} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3474} 	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3475} 	If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.


	[B1] {3476} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3477} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3478} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3479} #11	(PLMN not allowed); or


	[B1] {3480} #35	(Requested service option not authorized in this PLMN);


	[B1] {3481} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.


	[B1] {3482} 	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.


	[B1] {3483} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3484} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause value #11.


	[B1] {3485} 	For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3486} 	For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


	[B1] {3487} #12	(Tracking area not allowed);


	[B1] {3488} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.


	[B1] {3489} 	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.


	[B1] {3490} 	If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3491} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3492} 	If the UE is operating in single-registration mode, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3493} #13	(Roaming not allowed in this tracking area);


	[B1] {3494} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH.


	[B1] {3495} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.


	[B1] {3496} 	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3497} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3498} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3499} #15	(No suitable cells in tracking area);


	[B1] {3500} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3501} 	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.


	[B1] {3502} 	If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3503} 	If the service request was not initiated for mobile originated CS fallback, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].


	[B1] {3504} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3505} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3506} #18	(CS domain not available);


	[B1] {3507} 	If the request was related to CS fallback, the UE shall send an indication to the MM sublayer and shall not attempt CS fallback until combined tracking area updating procedure has been successfully completed. The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE.


	[B1] {3508} 	The UE shall set the update status to U2 NOT UPDATED.


	[B1] {3509} 	If the UE is in CS/PS mode 1 of operation with "IMS voice not available" and the request was related to CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).


	[B1] {3510} 	If the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, the UE may provide a notification to the user or the upper layers that the CS domain is not available.


	[B1] {3511} 	If the request was related to 1xCS fallback, the UE shall cancel upper layer actions related to 1xCS fallback and enter the state EMM-REGISTERED.NORMAL-SERVICE.


	[B1] {3512} #22	(Congestion);


	[B1] {3513} 	If the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.6.


	[B1] {3514} 	If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall abort the service request procedure and enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.


	[B1] {3515} 	The UE shall stop timer T3346 if it is running.


	[B1] {3516} 	If the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.


	[B1] {3517} 	If the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].


	[B1] {3518} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3519} 	If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3520} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3521} 	If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3522} 	If the service request was initiated in EMM-CONNECTED mode with Control plane service type "mobile originating request" and with the "active" flag set to 1, the UE shall abort the procedure.


	[B1] {3523} 	If the service request procedure was initiated for an MO MMTEL voice call is started, a notification that the service request was not accepted due to congestion shall be provided to the upper layers.


	[B1] {3524} 	For all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3525} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3526} 	If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:


		[B2] {3527} -	stop timer T3448 if it is running;


		[B2] {3528} -	consider the transport of user data via the control plane as unsuccessful; and


		[B2] {3529} -	start timer T3448:


			[B3] {3530} -	with the value provided in the T3448 value IE if the SERVICE REJECT message is integrity protected; or


			[B3] {3531} -	with a random value from the default range specified in table 10.2.1 if the SERVICE REJECT message is not integrity protected.


		[B2] {3532} 	If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and-	stop timer T3448 if it is running; and


		[B2] {3533} -	consider the transport of user data via the control plane as unsuccessful.


	[B1] {3534} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state and 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3535} #25	(Not authorized for this CSG);


	[B1] {3536} 	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.6.


	[B1] {3537} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3538} 	If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.


	[B1] {3539} 	If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.


	[B1] {3540} 	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].


	[B1] {3541} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.


	[B1] {3542} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.


	[B1] {3543} #31	(Redirection to 5GCN required);


	[B1] {3544} 	EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.6. 


	[B1] {3545} 	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the service request attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.


	[B1] {3546} 	The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see subclause 4.5).


	[B1] {3547} 	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.


	[B1] {3548} #39	(CS service temporarily not available); 


	[B1] {3549} 	If the T3442 value received in the SERVICE REJECT message is not zero, the UE shall start timer T3442 and enter the state EMM-REGISTERED.NORMAL-SERVICE. If the T3442 value received in the SERVICE REJECT message is zero, the UE shall not start timer T3442.


	[B1] {3550} 	The UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message.	


	[B1] {3551} #40	(No EPS bearer context activated);


	[B1] {3552} 	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.


	[B1] {3553} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3554} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3555} 	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.


	[B1] {3556} 	If the service request was initiated for any reason other than CS fallback or 1x CS fallback, the UE shall perform a new attach procedure.


	[B1] {3557} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause value #10 "Implicitly detached".


	[B1] {3558} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.


	[B1] {3559} 	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.


	[B1] {3560} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.


	[B1] {3561} #42	(Severe network failure);


	[B1] {3562} 	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].


	[B1] {3563} 	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.


	[B1] {3564} 	If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.


[Nm] {3565} Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.6.1.6.


[H4] {3566} 5.6.1.5A	Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network


[Nm] {3567} If the service request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.6.1.5. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:


	[B1] {3568} a)	inform the upper layers of the failure of the procedure; or


	[B1] {3569} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


[Nm] {3570} If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.6.1.6, the UE shall perform the actions as described in subclause 5.6.1.6 and inform the upper layers of the failure to access the network.


[Nm] {3571} If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or e) in subclause 5.6.1.6, the UE shall perform the procedures as described in subclause 5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:


	[B1] {3572} a)	inform the upper layers of the failure of the procedure; or


	[B1] {3573} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


[H4] {3574} 5.6.1.5B	Service request procedure for UE attached for access to RLOS not accepted by the network


[Nm] {3575} If the service request for UE attached for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.6.1.5. 


[Nm] {3576} Then if:


	[B1] {3577} a)	the UE is in the same selected PLMN where the last service request was attempted and rejected;


	[B1] {3578} b)	the service request procedure was rejected with an EMM cause value other than #9, #10 and #40; and


	[B1] {3579} c)	timer T3346 is not running,


[Nm] {3580} the UE shall:


	[B1] {3581} a)	detach locally, if not detached already, and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[Nm] {3582} If the service request for UE attached for access to RLOS fails due to abnormal cases a), b), c) or e) in subclause 5.6.1.6, the UE shall perform the procedures as described in subclause 5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:


	[B1] {3583} a)	detach locally, if not detached already, and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.


[H4] {3584} 5.6.1.6	Abnormal cases in the UE


[Nm] {3585} The following abnormal cases can be identified:


	[B1] {3586} a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers


	[B1] {3587} 	In WB-S1 mode, if the service request procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.


	[B1] {3588} 	In NB-S1 mode, if the service request procedure is started in response to a paging request from the network, access barring is not applicable.


	[B1] {3589} 	If the trigger for the service request procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. During an implementation dependent time period, the service request procedure may be started when access for "terminating calls" is granted or upon a cell change.


	[B1] {3590} 	If the service request was initiated for CS fallback and the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 [22]) and the lower layer indicates "the barring is due to CSFB specific access barring information", the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary, i.e. when access for "mobile originating CS fallback" is granted or because of a cell change.


	[B1] {3591} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received and the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 [22]) and the lower layer does not indicate "the barring is due to CSFB specific access barring information", the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3592} 	If the service request was initiated for 1xCS fallback and the access is barred for "originating calls" (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3593} 	The service request procedure shall be started, if the lower layer indicated the access was barred because of access class barring for "originating calls" (see 3GPP TS 36.331 [22]) and if:


		[B2] {3594} -	the service request is initiated due to a request from upper layers for user plane radio resources, and the MO MMTEL voice call is started, the MO MMTEL video call is started or the MO SMSoIP is started;


		[B2] {3595} -	the service request is initiated due to a mobile originated SMS over NAS or SMS over S102; or


		[B2] {3596} -	the service request is initiated due to a request from upper layers for user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.


	[B1] {3597} 	The call type used shall be per annex D of this document, if the lower layer indicated the access was barred because of access class barring for "originating calls" (see 3GPP TS 36.331 [22]) and if:


		[B2] {3598} -	the service request is initiated due to a request from upper layers for user plane radio resources, and the MO MMTEL voice call is started, the MO MMTEL video call is started or the MO SMSoIP is started;


		[B2] {3599} -	the service request is initiated due to a mobile originated SMS over NAS or SMS over S102; or


		[B2] {3600} -	the service request is initiated due to a request from upper layers for user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.


	[B1] {3601} 	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the service request procedure shall be started.


	[B1] {3602} 	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the service request procedure shall be started.


	[B1] {3603} 	Otherwise:


		[B2] {3604} -	In WB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331 [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary when access for "originating calls" is granted or because of a cell change.


		[B2] {3605} -	In NB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331 [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. Further UE behaviour is implementation specific, e.g. the service request procedure is started again after an implementation dependent time; or


		[B2] {3606} 	In NB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331 [22]), and a request for an exceptional event is received from the upper layers, then the service request procedure shall be started.


	[B1] {3607} b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time", without "Extended wait time CP data", and without redirection indication received from lower layers before the service request procedure is completed (see subclause 5.6.1.4) or before SERVICE REJECT message is received


	[B1] {3608} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3609} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3610} 	If the service request was initiated for 1xCS fallback, the UE shall either:


		[B2] {3611} -	attempt to select cdma2000® 1x radio access technology and proceed with appropriate cdma2000® 1x CS procedures. If the UE fails to select cdma2000® 1x radio access technology, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE; or


		[B2] {3612} -	set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE, and perform cell selection according to 3GPP TS 36.304 [21].


	[B1] {3613} 	If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.


	[B1] {3614} 	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.


	[B1] {3615} c)	T3417 expired


	[B1] {3616} 	The UE shall enter the state EMM-REGISTERED.


	[B1] {3617} 	If the UE triggered the service request procedure in EMM-IDLE mode in order to obtain packet services, then the EMM sublayer shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. The service request counter shall not be incremented, if:


		[B2] {3618} -	the service request procedure is initiated to establish a PDN connection for emergency bearer services;


		[B2] {3619} -	the UE has a PDN connection for emergency bearer services established;


		[B2] {3620} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3621} -	the service request is initiated in response to paging from the network; or


		[B2] {3622} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]). 


	[B1] {3623} 	If the service request attempt counter is greater than or equal to 5, the UE shall start timer T3325 (see 3GPP TS 24.008 [13]). Additionally if the service request was initiated for an "originating MMTEL voice" call type, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers. 


	[B1] {3624} 	The UE shall not attempt service request until expiry of timer T3325 unless:


		[B2] {3625} -	the service request is initiated in response to paging from the network;


		[B2] {3626} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3627} -	the service request is initiated to establish a PDN connection for emergency bearer services;


		[B2] {3628} -	the UE has a PDN connection for emergency bearer services established;


		[B2] {3629} -	the UE is registered in a new PLMN; or


		[B2] {3630} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).


	[B1] {3631} 	If the service request for "originating MMTEL voice" call type was triggered while T3325 is running, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.


	[B1] {3632} 	If the UE triggered the service request procedure in order to obtain services other than packet services from EMM-IDLE mode, then the EMM sublayer shall abort the procedure and release locally any resources allocated for the service request procedure.


	[B1] {3633} 	If the UE triggered the service request procedure in EMM-CONNECTED mode, the EMM sublayer shall abort the procedure and consider the service request procedure with "active" flag set or the 1xCS fallback procedure as failed. The UE shall stay in EMM-CONNECTED mode.


	[B1] {3634} d)	T3417ext or T3417ext-mt expired


	[B1] {3635} 	If a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3636} 	If a CS fallback cancellation request was received the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3637} e)	SERVICE REJECT received, other EMM cause values than those treated in subclause 5.6.1.5, and cases of EMM cause values #22, #25 and #31 if considered as abnormal cases according to subclause 5.6.1.5.


	[B1] {3638} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3639} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3640} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3641} 	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, then upon entering EMM-IDLE mode the UE shall perform tracking area updating procedure.


	[B1] {3642} 	If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.


	[B1] {3643} 	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.


	[B1] {3644} f)	Tracking area updating procedure is triggered


	[B1] {3645} 	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt if running and perform the tracking area updating procedure. The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.


	[B1] {3646} g)	Switch off


	[B1] {3647} 	If the UE is in state EMM-SERVICE-REQUEST-INITIATED at switch off, the detach procedure shall be performed. 


	[B1] {3648} h)	Detach procedure collision


	[B1] {3649} 	EPS detach containing detach type "re-attach required":


		[B2] {3650} 	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:


			[B3] {3651} -	If the service request was initiated for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM, CC and GMM specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer;


			[B3] {3652} -	If the service request was initiated for 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures; or


			[B3] {3653} -	If the service request was not initiated for CS fallback or 1xCS fallback, the detach procedure shall be progressed and the service request procedure shall be aborted.


	[B1] {3654} 	EPS detach containing detach type "re-attach not required":


		[B2] {3655} 	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:


			[B3] {3656} -	If the DETACH REQUEST message contains an EMM cause other than #2 "IMSI unknown in HSS" or no EMM cause IE, the detach procedure shall be progressed and the service request procedure shall be aborted. Additionally, if the service request was initiated for CS fallback or 1xCS fallback, but not for CS fallback for emergency call or 1xCS fallback for emergency call, the EMM sublayer shall indicate to the MM sublayer or the cdma2000® upper layers that the CS fallback or 1xCS fallback procedure has failed; or


		[B2] {3657} 	If the DETACH REQUEST message contains EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".


	[B1] {3658} 	EPS detach containing detach type "IMSI detach":


		[B2] {3659} 	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:


			[B3] {3660} -	if the service request was initiated for SMS over NAS or CS fallback, but not for CS fallback for emergency call, the UE shall abort the service request procedure and progress the detach procedure; or


			[B3] {3661} -	otherwise the UE shall progress both procedures.


	[B1] {3662} i)	Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication with TAI change from lower layers


	[B1] {3663} 	If the current TAI is not in the TAI list, the service request procedure shall be aborted to perform the tracking area updating procedure. The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.


	[B1] {3664} 	If the current TAI is still part of the TAI list, the UE shall restart the service request procedure.


	[B1] {3665} j)	Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication without TAI change from lower layers


	[B1] {3666} 	The UE shall restart the service request procedure.


	[B1] {3667} k)	Default or dedicated bearer set up failure


	[B1] {3668} 	If the lower layers indicate a failure to set up a radio bearer, the UE shall locally deactivate the EPS bearer as described in subclause 6.4.4.6.


	[B1] {3669} l)	"Extended wait time" from the lower layers


	[B1] {3670} 	The UE shall abort the service request procedure, enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.


	[B1] {3671} 	If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value.


	[B1] {3672} 	If the SERVICE REQUEST message was sent by a UE configured for NAS signalling low priority, the UE shall start timer T3346 with the "Extended wait time" value.


	[B1] {3673} 	If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority" or if the SERVICE REQUEST message was sent by a UE not configured for NAS signalling low priority, the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value.


	[B1] {3674} 	In other cases the UE shall ignore the "Extended wait time".


	[B1] {3675} 	The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3676} 	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3677} 	If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3678} 	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3679} 	If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.


	[B1] {3680} 	If the service request was initiated due to a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.


	[B1] {3681} la)	"Extended wait time CP data" from the lower layers


	[B1] {3682} 	The UE shall abort the service request procedure for transfer of user data via the control plane, enter state EMM-REGISTERED, and stop timer T3417 if still running.


	[B1] {3683} 	If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value.


	[B1] {3684} 	In other cases the UE shall ignore the "Extended wait time CP data".


	[B1] {3685} 	The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure for transfer of user data via the control plane is started, if still necessary, when the timer T3448 expires or is stopped.


	[B1] {3686} m)	Timer T3346 is running


	[B1] {3687} 	The UE shall not start the service request procedure unless:


		[B2] {3688} -	the UE receives a paging;


		[B2] {3689} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3690} -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services; 


		[B2] {3691} -	the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call; 


		[B2] {3692} -	the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority"; or


		[B2] {3693} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and:


			[B3] {3694} -	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the	NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and


			[B3] {3695} -	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data".


	[B1] {3696} 	If the UE is in EMM-IDLE mode, the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3697} 	Upon upper layer's request for a mobile originated CS fallback which is not for emergency call, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3698} 	Upon upper layer's request for a CS fallback for emergency call, the UE may select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.


	[B1] {3699} 	Upon a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.


	[B1] {3700} 	Upon upper layer's request for a mobile originated 1x CS fallback which is not for emergency call, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.


	[B1] {3701} 	Upon upper layer's request for a 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.


	[B1] {3702} 	If the service request procedure was triggered for an MO MMTEL voice call is started, a notification that the service request procedure was not initiated due to congestion shall be provided to the upper layers.


	[B1] {3703} n)	Failure to find a suitable GERAN or UTRAN cell, after release of the NAS signalling connection without "Extended wait time" and with redirection indication received from lower layers when the service request was initiated for CS fallback 


	[B1] {3704} 	The EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


	[B1] {3705} 	The UE shall abort the service request procedure, stop timer T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.


	[B1] {3706} o)	Timer T3448 is running


	[B1] {3707} 	The UE in EMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane unless:


		[B2] {3708} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3709} -	the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or


		[B2] {3710} -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).


	[B1] {3711} 	The UE stays in the current serving cell and applies the normal cell reselection process.


	[B1] {3712} p)	Timer T3447 is running


	[B1] {3713} 	The UE shall not start any service request procedure unless:


		[B2] {3714} -	the UE receives a paging;


		[B2] {3715} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3716} -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services.


	[B1] {3717} 	The UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3447 expires.


[H4] {3718} 5.6.1.7	Abnormal cases on the network side


[Nm] {3719} The following abnormal cases can be identified:


	[B1] {3720} a)	Lower layer failure 


	[B1] {3721} 	If a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE or the service request procedure has been completed by the network, the network enters/stays in EMM-IDLE.


	[B1] {3722} b)	Protocol error


	[B1] {3723} 	If the SERVICE REQUEST, EXTENDED SERVICE REQUEST or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, the network shall return a SERVICE REJECT message with one of the following EMM cause values:


		[B2] {3724} #96:	invalid mandatory information;


		[B2] {3725} #99:	information element non-existent or not implemented;


		[B2] {3726} #100:	conditional IE error; or


		[B2] {3727} #111:	protocol error, unspecified.


	[B1] {3728} 	The network stays in the current EMM mode.


	[B1] {3729} c)	More than one SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed)


		[B2] {3730} -	If one or more of the information elements in the SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST for packet services differs from the ones received within the previous SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message for packet services, the previously initiated service request procedure shall be aborted and the new service request procedure shall be progressed;


		[B2] {3731} -	If the information elements do not differ, then the network shall continue with the previous service request procedure and shall not treat any further this SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message.


	[B1] {3732} d)	ATTACH REQUEST received before a SERVICE REJECT message has been sent or the service request procedure has been completed


	[B1] {3733} 	If an ATTACH REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure, delete the EMM context, EPS bearer contexts, if any, and progress the new ATTACH REQUEST. 


	[B1] {3734} e)	TRACKING AREA UPDATE REQUEST message received before the service request procedure has been completed or a SERVICE REJECT message has been sent


	[B1] {3735} 	If a TRACKING AREA UPDATE REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure and progress the tracking area updating procedure.


	[B1] {3736} f)	Default or dedicated bearer set up failure


	[B1] {3737} 	If the lower layers indicate a failure to set up a radio or S1 bearer, the MME shall locally deactivate the EPS bearer as described in subclause 6.4.4.6.


[H3] {3738} 5.6.2	Paging procedure


[H4] {3739} 5.6.2.1	General


[Nm] {3740} The paging procedure is used by the network to request the establishment or resumption of a NAS signalling connection to the UE. Another purpose of the paging procedure is to prompt the UE to reattach if necessary as a result of a network failure. If the UE is not attached when it receives a paging for EPS services, the UE shall ignore the paging.


[Nm] {3741} Additionally, the network can use the paging procedure to initiate the mobile terminating CS fallback procedure or SMS or user data transfer via the MME.


[H4] {3742} 5.6.2.2	Paging for EPS services


[H5] {3743} 5.6.2.2.1	Paging for EPS services through E-UTRAN using S-TMSI


[H5] {3744} 5.6.2.2.1.1	General


[Nm] {3745} The network shall initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" when NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE when no NAS signalling connection exists (see example in figure 5.6.2.2.1.1).


[Nm] {3746} For the UE using eDRX, the network initiates the paging procedure when NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE within the paging time window. If NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.


[Nm] {3747} To initiate the procedure the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]) and shall start the timer:


	[B1] {3748} -	T3415 for this paging procedure, if the network accepted to use eDRX for the UE and the UE does not have a PDN connection for emergency bearer services.


	[B1] {3749} -	Otherwise, T3413 for this paging procedure.


[Nm] {3750} If the network starts timer T3415, the network shall set timer T3415 to a value smaller than the value of timer T3-RESPONSE (see 3GPP TS 29.274 [16D] for further details on timer T3-RESPONSE).


[Nm] {3751} The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer.


[Nm] {3752} If the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]).


[Nm] {3753} Upon reception of a paging indication, if control plane CIoT EPS optimization is not used by the UE, the UE shall stop the timer T3346, if running, and shall initiate a service request procedure to respond to the paging (see 3GPP TS 23.401 [10] and 3GPP TS 36.413 [23]) or a tracking area updating procedure as specified in subclauses 5.5.3.2.2 and 5.5.3.3.2. And additionally, if the UE is in the EMM-IDLE mode with suspend indication, resume the suspended NAS signalling connection to the MME as specified in subclause 5.3.1.3.


[Nm] {3754} Upon reception of a paging indication, if control plane CIoT EPS optimization is used by the UE, the UE shall stop the timer T3346, if running, and shall additionally:


	[B1] {3755} -	initiate a service request procedure as specified in subclause 5.6.1.2.2 if the UE is in the EMM-IDLE mode without suspend indication;


	[B1] {3756} -	initiate a tracking area updating procedure as specified in subclauses 5.5.3.2.2; or


	[B1] {3757} -	proceed the behaviour as specified in subclause 5.3.1.3 if the UE is in the EMM-IDLE mode with suspend indication.


[Nm] {3758} If the paging for EPS services was received during an ongoing UE-initiated EMM specific procedure or service request procedure, then the UE shall ignore the paging. The network shall proceed with the EMM specific procedure or the service request procedure, and stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415). If the network receives an ATTACH REQUEST message when the paging procedure is ongoing, it should be considered as an abnormal case, and the behaviour of the network for this case is specified in subclause 5.6.2.2.1.2.


[Nm] {3759} The network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415) when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the EMM entity in the MME receives an indication from the lower layer that it has received the S1-AP UE context resume request message as specified in 3GPP TS 36.413 [23]. If the response received is not integrity protected, or the integrity check is unsuccessful, the timer for the paging procedure (i.e. either timer T3413 or timer T3415) shall be kept running unless:


	[B1] {3760} -	the UE has a PDN connection for emergency bearer services; or


	[B1] {3761} -	the response received is a TRACKING AREA UPDATE REQUEST message and the security mode control procedure or authentication procedure performed during tracking area updating procedure has completed successfully.


[Nm] {3762} Upon expiry of timer T3413, the network may reinitiate paging.


[Nm] {3763} If the network, while waiting for a response to the paging sent without paging priority, receives downlink signalling or downlink data associated with priority EPS bearers, the network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415), and then initiate the paging procedure with paging priority.


[Nm] {3764} Upon expiry of timer T3415, the network shall abort the paging procedure and shall proceed as specified in 3GPP TS 23.401 [10].


[H5] {3765} 5.6.2.2.1.2	Abnormal cases on the network side


[Nm] {3766} The following abnormal case can be identified:


	[B1] {3767} a)	ATTACH REQUEST message received when paging procedure is ongoing.


	[B1] {3768} 	If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed.The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.


[H5] {3769} 5.6.2.2.1.3	Abnormal cases in the UE


[Nm] {3770} The following abnormal case can be identified:


	[B1] {3771} a)	The paging indication received for a UE that is attached for access to RLOS


	[B1] {3772} A UE attached for access to RLOS shall ignore the paging indication from the network.


	[B1] {3773} b)	The paging indication received when UE-initiated EMM specific procedure or service request procedure is ongoing.


	[B1] {3774} 	The UE shall ignore the paging indication from the network.


[H5] {3775} 5.6.2.2.2	Paging for EPS services through E-UTRAN using IMSI


[Nm] {3776} Paging for EPS services using IMSI is an abnormal procedure used for error recovery in the network.


[Nm] {3777} The network may initiate paging for EPS services using IMSI with CN domain indicator set to "PS" if the S-TMSI is not available due to a network failure (see example in figure 5.6.2.2.2.1).


[Nm] {3778} In S1 mode, to initiate the procedure the EMM entity in the network requests the lower layer to start paging. If the TAI list is not available due to a network failure, the network may perform the paging within all tracking areas served by the MME (see 3GPP TS 36.331 [22] and 3GPP TS 36.413 [23]).


[Nm] {3779} When a UE receives a paging for EPS services using IMSI from the network before a UE initiated EMM specific procedure has been completed, then the UE shall abort the EMM specific procedure and proceed according to the description in this subclause.


[Nm] {3780} Upon reception of a paging for EPS services using IMSI, the UE shall stop timer T3346, if it is running, locally deactivate any EPS bearer context(s), if any, and locally detach from EPS. Additionally the UE shall delete the following parameters: last visited registered TAI, TAI list, GUTI and KSIASME. The UE shall set the EPS update status to EU2 NOT UPDATED and change the state to EMM-DEREGISTERED. The UE shall stop all timers T3396 that are running.


[Nm] {3781} If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a paging for GPRS services using IMSI is received.


[Nm] {3782} After performing the local detach, the UE shall then perform an attach procedure as described in subclause 5.5.1.2. If the UE is operating in CS/PS mode 1 or CS/PS mode 2 of operation, then the UE shall perform a combined attach procedure as described in subclause 5.5.1.3.


[H4] {3783} 5.6.2.3	Paging for CS fallback to A/Gb or Iu mode


[H5] {3784} 5.6.2.3.1	General


[Nm] {3785} The network may initiate the paging procedure for CS fallback when the UE is IMSI attached for non-EPS services (see example in figure 5.6.2.3.1.1).


[Nm] {3786} To initiate the procedure when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]). The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. The paging message includes a UE Paging Identity set to either the UE's S-TMSI or the UE's IMSI, and a CN domain indicator set to "CS" in order to indicate that this is paging for CS fallback.


[Nm] {3787} To notify the UE about an incoming mobile terminating CS service excluding SMS over SGs when a NAS signalling connection exists, the EMM entity in the network shall send a CS SERVICE NOTIFICATION message. This message may also include CS service related parameters (e.g. Calling Line Identification, SS or LCS related parameters).


[Nm] {3788} Upon reception of a paging indication, a UE that is IMSI attached for non-EPS services shall initiate a service request procedure or combined tracking area updating procedure as specified in subclause 5.5.3.3.2. If the paging is received in EMM-IDLE mode, the UE shall respond immediately. If the paging is received as a CS SERVICE NOTIFICATION message in EMM-CONNECTED mode, the UE may request upper layers input i.e. to accept or reject CS fallback before responding with an EXTENDED SERVICE REQUEST. The response is indicated in the CSFB response information element in the EXTENDED SERVICE REQUEST message in both EMM-IDLE and EMM-CONNECTED modes.


[H5] {3789} 5.6.2.3.2	Abnormal cases in the UE


[Nm] {3790} A UE that requested "SMS only" in the combined attach procedure or combined tracking area updating procedure may ignore the CS SERVICE NOTIFICATION message or the paging indication with the CN domain indicator set to "CS".


[H5] {3791} 5.6.2.3.3	Abnormal cases on the network side


[Nm] {3792} The following abnormal case can be identified:


	[B1] {3793} a)	Void


	[B1] {3794} b)	ATTACH REQUEST message received when paging procedure is ongoing.


	[B1] {3795} 	If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed.The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.


	[B1] {3796} c)	TRACKING AREA UPDATE REQUEST message received in response to a CS SERVICE NOTIFICATION message


	[B1] {3797} 	If the network receives a TRACKING AREA UPDATE REQUEST message in response to a CS SERVICE NOTIFICATION message, the network shall progress the tracking area updating procedure.


	[B1] {3798} d)	DETACH REQUEST message received in response to a CS SERVICE NOTIFICATION message


	[B1] {3799} 	If the network receives a DETACH REQUEST message with detach type "IMSI detach" or "combined EPS/IMSI detach" in response to a CS SERVICE NOTIFICATION message, the network shall progress the detach procedure.


[H4] {3800} 5.6.2.4	Paging for SMS


[Nm] {3801} The network shall initiate the paging procedure when it receives an incoming mobile terminating SMS to the UE if the UE is IMSI attached for non-EPS services or for "SMS only", and no NAS signalling connection exists.


[Nm] {3802} The network shall initiate the paging procedure when it receives an incoming mobile terminating SMS to the UE if the UE is attached for EPS services with CIoT EPS optimization and the UE has requested "SMS only", the UE is in NB-S1 mode, and no NAS signalling connection exists.


[Nm] {3803} For the UE using eDRX, the network initiates the paging procedure when an incoming mobile terminating SMS is received within the paging time window. If an incoming mobile terminating SMS is received outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.


[Nm] {3804} To initiate the procedure for SMS when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.413 [23]). The paging message shall include a CN domain indicator set to "PS". If the paging message includes a UE Paging Identity set to the UE's S-TMSI, the paging procedure is performed according to subclause 5.6.2.2.1. If the paging message includes a UE Paging Identity set to the UE's IMSI, the paging procedure is performed according to subclause 5.6.2.2.2. The MME shall not start timers T3413 and T3415 for this procedure.


[Nm] {3805} If the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]).


[H3] {3806} 5.6.3	Transport of NAS messages procedure


[H4] {3807} 5.6.3.1	General


[Nm] {3808} The purpose of the transport of NAS messages procedure is to carry SMS messages in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and non-EPS services or for EPS services and "SMS only", and the UE is in EMM-CONNECTED mode.


[H4] {3809} 5.6.3.2	UE initiated transport of NAS messages


[Nm] {3810} Upon request from the SMS entity to send an SMS message, the EMM entity in the UE initiates the procedure by sending an UPLINK NAS TRANSPORT message including the SMS message in the NAS message container IE.


[H4] {3811} 5.6.3.3	Network initiated transport of NAS messages


[Nm] {3812} The network initiates the procedure by sending a DOWNLINK NAS TRANSPORT message. When receiving the DOWNLINK NAS TRANSPORT message, the EMM entity in the UE shall forward the contents of the NAS message container IE to the SMS entity.


[H4] {3813} 5.6.3.4	Abnormal cases in the UE


[Nm] {3814} The following abnormal case can be identified:


	[B1] {3815} a)	Timer T3346 is running


	[B1] {3816} 	The UE shall not send an UPLINK NAS TRANSPORT message unless:


		[B2] {3817} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3818} -	the UE has a PDN connection for emergency bearer services established; or


		[B2] {3819} -	the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.


	[B1] {3820} -	The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3821} b)	Timer T3447 is running


	[B1] {3822} 	The UE shall not send an UPLINK NAS TRANSPORT message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:


		[B2] {3823} -	the UE is a UE configured to use AC11 – 15 in the selected PLMN; or


		[B2] {3824} -	a network initiated signaling message has been received.


	[B1] {3825} 	The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.


[H4] {3826} 5.6.3.5	Abnormal cases on the network side


[Nm] {3827} The following abnormal case can be identified:


	[B1] {3828} a)	Lower layer indication of non-delivered NAS PDU


	[B1] {3829} 	If the DOWNLINK NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.


[H3] {3830} 5.6.4	Generic transport of NAS messages procedure


[H4] {3831} 5.6.4.1	General


[Nm] {3832} The purpose of the generic transport of NAS messages procedure is to carry protocol messages from various applications (e.g., an LCS application to send an LPP message or a location service message) in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and is in EMM-CONNECTED mode.


[H4] {3833} 5.6.4.2	UE initiated generic transport of NAS messages


[Nm] {3834} Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the UE initiates the procedure by sending an UPLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the UPLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.


[Nm] {3835} The UE shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the UPLINK GENERIC NAS TRANSPORT message, the EMM entity in the MME shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the MME shall also provide the contents of the Additional information IE.


[H4] {3836} 5.6.4.3	Network initiated transport of NAS messages


[Nm] {3837} Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the MME initiates the procedure by sending a DOWNLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the DOWNLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.


[Nm] {3838} The MME shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the DOWNLINK GENERIC NAS TRANSPORT message, the EMM entity in the UE shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the UE shall also provide the contents of the Additional information IE.


[H4] {3839} 5.6.4.4	Abnormal cases in the UE


[Nm] {3840} The following abnormal case can be identified:


	[B1] {3841} a)	Timer T3346 is running


	[B1] {3842} 	The UE shall not send an UPLINK GENERIC NAS TRANSPORT message unless:


		[B2] {3843} 	the UE is a UE configured to use AC11 – 15 in selected PLMN;


		[B2] {3844} -	the UE has a PDN connection for emergency bearer services established; or


		[B2] {3845} 	the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.


	[B1] {3846} The UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.


	[B1] {3847} b)	Timer T3447 is running


	[B1] {3848} 	The UE shall not send an UPLINK GENERIC NAS TRANSPORT message when the UE is in EMM-CONNECTED mode, unless:


		[B2] {3849} -	the UE is a UE configured to use AC11 – 15 in the selected PLMN;


		[B2] {3850} -	the UE has a PDN connection for emergency bearer services established; or


		[B2] {3851} -	a network initiated signaling message has been received.


	[B1] {3852} The UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.


[H4] {3853} 5.6.4.5	Abnormal cases on the network side


[Nm] {3854} The following abnormal case can be identified:


	[B1] {3855} a)	Lower layer indication of non-delivered NAS PDU


	[B1] {3856} 	If the DOWNLINK GENERIC NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.


[H2] {3857} 5.7	Reception of an EMM STATUS message by an EMM entity


[Nm] {3858} The purpose of the sending of the EMM STATUS message is to report at any time certain error conditions detected upon receipt of EMM protocol data. The EMM STATUS message can be sent by both the MME and the UE (see example in figure 5.7.1).


[Nm] {3859} On receipt of an EMM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by the MME or the UE on receipt of an EMM STATUS message are implementation dependent.


[H1] {3860} 6	Elementary procedures for EPS session management


[H2] {3861} 6.1	Overview


[H3] {3862} 6.1.1	General


[Nm] {3863} This clause describes the procedures used for EPS session management (ESM) at the radio interface (reference point "LTE-Uu").


[Nm] {3864} The main function of the ESM sublayer is to support the EPS bearer context handling in the UE and in the MME.


[Nm] {3865} The ESM comprises procedures for:


	[B1] {3866} -	the activation, deactivation and modification of EPS bearer contexts;


	[B1] {3867} -	the request for resources (IP connectivity to a PDN or dedicated bearer resources) by the UE; and


	[B1] {3868} -	the transport of user data via the control plane between the UE and the MME.


[Nm] {3869} Each EPS bearer context represents an EPS bearer between the UE and a PDN. EPS bearer contexts can remain activated even if the radio and S1 bearers constituting the corresponding EPS bearers between UE and MME are temporarily released.


[Nm] {3870} An EPS bearer context can be either a default bearer context or a dedicated bearer context.


[Nm] {3871} A default EPS bearer context is activated when the UE requests a connection to a PDN.


[Nm] {3872} Generally, ESM procedures can be performed only if an EMM context has been established between the UE and the MME, and the secure exchange of NAS messages has been initiated by the MME by use of the EMM procedures described in clause 5. The first default EPS bearer context, however, can be activated during the EPS attach procedure (see subclause 4.2). Once the UE is successfully attached, and the first default EPS bearer context has been activated during or after the attach procedure, the UE can request the MME to set up connections to additional PDNs. For each additional connection, the MME will activate a separate default EPS bearer context. A default EPS bearer context remains activated throughout the lifetime of the connection to the PDN.


[Nm] {3873} A dedicated EPS bearer context is always linked to a default EPS bearer context and represents additional EPS bearer resources between the UE and the PDN. The network can initiate the activation of dedicated EPS bearer contexts together with the activation of the default EPS bearer context or at any time later, as long as the default EPS bearer context remains activated. However, the network shall not initiate a dedicated bearer context activation procedure for established PDN connection(s) of "non IP" PDN type.


[Nm] {3874} Default and dedicated EPS bearer contexts can be modified. Dedicated EPS bearer contexts can be released without affecting the default EPS bearer context. When the default EPS bearer context is released, then all dedicated EPS bearer contexts linked to it are released too.


[Nm] {3875} The UE can request the network to allocate, modify or release EPS bearer resources. The network can fulfil such a request from the UE by activating a new dedicated EPS bearer context, modifying an EPS bearer context or deactivating an EPS bearer context.


[H3] {3876} 6.1.2	Types of ESM procedures


[Nm] {3877} Two types of ESM procedures can be distinguished:


	[B1] {3878} 1)	Procedures related to EPS bearer contexts:


	[B1] {3879} 	These procedures are initiated by the network and are used for the manipulation of EPS bearer contexts:


		[B2] {3880} -	default EPS bearer context activation;


		[B2] {3881} -	dedicated EPS bearer context activation;


		[B2] {3882} -	EPS bearer context modification;


		[B2] {3883} -	EPS bearer context deactivation.


	[B1] {3884} 	This procedure is initiated by the network or by the UE and is used for the transport of user data via the control plane:


		[B2] {3885} -	transport of user data via the control plane procedure.


	[B1] {3886} 2)	Transaction related procedures:


	[B1] {3887} 	These procedures are initiated by the UE to request for resources, i.e. a new PDN connection or dedicated bearer resources, or to release these resources:


		[B2] {3888} -	PDN connectivity procedure;


		[B2] {3889} -	PDN disconnect procedure;


		[B2] {3890} -	bearer resource allocation procedure;


		[B2] {3891} -	bearer resource modification procedure. 


	[B1] {3892} 	This procedure is initiated by the ProSe UE-to-network relay and is used for the manipulation of EPS bearer contexts:


		[B2] {3893} -	remote UE report.


	[B1] {3894} 	When combined with the attach procedure, the PDN connectivity procedure can trigger the network to execute the following transaction related procedure:


		[B2] {3895} -	ESM information request procedure.


	[B1] {3896} 	When combined with the attach procedure, if EMM-REGISTERED without PDN connection is supported by the UE and the network and no PDN connectivity procedure is initiated during the attach procedure, the UE or the network executes the following transaction related procedure:


		[B2] {3897} -	ESM dummy message procedure.


[Nm] {3898} A successful transaction related procedure initiated by the UE triggers the network to execute one of the procedures related to EPS bearer contexts. The UE treats the start of the procedure related to the EPS bearer context as completion of the transaction related procedure.


[Nm] {3899} During procedures related to EPS bearer contexts, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.


[Nm] {3900} Except for the remote UE report procedure and ESM information request procedure, during transaction related procedures, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.


[Nm] {3901} The following ESM procedures can be related to an EPS bearer context or to a procedure transaction:


	[B1] {3902} -	ESM status procedure;


	[B1] {3903} -	notification procedure.


[H3] {3904} 6.1.3	ESM sublayer states


[H4] {3905} 6.1.3.1	General


[Nm] {3906} In this subclause the possible states of EPS bearer contexts in the UE and on the network side are described. Each EPS bearer context is associated with an individual state. 


[H4] {3907} 6.1.3.2	ESM sublayer states in the UE


[H5] {3908} 6.1.3.2.1	BEARER CONTEXT INACTIVE


[Nm] {3909} No EPS bearer context exists.


[H5] {3910} 6.1.3.2.2	BEARER CONTEXT ACTIVE


[Nm] {3911} The EPS bearer context is active in the UE.


[H5] {3912} 6.1.3.2.3	PROCEDURE TRANSACTION INACTIVE


[Nm] {3913} No procedure transaction exists.


[H5] {3914} 6.1.3.2.4	PROCEDURE TRANSACTION PENDING


[Nm] {3915} The UE has initiated a procedure transaction towards the network.


[H4] {3916} 6.1.3.3	ESM sublayer states in the MME


[H5] {3917} 6.1.3.3.1	BEARER CONTEXT INACTIVE


[Nm] {3918} No EPS bearer context exists.


[H5] {3919} 6.1.3.3.2	BEARER CONTEXT ACTIVE PENDING


[Nm] {3920} The network has initiated an EPS bearer context activation towards the UE.


[H5] {3921} 6.1.3.3.3	BEARER CONTEXT ACTIVE


[Nm] {3922} The EPS bearer context is active in the network.


[H5] {3923} 6.1.3.3.4	BEARER CONTEXT INACTIVE PENDING


[Nm] {3924} The network has initiated an EPS bearer context deactivation towards the UE.


[H5] {3925} 6.1.3.3.5	BEARER CONTEXT MODIFY PENDING


[Nm] {3926} The network has initiated an EPS bearer context modification towards the UE.


[H5] {3927} 6.1.3.3.6	PROCEDURE TRANSACTION INACTIVE


[Nm] {3928} No procedure transaction exists.


[H5] {3929} 6.1.3.3.7	PROCEDURE TRANSACTION PENDING


[Nm] {3930} The network has initiated a procedure transaction towards the UE.


[H3] {3931} 6.1.4	Coordination between ESM and SM


[Nm] {3932} For inter-system change from S1 mode to A/Gb mode or Iu mode, SM uses the following parameters from each active EPS bearer context:


	[B1] {3933} -	EPS bearer identity to map to NSAPI;


	[B1] {3934} -	linked EPS bearer identity (if available) to map to linked TI;


	[B1] {3935} -	PDN address and APN of the default EPS bearer context to map to PDP address and APN of the default PDP context;


	[B1] {3936} -	TFT of the default EPS bearer context, if any, to map to the TFT of the default PDP context;


	[B1] {3937} -	TFTs of the dedicated EPS bearer contexts to map to TFTs of the secondary PDP contexts; and


	[B1] {3938} -	GERAN/UTRAN parameters as provided by the MME while on E-UTRAN access, i.e. R99 QoS, LLC SAPI, radio priority, packet flow identifier, transaction identifier and BCM (if available). If the MME also provided an Extended EPS QoS IE, then the bit rates signalled with this IE are also applicable to the R99 QoS.


[Nm] {3939} The MME performs the mapping from EPS to R99 QoS parameters according to 3GPP TS 23.401 [10], annex E.


[Nm] {3940} At inter-system change from S1 mode to A/Gb mode, SM shall not activate the PDP context(s) if SM does not have the following parameters from the active EPS bearer context(s):


	[B1] {3941} -	LLC SAPI;


	[B1] {3942} -	radio priority;


	[B1] {3943} -	transaction identifier; and


	[B1] {3944} -	R99 QoS.


[Nm] {3945} At inter-system change from S1 mode to Iu mode, SM shall not activate the PDP context(s) if SM does not have the following parameter from the active EPS bearer context(s):


	[B1] {3946} -	transaction identifier; and


	[B1] {3947} -	R99 QoS.


[Nm] {3948} For inter-system change from A/Gb mode or Iu mode to S1 mode, ESM uses the following parameters from each active PDP context:


	[B1] {3949} -	NSAPI to map to EPS bearer identity;


	[B1] {3950} -	NSAPI of the default PDP context to map to linked EPS bearer identity;


	[B1] {3951} -	PDP address and APN of the default PDP context to map to PDN address and APN of the default EPS bearer context;


	[B1] {3952} -	TFT of the default PDP context, if any, to map to the TFT of the default EPS bearer context; and


	[B1] {3953} -	TFTs of the secondary PDP contexts to map to the TFTs of the dedicated EPS bearer contexts.


[Nm] {3954} The MME and the UE perform the mapping from R99 to EPS QoS parameters according to 3GPP TS 23.401 [10], annex E. In particular the MME derives the APN-AMBR for the corresponding PDN connection from the MBR of the R99 subscribed QoS profile and the UE maps the MBR of its default PDP context to the APN-AMBR of the corresponding PDN connection.


[H4] {3955} 6.1.4A	Coordination between ESM and 5GSM


[Nm] {3956} See subclause 6.1.4 in 3GPP TS 24.501 [54].


[H3] {3957} 6.1.5	Coordination between ESM and EMM for supporting ISR


[Nm] {3958} The UE with its TIN set as "RATrelated TMSI" for which ISR is activated shall change its TIN to "GUTI" to locally deactivate ISR and stop the periodic routing area update timer T3312 or T3323, if running:


	[B1] {3959} -	upon modification of any EPS bearer context which was activated before the ISR is activated in the UE;


	[B1] {3960} -	at the time when the UE changes from S1 mode to A/Gb mode or Iu mode not due to PS handover procedure (see 3GPP TS 24.008 [13]), if any EPS bearer context activated after the ISR was activated in the UE exists; or


	[B1] {3961} -	upon deactivation of the last non-emergency EPS bearer context in the UE, if the UE has only a PDN connection for emergency bearer services remaining.


[Nm] {3962} ISR remains activated on the network side in the above cases.


[H2] {3963} 6.2	IP address allocation


[H3] {3964} 6.2.1	General


[Nm] {3965} The UE can configure an IPv4 address during the establishment of a default EPS bearer context. The UE can obtain an IPv4 address or an IPv6 prefix or both via an IETF-based IP address allocation mechanism once the default bearer is established.


[Nm] {3966} The following IETF-based IP address/prefix allocation methods are specified for EPS (the corresponding procedures are specified in 3GPP TS 29.061 [16]):


	[B1] {3967} a)	/64 IPv6 default prefix allocation via IPv6 stateless address autoconfiguration. Optionally, allocation of additional IPv6 prefix(es) with length /64 or shorter via stateful DHCPv6 Prefix Delegation (see IETF RFC 3633 [24A]);


	[B1] {3968} b)	IPv4 address allocation and IPv4 parameter configuration via DHCPv4;


	[B1] {3969} c)	IPv6 parameter configuration via stateless DHCPv6.


[Nm] {3970} Upon deactivation of the default bearer of a PDN connection, the UE shall locally release any IPv4 address or IPv6 prefix allocated to the UE for the corresponding PDN connection.


[H3] {3971} 6.2.2	IP address allocation via NAS signalling


[Nm] {3972} The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message, based on its IP stack configuration if it requests IP connectivity (e.g. the per APN settings specified in 3GPP TS 23.401 [10]) as follows:


	[B1] {3973} a)-	A UE, which is IPv6 and IPv4 capable and 


		[B2] {3974} -	has not been allocated an IP address for this APN, shall set the PDN type IE to IPv4v6.


		[B2] {3975} -	has been allocated an IPv4 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv6 address, shall set the PDN type IE to IPv6.


		[B2] {3976} -	has been allocated an IPv6 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv4 address, shall set the PDN type IE to IPv4.


	[B1] {3977} b)	A UE, which is only IPv4 capable, shall set the PDN type IE to IPv4.


	[B1] {3978} c)	A UE, which is only IPv6 capable, shall set the PDN type IE to IPv6.


	[B1] {3979} d)	When the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall set the PDN type IE to IPv4v6.


[Nm] {3980} If the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate that to the network within the Protocol Configuration Options IE in the PDN CONNECTIVITY REQUEST.


[Nm] {3981} If the UE wants to get PDN connectivity for non-IP, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "non IP". If the UE wants to get PDN connectivity for Ethernet, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "Ethernet".


[Nm] {3982} On receipt of the PDN CONNECTIVITY REQUEST message sent by the UE, the network when allocating an IP address shall take into account the PDN type IE, the operator policies of the home and visited network, and the user's subscription data and:


	[B1] {3983} -	if the UE requests for PDN type IPv4v6, but the subscription is limited to IPv4 only or IPv6 only for the requested APN, the network shall override the PDN type requested by the UE to be limited to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:


		[B2] {3984} a)	all EPS bearer contexts to the given APN are deactivated at the UE as a result of:


			[B3] {3985} i)	EPS bearer context synchronization during tracking area updating or service request procedure;


			[B3] {3986} ii)	an EPS bearer context deactivation procedure initiated by the network;


			[B3] {3987} iii)	a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6;


			[B3] {3988} iv)	a detach procedure; or


			[B3] {3989} v)	a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED;


		[B2] {3990} b)	the PDN type which is used to access to the APN is changed;


	[B1] {3991} -	if the UE requests PDN type IPv4v6, but the PDN GW configuration dictates the use of IPv4 addressing only or IPv6 addressing only for this APN, the network shall override the PDN type requested by the UE to limit it to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:


		[B2] {3992} a)	all EPS bearer contexts to the given APN are deactivated at the UE and the network as a result of:


			[B3] {3993} i)	EPS bearer context synchronization during tracking area updating or service request procedure;


			[B3] {3994} ii)	an EPS bearer context deactivation procedure initiated by the network;


			[B3] {3995} iii)	a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6;


			[B3] {3996} iv)	a detach procedure; or


			[B3] {3997} v)	a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED ;


		[B2] {3998} b)	the PDN type which is used to access to the APN is changed;


	[B1] {3999} -	if the UE requests PDN type IPv4v6, but the operator uses single addressing per bearer, e.g. due to interworking with nodes of earlier releases, the network shall override the PDN type requested by the UE to a single IP version only. In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #52 "single address bearers only allowed". The UE should subsequently request another PDN connection for the other IP version using the UE requested PDN connectivity procedure to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated;


	[B1] {4000} -	if the network sets the PDN type to IPv4 or IPv4v6, the network shall include an IPv4 address in the PDN address information. In this case, if the IPv4 address is to be configured using DHCPv4, the network shall set the IPv4 address to 0.0.0.0; and


	[B1] {4001} -	if the network sets the PDN type to IPv6 or IPv4v6, the network shall include the interface identifier that the UE shall use for the link local address in the PDN address information.


[Nm] {4002} The network shall include the PDN type and the PDN address information within the PDN address IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE.


[H2] {4003} 6.2A	IP header compression


[Nm] {4004} The UE and the MME may support robust header compression (ROHC) framework (see IETF RFC 5795 [37]) for IP header compression if control plane CIoT EPS optimization is supported for PDN connections of IP PDN type. If IP header compression for control plane CIoT EPS optimization is supported, the ROHC profiles defined in 3GPP TS 36.323 [38] may be supported. The ROHC configuration is negotiated and established during the UE requested PDN connectivity procedure as specified in subclause 6.5.1. Both the UE and the MME indicate whether IP header compression for control plane CIoT EPS optimization is supported during attach and tracking area updating procedures (see subclauses 5.5.1 and 5.5.3). The ROHC configuration can be re-negotiated by using the UE requested bearer resource modification procedure or the EPS bearer context modification procedure as specified in subclauses 6.4.3 and 6.5.4.


[H2] {4005} 6.3	General on elementary ESM procedures


[H3] {4006} 6.3.1	Services provided by lower layers 


[Nm] {4007} Unless explicitly stated otherwise, the procedures described in the following subclauses can only be executed whilst a NAS signalling exists between the UE and the MME.


[H3] {4008} 6.3.2	Principles of address handling for ESM procedures


[Nm] {4009} Transaction related procedures use the procedure transaction identity as address parameter in the ESM message header. When the UE or the network initiates a transaction related procedure, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned". When the ProSe UE-to-network relay initiates the transaction related procedure remote UE report, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to a valid EPS bearer identity value.


[Nm] {4010} If the response message is again a transaction related message, e.g. a PDN CONNECTIVITY REJECT, PDN DISCONNECT REJECT, BEARER RESOURCE ALLOCATION REJECT, BEARER RESOURCE MODIFICATION REJECT, ESM INFORMATION REQUEST message or ESM DUMMY MESSAGE from the network or an ESM INFORMATION RESPONSE message or ESM DUMMY MESSAGE from the UE, the sending entity shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to "no EPS bearer identity assigned" (see examples in figures 6.3.2.1, 6.3.2.1a and 6.3.2.2). If the response message is the transaction related message REMOTE UE REPORT RESPONSE message from the network, the network shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to the EPS bearer identity value received from the ProSe UE-to-network relay (see example in figure 6.3.2.3).


[Nm] {4011} If an ESM DUMMY MESSAGE is sent in response to a received ESM DUMMY MESSAGE, the sending entity shall include the received procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned".


[Nm] {4012} EPS bearer context related procedures use the EPS bearer identity as address parameter in the ESM message header. When the network initiates an EPS bearer context related procedure, it shall include a valid EPS bearer identity value in the message header. The procedure transaction identity value shall be set as follows:


	[B1] {4013} -	If the EPS bearer context related procedure was triggered by the receipt of a transaction related request message from the UE, the network shall include the procedure transaction identity value received with the transaction related request message in the message header of the EPS bearer context related request message (see example in figure 6.3.2.3).


	[B1] {4014} -	If the procedure was triggered network-internally, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure 6.3.2.4).


	[B1] {4015} -	If the procedure was triggered by the transport of user data via the control plane, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure 6.3.2.5).


[Nm] {4016} In the response message of the EPS bearer context related procedure, the UE shall include the EPS bearer identity value received from the network and set the procedure transaction identity value to "no procedure transaction identity assigned".


[Nm] {4017} When the UE initiates an EPS bearer context related procedure and the procedure was triggered by the transport of user data via the control plane, it shall include a valid EPS bearer identity value and set the procedure transaction identity value to "no procedure transaction identity assigned" in the message header (see example in figure 6.3.2.6).


[H3] {4018} 6.3.3	Abnormal cases in the UE


[Nm] {4019} The following abnormal case can be identified:


	[B1] {4020} a)	ESM uplink message transmission failure indication by lower layers


	[B1] {4021} 	Unless the procedure descriptions in subclause 6.6 specify a different behaviour, the following applies:


		[B2] {4022} 	If lower layers indicate a TAI change, but the current TAI is not in the TAI list, the ESM procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure.


		[B2] {4023} 	If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, it is up to the UE implementation how the ESM procedure is re-initiated.


		[B2] {4024} 	If lower layers indicate the TAI has not changed, it is up to the UE implementation how the ESM procedure is re-initiated.


[Nm] {4025} The case a) above does not apply to the ESM INFORMATION RESPONSE message.


	[B1] {4026} b)	Transmission failure of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message indication from EMM sublayer when the UE received any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure


	[B1] {4027} 	It is up to the UE implementation how the dedicated EPS bearer context activation procedure is re-initiated.


[H3] {4028} 6.3.4	Abnormal cases in the network


[Nm] {4029} The following abnormal case can be identified:


	[B1] {4030} a)	Lower layer indication of non-delivered NAS PDU due to handover 


	[B1] {4031} 	Unless the procedure descriptions in subclause 6.4, 6.5 or 6.6 specify a different behaviour, the following applies:


	[B1] {4032} 	If the downlink ESM NAS message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the ESM message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.


	[B1] {4033} b)	Lower layer indication of non-delivered NAS PDU due to inter-eNodeB connected mode mobility when the transport of user data via the control plane is used 


	[B1] {4034} 	If the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is not changed, then upon successful completion of inter-eNodeB connected mode mobility the MME shall retransmit the ESM message. If a failure of inter-eNodeB connected mode mobility is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.


[H3] {4035} 6.3.5	Handling of APN based congestion control


[Nm] {4036} The network may detect and start performing the APN based congestion control when one or more APN congestion criteria as specified in 3GPP TS 23.401 [10] are met. The network may store an APN congestion back-off time on a per UE and congested APN basis. If the UE does not provide an APN for a non-emergency PDN connection, then the MME uses the APN which is used in PDN GW selection procedure as congested APN. When APN based congestion control is active, the network may reject session management requests except the modification of bearer resources requests from UEs or disconnect existing PDN connections with ESM cause value #26 "insufficient resources".


[Nm] {4037} In the UE, EPS session management timers T3396 for APN based congestion control are started and stopped on a per APN basis. The APN associated with T3396 is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then T3396 is associated with no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The timer T3396 associated with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the timer T3396 associated with no APN is running or deactivated, it does not affect the ability of the UE to request an emergency PDN connection.


[Nm] {4038} If timer T3396 is running or is deactivated, the UE is allowed to indicate change of the 3GPP PS data off UE status, initiate PDN disconnection procedure, initiate bearer resource modification procedure to release of bearer resources for the respective APN, and if the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for the respective APN.


[H3] {4039} 6.3.5A	Handling of group specific session management congestion control


[Nm] {4040} The network may detect and start performing the group specific session management congestion control when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met. When group specific session management congestion control is active, the mechanism for APN based congestion control as specified in subclause 6.3.5 shall be followed.


[H3] {4041} 6.3.6	Handling of network rejection not due to APN based congestion control


[Nm] {4042} The network may include a back-off timer value in an EPS session management reject message to regulate the time interval at which the UE may retry the same procedure. For ESM cause values other than #26 "insufficient resources", the network may also include the re-attempt indicator to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same APN in A/Gb or Iu mode or N1 mode after inter-system change.


[Nm] {4043} If re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall consider the back-off timer to be applicable only to the EPS session management in S1 mode for the rejected EPS session management procedure and the given PLMN and APN combination. If re-attempt in A/Gb and Iu mode and N1 mode is not allowed, the UE shall consider the back-off timer to be applicable to all three NAS protocols, i.e. applicable to the EPS session management in S1 mode for the rejected EPS session management procedure, to the GPRS session management in A/Gb and Iu mode for the corresponding session management procedure and the given PLMN and APN combination and to the 5GS session management in N1 mode for the corresponding session management procedure and the given PLMN and APN combination.


[Nm] {4044} The APN of the PLMN and APN combination associated with the back-off timer is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then the back-off timer is associated with the combination of the PLMN and no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The back-off timer associated with the combination of a PLMN with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the back-off timer associated with the combination of a PLMN with no APN is running, it does not affect the ability of the UE to request an emergency PDN connection.


[Nm] {4045} The network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the EPS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the EPS session management reject message was received.


[Nm] {4046} If the back-off timer is running or is deactivated for a given PLMN and APN combination, and the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for this PLMN and APN combination.


[H3] {4047} 6.3.7	Handling of WLAN offload control


[Nm] {4048} In networks that support offloading of traffic to WLAN, as specified in 3GPP TS 36.331 [22], a permission to offload is determined for the UE and the PDN connection in accordance with 3GPP TS 23.401 [10] subclause 4.3.23.


[H3] {4049} 6.3.8	Handling of serving PLMN rate control


[Nm] {4050} Serving PLMN rate control enables the serving PLMN to protect its MME and the signalling radio bearers in the E-UTRAN from load generated by NAS messages with user data over control plane. The MME can inform the UE of any local serving PLMN rate control during the default EPS bearer context activation procedure (see subclause 6.4.1). If the serving PLMN rate control is enabled, the MME shall start the serving PLMN rate control for the PDN connection when the first NAS message with user data over control plane is received over the PDN connection. The UE shall limit the rate at which it generates uplink NAS messages with user data over control plane to comply with the serving PLMN policy provided by the network. The indicated rate in a NAS procedure applies to the PDN connection the NAS procedure corresponds to, and the indicated rate is valid until the PDN connection is released.


[Nm] {4051} Serving PLMN rate control is applicable for PDN connections established for control plane CIoT EPS optimization only.


[Nm] {4052} Any serving PLMN rate control information provided by the network to the UE is only applicable for the PLMN which provided this information. This serving PLMN rate control information shall be discarded when the UE successfully registers to another PLMN.


[H3] {4053} 6.3.9	Handling of APN rate control


[Nm] {4054} APN rate control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the APN in accordance with 3GPP TS 23.401 [10]. The UE shall limit the rate at which it generates uplink user data messages to comply with the APN rate control policy. The NAS shall provide the indicated rates to upper layers for enforcement. The indicated rates in a NAS procedure applies to the APN the NAS procedure corresponds to, and the indicated rates are valid until a new value is indicated or the last PDN connection using this APN is released.


[Nm] {4055} If the UE supports APN rate control, the UE shall provide the support indication of APN rate control and additional APN rate control for exception data reporting to the network. If the UE indicates support of additional APN rate control for exception data reporting, the network may provide the APN rate control parameters for exception data to the UE. If the UE does not indicate support of additional APN rate control for exception data reporting, the network shall not provide the APN rate control parameters for exception data to the UE.


[Nm] {4056} If an allowed indication of additional exception reports is provided with the APN rate control parameters and:


	[B1] {4057} -	the additional APN rate control parameters for exception data is provided and the limit for additional rate for exception data reporting is not reached; or


	[B1] {4058} -	the additional APN rate control parameters for exception data is not provided,


[Nm] {4059} the UE is allowed to send uplink exception reports even if the limit for the APN rate control has been reached.


[Nm] {4060} Upon inter-system change from S1 mode to N1 mode, the UE shall store the current APN rate control status for each APN associated with PDN connection(s) to be transferred from S1 mode to N1 mode as specified in 3GPP TS 23.501 [58]. 


[Nm] {4061} Upon inter-system change from N1 mode to S1 mode, the UE shall use the stored APN rate control status, if any, to comply with the APN rate control policy for an APN as specified in 3GPP TS 23.501 [58] if:


	[B1] {4062} a)	there is at least one PDN connection associated with this APN was transferred from N1 mode to S1 mode; and


	[B1] {4063} b)	the validity period of the stored APN rate control status has not expired.


[Nm] {4064} After inter-system change from S1 mode to N1 mode, if all the PDU sessions associated with the same APN that was used in S1 mode are released, the UE shall delete the stored APN rate control status for this APN.


[H3] {4065} 6.3.10	Handling of 3GPP PS data off


[Nm] {4066} A UE, which supports 3GPP PS data off (see 3GPP TS 23.401 [10]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP TS 24.368 [15A] or in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17]:


	[B1] {4067} -	a list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN; and


	[B1] {4068} -	a list of 3GPP PS data off exempt services to be used in the VPLMN.


[Nm] {4069} If only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured at the UE, this list shall be also used in the VPLMN.


[Nm] {4070} If the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off UE status in the protocol configuration options IE during attach, UE-requested PDN connectivity, and UE-requested bearer resource modification procedure (see subclause 5.5.1, 6.5.1, and 6.5.4).


[Nm] {4071} The network informs the UE about the support of 3GPP PS data off during the activation of the default bearer of a PDN connection (see subclause 6.4.1). If 3GPP PS data off support is not indicated in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall not indicate any change of 3GPP PS data off UE status for the PDN connection established by the default EPS bearer context activation procedure; otherwise the UE shall indicate change of the 3GPP PS data off UE status for the PDN connection by using the UE-requested bearer resource modification procedure as specified in subclause 6.5.4. If the network does not provide indication of support of 3GPP PS data off during default EPS bearer context activation procedure of the PDN connection, the UE behaviour for non-exempt service requests from the network is implementation dependent.


[Nm] {4072} When the 3GPP PS data off UE status is "activated":


	[B1] {4073} a)	the UE does not send uplink IP packets except:


		[B2] {4074} -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN as specified in 3GPP TS 24.368 [15A] when the UE is in its HPLMN or EHPLMN;


		[B2] {4075} -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured to the UE as specified in 3GPP TS 24.368 [15A];


		[B2] {4076} -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP TS 24.368 [15A];


		[B2] {4077} -	for those services indicated in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17];


		[B2] {4078} -	any uplink traffic due to procedures specified in 3GPP TS 24.229 [13D]; and


		[B2] {4079} -	any uplink traffic due to procedures specified in 3GPP TS 24.623 [50]; and


	[B1] {4080} b)	the UE does not send uplink non-IP or Ethernet user data packets.


[Nm] {4081} Otherwise the UE sends uplink user data packets without restriction.


[H3] {4082} 6.3.11	Handling of Reliable Data Service


[Nm] {4083} If the UE supports Reliable Data Service (see 3GPP TS 24.250 [51]), the UE may request data transfer using Reliable Data Service for a PDN connection in the extended protocol configuration options IE during attach and UE-requested PDN connectivity procedures (see subclause 5.5.1 and 6.5.1).


[Nm] {4084} The Reliable Data Service may only be used with PDN connections for which the "Control plane only" indicator is set or with PDN connections using the control plane CIoT EPS optimization when the MME does not move such PDN connections to the user plane.


[Nm] {4085} The SCEF or P-GW shall inform the UE about the acceptance of UE's request for Reliable Data Service usage during the activation of the default bearer of a PDN connection (see subclause 6.4.1) in the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.


[Nm] {4086} If the SCEF or P-GW accepts the use of Reliable Data Service to transfer data for the specified PDN connection, the UE shall use this PDN connection exclusively for data transfer using Reliable Data Service; otherwise the UE shall not use this PDN connection for data transfer using Reliable Data Service.


[H3] {4087} 6.3.12	Handling of Ethernet PDN type


[Nm] {4088} A UE may support the Ethernet PDN type. A network may support the Ethernet PDN type.


[H2] {4089} 6.4	Network initiated ESM procedures


[H3] {4090} 6.4.1	Default EPS bearer context activation procedure


[H4] {4091} 6.4.1.1	General


[Nm] {4092} The purpose of the default bearer context activation procedure is to establish a default EPS bearer context between the UE and the EPC. The default EPS bearer context activation procedure is initiated by the network as a response to the PDN CONNECTIVITY REQUEST message from the UE. The default bearer context activation procedure can be part of the attach procedure, and if the attach procedure fails, the UE shall consider that the default bearer activation has implicitly failed. The default EPS bearer context does not have any TFT assigned during the activation procedure. This corresponds to using a match-all packet filter. The network may at anytime after the establishment of this bearer assign a TFT to the default EPS bearer and may subsequently modify the TFT or the packet filters of this default bearer.


[H4] {4093} 6.4.1.2	Default EPS bearer context activation initiated by the network


[Nm] {4094} The MME shall initiate the default bearer context activation procedure by sending an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.1.2.1). When the default bearer is activated as part of the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message together with ATTACH ACCEPT and shall not start the timer T3485. When the default bearer is activated as the response to a stand-alone PDN CONNECTIVITY REQUEST message apart from the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message alone, and start the timer T3485.


[Nm] {4095} The MME shall assign and include an EPS bearer identity in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message selecting a value as specified by subclause 9.3.2. The MME shall retrieve the PTI from the PDN CONNECTIVITY REQUEST message and include it in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Both the network identifier part and the operator identifier part shall be included in the Access Point Name IE.


[H4] {4096} 6.4.1.3	Default EPS bearer context activation accepted by the UE


[Nm] {4097} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message was received in response to a request for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then send an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. When the default bearer is activated as part of the attach procedure, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message together with ATTACH COMPLETE message. When the default bearer is activated as the response to the stand-alone PDN CONNECTIVITY REQUEST message, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message alone.


[Nm] {4098} If a WLAN offload indication information element is included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.


[Nm] {4099} The UE checks the PTI in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to identify the UE requested PDN connectivity procedure to which the default bearer context activation is related (see subclause 6.5.1).


[Nm] {4100} If the UE receives a serving PLMN rate control IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the serving PLMN rate control IE value and use the stored serving PLMN rate control value as the maximum allowed limit of uplink User data container IEs included in ESM DATA TRANSPORT messages for the corresponding PDN connection in accordance with 3GPP TS 23.401 [10].


[Nm] {4101} If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.


[Nm] {4102} If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.


[Nm] {4103} If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58].


[Nm] {4104} If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58].


[Nm] {4105} If the UE receives non-IP Link MTU parameter, Ethernet Frame Payload MTU parameter, or IPv4 Link MTU parameter of the protocol configuration options IE or of the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass the received Non-IP Link MTU, Ethernet Frame Payload MTU size, or IPv4 Link MTU to the upper layer.


[Nm] {4106} Upon receiving the DNS server security information, the UE shall pass it to the upper layer. The UE shall use this information to send the DNS over (D)TLS (See 3GPP TS 33.501 [24]).


[Nm] {4107} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT ACTIVE and stop the timer T3485, if the timer is running. If the PDN CONNECTIVITY REQUEST message included a low priority indicator set to "MS is configured for NAS signalling low priority", the MME shall store the NAS signalling low priority indication within the default EPS bearer context.


[H4] {4108} 6.4.1.4	Default EPS bearer context activation not accepted by the UE


[Nm] {4109} If the default EPS bearer context activation is part of the attach procedure, the ESM sublayer shall notify the EMM sublayer of an ESM failure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the ESM sublayer shall additionally provide an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message to the EMM sublayer.


[Nm] {4110} If the default EPS bearer context activation is not part of the attach procedure, the UE shall send an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message and enter the state BEARER CONTEXT INACTIVE.


[Nm] {4111} The ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following cause values:


	[B1] {4112} #26:	insufficient resources;


	[B1] {4113} #31:	request rejected, unspecified; or


	[B1] {4114} #95 – 111:	protocol errors.


[Nm] {4115} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3485, if the timer is running.


[H4] {4116} 6.4.1.5	Abnormal cases in the UE


[Nm] {4117} The following abnormal cases can be identified:


	[B1] {4118} a)	Default EPS bearer context activation request for an already activated default EPS bearer context:


	[B1] {4119} 	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested default EPS bearer context activation.


	[B1] {4120} b)	Default EPS bearer context activation request for an already activated dedicated EPS bearer context:


	[B1] {4121} 	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested default EPS bearer context activation.


[H4] {4122} 6.4.1.6	Abnormal cases on the network side


[Nm] {4123} The following abnormal cases can be identified:


	[B1] {4124} a)	Expiry of timer T3485:


	[B1] {4125} 	On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall release possibly allocated resources for this activation and shall abort the procedure.


	[B1] {4126} b)	Lower layer indicates that the HeNB rejected the establishment of the default bearer (see 3GPP TS 36.413 [23]) for a LIPA PDN connection or SIPTO at the local network PDN connection due to a triggered handover:


	[B1] {4127} 	The MME shall enter the state BEARER CONTEXT INACTIVE,stop timer T3485 and reject the PDN connectivity request procedure including the ESM cause value #34 "service option temporarily out of order" in the PDN CONNECTIVITY REJECT message. The MME shall release possibly allocated resources for this activation.


[H3] {4128} 6.4.2	Dedicated EPS bearer context activation procedure


[H4] {4129} 6.4.2.1	General


[Nm] {4130} The purpose of the dedicated EPS bearer context activation procedure is to establish an EPS bearer context with specific QoS and TFT between the UE and the EPC.


[Nm] {4131} In WB-S1 mode, the dedicated EPS bearer context activation procedure is initiated by the network, but may be requested by the UE by means of the UE requested bearer resource allocation procedure (see subclause 6.5.3) or the UE requested bearer resource modification procedure (see subclause 6.5.4). The dedicated bearer context activation procedure can be part of the attach procedure or be initiated together with the default EPS bearer context activation procedure when the UE initiated stand-alone PDN connectivity procedure. If the attach procedure or the default EPS bearer context activation procedure fails, the UE shall consider that the dedicated bearer activation has implicitly failed. The network may initiate the dedicated EPS bearer context activation procedure together with the completion of the service request procedure.


[Nm] {4132} In NB-S1 mode, the dedicated EPS bearer contexts activation procedure is not used. 


[Nm] {4133} Upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode, if the UE has at least one dedicated EPS bearer context in ESM state BEARER CONTEXT ACTIVE, the UE shall locally deactivate any such dedicated EPS bearer context and shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message.


[Nm] {4134} Upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, the UE shall set each mapped dedicated EPS bearer context, if any, to ESM state BEARER CONTEXT INACTIVE and shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.


[H4] {4135} 6.4.2.2	Dedicated EPS bearer context activation initiated by the network


[Nm] {4136} In WB-S1 mode, the MME shall initiate the dedicated bearer context activation procedure by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, start the timer T3485, and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.2.2.1).


[Nm] {4137} The MME allocates the EPS bearer identity selecting a value as specified by subclause 9.3.2, and includes it in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The MME shall include the EPS bearer identity of the associated default bearer as the linked EPS bearer identity in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.


[H4] {4138} 6.4.2.3	Dedicated EPS bearer context activation accepted by the UE


[Nm] {4139} Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use, send an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. The ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message shall include the EPS bearer identity.


[Nm] {4140} The linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message indicates to the UE to which default bearer, IP address and PDN the dedicated bearer is linked.


[Nm] {4141} If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the dedicated bearer context activation is related.


[Nm] {4142} If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.


[Nm] {4143} The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer.


[Nm] {4144} The UE shall treat any packet filter without explicit direction as being bi-directional.


[Nm] {4145} If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.


[Nm] {4146} If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value. 


[Nm] {4147} If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.


[Nm] {4148} If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.


[Nm] {4149} If the UE receives QoS rule(s) of the 5GS QoS flow(s), which corresponds to the dedicated EPS bearer being activated, in the protocol configuration options IE or the extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE stores the QoS rule(s) for use during inter-system change from S1 mode to N1 mode.


[Nm] {4150} Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timerT3485 and enter the state BEARER CONTEXT ACTIVE.


[H4] {4151} 6.4.2.4	Dedicated EPS bearer context activation not accepted by the UE


[Nm] {4152} Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the dedicated EPS bearer context activation request.


[Nm] {4153} The ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:


	[B1] {4154} #26:	insufficient resources;


	[B1] {4155} #31:	request rejected, unspecified;


	[B1] {4156} #41:	semantic error in the TFT operation;


	[B1] {4157} #42:	syntactical error in the TFT operation;


	[B1] {4158} #43:	invalid EPS bearer identity;


	[B1] {4159} #44:	semantic error(s) in packet filter(s);


	[B1] {4160} #45:	syntactical error(s) in packet filter(s); or


	[B1] {4161} #95 – 111:	protocol errors.


[Nm] {4162} The UE shall check the TFT in the request message for different types of TFT IE errors as follows:


	[B1] {4163} a)	Semantic errors in TFT operations:


		[B2] {4164} 1)	When the TFT operation is an operation other than "Create a new TFT"


	[B1] {4165} 	The UE shall reject the activation request with ESM cause #41 "semantic error in the TFT operation".


	[B1] {4166} b)	Syntactical errors in TFT operations:


		[B2] {4167} 1)	When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.


		[B2] {4168} 2)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.


	[B1] {4169} 	The UE shall reject the activation request with ESM cause #42 "syntactical error in the TFT operation".


	[B1] {4170} c)	Semantic errors in packet filters:


		[B2] {4171} 1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.


		[B2] {4172} 2)	When the resulting TFT does not contain any packet filter which applicable for the uplink direction.


	[B1] {4173} 	The UE shall reject the activation request with ESM cause #44 "semantic errors in packet filter(s)".


	[B1] {4174} d)	Syntactical errors in packet filters:


		[B2] {4175} 1)	When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.


		[B2] {4176} 2)	When the TFT operation = "Create a new TFT" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values.


		[B2] {4177} 3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier. 


	[B1] {4178} 	In case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new activation request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, by means of explicit peer-to-peer signalling between the network and the UE, the UE shall perform a UE requested bearer resource modification procedure to deactivate the EPS bearer context(s) for which it has deleted the packet filters.


	[B1] {4179} 	In case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.


	[B1] {4180} 	In cases 1 and 3 the UE shall reject the activation request with ESM cause #45 "syntactical errors in packet filter(s)".


[Nm] {4181} Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message in state BEARER CONTEXT ACTIVE PENDING, the MME shall stop the timer T3485, enter the state BEARER CONTEXT INACTIVE and abort the dedicated EPS bearer context activation procedure. The MME also requests the lower layer to release the radio resources that were established during the dedicated EPS bearer context activation procedure.


[H4] {4182} 6.4.2.5	Abnormal cases in the UE


[Nm] {4183} The following abnormal cases can be identified:


	[B1] {4184} a)	Dedicated EPS bearer context activation request for an already activated default EPS bearer context:


	[B1] {4185} 	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested dedicated EPS bearer context activation.


	[B1] {4186} b)	Dedicated EPS bearer context activation request for an already activated dedicated EPS bearer context


	[B1] {4187} 	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested dedicated EPS bearer context activation.


	[B1] {4188} c)	No default EPS bearer context with linked EPS bearer identity activated


	[B1] {4189} 	If the linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message does not match the EPS bearer identity of any activated default EPS bearer context, the UE shall reply with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity".


	[B1] {4190} d)	Dedicated EPS bearer context activation request when the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE:


	[B1] {4191} 	If the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE and the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall clear the determination representing the PLMN's maximum number of EPS bearer contexts in S1 mode and proceed with the dedicated EPS bearer context activation procedure.


[H4] {4192} 6.4.2.6	Abnormal cases on the network side


[Nm] {4193} The following abnormal cases can be identified:


	[B1] {4194} a)	Expiry of timer T3485:


	[B1] {4195} 	On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall abort the procedure, release any resources allocated for this activation and enter the state BEARER CONTEXT INACTIVE.


	[B1] {4196} b)	Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:


	[B1] {4197} 	When the MME receives a PDN DISCONNECT REQUEST message during the dedicated EPS bearer context activation procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the dedicated bearer context activation procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.


[H3] {4198} 6.4.3	EPS bearer context modification procedure


[H4] {4199} 6.4.3.1	General


[Nm] {4200} The purpose of the EPS bearer context modification procedure is to modify an EPS bearer context with a specific QoS and TFT, or re-negotiate header compression configuration associated to an EPS bearer context. The EPS bearer context modification procedure is initiated by the network, but it may also be initiated as part of the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure.


[Nm] {4201} The network may also initiate the EPS bearer context modification procedure to update the APN-AMBR of the UE, for instance after an inter-system handover. See 3GPP TS 23.401 [10] annex E.


[Nm] {4202} The MME may also initiate the EPS bearer context modification procedure to update the WLAN offload indication to the UE, for instance after the MME received an updated WLAN offload indication of a PDN Connection from HSS. See 3GPP TS 23.401 [10] subclause 4.3.23.


[Nm] {4203} The MME may also initiate the EPS bearer context modification procedure to update information required for inter-system change from S1 mode to N1 mode (e.g. session-AMBR, QoS rule(s)). See 3GPP TS 24.501 [54].


[Nm] {4204} The network may initiate the EPS bearer context modification procedure together with the completion of the service request procedure.


[H4] {4205} 6.4.3.2	EPS bearer context modification initiated by the network


[Nm] {4206} The MME shall initiate the EPS bearer context modification procedure by sending a MODIFY EPS BEARER CONTEXT REQUEST message to the UE, starting the timer T3486, and entering the state BEARER CONTEXT MODIFY PENDING (see example in figure 6.4.3.2.1).


[Nm] {4207} The MME shall include an EPS bearer identity that identifies the EPS bearer context to be modified in the MODIFY EPS BEARER CONTEXT REQUEST message.


[Nm] {4208} If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the MODIFY EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.


[Nm] {4209} If the UE indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the UE network capability IE in the latest ATTACH REQUEST message or the TRACKING AREA UPDATE REQUEST message, and the MME supports Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization, the MME may include the Header compression configuration IE in the MODIFY EPS BEARER CONTEXT REQUEST message to re-negotiate header compression configuration associated to an EPS bearer context.


[H4] {4210} 6.4.3.3	EPS bearer context modification accepted by the UE


[Nm] {4211} Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the MODIFY EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use and send a MODIFY EPS BEARER CONTEXT ACCEPT message to the MME.


[Nm] {4212} If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the EPS bearer context modification is related (see subclause 6.5.3 and subclause 6.5.4).


[Nm] {4213} If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.


[Nm] {4214} If the EPS bearer context that is modified is a GBR bearer and the MODIFY EPS BEARER CONTEXT REQUEST message does not contain the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) values for uplink and downlink, the UE shall continue to use the previously received values for the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) for the corresponding bearer.


[Nm] {4215} The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer if the TFT contains packet filters for the uplink direction.


[Nm] {4216} If a WLAN offload indication information element is included in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.


[Nm] {4217} If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.


[Nm] {4218} If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.


[Nm] {4219} If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.


[Nm] {4220} If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.


[Nm] {4221} Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s) in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.


[Nm] {4222} Upon receipt of the MODIFY EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timer T3486 and enter the state BEARER CONTEXT ACTIVE.


[H4] {4223} 6.4.3.4	EPS bearer context modification not accepted by the UE


[Nm] {4224} Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending a MODIFY EPS BEARER CONTEXT REJECT message to the MME. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the EPS bearer context modification request.


[Nm] {4225} The MODIFY EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:


	[B1] {4226} #26:	insufficient resources;


	[B1] {4227} #41:	semantic error in the TFT operation;


	[B1] {4228} #42:	syntactical error in the TFT operation;


	[B1] {4229} #43:	invalid EPS bearer identity;


	[B1] {4230} #44:	semantic error(s) in packet filter(s);


	[B1] {4231} #45:	syntactical error(s) in packet filter(s); or


	[B1] {4232} #95 – 111:	protocol errors.


[Nm] {4233} The UE shall check the TFT in the request message for different types of TFT IE errors as follows:


	[B1] {4234} a)	Semantic errors in TFT operations:


		[B2] {4235} 1)	TFT operation = "Create a new TFT" when there is already an existing TFT for the EPS bearer context.


		[B2] {4236} 2)	When the TFT operation is an operation other than "Create a new TFT", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.


		[B2] {4237} 3)	TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.


		[B2] {4238} 4)	TFT operation = "Delete existing TFT" for a dedicated EPS bearer context.


	[B1] {4239} 	In case 4 the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".


	[B1] {4240} 	In the other cases the UE shall not diagnose an error and perform the following actions to resolve the inconsistency:


	[B1] {4241} 	In case 1 the UE shall further process the new activation request to create a new TFT and, if it was processed successfully, delete the old TFT.


	[B1] {4242} 	In case 2 the UE shall:


		[B2] {4243} -	process the new request and if the TFT operation is "Delete existing TFT" or "Delete packet filters from existing TFT", and if no error according to items b, c, and d was detected, consider the TFT as successfully deleted;


		[B2] {4244} -	process the new request as an activation request, if the TFT operation is "Add packet filters in existing TFT" or "Replace packet filters in existing TFT".


	[B1] {4245} 	In case 3, if the packet filters belong to a dedicated EPS bearer context, the UE shall process the new deletion request and, if no error according to items b, c, and d was detected, the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".


	[B1] {4246} 	In case 3, if the packet filters belong to the default EPS bearer context, the UE shall process the new deletion request and if no error according to items b, c, and d was detected then delete the existing TFT, this corresponds to using match-all packet filter for the default EPS bearer context.


	[B1] {4247} b)	Syntactical errors in TFT operations:


		[B2] {4248} 1)	When the TFT operation = "Create a new TFT", "Add packet filters in existing TFT", "Replace packet filters in existing TFT" or "Delete packet filters from existing TFT" and the packet filter list in the TFT IE is empty.


		[B2] {4249} 2)	TFT operation = "Delete existing TFT" or "No TFT operation" with a non-empty packet filter list in the TFT IE.


		[B2] {4250} 3)	TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.


		[B2] {4251} 4)	TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.


		[B2] {4252} 5)	Void.


		[B2] {4253} 6)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.


	[B1] {4254} 	In case 3 the UE shall not diagnose an error, further process the replace request and, if no error according to items c and d was detected, include the packet filters received to the existing TFT.


	[B1] {4255} 	In case 4 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.


	[B1] {4256} 	Otherwise the UE shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".


	[B1] {4257} c)	Semantic errors in packet filters:


		[B2] {4258} 1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.


		[B2] {4259} 2)	When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network.


	[B1] {4260} 	The UE shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".


	[B1] {4261} d)	Syntactical errors in packet filters:


		[B2] {4262} 1)	When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT", or "Replace packet filters in existing TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.


		[B2] {4263} 2)	When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT" or "Replace packet filters in existing TFT", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values.


		[B2] {4264} 3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.


	[B1] {4265} 	In case 1, if two or more packet filters with identical packet filter identifiers are contained in the new request, the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". Otherwise, the UE shall not diagnose an error, further process the new request and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.


	[B1] {4266} 	In case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the UE shall perform a UE requested bearer resource modification request procedure to delete the corresponding packet filters for which it has deleted.


	[B1] {4267} 	In case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.


	[B1] {4268} 	Otherwise the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".


[Nm] {4269} Upon receipt of the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause value other than #43 "invalid EPS bearer identity" in state BEARER CONTEXT MODIFY PENDING, the MME shall stop the timer T3486, enter the state BEARER CONTEXT ACTIVE and abort the EPS bearer context modification procedure. If the network receives the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity", the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling. When the MME detects that after the failed EPS bearer context modification there is a misalignment between the EPS bearer configuration and the EPS bearer context configuration or between the QoS on NAS and AS level, the MME should initiate the necessary procedures to achieve a re-alignment.


[H4] {4270} 6.4.3.5	Abnormal cases in the UE


[Nm] {4271} Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.


[H4] {4272} 6.4.3.6	Abnormal cases on the network side


[Nm] {4273} The following abnormal cases can be identified:


	[B1] {4274} a)	Expiry of timer T3486:


	[B1] {4275} 	On the first expiry of the timer T3486, the MME shall resend the MODIFY EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3486. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3486, the MME shall abort the procedure and enter the state BEARER CONTEXT ACTIVE.


	[B1] {4276} 	The MME may continue to use the previous configuration of the EPS bearer context or initiate an EPS bearer context deactivation procedure.


	[B1] {4277} b)	Collision of UE requested PDN disconnect procedure and EPS bearer context modification:


	[B1] {4278} 	When the MME receives a PDN DISCONNECT REQUEST message during an EPS bearer context modification procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the EPS bearer context modification procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.


[H3] {4279} 6.4.4	EPS bearer context deactivation procedure


[H4] {4280} 6.4.4.1	General


[Nm] {4281} The purpose of the EPS bearer context deactivation procedure is to deactivate an EPS bearer context or disconnect from a PDN by deactivating all EPS bearer contexts to the PDN. The EPS bearer context deactivation procedure is initiated by the network, and it may be triggered by the UE by means of the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure.


[Nm] {4282} In the case of EPS bearer context deactivation with reactivation requested for a PDN connection, if no NAS signalling connection exists, the MME follows the procedures for re-establishing the NAS signalling connection and deactivating the EPS bearer contexts to the PDN with reactivation requested, as specified in 3GPP TS 23.401 [10] subclauses 5.4.4.1 and 5.10.3 and 3GPP TS 23.380 [33] subclause 5.4.2.1.


[Nm] {4283} If a UE is receiving emergency bearer services from a CSG cell, and the CSG subscription expires or is removed, the MME shall deactivate all non-emergency EPS bearers if any. The MME shall not deactivate the emergency EPS bearers.


[Nm] {4284} If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall send a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE for all bearers that are not allocated for emergency services.


[H4] {4285} 6.4.4.2	EPS bearer context deactivation initiated by the network


[Nm] {4286} If a NAS signalling connection exists when the MME initiates the EPS bearer context deactivation procedure, the MME shall initiate the EPS bearer context deactivation procedure by sending a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE, start the timer T3495, and enter the state BEARER CONTEXT INACTIVE PENDING (see example in figure 6.4.4.2.1). The DEACTIVATE EPS BEARER CONTEXT REQUEST message contains an ESM cause typically indicating one of the following:


	[B1] {4287} #8:	operator determined barring;


	[B1] {4288} #26:	insufficient resources;


	[B1] {4289} #29:	user authentication or authorization failed;


	[B1] {4290} #36:	regular deactivation;


	[B1] {4291} #38:	network failure;


	[B1] {4292} #39:	reactivation requested;


	[B1] {4293} #112:	APN restriction value incompatible with active EPS bearer context; or


	[B1] {4294} #113:	Multiple accesses to a PDN connection not allowed.


[Nm] {4295} If the deactivation is triggered by a UE initiated bearer resource modification procedure or UE requested PDN disconnect procedure, the DEACTIVATE EPS BEARER CONTEXT REQUEST message shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE MODIFICATION REQUEST or PDN DISCONNECT REQUEST respectively.


[Nm] {4296} When the MME wants to deactivate all EPS bearer contexts of a PDN connection and thus disconnect the UE from the PDN, the MME shall include the EPS bearer identity of the default bearer associated to the PDN in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. In this case, the MME shall not include the WLAN offload indication in the DEACTIVATE EPS BEARER CONTEXT REQUEST message, and if the UE receives the WLAN offload indication, the UE shall ignore the indication.


[Nm] {4297} If no NAS signalling connection exists when the MME initiates the EPS bearer context deactivation, the ESM entity in the MME shall locally deactivate the EPS bearer context towards the UE without any peer-to-peer ESM signalling between the MME and the UE.


[H4] {4298} 6.4.4.3	EPS bearer context deactivation accepted by the UE


[Nm] {4299} Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message, the UE shall delete the EPS bearer context identified by the EPS bearer identity. After deactivating the identified EPS bearer context, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.


[Nm] {4300} If the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST is that of the default bearer to a PDN, the UE shall delete all EPS bearer contexts associated to the PDN. After deactivating all EPS bearer contexts, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.


[Nm] {4301} Upon sending the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the UE shall enter the state BEARER CONTEXT INACTIVE. If due to the EPS bearer context deactivation only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.


[Nm] {4302} If the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 "reactivation requested" and the EPS bearer context is a default EPS bearer context, and the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. The UE should then re-initiate the UE requested PDN connectivity procedure for the same APN as the deactivated default EPS bearer context to reactivate the EPS bearer context. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running, and should re-initiate the UE requested PDN connectivity procedure without including an APN. Additionally, the UE should re-initiate the request(s) for dedicated bearer resources that have been activated on request of the UE and released as a result of this EPS bearer context deactivation procedure. If the DEACTIVATE EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. The UE should then re-initiate the UE requested PDN connectivity procedure for the emergency PDN connection.


[Nm] {4303} If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure to which the EPS bearer context deactivation is related (see subclause 6.5.4).


[Nm] {4304} If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE shall release the traffic flow aggregate description associated to the PTI value provided.


[Nm] {4305} If the ESM cause value is #26 "insufficient resources", the network may include a value for timer T3396 in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. The UE shall take different actions depending on the timer value received for timer T3396 (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):


	[B1] {4306} i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall start timer T3396 with received value and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or the timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


	[B1] {4307} ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE , until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; and


	[B1] {4308} iii)	if the timer value indicates zero, the UE:


		[B2] {4309} -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and


		[B2] {4310} -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.


[Nm] {4311} If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.


[Nm] {4312} If the UE is switched off when the timer T3396 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:


	[B1] {4313} -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;


	[B1] {4314} -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and


	[B1] {4315} -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


[Nm] {4316} If the T3396 IE is not included, the UE shall proceed with deactivation procedure and then send DEACTIVATE EPS BEARER CONTEXT ACCEPT message.


[Nm] {4317} Upon receipt of the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3495.


[H4] {4318} 6.4.4.4	Abnormal cases in the UE


[Nm] {4319} The following abnormal case can be identified:


	[B1] {4320} a)	UE is requested to deactivate a default EPS bearer context of the last PDN connection:


	[B1] {4321} 	If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the UE determines that the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer of the last PDN connection that the UE has, then the UE shall respond by performing a detach procedure. Additionally, the UE should perform an attach procedure.


	[B1] {4322} 	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall proceed with the deactivation procedure as specified in subclause 6.4.4.3.


[H4] {4323} 6.4.4.5	Abnormal cases on the network side


[Nm] {4324} The following abnormal cases can be identified:


	[B1] {4325} a)	Expiry of timer T3495:


	[B1] {4326} 	On the first expiry of the timer T3495, the MME shall resend the DEACTIVATE EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3495. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3495, the MME shall abort the procedure and deactivate the EPS bearer context locally without any peer-to-peer ESM signalling between the MME and the UE.


	[B1] {4327} b)	Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation:


	[B1] {4328} 	When the MME receives a PDN DISCONNECT REQUEST message during the EPS bearer context deactivation procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the MME shall proceed with both procedures. If the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer, the MME shall proceed with the EPS bearer context deactivation procedure.


[H4] {4329} 6.4.4.6	Local EPS bearer context deactivation without NAS signalling


[Nm] {4330} The UE and the MME deactivate EPS bearer contexts locally without peer-to-peer ESM signalling:


	[B1] {4331} 1)	during the service request procedure, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts, e.g. due to radio access control (see subclause 5.6.1.4 for details); 


	[B1] {4332} 1a)	during the resume of NAS signalling connection procedure as specified in subclause 5.3.1.3, if one or more but not all the suspended user plane radio bearers are resumed;


	[B1] {4333} 2)	during the tracking area updating procedure but the network established the user plane radio bearers due to downlink pending data, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts indicated active by both UE and network;


	[B1] {4334} 3)	during handover, if the target E-UTRAN does not establish all the user plane radio bearers for the UE;


	[B1] {4335} 4)	if the E-UTRAN releases one or more user plane radio bearers but not all the user plane radio bearers of the UE due to E-UTRAN specific reasons; or


	[B1] {4336} 5)	if triggered by an NBIFOM procedure (see 3GPP TS 24.161 [36]), for an NBIFOM multi-access PDN connection.


[Nm] {4337} For cases 1) to 4), based on the indication from the lower layers, the UE and the MME shall locally deactivate the EPS bearer contexts for which no user plane radio bearers are set up.


[Nm] {4338} If due to any of the cases described above the UE locally deactivates a default EPS bearer context, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context.


[Nm] {4339} If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall perform a local detach and enter state EMM-DEREGISTERED. If this occurs during a service request procedure for CS fallback, the UE shall reselect to GERAN or UTRAN and continue with the CS service, otherwise the UE shall initiate an attach procedure.


[Nm] {4340} If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter state EMM-REGISTERED.


[Nm] {4341} If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.


[Nm] {4342} The MME shall deactivate the GBR EPS bearer contexts locally without peer-to-peer ESM signalling, when the MME performs locally the release of the S1AP signalling connection due to the S1AP signalling connection is lost. All non-GBR EPS bearers established are preserved in the MME and in the PDN GW.


[Nm] {4343} If the EUTRAN requests the MME to release the S1AP signalling connection, the MME shall deactivate or preserve the GBR EPS bearer contexts according to 3GPP TS 23.401 [10], subclause 5.3.5. All non-GBR EPS bearer contexts established are preserved in the MME and in the PDN GW.


[Nm] {4344} If due to any of the cases described above the MME locally deactivates a default EPS bearer context, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.


[Nm] {4345} If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME shall perform a local detach and enter state EMM-DEREGISTERED.


[Nm] {4346} If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall enter state EMM-REGISTERED.


[Nm] {4347} For EPS bearer context deactivation procedure initiated by the network, if no NAS signalling connection exists, the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling In the case of reactivation requested, the MME can perform this local deactivation only when the EMM-entity in the network was unable to re-establish the NAS signalling connection. The EPS bearer context deactivation procedure is not initiated by the network when the MME disconnects the UE from the last remaining PDN to which it is connected and EMM-REGISTERED without PDN connection is not supported by the UE or the MME. In this case, the MME initiates a network initiated detach procedure.


[Nm] {4348} If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established for the UE, the MME shall consider the UE to be attached for emergency bearer services only.


[H2] {4349} 6.5	UE requested ESM procedures


[H3] {4350} 6.5.0	General


[Nm] {4351} The UE's maximum number of active EPS bearer contexts in a PLMN is determined by whichever is the lowest of the maximum number of EPS bearer identities allowed by the protocol (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5), the PLMN's maximum number of EPS bearer contexts in S1 mode and the UE's implementation-specific maximum number of EPS bearer contexts.


[Nm] {4352} In earlier versions of the protocol, the maximum number of simultaneously active EPS bearer contexts was limited by lower layer protocols to 8.


[Nm] {4353} In the present version of the protocol, the UE and the network may support a maximum number of 15 EPS bearer contexts.


[Nm] {4354} A UE supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5). The UE indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the UE Network Capability IE.


[Nm] {4355} A network supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5). The network indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the EPS network feature support IE.


[Nm] {4356} For a UE in NB-S1 mode, the UE's implementation-specific maximum number of active user plane radio bearers is 2 (as defined in 3GPP TS 36.300 [20]) when the UE sets the Multiple DRB support bit to "Multiple DRB supported" during attach or tracking area updating procedures, and 1 otherwise.


[Nm] {4357} Upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, if:


	[B1] {4358} a)	the number of active default EPS bearer contexts in the UE is larger than the UE's implementation-specific maximum number of active user plane radio bearers; and


	[B1] {4359} b)	the UE is using user plane CIoT EPS optimization;


[Nm] {4360} the UE shall locally deactivate at least one default EPS bearer context such that the total number of active default EPS bearer contexts that remained does not exceed the UE's implementation-specific maximum number of active user plane radio bearers. In this case, choosing which EPS bearer context to deactivate is implementation specific. The UE shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.


[H3] {4361} 6.5.1	UE requested PDN connectivity procedure


[H4] {4362} 6.5.1.1	General


[Nm] {4363} The purpose of the UE requested PDN connectivity procedure is for a UE to request the setup of a default EPS bearer to a PDN. The UE requests connectivity to a PDN by sending a PDN CONNECTIVITY REQUEST message to the network. If accepted by the network, this procedure initiates the establishment of a default EPS bearer context. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the procedure is used either to establish the first default bearer by including the PDN CONNECTIVITY REQUEST message into the initial attach message, or to establish subsequent default bearers to additional PDNs in order to allow the UE simultaneous access to multiple PDNs by sending the message stand-alone. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the procedure is used to establish the first or subsequent default bearers to a PDN or additional PDNs by sending the PDN CONNECTIVITY REQUEST message stand-alone.


[Nm] {4364} If the UE requests PDN connectivity for emergency bearer services, the MME shall not check for regional restrictions or subscription restrictions when processing the PDN CONNECTIVITY REQUEST message.


[Nm] {4365} If there is already a PDN connection for emergency bearer services established, the UE shall not request an additional PDN connection for emergency bearer services.


[Nm] {4366} A UE attached for emergency bearer services shall not request a PDN connection to any other PDN.


[Nm] {4367} A UE attached for access to RLOS shall not request any additional PDN connection for RLOS nor any PDN connection to any other PDN.


[Nm] {4368} The UE may also initiate the UE requested PDN connectivity procedure to add 3GPP access to the PDN connection which is already established over WLAN as specified in the subclause 6.2.2 of 3GPP TS 23.161 [34].


[Nm] {4369} The UE may also initiate the UE requested PDN connectivity procedure to transfer an existing PDU session in the 5GS to EPS as specified in 3GPP TS 24.501 [54].


[Nm] {4370} If the UE supports the device triggering short message as specified in 3GPP TS 23.040 [57] and supports non-IP PDN type, then upon receiving from ESMS entity as specified in 3GPP TS 24.007 [12] an indication requesting establishment of a PDN connection for non-IP PDN type using the default APN as specified in 3GPP TS 24.011 [13A], the UE shall initiate the UE requested PDN connectivity procedure in order to request connectivity to a PDN using the default APN and non-IP PDN type.


[H4] {4371} 6.5.1.2	UE requested PDN connectivity procedure initiation


[Nm] {4372} In order to request connectivity to a PDN, the UE shall send a PDN CONNECTIVITY REQUEST message to the MME, start timer T3482 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.1.2.1).


[Nm] {4373} When the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, the UE shall not start timer T3482 and shall not include the APN.


[Nm] {4374} In order to request a PDN connection for emergency bearer services or for access to RLOS, the UE shall not include an APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.


[Nm] {4375} In order to request connectivity to a PDN using the default APN, the UE includes the access point name IE in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message, according to the following conditions:


	[B1] {4376} -	if use of a PDN using the default APN requires PAP/CHAP, then the UE should include the Access point name IE; and


	[B1] {4377} -	in all other conditions, the UE need not include the Access point name IE.


[Nm] {4378} In order to request connectivity to an additional PDN using a specific APN, the UE shall include the requested APN in the PDN CONNECTIVITY REQUEST message.


[Nm] {4379} In the PDN type IE the UE shall either indicate the IP version capability of the IP stack associated with the UE or non IP or Ethernet as specified in subclause 6.2.2.


[Nm] {4380} If the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6 and the UE indicates "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message, the UE may include the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message.


[Nm] {4381} The UE shall set the request type to "initial request" when the UE is establishing a new PDN connectivity to a PDN in an attach procedure or in a stand-alone PDN connectivity procedure or when the UE is a 5G-RG and requests establishment of a PDN connection as a user-plane resource of an MA PDU session to be established. The UE shall set the request type to "emergency" when the UE is requesting a new PDN connectivity for emergency bearer services. The UE shall set the request type to "handover" when the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, when the UE initiates the procedure to add 3GPP access to the PDN connection which is already established over WLAN, when the UE supporting N1 mode requests transfer of an existing non-emergency PDU session in 5GS or when the UE is a 5G-RG and requests establishment of a PDN connection as a user-plane resource of an already established MA PDU session. The UE shall set the request type to "handover of emergency bearer services" when a PDN connection for emergency bearer services is to be transferred from a WLAN to the 3GPP access network or when the UE supporting N1 mode requests transfer of an existing emergency PDU session in 5GS. The UE shall set the request type to "RLOS" when the UE is requesting a new PDN connection for RLOS.


[Nm] {4382} If the UE supports DSMIPv6, the UE may include a request for obtaining the IPv6 address and optionally the IPv4 address of the home agent in the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST message. The UE may also include a request for obtaining the IPv6 Home Network Prefix. The UE shall request the IPv6 Home Network Prefix only if the UE has requested the home agent IPv6 address. The requested home agent address(es) and the Home Network Prefix are related to the APN the UE requested connectivity for.


[Nm] {4383} The UE may set the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message to indicate that it has ESM information, i.e. protocol configuration options, APN, or both, that needs to be sent after the NAS signalling security has been activated between the UE and the MME.


[Nm] {4384} If the UE supports A/Gb mode or Iu mode or both, the UE shall indicate the support of the network requested bearer control procedures (see 3GPP TS 24.008 [13]) in A/Gb mode or Iu mode in the protocol configuration options IE.


[Nm] {4385} If the UE supports N1 mode and the request type is:


	[B1] {4386} a)	"initial request" or "emergency", the UE shall generate a PDU session ID, associate the PDU session ID with the PDN connection that is being established, and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE;


	[B1] {4387} b)	"handover" or "handover of emergency bearer services", and the UE requests:


		[B2] {4388} 1)	transfer of an existing PDU session in 5GS or establishment of a PDN connection as a user-plane resource of an already established MA PDU session, the UE shall associate the PDU session ID of the PDU session with the PDN connection that is being established for the existing PDU session and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE; or


		[B2] {4389} 2)	transfer of an existing PDN connection in a non-3GPP access connected to the EPC and a PDU session ID is associated with the existing PDN connection, the UE shall include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE.


[Nm] {4390} If the UE supporting N1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the extended protocol configuration options IE, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the protocol configuration options IE or the extended protocol configuration options IE.


[Nm] {4391} Protocol configuration options provided in the ESM INFORMATION RESPONSE message replace any protocol configuration options provided in the PDN CONNECTIVITY REQUEST message.


[Nm] {4392} When the UE initiates the procedure to add 3GPP access to the PDN connection that is already established over WLAN, the UE shall provide the same APN as that of the PDN connection established over WLAN in the PDN connectivity procedure as specified in the subclause 6.2.2 of 3GPP TS 23.161 [34].


[Nm] {4393} If the UE supports APN rate control, the UE shall include an APN rate control support indicator and an additional APN rate control for exception data support indicator in the protocol configuration options IE or extended protocol configuration options IE.


[Nm] {4394} If the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), the UE shall include the extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message and include DNS server security information indicator.


[H4] {4395} 6.5.1.3	UE requested PDN connectivity procedure accepted by the network


[Nm] {4396} Upon receipt of the PDN CONNECTIVITY REQUEST message, the MME checks whether the ESM information transfer flag is included. If the flag is included the MME waits for completion of the ESM information request procedure before proceeding with the PDN connectivity procedure. The MME then checks if connectivity with the requested PDN can be established. If no requested APN is included in the PDN CONNECTIVITY REQUEST message or the ESM INFORMATION RESPONSE message and the request type is different from "emergency" and from "handover of emergency bearer services" and from "RLOS", the MME shall use the default APN as the requested APN. If the request type is "emergency" or "handover of emergency bearer services", the MME shall use the APN configured for emergency bearer services or select the statically configured PDN GW for unauthenticated UEs, if applicable. If the request type is "RLOS", the MME shall use the APN configured for RLOS.


[Nm] {4397} If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, and multiple PDN connections for a given APN are allowed, the network retains the existing EPS bearer contexts for the PDN connection and proceeds with the requested PDN connectivity procedure.


[Nm] {4398} If the lower layers provide a GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a LIPA PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the GW Transport Layer Address value as the P-GW address in the EPS bearer context of the LIPA PDN connection.


[Nm] {4399} If the lower layers provide a SIPTO L-GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the SIPTO L-GW Transport Layer Address value as the P-GW address in the EPS bearer context of the SIPTO at the local network PDN connection.


[Nm] {4400} If the lower layers provide a LHN-ID value together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the LHN-ID value in the EPS bearer context of the SIPTO at the local network PDN connection.


[Nm] {4401} If connectivity with the requested PDN is accepted by the network, the MME shall initiate the default EPS bearer context activation procedure (see subclause 6.4.1).


[Nm] {4402} If connectivity with the requested PDN is accepted and the network considers this PDN connection a LIPA PDN connection, then subject to operator policy the MME shall include in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection".


[Nm] {4403} If connectivity with the requested PDN is accepted, but with a restriction of IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, but only one particular IP version, or only single IP version bearers are supported/allowed by the network), ESM cause #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", or #52 "single address bearers only allowed", respectively, shall be included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.


[Nm] {4404} If connectivity with the requested PDN is accepted and the UE provided the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message, the MME may include the Header compression configuration IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Furthermore, if the MME decides that the associated PDN connection is only for control plane CIoT EPS optimization (see subclause 5.3.15), the MME shall include the Control plane only indication in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.


[Nm] {4405} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).


[Nm] {4406} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection", the UE provides an indication to the upper layers that the connectivity is provided by a LIPA PDN connection.


[Nm] {4407} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the 3GPP PS data off UE status is "activated", the UE behaves as described in subclause 6.3.10.


[Nm] {4408} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the SCEF or P-GW indicates acceptance of use of Reliable Data Service to transfer data for the PDN connection, the UE behaves as described in subclause 6.3.11.


[Nm] {4409} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if an S-NSSAI and the PLMN ID that this S-NSSAI relates to are provided in the protocol configuration options IE or extended protocol configuration options IE, the UE shall delete the stored S-NSSAI, if any, and shall store the S-NSSAI provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and the associated PLMN ID along with the corresponding PDU session ID that the UE provided in the PDN CONNECTIVITY REQUEST message. The usage of the PDU session ID and the corresponding S-NSSAI with the associated PLMN ID is specified in 3GPP TS 24.501 [54].


[Nm] {4410} Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s), which correspond to the default EPS bearer of the PDN connectivity being activated, in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.


[H4] {4411} 6.5.1.4	UE requested PDN connectivity procedure not accepted by the network


[H5] {4412} 6.5.1.4.1	General


[Nm] {4413} If connectivity with the requested PDN cannot be accepted by the network, the MME shall send a PDN CONNECTIVITY REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity.


[Nm] {4414} The ESM cause IE typically indicates one of the following ESM cause values:


	[B1] {4415} #8:	operator determined barring;


	[B1] {4416} #26:	insufficient resources;


	[B1] {4417} #27:	missing or unknown APN;


	[B1] {4418} #28:	unknown PDN type;


	[B1] {4419} #29:	user authentication or authorization failed;


	[B1] {4420} #30:	request rejected by Serving GW or PDN GW;


	[B1] {4421} #31:	request rejected, unspecified;


	[B1] {4422} #32:	service option not supported;


	[B1] {4423} #33:	requested service option not subscribed;


	[B1] {4424} #34:	service option temporarily out of order;


	[B1] {4425} #35:	PTI already in use;


	[B1] {4426} #38:	network failure;


	[B1] {4427} #50:	PDN type IPv4 only allowed;


	[B1] {4428} #51:	PDN type IPv6 only allowed;


	[B1] {4429} #53:	ESM information not received;


	[B1] {4430} #54:	PDN connection does not exist;


	[B1] {4431} #55:	multiple PDN connections for a given APN not allowed;


	[B1] {4432} #57:	PDN type IPv4v6 only allowed;


	[B1] {4433} #58:	PDN type non IP only allowed;


	[B1] {4434} #61:	PDN type Ethernet only allowed;


	[B1] {4435} #65:	maximum number of EPS bearers reached;


	[B1] {4436} #66:	requested APN not supported in current RAT and PLMN combination;


	[B1] {4437} #95 – 111:	protocol errors;


	[B1] {4438} #112:	APN restriction value incompatible with active EPS bearer context;


	[B1] {4439} #113:	Multiple accesses to a PDN connection not allowed.


[Nm] {4440} The network may include a Back-off timer value IE in the PDN CONNECTIVITY REJECT message. If the ESM cause value is #26 "insufficient resources" and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause "High priority access AC 11 – 15" or the request type in the PDN CONNECTIVITY REQUEST message was set to "emergency" or "handover of emergency bearer services", the network shall not include a Back-off timer value IE.


[Nm] {4441} If the Back-off timer value IE is included and the ESM cause value is different from #26 "insufficient resources", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate:


	[B1] {4442} -	whether the UE is allowed to attempt a PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session establishment procedure in the PLMN for the same APN in N1 mode; and


	[B1] {4443} -	whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.


[Nm] {4444} If the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode using the same PDN type.


[Nm] {4445} If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode.


[Nm] {4446} Upon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE.


[Nm] {4447} If the PDN CONNECTIVITY REJECT message is due to an ESM failure notified by EMM layer (i.e., EMM cause #19 "ESM failure" included in an ATTACH REJECT message), the UE may include a different APN in the PDN CONNECTIVITY REQUEST message.


[Nm] {4448} If the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure and the UE receives a PDN CONNECTIVITY REJECT message, then the UE may:


	[B1] {4449} a)	inform the upper layers of the failure to establish the emergency bearer; or


	[B1] {4450} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


[Nm] {4451} If the PDN CONNECTIVITY REQUEST message was sent with PDN type set to "Ethernet" and the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #58 "PDN type non IP only allowed", then the UE may attempt a PDN connectivity procedure with the non-IP PDN type.


[H5] {4452} 6.5.1.4.2	Handling of network rejection due to ESM cause #26


[Nm] {4453} If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and behave as follows:


	[B1] {4454} 1)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):


		[B2] {4455} i)	if the timer value indicates neither zero nor deactivated and an APN was included in the PDN CONNECTIVITY REQUEST message, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. If the timer value indicates neither zero nor deactivated, no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:


			[B3] {4456} -	shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and


			[B3] {4457} -	shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires or timer T3396 is stopped.


			[B3] {4458} The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


		[B2] {4459} ii)	if the timer value indicates that this timer is deactivated, the UE:


			[B3] {4460} -	shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network; and


			[B3] {4461} -	shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE.


			[B3] {4462} The timer T3396 remains deactivated upon a PLMN change or inter-system change; and


		[B2] {4463} iii)	if the timer value indicates zero, the UE:


			[B3] {4464} -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and


			[B3] {4465} -	if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE; and


	[B1] {4466} 2)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):


		[B2] {4467} i)	if the ATTACH REJECT message is not integrity protected and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the ATTACH REJECT message is not integrity protected, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with a random value from a default range specified in table 11.2.3 defined in 3GPP TS 24.008 [13], and:


			[B3] {4468} a)	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and


			[B3] {4469} b)	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.


		[B2] {4470} 	The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


		[B2] {4471} ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:


			[B3] {4472} a)	if the timer value indicates neither zero nor deactivated and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the timer value indicates neither zero nor deactivated, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:


				[B4] {4473} -	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and


				[B4] {4474} -	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.


			[B3] {4475} 	The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


			[B3] {4476} b)	if the timer value indicates that this timer is deactivated, the UE:


				[B4] {4477} -	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for the same APN from the network; and


				[B4] {4478} -	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.


			[B3] {4479} 	The timer T3396 remains deactivated upon a PLMN change or inter-system change; and


			[B3] {4480} c)	if the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d.


[Nm] {4481} If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN.


[Nm] {4482} When the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.


[Nm] {4483} If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.


[Nm] {4484} If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE shall behave as follows:


	[B1] {4485} -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;


	[B1] {4486} -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and


	[B1] {4487} -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


[H5] {4488} 6.5.1.4.3	Handling of network rejection due to ESM cause other than ESM cause #26


[Nm] {4489} If the ESM cause value is different from #26 "insufficient resources", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", #65 "maximum number of EPS bearers reached", and #66 "requested APN not supported in current RAT and PLMN combination", and the Back-off timer value IE is included, the UE shall behave as follows:


	[B1] {4490} 1)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


		[B2] {4491} i)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and


			[B3] {4492} -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and


			[B3] {4493} -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the back-off timer expires, the UE is switched off or the USIM is removed;


		[B2] {4494} ii)	if the timer value indicates that this timer is deactivated, the UE:


			[B3] {4495} -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and


			[B3] {4496} -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the UE is switched off or the USIM is removed; and


		[B2] {4497} iii)	if the timer value indicates zero, the UE:


			[B3] {4498} -	may send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN; and


			[B3] {4499} -	may send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN; and


	[B1] {4500} 2)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


		[B2] {4501} i)	if the ATTACH REJECT message is not integrity protected, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and:


			[B3] {4502} a)	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and


			[B3] {4503} b)	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency", until the back-off timer expires, the UE is switched off or the USIM is removed; and


		[B2] {4504} ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:


			[B3] {4505} a)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and:


				[B4] {4506} -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and


				[B4] {4507} -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the back-off timer expires, the UE is switched off or the USIM is removed;


			[B3] {4508} b)	if the timer value indicates that this timer is deactivated, the UE:


				[B4] {4509} -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed; and


				[B4] {4510} -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed; and


			[B3] {4511} c)	if the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d.


[Nm] {4512} If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any.


	[B1] {4513} 1)	Additionally, if the ESM cause value is #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:


		[B2] {4514} -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and


		[B2] {4515} -	otherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.


	[B1] {4516} 2)	For ESM cause values different from #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.


[Nm] {4517} The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the PDN connectivity procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.


[Nm] {4518} If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any, and proceed as specified in subclause 5.5.1.2.6, item d.


[Nm] {4519} If the back-off timer is started upon receipt of a PDN CONNECTIVITY REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:


	[B1] {4520} 1)	after a PLMN change the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the PDN connectivity procedure and the combination of new PLMN and APN;


	[B1] {4521} 	Furthermore as an implementation option, for the ESM cause values #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, or the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message included in an ATTACH REQUEST message without an APN using the same PDN type if the UE did not provide any APN in the PDN connectivity procedure, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.


	[B1] {4522} 2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:


		[B2] {4523} -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session establishment procedure for the same PLMN and APN combination in N1 mode; and


		[B2] {4524} -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session establishment procedure for the same PLMN and APN combination in N1 mode are unspecified; and


	[B1] {4525} 3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the PDN connectivity procedure with the value provided by the network, or deactivate the respective back-off timer as follows:


		[B2] {4526} -	if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and


		[B2] {4527} -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.


[Nm] {4528} If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.


[Nm] {4529} If a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION ESTABLISHMENT REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timers for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.


[Nm] {4530} When the back-off timer is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.


[Nm] {4531} If the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", the UE shall ignore the Back-off timer value IE provided by the network, if any. The UE shall not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type until:


	[B1] {4532} -	the UE is registered to a new PLMN, and either the network did not include a Re-attempt indicator IE in the PDN CONNECTIVITY REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed;


	[B1] {4533} -	the UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDN CONNECTIVITY REJECT message was received;


	[B1] {4534} -	the PDN type which is used to access to the APN is changed;


	[B1] {4535} -	the UE is switched off; or


	[B1] {4536} -	the USIM is removed.


[Nm] {4537} For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.


[Nm] {4538} Furthermore as an implementation option, for the SM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", if the network does not include a Re-attempt indicator IE the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.


[Nm] {4539} If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.


[Nm] {4540} The PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off, when the USIM is removed, or when there is a change in the value indicated by the network in the 15 bearers bit of the EPS network feature support IE, the UE shall clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number(s) of EPS bearer contexts in S1 mode.


[Nm] {4541} If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the UE shall take different actions depending on the Back-off timer value IE and the Re-attempt indicator IE optionally included:


	[B1] {4542} 1)	If the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed;


	[B1] {4543} 2)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed;


	[B1] {4544} 3)	if the PDN CONNECTIVITY REQUEST message was sent standalone and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


		[B2] {4545} i)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PLMN and APN combination and shall not send another PDN CONNECTIVITY REQUEST for the same APN in the current PLMN in S1 mode until the back-off timer expires, the UE is switched off or the USIM is removed;


		[B2] {4546} ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and


		[B2] {4547} iii)	if the timer value indicates that this timer is zero, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN; and


	[B1] {4548} 4)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


			[B3] {4549} i)	if the ATTACH REJECT message is not integrity protected, regardless whether the Back-off timer IE is included, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and


		[B2] {4550} ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:


				[B4] {4551} a)	if the Back-off timer value IE is included and the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed;


				[B4] {4552} b)	if the Back-off timer value IE is included and the timer value indicates that this timer is deactivated, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed;


			[B3] {4553} c)	if the Back-off timer value IE is included and the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d;


			[B3] {4554} d)	if the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and


			[B3] {4555} e)	if the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not initiate a new attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed.


[Nm] {4556} If the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then


	[B1] {4557} -	for cases 3.i, 4.i and 4.ii.a the UE shall additionally start a back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN; and


	[B1] {4558} -	for cases 3.ii and 4.ii.b the UE shall deactivate the respective back-off timers for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN.


[Nm] {4559} For the ESM cause value #66 "requested APN not supported in current RAT and PLMN combination" the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.


[Nm] {4560} As an implementation option, for cases 1, 3.i, 3.ii, 4.iv, 4.v.a and 4.v.b, if the Re-attempt indicator IE is not included, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN in a PLMN which is in the list of equivalent PLMNs.


[Nm] {4561} If the ESM cause value is #54 "PDN connection does not exist", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. And take different actions as follows:


	[B1] {4562} -	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall set the request type to "initial request" in the subsequent PDN CONNECTIVITY REQUEST message to establish a PDN connectivity to the same APN;


	[B1] {4563} -	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST message, the UE shall set the request type to "initial request" in the PDN CONNECTIVITY REQUEST message which is included in the subsequent ATTACH REQUEST message to establish a PDN connectivity to the same APN.


[H4] {4564} 6.5.1.4A	Handling the maximum number of active EPS bearer contexts


[Nm] {4565} If the maximum number of active EPS bearer contexts is reached at the UE (see subclause 6.5.0) and the upper layers of the UE request connectivity to a PDN the UE shall not send a PDN CONNECTIVITY REQUEST message unless an active EPS bearer is deactivated. If the UE needs to de-activate an active EPS bearer context, choosing which EPS bearer context to de-activate is implementation specific, however the UE shall not deactivate an EPS bearer context for emergency.


[Nm] {4566} If the UE needs to de-activate an EPS bearer context in order to request an emergency EPS bearer context, it shall either de-activate an EPS bearer context locally or via explicit signalling. If the UE performs local de-activation, the UE shall perform tracking area updating procedure to indicate EPS bearer context status to the network.


[H4] {4567} 6.5.1.4B	Void


[H4] {4568} 6.5.1.4C	Handling the maximum number of active user plane radio bearers in NB-S1 mode


[Nm] {4569} When the maximum number of active user plane radio bearers in NB-S1 mode is reached (see subclause 6.5.0) and upper layers request for more DRBs for PDN connections other than PDN connections with those DRBs, the UE can choose to release one or more of the PDN connections to cater for the upper layer request. The choice of which PDN connection to be released is implementation specific. 


[Nm] {4570} If the maximum number of active user plane radio bearers in NB-S1 mode is reached and the upper layers of the UE request user-plane resources for exception data reporting, the UE shall release a PDN connection that has user-plane resources to cater for the request for exception data reporting. The choice of which PDN connection to be released is implementation specific.


[Nm] {4571} If the UE needs to release a PDN connection for the reasons stated in this subclause, a PDN connection that is used for exception data reporting shall not be released.


[Nm] {4572} If the UE releases a PDN connection to cater for the upper layer request, the UE shall release the PDN connection via explicit ESM signalling.


[H4] {4573} 6.5.1.5	Abnormal cases in the UE


[Nm] {4574} The following abnormal cases can be identified:


	[B1] {4575} a)	T3482 expired


	[B1] {4576} 	On the first expiry of the timer T3482:


		[B2] {4577} -	if the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure, then the UE shall:


			[B3] {4578} a)	inform the upper layers of the failure to establish the emergency bearer; or


			[B3] {4579} b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


		[B2] {4580} -	otherwise, the UE shall resend the PDN CONNECTIVITY REQUEST and shall reset and restart timer T3482. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3482, the UE shall abort the procedure, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE.


	[B1] {4581} b)	T3447 is running


	[B1] {4582} 	The UE shall not send a PDN CONNECTIVITY REQUEST message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:


		[B2] {4583} -	establishment of a PDN connection for emergency bearer services is requested;


		[B2] {4584} -	the UE is a UE configured to use AC11 – 15 in the selected PLMN; or


		[B2] {4585} -	a network initiated signalling message has been received.


	[B1] {4586} 	The PDN CONNECTIVITY REQUEST message can be sent, if still necessary, when timer T3447 expires.


[H4] {4587} 6.5.1.6	Abnormal cases on the network side


[Nm] {4588} The following abnormal cases can be identified:


	[B1] {4589} a)	UE initiated PDN connectivity request for an already existing PDN connection:


	[B1] {4590} 	If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, 


		[B2] {4591} 	If the information elements in the PDN CONNECTIVITY REQUEST message do not differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure.


		[B2] {4592} 	If one or more information elements in the PDN CONNECTIVITY REQUEST message differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and multiple PDN connections for a given APN are not allowed, the network may deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure or may reject this PDN connectivity procedure including the ESM cause #55 "multiple PDN connections for a given APN not allowed", in the PDN CONNECTIVITY REJECT message.


	[B1] {4593} 	If the network receives a PDN CONNECTIVITY REQUEST message with request type "emergency" and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE for the previous PDN connectivity request for emergency bearer services, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure. If there is already a PDN connection for emergency bearer services existing, the MME shall reject the request with ESM cause #55 "multiple PDN connections for a given APN not allowed" or deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure.


	[B1] {4594} b)	UE initiated PDN connectivity request with request type "handover" for a PDN connection that does not exist:


	[B1] {4595} 	If the network receives a PDN CONNECTIVITY REQUEST message for either a default APN or a specific APN with request type set to "handover" and the MME does not have any information about that PDN connection, then MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.


	[B1] {4596} c)	ESM information not received:


	[B1] {4597} 	If the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message has been set and the ESM information is not received before the final expiry of timer T3489 as described in subclause 6.6.1.2.6, the MME shall reject the PDN connectivity request procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.


	[B1] {4598} d)	Additional UE initiated PDN connectivity request received from a UE that is attached for emergency bearer services:


	[B1] {4599} 	The MME shall reject the request with ESM cause #31 "request rejected, unspecified".


	[B1] {4600} e)	A PDN CONNECTIVITY REQUEST message with request type "handover of emergency bearer services" received from a UE and the MME does not have any information about a P-GW currently providing emergency bearer services for the UE or the MME is not configured with an address of a P-GW in the MME emergency configuration data:


	[B1] {4601} 	MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.


	[B1] {4602} f)	Additional UE initiated PDN connectivity request received from a UE that is attached for access to RLOS:


	[B1] {4603} 	The MME shall reject the request with ESM cause #31 "request rejected, unspecified".


[H4] {4604} 6.5.1.7	Handling PDN connectivity request for UE configured for dual priority


[Nm] {4605} If a PDN connection exists that was established due to a request including a low priority indicator set to "MS is configured for NAS signalling low priority" and the upper layers of the UE request to establish a PDN connection with the same APN and a low priority indicator set to "MS is not configured for NAS signalling low priority", when initiating the PDN connectivity request procedure, the UE shall:


	[B1] {4606} -	send a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as the existing PDN connection. If the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #55 "multiple PDN connections for a given APN not allowed", the upper layers are informed of this; or


	[B1] {4607} -	send a PDN CONNECTIVITY REQUEST message with the same APN after the successful deactivation of the existing PDN connection.


[Nm] {4608} As an alternative the upper layers of the UE can request to establish a PDN connection with a different APN.


[H3] {4609} 6.5.2	UE requested PDN disconnect procedure


[H4] {4610} 6.5.2.1	General


[Nm] {4611} The purpose of the UE requested PDN disconnection procedure is for a UE to request disconnection from one PDN. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE can initiate this procedure to disconnect from any PDN as long as it is connected to at least one other PDN. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE can initiate this procedure to disconnect from any PDN. With this procedure, all EPS bearer contexts established towards this PDN, including the default EPS bearer context, are released.


[Nm] {4612} The UE is allowed to initiate the PDN disconnection procedure even if the timer T3396 is running.


[H4] {4613} 6.5.2.2	UE requested PDN disconnection procedure initiation


[Nm] {4614} In order to request PDN disconnection from a PDN, the UE shall send a PDN DISCONNECT REQUEST message to the MME, start the timer T3492 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.2.2.1). The PDN DISCONNECT REQUEST message shall include the EPS bearer identity of the default bearer associated with the PDN to disconnect from as the linked EPS bearer identity in the PDN DISCONNECT REQUEST message.


[H4] {4615} 6.5.2.3	UE requested PDN disconnection procedure accepted by the network


[Nm] {4616} Upon receipt of the PDN DISCONNECT REQUEST message, if it is accepted by the network, the MME shall initiate the bearer context deactivation procedure by sending the DEACTIVATE EPS BEARER CONTEXT REQUEST message including the linked EPS bearer identity of the default bearer associated with the PDN to disconnect from and the PTI. The behaviour of the MME is described in subclause 6.4.4.


[Nm] {4617} Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the PDN DISCONNECT REQUEST message, the UE shall stop the timer T3492 and enter the state PROCEDURE TRANSACTION INACTIVE. The behaviour of the UE is described in subclause 6.4.4. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).


[Nm] {4618} On reception of DEACTIVATE EPS BEARER CONTEXT ACCEPT message from the UE, the MME releases all the resources reserved for the PDN in the network.


[H4] {4619} 6.5.2.4	UE requested PDN disconnection procedure not accepted by the network


[Nm] {4620} Upon receipt of the PDN DISCONNECT REQUEST message, if it is not accepted by the network, the MME shall send a PDN DISCONNECT REJECT message to the UE. The PDN DISCONNECT REJECT message shall contain the PTI and an ESM cause IE that typically indicates one of the following ESM cause values:


	[B1] {4621} #35:	PTI already in use;


	[B1] {4622} #43:	invalid EPS bearer identity;


	[B1] {4623} #49:	last PDN disconnection not allowed;


	[B1] {4624} #95 – 111: protocol errors.


[Nm] {4625} If EMM-REGISTERED without PDN connection is supported by the UE and the MME, then ESM cause #49 "last PDN disconnection not allowed" is not applicable.


[Nm] {4626} Upon receipt of the PDN DISCONNECT REJECT message, the UE shall stop the timer T3492, enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN disconnection procedure. Additionally, in all cases with the exception of the UE having received ESM cause #49 "last PDN disconnection not allowed" if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME. If the UE receives ESM cause #49 "last PDN disconnection not allowed" and the UE has any other PDN connections established, the UE may locally deactivate, without peer-to-peer signalling between the UE and the MME, all EPS bearer contexts associated with those other PDN connections.


[H4] {4627} 6.5.2.5	Abnormal cases in the UE


[Nm] {4628} The following abnormal cases can be identified:


	[B1] {4629} a)	Expiry of timer T3492:


	[B1] {4630} 	On the first expiry of the timer T3492, the UE shall resend the PDN DISCONNECT REQUEST and shall reset and restart timer T3492. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3492, the UE shall abort the procedure, deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE. In order to synchronize EPS bearer contexts status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.


	[B1] {4631} b)	Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:


	[B1] {4632} 	When the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.


	[B1] {4633} c)	Collision of UE requested PDN disconnect procedure and EPS bearer context modification:


	[B1] {4634} 	When the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the MODIFY EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.


	[B1] {4635} d)	Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation procedure:


	[B1] {4636} 	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the UE shall proceed with both procedures.


[H4] {4637} 6.5.2.6	Abnormal cases on the network side


[Nm] {4638} The following abnormal cases can be identified:


	[B1] {4639} a)	No PDN connection with the linked EPS bearer identity activated:


	[B1] {4640} 	If the linked EPS bearer identity included in the PDN DISCONNECT REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a PDN DISCONNECT REJECT message with ESM cause #43 "invalid EPS bearer identity".


[H3] {4641} 6.5.3	UE requested bearer resource allocation procedure


[H4] {4642} 6.5.3.1	General


[Nm] {4643} The purpose of the UE requested bearer resource allocation procedure is for a UE to request an allocation of bearer resources for a traffic flow aggregate. The UE requests a specific QoS demand (QCI) and optionally sends a GBR requirement for a new traffic flow aggregate. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2) or an EPS bearer context modification procedure (see subclause 6.4.3).


[Nm] {4644} If there is a PDN connection for emergency bearer services established, the UE shall not request additional bearer resources for this PDN connection.


[H4] {4645} 6.5.3.2	UE requested bearer resource allocation procedure initiation


[Nm] {4646} In order to request the allocation of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE ALLOCATION REQUEST message to the MME, start timer T3480 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.3.2.1).


[Nm] {4647} The UE shall include the EPS bearer identity of the default EPS bearer associated with the requested bearer resource in the Linked EPS bearer identity IE. The UE shall set the TFT operation code in the Traffic flow aggregate IE to "Create new TFT". The packet filters in the Traffic flow aggregate IE shall include at least one packet filter applicable for the uplink direction. In the Required traffic flow QoS IE, the UE shall indicate a QCI and, if the UE also includes a GBR, the additional GBR required for the traffic flow aggregate. 


[Nm] {4648} For the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE ALLOCATION REQUEST message to the MME. If the traffic flow aggregate IE is not needed in those procedures, the UE shall set:


	[B1] {4649} -	the length indicator of the Traffic flow aggregate IE to the value 1;


	[B1] {4650} -	the TFT operation code to "000";


	[B1] {4651} -	the E bit to zero; and


	[B1] {4652} -	the number of packet filters to zero;


[Nm] {4653} and in the Required traffic flow QoS IE:


	[B1] {4654} -	the length indicator to the value 1; and


	[B1] {4655} -	the QCI to zero.


[H4] {4656} 6.5.3.3	UE requested bearer resource allocation procedure accepted by the network


[Nm] {4657} Upon receipt of the BEARER RESOURCE ALLOCATION REQUEST message, the MME checks whether the resources requested by the UE can be established by verifying the EPS bearer identity given in the Linked EPS bearer identity IE to be any of the active default EPS bearer context(s).


[Nm] {4658} If the bearer resource allocation requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure or an EPS bearer context modification procedure. Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE ALLOCATION REQUEST message, the UE shall stop timer T3480 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).


[Nm] {4659} If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4.


[Nm] {4660} If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4.


[H4] {4661} 6.5.3.4	UE requested bearer resource allocation procedure not accepted by the network


[H5] {4662} 6.5.3.4.1	General


[Nm] {4663} If the bearer resource allocation requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE ALLOCATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource allocation.


[Nm] {4664} The ESM cause value typically indicates one of the following:


	[B1] {4665} #26:	insufficient resources;


	[B1] {4666} #30:	request rejected by Serving GW or PDN GW;


	[B1] {4667} #31:	request rejected, unspecified;


	[B1] {4668} #32:	service option not supported;


	[B1] {4669} #33:	requested service option not subscribed;


	[B1] {4670} #34:	service option temporarily out of order;


	[B1] {4671} #35:	PTI already in use;


	[B1] {4672} #37:	EPS QoS not accepted;


	[B1] {4673} #41:	semantic error in the TFT operation;


	[B1] {4674} #42:	syntactical error in the TFT operation;


	[B1] {4675} #43:	invalid EPS bearer identity;


	[B1] {4676} #44:	semantic error(s) in packet filter(s);


	[B1] {4677} #45:	syntactical error(s) in packet filter(s);


	[B1] {4678} #56:	collision with network initiated request; 


	[B1] {4679} #59:	unsupported QCI value;


	[B1] {4680} #60:	bearer handling not supported;


	[B1] {4681} #65:	maximum number of EPS bearers reached; or


	[B1] {4682} #95 – 111:	protocol errors.


[Nm] {4683} If the bearer resource allocation requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #60 "bearer handling not supported".


[Nm] {4684} If the requested new TFT is not available, then the BEARER RESOURCE ALLOCATION REJECT message shall be sent.


[Nm] {4685} The TFT in the request message is checked by the network for different types of TFT IE errors as follows:


	[B1] {4686} a)	Semantic errors in TFT operations:


		[B2] {4687} 1)	When the TFT operation is an operation other than "Create a new TFT".


	[B1] {4688} 	The network shall reject the allocation request with ESM cause #41 "semantic error in the TFT operation".


	[B1] {4689} b)	Syntactical errors in TFT operations:


		[B2] {4690} 1)	When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.


		[B2] {4691} 2)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.


	[B1] {4692} 	The network shall reject the allocation request with ESM cause #42 "syntactical error in the TFT operation".


	[B1] {4693} c)	Semantic errors in packet filters:


		[B2] {4694} 1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.


		[B2] {4695} 2)	When the resulting TFT does not contain any packet filter which applicable for the uplink direction.


	[B1] {4696} 	The network shall reject the allocation request with ESM cause #44 "semantic errors in packet filter(s)".


	[B1] {4697} d)	Syntactical errors in packet filters:


		[B2] {4698} 1)	When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.


		[B2] {4699} 2)	When the TFT operation = "Create a new TFT" and two or more packet filters among all TFTs associated with the PDN connection would have identical packet filter precedence values.


		[B2] {4700} 3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.


	[B1] {4701} 	In case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.


	[B1] {4702} 	In case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure.If it is the last remaining PDN connection and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".


	[B1] {4703} 	Otherwise the network shall reject the allocation request with ESM cause #45 "syntactical errors in packet filter(s)".


[Nm] {4704} The network may include a Back-off timer value IE in the BEARER RESOURCE ALLOCATION REJECT message.


[Nm] {4705} If the Back-off timer value IE is included and the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate:


	[B1] {4706} -	whether the UE is allowed to attempt a secondary PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and


	[B1] {4707} -	whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.


[Nm] {4708} Upon receipt of a BEARER RESOURCE ALLOCATION REJECT message, the UE shall stop the timer T3480, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE.


[H5] {4709} 6.5.3.4.2	Handling of network rejection due to ESM cause #26


[Nm] {4710} If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):


	[B1] {4711} i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


	[B1] {4712} ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or


	[B1] {4713} iii)	if the timer value indicates zero, the UE:


		[B2] {4714} -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and


		[B2] {4715} -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.


[Nm] {4716} If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.


[Nm] {4717} The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


[Nm] {4718} If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.


[Nm] {4719} If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:


	[B1] {4720} -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;


	[B1] {4721} -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and


	[B1] {4722} -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


[H5] {4723} 6.5.3.4.3	Handling of network rejection due to ESM cause other than ESM cause #26


[Nm] {4724} If the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


	[B1] {4725} -	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource allocation procedure and PLMN and APN combination and not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;


	[B1] {4726} -	if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and


	[B1] {4727} -	if the timer value indicates zero, the UE may send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.


[Nm] {4728} If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt Indicator IE provided by the network, if any.


	[B1] {4729} 1)	Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:


		[B2] {4730} -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and


		[B2] {4731} -	otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.


	[B1] {4732} 2)	For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.


[Nm] {4733} The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.


[Nm] {4734} If the back-off timer is started upon receipt of BEARER RESOURCE ALLOCATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:


	[B1] {4735} 1)	after a PLMN change the UE may send a BEARER RESOURCE ALLOCATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource allocation procedure and the combination of new PLMN and APN;


	[B1] {4736} 	Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.


	[B1] {4737} 2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:


		[B2] {4738} -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and


		[B2] {4739} -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and


	[B1] {4740} 3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource allocation procedure with the value provided by the network, or deactivate the respective back-off timer as follows:


		[B2] {4741} -	if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and


		[B2] {4742} -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.


[Nm] {4743} If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.


[Nm] {4744} If a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.


[Nm] {4745} If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.


[Nm] {4746} The PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode.


[Nm] {4747} The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


[H4] {4748} 6.5.3.4A	Handling the maximum number of active EPS bearer contexts


[Nm] {4749} If the UE requests allocation of additional bearer resources, and the network has reached its maximum number of active EPS bearer contexts, then the network can:


	[B1] {4750} -	reject the request if the network decides that it is necessary to allocate a dedicated EPS bearer context; or 


	[B1] {4751} -	accept the request by sending a MODIFY EPS BEARER CONTEXT REQUEST message.


[Nm] {4752} If the maximum number of active EPS bearer contexts is reached at the UE (see subclause 6.5.0) and the UE de-activates an active EPS bearer context prior to sending the request for additional bearer resources, then choosing which EPS bearer context to de-activate is a implementation specific, however the UE shall not deactivate a default EPS bearer context for emergency.


[H4] {4753} 6.5.3.5	Abnormal cases in the UE


[Nm] {4754} The following abnormal cases can be identified:


	[B1] {4755} a)	Expiry of timer T3480:


	[B1] {4756} 	On the first expiry of the timer T3480, the UE shall resend the BEARER RESOURCE ALLOCATION REQUEST and shall reset and restart timer T3480. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3480, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE.


	[B1] {4757} b)	Unknown EPS bearer context


	[B1] {4758} 	Upon receipt of the BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing default EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3480.


	[B1] {4759} c)	Collision of a UE requested bearer resource allocation procedure and an EPS bearer context deactivation procedure.


	[B1] {4760} 	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message for the default EPS bearer context related to the UE requested bearer resource allocation procedure, the UE shall abort the UE requested bearer resource allocation procedure and shall stop the timer T3480 and proceed with the EPS bearer context deactivation procedure.


[H4] {4761} 6.5.3.6	Abnormal cases on the network side


[Nm] {4762} The following abnormal case can be identified:


	[B1] {4763} a)	No PDN connection with the linked EPS bearer identity activated:


	[B1] {4764} 	If the linked EPS bearer identity included in the BEARER RESOURCE ALLOCATION REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #43 "invalid EPS bearer identity".


	[B1] {4765} b)	BEARER RESOURCE ALLOCATION REQUEST message received for a PDN connection established for emergency bearer services:


	[B1] {4766} 	The MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #31 "request rejected, unspecified".


[H3] {4767} 6.5.4	UE requested bearer resource modification procedure


[H4] {4768} 6.5.4.1	General


[Nm] {4769} The purpose of the UE requested bearer resource modification procedure is for a UE to request a modification, or release of bearer resources for a traffic flow aggregate, or modification of a traffic flow aggregate by replacing packet filters or adding packet filters, or re-negotiate header compression configuration associated to an EPS bearer context, or to indicate a change of 3GPP PS data off UE status for a PDN connection. When requesting a modification of bearer resources for a traffic flow aggregate or a modification of a traffic flow aggregate, the UE can modify the existing GBR. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2), an EPS bearer context modification procedure (see subclause 6.4.3), or an EPS bearer context deactivation procedure (see subclause 6.4.4).


[Nm] {4770} If there is a PDN connection for emergency bearer services established, the UE shall not request a modification of bearer resources for this PDN connection.


[Nm] {4771} When the UE requested bearer resource modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDN connection (see subclause 6.3.10), the UE shall initiate the UE requested bearer resource modification procedure even if the timer T3396 or the back-off timer is running or is deactivated.


[H4] {4772} 6.5.4.2	UE requested bearer resource modification procedure initiation


[Nm] {4773} In order to request the modification of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME, start timer T3481 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.4.2.1).


[Nm] {4774} The UE shall include the EPS bearer identity of the EPS bearer associated with the traffic flow aggregate in the EPS bearer identity for packet filter IE.


[Nm] {4775} To request a change of the GBR without changing the packet filter(s), the UE shall set the TFT operation code in the Traffic flow aggregate IE to "no TFT operation" and include the packet filter identifier(s) to which the change of the GBR applies in the Packet filter identifier parameter in the parameters list. The UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.


[Nm] {4776} To request a modification of a traffic flow aggregate, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Replace packet filters in existing TFT" or "Add packet filters to existing TFT". If the TFT operation code is set to "Add packet filters to existing TFT", the UE shall include in the parameter list one existing packet filter identifier to which the newly added packet filter(s) is linked. If the EPS bearer is a GBR bearer and the UE also wishes to request a change of GBR, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.


[Nm] {4777} To request a release of bearer resources, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Delete packet filters from existing TFT". If the EPS bearer is a GBR bearer and the UE does not request the release of all bearer resources, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.


[Nm] {4778} To request re-negotiation of header compression configuration associated to an EPS bearer context, the UE shall include the Header compression configuration IE in the BEARER RESOURCE MODIFICATION REQUEST message if the network indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE.


[Nm] {4779} After an inter-system change from N1 mode to S1 mode, if:


	[B1] {4780} a)	the UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network;


	[B1] {4781} b)	the PDN type value of the PDN type IE is set to "IPv4", "IPv6" or "IPv4v6";


	[B1] {4782} c)	the UE indicates "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; and


	[B1] {4783} d)	the network indicates "Control plane CIoT 5GS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message;


[Nm] {4784} the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME and include the Header compression configuration IE to negotiate the header compression configuration.


[Nm] {4785} To indicate a change of 3GPP PS data off UE status associated to a PDN connection, the UE shall include the protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message and set the 3GPP PS data off UE status only if:


	[B1] {4786} -	the network included the 3GPP PS data off support indication in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message when the PDN connection was established; or


	[B1] {4787} -	the PDU session was established when in N1 mode.


[Nm] {4788} The UE behaves as described in subclause 6.3.10.


[Nm] {4789} If the UE requests the modification of a traffic flow aggregate, which is assigned to a dedicated EPS bearer context, it shall ensure that at least one packet filter applicable for the uplink direction remains among the packet filters created on request from the UE in that TFT, or no own packet filters.


[Nm] {4790} If the UE includes the Required traffic flow QoS IE, the UE shall set the QCI to the current QCI value of the EPS bearer context.


[Nm] {4791} If the UE requests the release of bearer resources, the ESM cause value typically indicates one of the following:


	[B1] {4792} #36:	regular deactivation.


[Nm] {4793} For the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE MODIFICATION REQUEST message to the MME.


[Nm] {4794} It is possible that the traffic flow aggregate IE is not needed in the following procedures:


	[B1] {4795} -	re-negotiation of header compression configuration associated to an EPS bearer context;


	[B1] {4796} -	indicating a change of 3GPP PS data off UE status associated to a PDN connection; or


	[B1] {4797} -	NBIFOM procedures.


[Nm] {4798} If the traffic flow aggregate IE is not needed, the UE shall set:


	[B1] {4799} -	the length indicator of the Traffic flow aggregate IE to the value 1;


	[B1] {4800} -	the TFT operation code to "000";


	[B1] {4801} -	the E bit to zero; and


	[B1] {4802} -	the number of packet filters to zero.


[H4] {4803} 6.5.4.3	UE requested bearer resource modification procedure accepted by the network


[Nm] {4804} Upon receipt of the BEARER RESOURCE MODIFICATION REQUEST message, the MME checks whether the resources requested by the UE can be established, modified or released by verifying the EPS bearer identity given in the EPS bearer identity for packet filter IE.


[Nm] {4805} If the bearer resource modification requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure, an EPS bearer context modification procedure or an EPS bearer context deactivation procedure.


[Nm] {4806} If the request to re-negotiate header compression configuration associated to an EPS bearer context is accepted by the network, the MME shall initiate an EPS bearer context modification procedure.


[Nm] {4807} If the bearer resource modification requests a release of bearer resources that results in the TFT of the EPS bearer context containing only packet filters applicable to the uplink direction, the network may initiate the EPS bearer context deactivation procedure.


[Nm] {4808} Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall stop timer T3481 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).


	[B1] {4809} i)	If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4.


	[B1] {4810} ii)	If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4.


	[B1] {4811} iii)	If the DEACTIVATE EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is one of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.4.3.


[Nm] {4812} In case i, after successful completion of the dedicated EPS bearer context activation procedure, the network may initiate an EPS bearer context modification procedure to delete the packet filters which have packet filter identifiers indicated by the UE in the Traffic flow aggregate IE in the BEARER RESOURCE MODIFICATION REQUEST message and for which the network created new packet filters during the dedicated EPS bearer context activation procedure. In this case the MME shall set the procedure transaction identity value in the MODIFY EPS BEARER CONTEXT REQUEST message to "no procedure transaction identity assigned".


[H4] {4813} 6.5.4.4	UE requested bearer resource modification procedure not accepted by the network


[H5] {4814} 6.5.4.4.1	General


[Nm] {4815} If the bearer resource modification requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE MODIFICATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource modification.


[Nm] {4816} The ESM cause value typically indicates one of the following:


	[B1] {4817} #26:	insufficient resources;


	[B1] {4818} #30:	request rejected by Serving GW or PDN GW;


	[B1] {4819} #31:	request rejected, unspecified;


	[B1] {4820} #32:	service option not supported;


	[B1] {4821} #33:	requested service option not subscribed;


	[B1] {4822} #34:	service option temporarily out of order;


	[B1] {4823} #35:	PTI already in use;


	[B1] {4824} #37:	EPS QoS not accepted;


	[B1] {4825} #41:	semantic error in the TFT operation;


	[B1] {4826} #42:	syntactical error in the TFT operation;


	[B1] {4827} #43:	invalid EPS bearer identity;


	[B1] {4828} #44:	semantic error(s) in packet filter(s);


	[B1] {4829} #45:	syntactical error(s) in packet filter(s);


	[B1] {4830} #56:	collision with network initiated request;


	[B1] {4831} #59:	unsupported QCI value;


	[B1] {4832} #60:	bearer handling not supported; or


	[B1] {4833} #95 – 111:	protocol errors.


[Nm] {4834} If the bearer resource modification requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #60 "bearer handling not supported".


[Nm] {4835} If the requested new TFT is not available, then the BEARER RESOURCE MODIFICATION REJECT message shall be sent.


[Nm] {4836} The TFT in the request message is checked by the network for different types of TFT IE errors as follows:


	[B1] {4837} a)	Semantic errors in TFT operations:


		[B2] {4838} 1)	When the TFT operation is an operation other than "Replace packet filters in existing TFT", "Add packet filters to existing TFT", "Delete packet filters from existing TFT" or "No TFT operation".


		[B2] {4839} 2)	When the TFT operation is "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.


		[B2] {4840} 3)	TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.


	[B1] {4841} 	In case 1 the network shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".


	[B1] {4842} 	In case 2, if the TFT operation is "Delete packet filters from existing TFT", the network shall further process the new request and, if no error according to items b, c, and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete existing TFT" in the MODIFY EPS BEARER CONTEXT REQUEST message.


	[B1] {4843} 	In case 2, if the TFT operation is "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", the network shall process the new request as a request with TFT operation = "Create a new TFT".


	[B1] {4844} 	In case 3, if the packet filters belong to a dedicated EPS bearer context, the network shall process the new deletion request and, if no error according to items b, c, and d was detected, delete the existing TFT. After successful deletion of the TFT, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context between the UE and the network.


	[B1] {4845} 	In case 3, if the packet filters belong to the default EPS bearer context, the network shall process the new deletion request and if no error according to items b, c, and d was detected then perform an EPS bearer context modification procedure to remove the existing TFT of the default EPS bearer context, this corresponds to using match-all packet filter for the default EPS bearer context.


	[B1] {4846} b)	Syntactical errors in TFT operations:


		[B2] {4847} 1)	When the TFT operation = "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", and the packet filter list in the TFT IE is empty.


		[B2] {4848} 2)	TFT operation = "No TFT operation" with a non-empty packet filter list in the TFT IE.


		[B2] {4849} 3)	TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.


		[B2] {4850} 4)	TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.


		[B2] {4851} 5)	Void


		[B2] {4852} 6)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.


		[B2] {4853} 7)	TFT operation = "No TFT operation" with an empty parameters list.


	[B1] {4854} 	In case 3 the network shall not diagnose an error, shall further process the replace request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure using TFT operation = "Add packet filters to existing TFT" to include the packet filters received to the existing TFT.


	[B1] {4855} 	In case 4 the network shall not diagnose an error, shall further process the deletion request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete packet filters from existing TFT" and the received packet filter identifier(s) in the MODIFY EPS BEARER CONTEXT REQUEST message.


	[B1] {4856} 	Otherwise the network shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".


	[B1] {4857} c)	Semantic errors in packet filters:


		[B2] {4858} 1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.


		[B2] {4859} 2)	When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction.


	[B1] {4860} 	The network shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".


	[B1] {4861} d)	Syntactical errors in packet filters:


		[B2] {4862} 1)	When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", and two or more packet filters in the resultant TFT would have identical packet filter identifiers.


		[B2] {4863} 2)	When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", and two or more packet filters in all TFTs associated with the PDN connection would have identical packet filter precedence values.


		[B2] {4864} 3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.


	[B1] {4865} 	In case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.


	[B1] {4866} 	In case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If the relevant PDN connection is the last one and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".


	[B1] {4867} 	Otherwise the network shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".


[Nm] {4868} The network may include a Back-off timer value IE in the BEARER RESOURCE MODIFICATION REJECT message. 


[Nm] {4869} The network shall not include the ESM cause value #26 "insufficient resources" in the BEARER RESOURCE MODIFICATION REJECT message due to APN based congestion control being active.


[Nm] {4870} If the Back-off timer value IE is included and the ESM cause value is not #26 "insufficient resources", the network may include the Re-attempt indicator IE to indicate:


	[B1] {4871} -	whether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and


	[B1] {4872} -	whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.


[Nm] {4873} Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message, the UE shall stop the timer T3481, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE. If the ESM cause included in the BEARER RESOURCE MODIFICATION REJECT message is #43 "invalid EPS bearer identity", the UE locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling.


[H5] {4874} 6.5.4.4.2	Handling of network rejection due to ESM cause #26


[Nm] {4875} If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):


	[B1] {4876} i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;


	[B1] {4877} ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or


	[B1] {4878} iii)	if the timer value indicates zero, the UE:


		[B2] {4879} -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and


		[B2] {4880} -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.


[Nm] {4881} If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.


[Nm] {4882} The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


[Nm] {4883} If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.


[Nm] {4884} If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:


	[B1] {4885} -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;


	[B1] {4886} -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and


	[B1] {4887} -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


[H5] {4888} 6.5.4.4.3	Handling of network rejection due to ESM cause other than ESM cause #26


[Nm] {4889} If the ESM cause value is not #26 "insufficient resources", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):


	[B1] {4890} -	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource modification procedure and PLMN and APN combination and not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;


	[B1] {4891} -	if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN until the UE is switched off or the USIM is removed; and


	[B1] {4892} -	if the timer value indicates zero, the UE may send another BEARER RESOURCE MODIFICATION REQUEST message in the PLMN for the same APN.


[Nm] {4893} If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network, if any.


	[B1] {4894} 1)	Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:


		[B2] {4895} -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and


		[B2] {4896} -	otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.


	[B1] {4897} 2)	For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.


[Nm] {4898} The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource modification procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.


[Nm] {4899} If the back-off timer is started upon receipt of BEARER RESOURCE MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:


	[B1] {4900} 1)	after a PLMN change the UE may send a BEARER RESOURCE MODIFICATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource modification procedure and the combination of new PLMN and APN;


	[B1] {4901} 	Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE MODIFICATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.


	[B1] {4902} 2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:


		[B2] {4903} -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and


		[B2] {4904} -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and


	[B1] {4905} 3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource modification procedure with the value provided by the network, or deactivate the respective back-off timer as follows:


		[B2] {4906} -	if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and


		[B2] {4907} -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.


[Nm] {4908} If the back-off timer for a PLMN and APN combination was started or deactivated upon receipt of an MODIFY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.


[Nm] {4909} If a back-off timers for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.


[Nm] {4910} The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


[H4] {4911} 6.5.4.5	Abnormal cases in the UE


[Nm] {4912} The following abnormal cases can be identified:


	[B1] {4913} a)	Expiry of timer T3481:


	[B1] {4914} 	On the first expiry of the timer T3481, the UE shall resend the BEARER RESOURCE MODIFICATION REQUEST and shall reset and restart timer T3481. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3481, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE. In addition, if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.


	[B1] {4915} b)	Unknown EPS bearer context


	[B1] {4916} 	Upon receipt of the BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481.


	[B1] {4917} c)	Collision of a UE requested bearer resource modification procedure and an EPS bearer context deactivation procedure.


	[B1] {4918} 	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the bearer resource modification procedure, and the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a EPS bearer context the UE indicated in the UE requested bearer resource modification procedure, then the UE shall abort the UE requested bearer resource modification procedure and shall stop the timer T2381 and proceed with the EPS bearer context deactivation procedure.


	[B1] {4919} d)	Rejection of a UE requested bearer resource modification procedure when the UE has initiated the procedure to release all traffic flows for the bearer


	[B1] {4920} 	Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message with ESM cause value #31 "request rejected, unspecified", if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481. In order to synchronize the EPS bearer context status with the MME, the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.


[H4] {4921} 6.5.4.6	Abnormal cases on the network side


[Nm] {4922} The following abnormal cases can be identified:


	[B1] {4923} a)	Unknown EPS bearer context


	[B1] {4924} 	If the EPS bearer identity provided in the EPS bearer identity for packet filter IE in the BEARER RESOURCE MODIFICATION REQUEST message indicates an EPS bearer identity value and this does not belong to any already activated EPS bearer context, the MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #43 "invalid EPS bearer identity".


	[B1] {4925} b)	BEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services:


	[B1] {4926} 	The MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 "request rejected by Serving GW or PDN GW".


[H3] {4927} 6.5.5	Handling session management request for UE configured for dual priority


[Nm] {4928} If timer T3396 is running for a specific APN due to one of the following reasons:


	[B1] {4929} -	a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources";


	[B1] {4930} -	a DEACTIVATE EPS BEARER CONTEXT REQUEST message was received with a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority", or


	[B1] {4931} -	because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority",


[Nm] {4932} upon request of the upper layers the UE can:


	[B1] {4933} -	send a PDN CONNECTIVITY REQUEST message to the same APN, with low priority indicator set to "MS is not configured for NAS signalling low priority"; or,


	[B1] {4934} -	send a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message, with low priority indicator set to "MS is not configured for NAS signalling low priority", for a PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority" exists.


[Nm] {4935} If timer T3396 is running, because any of the following messages containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources":


	[B1] {4936} -	a PDN CONNECTIVITY REQUEST without APN and with request type different from "emergency" and from "handover of emergency bearer services", sent together with an ATTACH REQUEST message;


	[B1] {4937} -	a stand-alone PDN CONNECTIVITY REQUEST message without APN and with request type different from "emergency" and from "handover of emergency bearer services"; or


	[B1] {4938} -	a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message sent for a non-emergency PDN connection established without APN provided by the UE,


[Nm] {4939} or because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a non-emergency PDN connection established without APN provided by the UE and established with low priority indicator set to "MS is configured for NAS signalling low priority", then upon request of the upper layers the UE can initiate a new attach procedure or stand-alone PDN CONNECTIVITY REQUEST procedure without APN and with request type different from "emergency" and from "handover of emergency bearer services", with low priority indicator set to "MS is not configured for NAS signalling low priority".


[Nm] {4940} For requests with low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall follow the procedures specified in subclause 6.5.1.4.


[H2] {4941} 6.6	Miscellaneous procedures


[H3] {4942} 6.6.1	Exchange of protocol configuration options


[H4] {4943} 6.6.1.1	General


[Nm] {4944} The UE and the PDN GW can exchange protocol configuration options via the dedicated ESM information request procedure or via other ESM procedures.


[Nm] {4945} If supported by the network and UE end-to-end for a PDN connection, protocol configuration options shall be exchanged via the extended protocol configuration options IE. Otherwise the protocol configuration options IE is used.


[Nm] {4946} For the UE, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if 


	[B1] {4947} -	the UE is in NB-S1 mode;


	[B1] {4948} -	the PDN Type requested for the PDN connection is non-IP or Ethernet; or


	[B1] {4949} -	the network has indicated support of the extended protocol configuration options IE in the last ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message and the network has included the extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection.


[Nm] {4950} For the MME, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if 


	[B1] {4951} -	the UE is in NB-S1 mode;


	[B1] {4952} -	the PDN Type requested for the PDN connection is non-IP or Ethernet; or


	[B1] {4953} -	the UE has indicated support of the extended protocol configuration options IE in the last ATTACH REQUEST or TRACKING AREA UPDATING REQUEST message, and the MME has received the extended protocol configuration options IE in at least one message sent by the PDN GW towards the UE for this PDN connection (for details see 3GPP TS 29.274 [16D]).


[H4] {4954} 6.6.1.2	ESM information request procedure


[H5] {4955} 6.6.1.2.1	General


[Nm] {4956} The ESM information request procedure is used by the network to retrieve ESM information, i.e. protocol configuration options, APN, or both from the UE during the attach procedure if the UE indicated in the PDN CONNECTIVITY REQUEST message that it has ESM information that needs to be sent security protected. The purpose of this procedure is to provide privacy for the ESM information if ciphering is enabled in the network.


[H5] {4957} 6.6.1.2.2	ESM information request initiated by the network


[Nm] {4958} The network intiates the ESM information request procedure by sending a ESM INFORMATION REQUEST message to the UE, starting timer T3489 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.1.2.2.1). This message shall be sent only after the security context has been setup, and if the ESM information transfer flag has been set in the PDN CONNECTIVITY REQUEST message. The MME shall set the EPS bearer identity of the ESM INFORMATION REQUEST message to the value "no EPS bearer identity assigned" and include the PTI from the associated PDN CONNECTIVITY REQUEST message.


[H5] {4959} 6.6.1.2.3	ESM information request completion by the UE


[Nm] {4960} Upon receipt of the ESM INFORMATION REQUEST message, the UE shall send an ESM INFORMATION RESPONSE message to the network. The UE shall include all the protocol configuration options that need to be transferred security protected, and APN if required, to the network in the ESM INFORMATION RESPONSE message. The UE shall set the EPS bearer identity of the ESM INFORMATION RESPONSE message to the value "no EPS bearer identity assigned" and include the PTI from the ESM INFORMATION REQUEST message.


[H5] {4961} 6.6.1.2.4	ESM information request completion by the network


[Nm] {4962} Upon receipt of the ESM INFORMATION RESPONSE message, the network shall stop timer T3489 and enter the state PROCEDURE TRANSACTION INACTIVE. A protocol configuration options IE or extended protocol configuration options IE included in the ESM INFORMATION RESPONSE message replaces any protocol configuration options IE or extended protocol configuration options IE that the network previously may have received during the attach procedure execution.


[H5] {4963} 6.6.1.2.5	Abnormal cases in the UE


[Nm] {4964} Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.


[H5] {4965} 6.6.1.2.6	Abnormal cases on the network side


[Nm] {4966} The following abnormal cases can be identified:


	[B1] {4967} a)	Expiry of timer T3489:


	[B1] {4968} 	On the first expiry of the timer T3489, the MME shall resend the ESM INFORMATION REQUEST message and shall reset and restart timer T3489. This retransmission is repeated two times, i.e. on the third expiry of timer T3489, the MME shall abort the procedure, release any resources for this procedure and reject the associated PDN connectivity procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.


[H4] {4969} 6.6.1.3	Exchange of protocol configuration options in other messages


[Nm] {4970} The UE may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity request, PDN disconnect request, bearer resource allocation request and bearer resource modification request if the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the PDN GW or the SCEF. In particular, the UE may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], subclause 6.4.


[Nm] {4971} The PDN GW or the SCEF may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity reject, PDN disconnect reject, bearer resource allocation reject and bearer resource modification reject if the PDN GW or the SCEF wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE. In particular, the PDN GW may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], subclause 6.4.


[H3] {4972} 6.6.2	Notification procedure


[H4] {4973} 6.6.2.1	General


[Nm] {4974} The network can use the notification procedure to inform the UE about events which are relevant for the upper layer which is using an EPS bearer context or has requested a procedure transaction.


[Nm] {4975} If the UE has indicated that it supports the notification procedure, the network may initiate the procedure at any time while a PDN connection exists or a procedure transaction is ongoing.


[H4] {4976} 6.6.2.2	Notification procedure initiation by the network


[Nm] {4977} The network initiates the notification procedure by sending a NOTIFICATION message to the UE (see example in figure 6.6.2.2.1).


[H4] {4978} 6.6.2.3	Notification procedure in the UE


[Nm] {4979} When the UE receives a NOTIFICATION message, the ESM protocol entity in the UE shall provide the notification indicator to the upper layer.


[Nm] {4980} The notification indicator can have the following value:


	[B1] {4981} #1:	SRVCC handover cancelled, IMS session re-establishment required.


[H4] {4982} 6.6.2.4	Abnormal cases on the network side


[Nm] {4983} The following abnormal case can be identified:


	[B1] {4984} a)	Lower layer indication of non-delivered NAS PDU due to handover


	[B1] {4985} 	If the NOTIFICATION message could not be delivered due to an intra MME handover, then upon successful completion of the intra MME handover the MME shall retransmit the NOTIFICATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the NOTIFICATION message.


[H3] {4986} 6.6.3	Remote UE Report procedure


[H4] {4987} 6.6.3.1	General


[Nm] {4988} The purpose of the Remote UE Report procedure is for a UE acting as ProSe UE-to-network relay to notify the network that a remote UE is connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay as specified in 3GPP TS 23.303 [31].


[H4] {4989} 6.6.3.2	Remote UE Report initiated by the UE


[Nm] {4990} The UE initiates the Remote UE Report procedure by sending a REMOTE UE REPORT message to the network, starting timer T3493 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.3.2.1). The UE shall include information of newly connected or disconnected remote UEs to the network in the REMOTE UE REPORT message. If any encrypted IMSI remote UE identity is included in the REMOTE UE REPORT message, the UE shall include the corresponding ProSe Key Management Function address. The UE shall include the default EPS bearer identity of the PDN connection associated with the remote UE connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay.


[H4] {4991} 6.6.3.3	Remote UE Report completion by the network


[Nm] {4992} Upon receipt of the REMOTE UE REPORT message, the MME shall send an REMOTE UE REPORT RESPONSE message to the UE. The MME shall include the PTI from the REMOTE UE REPORT message.


[H4] {4993} 6.6.3.4	Remote UE Report completion by the UE


[Nm] {4994} Upon receipt of the REMOTE UE REPORT RESPONSE message, the UE shall stop timer T3493 and enter the state PROCEDURE TRANSACTION INACTIVE. 


[H4] {4995} 6.6.3.5	Abnormal cases in the UE


[Nm] {4996} The following abnormal cases can be identified:


	[B1] {4997} a)	Expiry of timer T3493:


	[B1] {4998} 	On the first expiry of the timer T3493, the UE shall resend the REMOTE UE REPORT message and shall reset and restart timer T3493. This retransmission is repeated two times, i.e. on the third expiry of timer T3493, the UE shall abort the procedure and release any resources for this procedure.


[H4] {4999} 6.6.3.6	Abnormal cases on the network side


[Nm] {5000} No abnormal cases have been identified.


[H3] {5001} 6.6.4	Transport of user data via the control plane procedure


[H4] {5002} 6.6.4.1	General


[Nm] {5003} The purpose of the transport of user data via the control plane procedure is to transfer user data via the control plane in an encapsulated form between the UE and the MME. 


[Nm] {5004} The procedure may be initiated by the UE or the network when the UE is in EMM-CONNECTED mode.


[Nm] {5005} The procedure may also be initiated by the UE in EMM-IDLE mode by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.


[H4] {5006} 6.6.4.2	UE initiated transport of user data via the control plane


[Nm] {5007} Upon receipt of a request to transfer user data via the control plane, if the UE is in EMM-CONNECTED mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message including the user data to be sent in the User data container IE (see example in figure 6.6.4.2.1). The length of the value part of the User data container IE should not exceed the link MTU size for the respective type of user data (IPv4, IPv6 or Non-IP). If the user data in the value part of the User data container IE is an Ethernet frame, then the length of the Ethernet frame payload should not exceed the Ethernet frame payload MTU size.


[Nm] {5008} If the UE is in EMM-IDLE mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message included in a CONTROL PLANE SERVICE REQUEST message.


[Nm] {5009} Based on information provided by the upper layers, the UE may include a Release assistance indication IE in the ESM DATA TRANSPORT message to inform the network that


	[B1] {5010} 1)	subsequent to the current uplink data transmission no further uplink or downlink data transmission (e.g. an acknowledgement or response) is expected; i.e. the upper layers indicated that data exchanges have completed with the current UL data transfer; or


	[B1] {5011} 2)	subsequent to the current uplink data transmission only a single downlink data transmission and no further uplink data transmission is expected; i.e. the upper layers indicated that data exchanges will have completed with the next downlink data transmission.


[Nm] {5012} When receiving the ESM DATA TRANSPORT message, the MME shall identify the PDN connection to the SCEF or to the PDN GW, based on the EPS bearer identity included in message, and forward the contents of the User data container IE accordingly. If the ESM DATA TRANSPORT message includes a Release assistance indication IE, then ESM layer indicates to the EMM layer to initiate release of the NAS signalling connection,


	[B1] {5013} 1)	if the release assistance indication indicates that no further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected; or


	[B1] {5014} 2)	upon subsequent delivery of the next received downlink data transmission to the UE if the release assistance indication indicates that only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected.


[H4] {5015} 6.6.4.3	Network initiated transport of user data via the control plane


[Nm] {5016} The network initiates the procedure by sending the ESM DATA TRANSPORT message (see example in figure 6.6.4.3.1). Upon receiving the ESM DATA TRANSPORT message, the UE shall:


	[B1] {5017} -	forward the contents of the User data container IE to the upper layers.


[H4] {5018} 6.6.4.4	Abnormal cases in the UE


[Nm] {5019} The following abnormal case can be identified:


	[B1] {5020} a)	T3396 is running


	[B1] {5021} 	The UE shall not send an ESM DATA TRANSPORT message unless


		[B2] {5022} -	the UE is a UE configured to use AC11 – 15 in selected PLMN; or


		[B2] {5023} -	the ESM DATA TRANSPORT message is used for an exception data reporting and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).


	[B1] {5024} 	The ESM DATA TRANSPORT message can be sent, if still necessary, when timer T3396 expires or is stopped.


	[B1] {5025} b)	Transmission failure of the ESM DATA TRANSPORT message indication from lower layers


	[B1] {5026} 	If lower layers indicate a TAI change and the current TAI is not in the TAI list, the transport of user data via the control plane procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure if the control plane CIoT EPS optimisation is still used and the user data exists. The "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message.


	[B1] {5027} 	If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, or the TAI has not changed, the transport of user data via the control plane procedure shall be re-initiated immediately if the user data still exists by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.


	[B1] {5028} c)	NAS-MAC calculation indication from lower layers


	[B1] {5029} 	If lower layers indicate to calculate an NAS-MAC, the UE shall calculate an NAS_MAC as specified in 3GPP TS 33.401 [19] and then provide the calculated NAS_MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS-MAC to lower layers (see 3GPP TS 36.331 [22]). The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS_MAC.


[H4] {5030} 6.6.4.5	Abnormal cases on the network side


	[B1] {5031} Apart from the case described in subclause 6.3.4, no other abnormal cases have been identified.


[H2] {5032} 6.7	Reception of an ESM STATUS message by an ESM entity


[Nm] {5033} The purpose of the sending of the ESM STATUS message is to report at any time certain error conditions detected upon receipt of ESM protocol data. The ESM STATUS message can be sent by both the MME and the UE (see example in figure 6.7.1).


[Nm] {5034} If the ESM entity of the UE receives an ESM STATUS message the UE shall take different actions depending on the received ESM cause value:


	[B1] {5035} #43	(Invalid EPS bearer identity);


	[B1] {5036} 	The UE shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the UE and the MME).


	[B1] {5037} #81	(Invalid PTI value);


	[B1] {5038} 	The UE shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.


	[B1] {5039} #97	(Message type non-existent or not implemented);


	[B1] {5040} 	The UE shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.


[Nm] {5041} On receipt of an ESM STATUS message with any other ESM cause value no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. 


[Nm] {5042} If the ESM entity of the MME receives an ESM STATUS message the MME shall take different actions depending on the received ESM cause value:


	[B1] {5043} #43	(Invalid EPS bearer identity);


	[B1] {5044} 	The MME shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the MME and the UE).


	[B1] {5045} #81	(Invalid PTI value);


	[B1] {5046} 	The MME shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.


	[B1] {5047} #97	(Message type non-existent or not implemented);


	[B1] {5048} 	The MME shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.


[Nm] {5049} The local actions to be taken by the MME on receipt of an ESM STATUS message with any other ESM cause value are implementation dependent.


[H1] {5050} 7	Handling of unknown, unforeseen, and erroneous protocol data


[H2] {5051} 7.1	General


[Nm] {5052} The procedures specified in the present document apply to those messages which pass the checks described in this subclause.


[Nm] {5053} This subclause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called "error handling procedures", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.


[Nm] {5054} Subclauses 7.1 to 7.8 shall be applied in order of precedence.


[Nm] {5055} Most error handling procedures are mandatory for the UE.


[Nm] {5056} Detailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this subclause as mandatory ("shall") and that is indicated as strongly recommended ("should").


[Nm] {5057} Also, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.


[Nm] {5058} For definition of semantical and syntactical errors see 3GPP TS 24.007 [12], subclause 11.4.2.


[H2] {5059} 7.2	Message too short


[Nm] {5060} When a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP TS 24.007 [12].


[H2] {5061} 7.3	Unknown or unforeseen procedure transaction identity or EPS bearer identity


[H3] {5062} 7.3.1	Procedure transaction identity


[Nm] {5063} The following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:


	[B1] {5064} a)	If the network receives a PDN CONNECTIVITY REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5065} b)	If the network receives a PDN DISCONNECT REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5066} c)	If the network receives a BEARER RESOURCE ALLOCATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5067} d)	If the network receives a BEARER RESOURCE MODIFICATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5068} e)	If the network receives an ESM INFORMATION RESPONSE message which includes an unassigned or reserved PTI value, the network shall ignore the message. If the PTI is an assigned value that does not match the PTI in use for any ongoing transaction related procedure, the network shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value".


	[B1] {5069} f)	If the network receives an ESM message other than those listed in items a through e above with a reserved PTI value, the network shall ignore the message.


[Nm] {5070} The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:


	[B1] {5071} a)	If the UE receives a PDN CONNECTIVITY REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.


	[B1] {5072} b)	If the UE receives a PDN DISCONNECT REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.


	[B1] {5073} c)	If the UE receives a BEARER RESOURCE ALLOCATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.


	[B1] {5074} d)	If the UE receives a BEARER RESOURCE MODIFICATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.


	[B1] {5075} e)	If the UE receives an ESM INFORMATION REQUEST message in which the PTI value is an unassigned or reserved value, the UE shall ignore the message. If the PTI is an assigned value that does not match a PTI in use for a pending UE requested PDN connectivity procedure for which the ESM information transfer flag was set in the PDN CONNECTIVITY REQUEST message, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".


	[B1] {5076} f)	If the UE receives a NOTIFICATION message in which the PTI value is an unassigned value, the UE shall proceed as specified in subclause 7.3.2. If the PTI is a reserved value, the UE shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value". If the PTI is an assigned value that does not match any PTI in use, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".


	[B1] {5077} g)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclause 6.5.1.3) the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".


	[B1] {5078} h)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which contains a reserved or unassigned PTI value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5079} i)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".


	[B1] {5080} j)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5081} k)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) the UE shall respond with a MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".


	[B1] {5082} l)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".


	[B1] {5083} m)	If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message in which the PTI value is a reserved value or an assigned value that does not match any PTI in use, the UE shall ignore the message.


	[B1] {5084} n)	If the UE receives an ESM message other than those listed in items a through m with a reserved PTI value or an assigned value that does not match any PTI in use, the UE shall ignore the message.


[H3] {5085} 7.3.2	EPS bearer identity


[Nm] {5086} The following network procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message (specified as the header of a standard L3 message, see 3GPP TS 24.007 [12]):


	[B1] {5087} a)	If the network receives a PDN CONNECTIVITY REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5088} b)	If the network receives a PDN DISCONNECT REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5089} c)	If the network receives a BEARER RESOURCE ALLOCATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5090} d)	If the network receives a BEARER RESOURCE MODIFICATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5091} e)	If the network receives an ESM INFORMATION RESPONSE message which includes an assigned or reserved EPS bearer identity value, the network shall ignore the message.


	[B1] {5092} f)	If the network receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5093} g)	If the network receives an ESM message other than those listed in items a through e above in which the message includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall ignore the message.


[Nm] {5094} The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message:


	[B1] {5095} a)	If the UE receives a PDN CONNECTIVITY REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.


	[B1] {5096} b)	If the UE receives a PDN DISCONNECT REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.


	[B1] {5097} c)	If the UE receives a BEARER RESOURCE ALLOCATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.


	[B1] {5098} d)	If the UE receives a BEARER RESOURCE MODIFICATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.


	[B1] {5099} e)	If the UE receives an ESM INFORMATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5100} f)	If the UE receives a NOTIFICATION message which includes a reserved EPS bearer identity value, an assigned EPS bearer identity value that does not match an existing EPS bearer context, or the combination of an unassigned PTI value and an unassigned EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5101} g)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5102} h)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5103} i)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5104} j)	If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a DEACTIVATE EPS BEARER CONTEXT ACCEPT message with the EPS bearer identity set to the received EPS bearer identity.


	[B1] {5105} k)	If the UE receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".


	[B1] {5106} l)	If the UE receives an ESM message other than those listed in items a through j in which the message includes an unassigned or reserved EPS bearer identity value or a value that does not match an EPS bearer context of an established PDN connection, the UE shall ignore the message.


[H2] {5107} 7.4	Unknown or unforeseen message type


[Nm] {5108} If UE receives an EMM message or ESM message with message type not defined for the protocol discriminator (PD) or not implemented by the receiver, it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".


[Nm] {5109} If the network receives an EMM or ESM message with message type not defined for the PD or not implemented by the receiver in a protocol state where reception of an unsolicited message with the given PD from the UE is not foreseen in the protocol, the network actions are implementation dependent. Otherwise, if the network receives a message with message type not defined for the PD or not implemented by the receiver, it shall ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".


[Nm] {5110} If the UE receives a message not compatible with the protocol state, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #98 "message type not compatible with protocol state".


[Nm] {5111} If the network receives a message not compatible with the protocol state, the network actions are implementation dependent.


[H2] {5112} 7.5	Non-semantical mandatory information element errors


[H3] {5113} 7.5.1	Common procedures


[Nm] {5114} When an “imperative message part” error or a “missing mandatory IE” error is diagnosed on receipt of a message, or when a message containing a syntactically incorrect mandatory IE, an IE unknown in the message but encoded as “comprehension required” (see 3GPP TS 24.007 [12]), or an out of sequence IE encoded as "comprehension required" (see 3GPP TS 24.007 [12]), the UE and the network shall proceed as follows:


	[B1] {5115} 1)	If the message is not one of the messages listed in subclause 7.5.3, item a, b, c, or d, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information";


	[B1] {5116} 2)	If the message is not one of the messages listed in subclause 7.5.3, item e, f, g or h, the network shall either:


		[B2] {5117} -	try to treat the message (the exact further actions are implementation dependent); or


		[B2] {5118} -	ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information".


[H3] {5119} 7.5.2	EPS mobility management


[Nm] {5120} No exceptional cases are described for mobility management messages.


[Nm] {5121} No semantical or syntactical diagnosis other than presence and length shall be performed on the ESM message container information element in the ATTACH REQUEST, ATTACH ACCEPT, ATTACH COMPLETE and CONTROL PLANE SERVICE REQUEST messages.


[H3] {5122} 7.5.3	EPS session management


[Nm] {5123} The following UE procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:


	[B1] {5124} a)	If the message is an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5125} b)	If the message is an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5126} c)	If the message is a MODIFY EPS BEARER CONTEXT REQUEST, a MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5127} d)	If the message is a DEACTIVATE EPS BEARER CONTEXT REQUEST, a DEACTIVATE EPS BEARER CONTEXT ACCEPT message shall be returned. All resources associated with that EPS bearer shall be released.


[Nm] {5128} The following network procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:


	[B1] {5129} e)	If the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5130} f)	If the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5131} g)	If the message is a BEARER RESOURCE ALLOCATION REQUEST, a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


	[B1] {5132} h)	If the message is a BEARER RESOURCE MODIFICATION REQUEST, a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


[H2] {5133} 7.6	Unknown and unforeseen IEs in the non-imperative message part


[H3] {5134} 7.6.1	IEIs unknown in the message


[Nm] {5135} The UE shall ignore all IEs unknown in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 [12]).


[Nm] {5136} The network shall take the same approach.


[H3] {5137} 7.6.2	Out of sequence IEs


[Nm] {5138} The UE shall ignore all out of sequence IEs in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 [12]).


[Nm] {5139} The network should take the same approach.


[H3] {5140} 7.6.3	Repeated IEs


[Nm] {5141} If an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause 8 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.


[Nm] {5142} The network should follow the same procedures.


[H2] {5143} 7.7	Non-imperative message part errors


[Nm] {5144} This category includes:


	[B1] {5145} -	syntactically incorrect optional IEs; and


	[B1] {5146} -	conditional IE errors.


[H3] {5147} 7.7.1	Syntactically incorrect optional IEs


[Nm] {5148} The UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.


[Nm] {5149} The network shall take the same approach.


[H3] {5150} 7.7.2	Conditional IE errors


[Nm] {5151} When upon receipt of a EMM or ESM message the UE diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error, or when it receives a EMM or ESM message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".


[Nm] {5152} When the network receives a message and diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:


	[B1] {5153} -	try to treat the message (the exact further actions are implementation dependent); or


	[B1] {5154} -	ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".


[H2] {5155} 7.8	Messages with semantically incorrect contents


[Nm] {5156} When a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses 4, 5 and 6). If however no such reactions are specified, the UE shall ignore the message except that it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #95 "semantically incorrect message".


[Nm] {5157} The network should follow the same procedure except that a status message is not normally transmitted.


[H1] {5158} 8	Message functional definitions and contents


[H2] {5159} 8.1	Overview


[Nm] {5160} This clause defines the structure of the messages of the Layer 3 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP TS 24.007 [12].


[Nm] {5161} Each definition given in the present clause includes:


	[B1] {5162} a)	a brief description of the message direction and use, including whether the message has:


		[B2] {5163} 1.	Local significance, i.e. relevant only on the originating or terminating access;


		[B2] {5164} 2.	Access significance, i.e. relevant in the originating and terminating access, but not in the network;


		[B2] {5165} 3.	Dual significance, i.e. relevant in either the originating or terminating access and in the network; or


		[B2] {5166} 4.	Global significance, i.e. relevant in the originating and terminating access and in the network.


	[B1] {5167} b)	a table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP TS 24.007 [12]). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements. 


	[B1] {5168} 	For each information element the table indicates:


		[B2] {5169} 1.	The Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLVE. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a "-" (example: B-).


		[B2] {5170} 2.	The name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by "IE" or "information element" is used in this technical report as reference to the information element within a message.


		[B2] {5171} 3.	The name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced subclause of clause 9 of the present document describing the value part of the information element.


		[B2] {5172} 4.	The presence requirement indication (M, C, or O) for the IE as defined in 3GPP TS 24.007 [12].


		[B2] {5173} 5.	The format of the information element (T, V, TV, LV, TLV, LV-E or TLV-E) as defined in 3GPP TS 24.007 [12].


		[B2] {5174} 6.	The length of the information element (or permissible range of lengths), in octets, in the message, where "?" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non-normative.


	[B1] {5175} c)	subclauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and – for IEs with presence requirement C – the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP TS 24.007 [12]).


[H2] {5176} 8.2	EPS mobility management messages


[H3] {5177} 8.2.1	Attach accept


[H4] {5178} 8.2.1.1	Message definition


[Nm] {5179} This message is sent by the network to the UE to indicate that the corresponding attach request has been accepted. See table 8.2.1.1.


	[B1] {5180} Message type:	ATTACH ACCEPT


	[B1] {5181} Significance:	dual


	[B1] {5182} Direction:	network to UE


[H4] {5183} 8.2.1.2	GUTI


[Nm] {5184} This IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.


[H4] {5185} 8.2.1.3	Location area identification


[Nm] {5186} This IE may be included to assign a new location area identification to a UE during a combined attach.


[H4] {5187} 8.2.1.4	MS identity


[Nm] {5188} This IE may be included to assign or unassign a new TMSI to a UE during a combined attach.


[H4] {5189} 8.2.1.5	EMM cause


[Nm] {5190} This IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.


[H4] {5191} 8.2.1.6	T3402 value


[Nm] {5192} This IE may be included to indicate a value for timer T3402.


[H4] {5193} 8.2.1.7	T3423 value


[Nm] {5194} This IE may be included to indicate a value for timer T3423.


[Nm] {5195} If this IE is not included, the UE shall use the default value.


[H4] {5196} 8.2.1.8	Equivalent PLMNs


[Nm] {5197} This IE may be included in order to assign a new equivalent PLMNs list to a UE.


[H4] {5198} 8.2.1.9	Emergency number list


[Nm] {5199} This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.


[H4] {5200} 8.2.1.9A	Extended emergency number list


[Nm] {5201} This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.


[H4] {5202} 8.2.1.10	EPS network feature support


[Nm] {5203} The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).


[H4] {5204} 8.2.1.11	Additional update result


[Nm] {5205} The network may include this IE to provide the UE with additional information about the result of:


	[B1] {5206} -	a combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or


	[B1] {5207} -	an attach procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".


[H4] {5208} 8.2.1.12	T3412 extended value


[Nm] {5209} The network may include this IE to provide the UE with longer periodic tracking area update timer.


[H4] {5210} 8.2.1.13	T3324 value


[Nm] {5211} The network shall include the T3324 value IE if:


	[B1] {5212} -	the UE included the T3324 value IE in the ATTACH REQUEST message; and


	[B1] {5213} -	the network supports PSM and accepts the use of PSM.


[H4] {5214} 8.2.1.14	Extended DRX parameters


[Nm] {5215} The network shall include the Extended DRX parameters IE if:


	[B1] {5216} -	the UE included the Extended DRX parameters IE in the ATTACH REQUEST message; and


	[B1] {5217} -	the network supports eDRX and accepts the use of eDRX.


[H4] {5218} 8.2.1.15	DCN-ID


[Nm] {5219} This IE is included in the message when the network wishes to provide a DCN-ID to the UE.


[H4] {5220} 8.2.1.16	SMS services status


[Nm] {5221} This IE may be included when a normal attach procedure for EPS services and "SMS only" was successful for EPS services only.


[H4] {5222} 8.2.1.17	Non-3GPP NW provided policies


[Nm] {5223} This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


[H4] {5224} 8.2.1.18	T3448 value


[Nm] {5225} The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


[H4] {5226} 8.2.1.19	Network policy


[Nm] {5227} This IE is included if the network needs to indicate network policy information to the UE, If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


[H4] {5228} 8.2.1.20	T3447 value


[Nm] {5229} The network may include T3447 value IE if:


	[B1] {5230} -	the UE has indicated support for service gap control in the ATTACH REQUEST message; and


	[B1] {5231} -	the EMM context contains a service gap time value.


[H4] {5232} 8.2.1.21	Ciphering key data


[Nm] {5233} This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.


[H4] {5234} 8.2.1.22	UE radio capability ID


[Nm] {5235} This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.


[H4] {5236} 8.2.1.23	UE radio capability ID deletion indication


[Nm] {5237} This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.


[H4] {5238} 8.2.1.24	Negotiated WUS assistance information


[Nm] {5239} The network shall include the Negotiated WUS assistance information IE if:


	[B1] {5240} -	the UE supports WUS assistance;


	[B1] {5241} -	the MME supports and accepts the use of WUS assistance; and


	[B1] {5242} -	the UE is not attaching for emergency bearer services.


[H4] {5243} 8.2.1.25	Negotiated DRX parameter in NB-S1 mode


[Nm] {5244} The network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.


[H3] {5245} 8.2.2	Attach complete


[Nm] {5246} This message is sent by the UE to the network in response to an ATTACH ACCEPT message. See table 8.2.2.1.


	[B1] {5247} Message type:	ATTACH COMPLETE


	[B1] {5248} Significance:	dual


	[B1] {5249} Direction:	UE to network


[H3] {5250} 8.2.3	Attach reject


[H4] {5251} 8.2.3.1	Message definition


[Nm] {5252} This message is sent by the network to the UE to indicate that the corresponding attach request has been rejected. See table 8.2.3.1.


	[B1] {5253} Message type:	ATTACH REJECT


	[B1] {5254} Significance:	dual


	[B1] {5255} Direction:	network to UE


[H4] {5256} 8.2.3.2	ESM message container


[Nm] {5257} This IE is included to carry a single ESM message.


[H4] {5258} 8.2.3.3	T3346 value


[Nm] {5259} The MME may include this IE when the NAS level mobility management congestion control is active.


[H4] {5260} 8.2.3.4	T3402 value


[Nm] {5261} This IE may be included to indicate a value for timer T3402.


[H4] {5262} 8.2.3.5	Extended EMM cause


[Nm] {5263} This IE may be included by the network to indicate additional information associated with the EMM cause.


[H3] {5264} 8.2.4	Attach request


[H4] {5265} 8.2.4.1	Message definition


[Nm] {5266} This message is sent by the UE to the network in order to perform an attach procedure. See table 8.2.4.1.


	[B1] {5267} Message type:	ATTACH REQUEST


	[B1] {5268} Significance:	dual


	[B1] {5269} Direction:	UE to network


[H4] {5270} 8.2.4.2	Old P-TMSI signature


[Nm] {5271} The UE shall include this IE if the UE holds a valid P-TMSI signature, P-TMSI and RAI, and the TIN either indicates "P-TMSI" or is deleted. If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.


[H4] {5272} 8.2.4.3	Additional GUTI


[Nm] {5273} The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI. If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.


[H4] {5274} 8.2.4.4	Last visited registered TAI


[Nm] {5275} This IE shall be included if the UE holds a valid last visited registered TAI.


[H4] {5276} 8.2.4.5	DRX parameter


[Nm] {5277} This IE is included if UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameters to the network.


[H4] {5278} 8.2.4.6	MS network capability


[Nm] {5279} A UE supporting A/Gb mode or Iu mode shall include this IE to indicate its capabilities to the network.


[H4] {5280} 8.2.4.7	Old location area identification


[Nm] {5281} The UE shall include this IE during a combined attach procedure if it has a valid location area identification.


[H4] {5282} 8.2.4.8	TMSI status


[Nm] {5283} The UE shall include this IE during combined attach procedure if it has no valid TMSI available.


[H4] {5284} 8.2.4.9	Mobile station classmark 2


[Nm] {5285} This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined attach procedure.


[H4] {5286} 8.2.4.10	Mobile station classmark 3


[Nm] {5287} This IE shall be included if the UE supports SRVCC to GERAN.


[H4] {5288} 8.2.4.11	Supported Codecs


[Nm] {5289} This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.


[H4] {5290} 8.2.4.12	Additional update type


[Nm] {5291} The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations.


[H4] {5292} 8.2.4.13	Voice domain preference and UE's usage setting


[Nm] {5293} This IE shall be included in WB-S1 mode if and only if the UE supports:


	[B1] {5294} -	CS fallback and SMS over SGs; or


	[B1] {5295} -	if the UE is configured to support IMS voice, but does not support 1xCS fallback.


[H4] {5296} 8.2.4.14	Device properties


[Nm] {5297} This IE shall be included if the UE is configured for NAS signalling low priority.


[H4] {5298} 8.2.4.15	Old GUTI type


[Nm] {5299} The UE shall include this IE if the type of identity in the EPS mobile identity IE is set to "GUTI".


[H4] {5300} 8.2.4.16	MS network feature support 


[Nm] {5301} This IE shall be included if the UE supports extended periodic timer T3412.


[H4] {5302} 8.2.4.17	TMSI based NRI container


[Nm] {5303} The UE shall include this IE during a combined attach procedure if it has a valid TMSI.


[H4] {5304} 8.2.4.18	T3324 value


[Nm] {5305} The UE may include this IE to request the use of PSM.


[H4] {5306} 8.2.4.19	T3412 extended value


[Nm] {5307} The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.


[H4] {5308} 8.2.4.20	Extended DRX parameters


[Nm] {5309} The UE may include this IE to request the use of eDRX.


[H4] {5310} 8.2.4.21	UE additional security capability


[Nm] {5311} The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.


[H4] {5312} 8.2.4.22	UE status


[Nm] {5313} This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.


[H4] {5314} 8.2.4.23	Additional information requested


[Nm] {5315} The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.


[H4] {5316} 8.2.4.24	N1 UE network capability


[Nm] {5317} The UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN.


[H4] {5318} 8.2.4.25	UE radio capability ID availability IE


[Nm] {5319} The UE shall include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.


[H4] {5320} 8.2.4.26	Requested WUS assistance information


[Nm] {5321} The UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.


[H4] {5322} 8.2.4.27	DRX parameter in NB-S1 mode


[Nm] {5323} This IE is included if the UE intends to use the UE specific DRX parameter in NB-S1 mode.


[H3] {5324} 8.2.5	Authentication failure 


[H4] {5325} 8.2.5.1	Message definition


[Nm] {5326} This message is sent by the UE to the network to indicate that authentication of the network has failed. See table 8.2.5.1.


	[B1] {5327} Message type:	AUTHENTICATION FAILURE


	[B1] {5328} Significance:	dual


	[B1] {5329} Direction:	UE to network


[H4] {5330} 8.2.5.2	Authentication failure parameter


[Nm] {5331} This IE shall be sent if and only if the EMM cause was #21 "synch failure". It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP TS 33.102 [18]).


[H3] {5332} 8.2.6	Authentication reject


[Nm] {5333} This message is sent by the network to the UE to indicate that the authentication procedure has failed and that the UE shall abort all activities. See table 8.2.6.1.


	[B1] {5334} Message type:	AUTHENTICATION REJECT


	[B1] {5335} Significance:	dual


	[B1] {5336} Direction:	network to UE


[H3] {5337} 8.2.7	Authentication request


[Nm] {5338} This message is sent by the network to the UE to initiate authentication of the UE identity. See table 8.2.7.1.


	[B1] {5339} Message type:	AUTHENTICATION REQUEST


	[B1] {5340} Significance:	dual


	[B1] {5341} Direction:	network to UE


[H3] {5342} 8.2.8	Authentication response


[Nm] {5343} This message is sent by the UE to the network to deliver a calculated authentication response to the network. See table 8.2.8.1.


	[B1] {5344} Message type:	AUTHENTICATION RESPONSE


	[B1] {5345} Significance:	dual


	[B1] {5346} Direction:	UE to network


[H3] {5347} 8.2.9	CS service notification


[H4] {5348} 8.2.9.1	Message definition


[Nm] {5349} This message is sent by the network when a paging request with CS call indicator was received via SGs for a UE, and a NAS signalling connection is already established for the UE. See table 8.2.9.1.


	[B1] {5350} Message type:	CS SERVICE NOTIFICATION


	[B1] {5351} Significance:	dual


	[B1] {5352} Direction:	network to UE


[H4] {5353} 8.2.9.2	CLI


[Nm] {5354} The network shall send this IE if it was received via SGs. It contains the identification of the calling line for the mobile terminating call in the CS domain, which triggered the paging via SGs. 


[H4] {5355} 8.2.9.3	SS Code


[Nm] {5356} The network shall send this IE if it was received via SGs. It contains information on the supplementary service transaction in the CS domain, which triggered the paging via SGs.


[H4] {5357} 8.2.9.4	LCS indicator


[Nm] {5358} The network shall send this IE if it was received via SGs. It indicates that the paging was triggered by a terminating LCS request in the CS domain.


[H4] {5359} 8.2.9.5	LCS client identity


[Nm] {5360} The network shall send this IE if received via SGs. It contains information related to the requestor of the terminating LCS request in the CS domain.


[H3] {5361} 8.2.10	Detach accept


[H4] {5362} 8.2.10.1	Detach accept (UE originating detach)


[Nm] {5363} This message is sent by the network to indicate that the detach procedure has been completed. See table 8.2.10.1.1.


	[B1] {5364} Message type:	DETACH ACCEPT


	[B1] {5365} Significance:	dual


	[B1] {5366} Direction:	network to UE


[H4] {5367} 8.2.10.2	Detach accept (UE terminated detach)


[Nm] {5368} This message is sent by the UE to indicate that the detach procedure has been completed. See table 8.2.10.2.1.


	[B1] {5369} Message type:	DETACH ACCEPT


	[B1] {5370} Significance:	dual


	[B1] {5371} Direction:	UE to network


[H3] {5372} 8.2.11	Detach request


[H4] {5373} 8.2.11.1	Detach request (UE originating detach)


[Nm] {5374} This message is sent by the UE to request the release of an EMM context. See table 8.2.11.1.1.


	[B1] {5375} Message type:	DETACH REQUEST


	[B1] {5376} Significance:	dual


	[B1] {5377} Direction:	UE to network


[H4] {5378} 8.2.11.2	Detach request (UE terminated detach)


[H5] {5379} 8.2.11.2.1	Message definition


[Nm] {5380} This message is sent by the network to request the release of an EMM context. See table 8.2.11.2.1.


	[B1] {5381} Message type:	DETACH REQUEST


	[B1] {5382} Significance:	dual


	[B1] {5383} Direction:	network to UE


[H5] {5384} 8.2.11.2.2	EMM cause


[Nm] {5385} This information element is included if an EMM cause is provided.


[H3] {5386} 8.2.12	Downlink NAS Transport


[Nm] {5387} This message is sent by the network to the UE in order to carry an SMS message in encapsulated format. See table 8.2.12.1.


	[B1] {5388} Message type:	DOWNLINK NAS TRANSPORT


	[B1] {5389} Significance:	dual


	[B1] {5390} Direction:	network to UE


[H3] {5391} 8.2.13	EMM information


[H4] {5392} 8.2.13.1	Message definition


[Nm] {5393} This message is sent by the network at any time during EMM context is established to send certain information to the UE. See table 8.2.13.1.


	[B1] {5394} Message type:	EMM INFORMATION


	[B1] {5395} Significance:	local


	[B1] {5396} Direction:	network to UE


[H4] {5397} 8.2.13.2	Full name for network


[Nm] {5398} This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "full length name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification. 


[H4] {5399} 8.2.13.3	Short name for network


[Nm] {5400} This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "abbreviated name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.


[H4] {5401} 8.2.13.4	Local time zone


[Nm] {5402} This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area of the current cell, and also applies to the tracking area list if available in the UE.


[Nm] {5403} If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.


[H4] {5404} 8.2.13.5	Universal time and local time zone


[Nm] {5405} This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area the UE is currently in, and also applies to the tracking area list if available in the UE. The UE shall not assume that the time information is accurate.


[Nm] {5406} If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.


[H4] {5407} 8.2.13.6	Network daylight saving time


[Nm] {5408} This IE may be sent by the network. If this IE is sent, the contents of this IE indicates the value that has been used to adjust the local time zone.


[H3] {5409} 8.2.14	EMM status


[Nm] {5410} This message is sent by the UE or by the network at any time to report certain error conditions listed in clause 7. See table 8.2.14.1.


	[B1] {5411} Message type:	EMM STATUS


	[B1] {5412} Significance:	local


	[B1] {5413} Direction:	both


[H3] {5414} 8.2.15	Extended service request


[H4] {5415} 8.2.15.1	Message definition


[Nm] {5416} This message is sent by the UE to the network


	[B1] {5417} -	to initiate a CS fallback or 1xCS fallback call or respond to a mobile terminated CS fallback or 1xCS fallback request from the network; or


	[B1] {5418} -	to request the establishment of a NAS signalling connection and of the radio and S1 bearers for packet services, if the UE needs to provide additional information that cannot be provided via a SERVICE REQUEST message.


	[B1] {5419} See table 8.2.15.1.


	[B1] {5420} Message type:	EXTENDED SERVICE REQUEST


	[B1] {5421} Significance:	dual


	[B1] {5422} Direction:	UE to network


[H4] {5423} 8.2.15.2	CSFB response


[Nm] {5424} The UE shall include this IE only if the Service type information element indicates "mobile terminating CS fallback or 1xCS fallback".


[H4] {5425} 8.2.15.3	EPS bearer context status


[Nm] {5426} This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.


[H4] {5427} 8.2.15.4	Device properties


[Nm] {5428} The UE shall include this IE if the UE is configured for NAS signalling low priority.


[H3] {5429} 8.2.16	GUTI reallocation command


[H4] {5430} 8.2.16.1	Message definition


[Nm] {5431} This message is sent by the network to the UE to reallocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both. See table 8.2.16.1.


	[B1] {5432} Message type:	GUTI REALLOCATION COMMAND


	[B1] {5433} Significance:	dual


	[B1] {5434} Direction:	network to UE


[H4] {5435} 8.2.16.2	TAI list


[Nm] {5436} This IE may be included to assign a TAI list to the UE.


[H4] {5437} 8.2.16.3	DCN-ID


[Nm] {5438} This IE may be included to assign a new DCN-ID to the UE.


[H4] {5439} 8.2.16.4	UE radio capability ID


[Nm] {5440} This IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to assign a network-assigned UE radio capability ID to the UE. If this IE is included, the UE radio capability ID deletion indication IE shall not be included.


[H4] {5441} 8.2.16.5	UE radio capability ID deletion indication


[Nm] {5442} This IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN. If this IE is included, the UE radio capability ID IE shall not be included.


[H3] {5443} 8.2.17	GUTI reallocation complete


[Nm] {5444} This message is sent by the UE to the network to indicate that reallocation of a GUTI has taken place. See table 8.2.17.1.


	[B1] {5445} Message type:	GUTI REALLOCATION COMPLETE


	[B1] {5446} Significance:	dual


	[B1] {5447} Direction:	UE to network


[H3] {5448} 8.2.18	Identity request


[Nm] {5449} This message is sent by the network to the UE to request the UE to provide the specified identity. See table 8.2.18.1.


	[B1] {5450} Message type:	IDENTITY REQUEST


	[B1] {5451} Significance:	dual


	[B1] {5452} Direction:	network to UE


[H3] {5453} 8.2.19	Identity response


[Nm] {5454} This message is sent by the UE to the network in response to an IDENTITY REQUEST message and provides the requested identity. See table 8.2.19.1.


	[B1] {5455} Message type:	IDENTITY RESPONSE


	[B1] {5456} Significance:	dual


	[B1] {5457} Direction:	UE to network


[H3] {5458} 8.2.20	Security mode command


[H4] {5459} 8.2.20.1	Message definition


[Nm] {5460} This message is sent by the network to the UE to establish NAS signalling security. See table 8.2.20.1.


	[B1] {5461} Message type:	SECURITY MODE COMMAND


	[B1] {5462} Significance:	dual


	[B1] {5463} Direction:	network to UE


[H4] {5464} 8.2.20.2	IMEISV request


[Nm] {5465} The MME may include this information element to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message.


[H4] {5466} 8.2.20.3	Replayed nonceUE


[Nm] {5467} The MME may include this information element to indicate to the UE to use the replayed nonceUE.


[H4] {5468} 8.2.20.4	NonceMME


[Nm] {5469} The MME may include this information element to indicate to the UE to use the nonceMME.


[H4] {5470} 8.2.20.5	HashMME


[Nm] {5471} The MME shall include this information element when the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message was received without integrity protection or did not successfully pass the integrity check at the MME.


[H4] {5472} 8.2.20.6	Replayed UE additional security capability


[Nm] {5473} The MME shall include this IE if the MME supports handling of UE additional security capabilities, the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message included a UE additional security capability IE.


[H4] {5474} 8.2.20.7	UE radio capability ID request


[Nm] {5475} The MME may include this information element in WB-S1 mode to request the UE to send its UE radio capability ID with the corresponding SECURITY MODE COMPLETE message.


[H3] {5476} 8.2.21	Security mode complete


[H4] {5477} 8.2.21.1	Message definition


[Nm] {5478} This message is sent by the UE to the network in response to a SECURITY MODE COMMAND message. See table 8.2.21.1.


	[B1] {5479} Message type:	SECURITY MODE COMPLETE


	[B1] {5480} Significance:	dual


	[B1] {5481} Direction:	UE to network


[H4] {5482} 8.2.21.2	IMEISV


[Nm] {5483} The UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message.


[H4] {5484} 8.2.21.3	Replayed NAS message container


[Nm] {5485} The UE shall include this information element, if during an ongoing attach or tracking area updating procedure, the MME included HASHMME in the SECURITY MODE COMMAND message and HASHMME has a different value from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19].


[H4] {5486} 8.2.21.4	UE radio capability ID


[Nm] {5487} The UE shall include this information element in WB-S1 mode if the UE radio capability ID was requested within the corresponding SECURITY MODE COMMAND message.


[H3] {5488} 8.2.22	Security mode reject


[Nm] {5489} This message is sent by the UE to the network to indicate that the corresponding security mode command has been rejected. See table 8.2.22.1.


	[B1] {5490} Message type:	SECURITY MODE REJECT


	[B1] {5491} Significance:	dual


	[B1] {5492} Direction:	UE to network


[H3] {5493} 8.2.23	Security protected NAS message


[Nm] {5494} This message is sent by the UE or the network to transfer a NAS message together with the sequence number and the message authentication code protecting the message. See table 8.2.23.1.


	[B1] {5495} Message type:	SECURITY PROTECTED NAS MESSAGE


	[B1] {5496} Significance:	dual


	[B1] {5497} Direction:	both


[H3] {5498} 8.2.24	Service reject


[H4] {5499} 8.2.24.1	Message definition


[Nm] {5500} This message is sent by the network to the UE in order to reject the service request procedure. See table 8.2.24.1.


	[B1] {5501} Message type:	SERVICE REJECT


	[B1] {5502} Significance:	dual


	[B1] {5503} Direction:	network to UE


[H4] {5504} 8.2.24.2	T3442 value


[Nm] {5505} The MME shall include this IE when the EMM cause value is #39 "CS service temporarily not available".


[H4] {5506} 8.2.24.3	T3346 value


[Nm] {5507} The MME may include this IE when the general NAS level mobility management congestion control is active.


[H4] {5508} 8.2.24.4	T3448 value


[Nm] {5509} The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


[H3] {5510} 8.2.25	Service request


[Nm] {5511} This message is sent by the UE to the network to request the establishment of a NAS signalling connection and of the radio and S1 bearers. Its structure does not follow the structure of a standard layer 3 message. See table 8.2.25.1.


	[B1] {5512} Message type:	SERVICE REQUEST


	[B1] {5513} Significance:	dual


	[B1] {5514} Direction:	UE to network


[H3] {5515} 8.2.26	Tracking area update accept


[H4] {5516} 8.2.26.1	Message definition


[Nm] {5517} This message is sent by the network to the UE to provide the UE with EPS mobility management related data in response to a tracking area update request message. See table 8.2.26.1.


	[B1] {5518} Message type:	TRACKING AREA UPDATE ACCEPT


	[B1] {5519} Significance:	dual


	[B1] {5520} Direction:	network to UE


[H4] {5521} 8.2.26.2	T3412 value


[Nm] {5522} The MME shall include this IE during normal and combined tracking area updating procedure, and may include this IE during periodic tracking area updating procedure.


[Nm] {5523} The MME shall include this IE if it includes the T3412 extended value IE.


[H4] {5524} 8.2.26.3	GUTI


[Nm] {5525} This IE may be included to assign a GUTI to a UE.


[H4] {5526} 8.2.26.4	TAI list


[Nm] {5527} This IE may be included to assign a TAI list to a UE.


[H4] {5528} 8.2.26.5	EPS bearer context status


[Nm] {5529} This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.


[H4] {5530} 8.2.26.6	Location area identification


[Nm] {5531} This IE may be included to assign a new location area identification to a UE during a combined TA/LA update.


[H4] {5532} 8.2.26.7	MS identity


[Nm] {5533} This IE may be included to assign or unassign a new TMSI to a UE during a combined TA/LA update.


[H4] {5534} 8.2.26.8	EMM cause


[Nm] {5535} This IE shall be included if the combined tracking area updating procedure was successful for EPS services only.


[H4] {5536} 8.2.26.9	T3402 value


[Nm] {5537} This IE may be included to indicate a value for timer T3402.


[H4] {5538} 8.2.26.10	T3423 value


[Nm] {5539} This IE may be included to indicate a value for timer T3423.


[Nm] {5540} If this IE is not included, the UE shall use the default value.


[H4] {5541} 8.2.26.11	Equivalent PLMNs


[Nm] {5542} This IE may be included in order to assign a new equivalent PLMNs list to a UE.


[H4] {5543} 8.2.26.12	Emergency number list


[Nm] {5544} This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.


[H4] {5545} 8.2.26.12A	Extended emergency number list


[Nm] {5546} This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.


[H4] {5547} 8.2.26.13	EPS network feature support


[Nm] {5548} The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).


[H4] {5549} 8.2.26.14	Additional update result


[Nm] {5550} The network may include this IE to provide the UE with additional information about the result of:


	[B1] {5551} -	a combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or


	[B1] {5552} -	a normal tracking area updating procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".


[H4] {5553} 8.2.26.15	T3412 extended value


[Nm] {5554} The network may include this IE to provide the UE with a longer periodic tracking area update timer.


[H4] {5555} 8.2.26.16	T3324 value


[Nm] {5556} The network shall include the T3324 value IE if:


	[B1] {5557} -	the UE included the T3324 value IE in the TRACKING AREA UPDATE REQUEST message; and


	[B1] {5558} -	the network supports PSM and accepts the use of PSM.


[H4] {5559} 8.2.26.17	Extended DRX parameters


[Nm] {5560} The network shall include the Extended DRX parameters IE if:


	[B1] {5561} -	the UE included the Extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message; and


	[B1] {5562} -	the network supports eDRX and accepts the use of eDRX.


[H4] {5563} 8.2.26.18	DCN-ID


[Nm] {5564} This IE is included in the message when the network wishes to provide a DCN-ID to the UE.


[H4] {5565} 8.2.26.19	SMS services status


[Nm] {5566} This IE may be included when a normal tracking area updating procedure for EPS services and "SMS only" was successful for EPS services only.


[H4] {5567} 8.2.26.20	Non-3GPP NW provided policies


[Nm] {5568} This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


[H4] {5569} 8.2.26.21	T3448 value


[Nm] {5570} The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


[H4] {5571} 8.2.26.22	Network policy


[Nm] {5572} This IE is included if the network needs to indicate network policy information to the UE, If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


[H4] {5573} 8.2.26.23	T3447 value


[Nm] {5574} The network may include T3447 value IE if:


	[B1] {5575} -	the UE has indicated support for service gap control in the TRACKING AREA UPDATE REQUEST messages; and


	[B1] {5576} -	the EMM context contains a service gap time value.


[H4] {5577} 8.2.26.24	Ciphering key data


[Nm] {5578} This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.


[H4] {5579} 8.2.26.25	UE radio capability ID


[Nm] {5580} This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.


[H4] {5581} 8.2.26.26	UE radio capability ID deletion indication


[Nm] {5582} This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.


[H4] {5583} 8.2.26.27	Negotiated WUS assistance information


[Nm] {5584} The network shall include the Negotiated WUS assistance information IE if:


	[B1] {5585} -	the UE supports WUS assistance; 


	[B1] {5586} -	the MME supports and accepts the use of WUS assistance; and


	[B1] {5587} -	the UE is not attaching for emergency bearer services.


[H4] {5588} 8.2.26.28	Negotiated DRX parameter in NB-S1 mode


[Nm] {5589} The network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message.


[H3] {5590} 8.2.27	Tracking area update complete


[Nm] {5591} This message shall be sent by the UE to the network in response to a tracking area update accept message if a GUTI has been changed or a new TMSI has been assigned. See table 8.2.27.1.


	[B1] {5592} Message type:	TRACKING AREA UPDATE COMPLETE


	[B1] {5593} Significance:	dual


	[B1] {5594} Direction:	UE to network


[H3] {5595} 8.2.28	Tracking area update reject


[H4] {5596} 8.2.28.1	Message definition


[Nm] {5597} This message is sent by the network to the UE in order to reject the tracking area updating procedure. See table 8.2.28.1.


	[B1] {5598} Message type:	TRACKING AREA UPDATE REJECT


	[B1] {5599} Significance:	dual


	[B1] {5600} Direction:	network to UE


[H4] {5601} 8.2.28.2	T3346 value


[Nm] {5602} The MME may include this IE when the general NAS level mobility management congestion control is active.


[H4] {5603} 8.2.28.3	Extended EMM cause


[Nm] {5604} This IE may be included by the network to indicate additional information associated with the EMM cause.


[H3] {5605} 8.2.29	Tracking area update request


[H4] {5606} 8.2.29.1	Message definition


[Nm] {5607} The purposes of sending the tracking area update request by the UE to the network are described in subclause 5.5.3.1. See table 8.2.29.1.


	[B1] {5608} Message type:	TRACKING AREA UPDATE REQUEST


	[B1] {5609} Significance:	dual


	[B1] {5610} Direction:	UE to network


[H4] {5611} 8.2.29.2	Non-current native NAS key set identifier


[Nm] {5612} The UE shall include this IE if the UE has a valid non-current native EPS security context when the UE performs an A/Gb mode or Iu mode or N1 mode to S1 mode inter-system change in EMM-CONNECTED mode and the UE uses a mapped EPS security context to protect the TRACKING AREA UPDATE REQUEST message.


[H4] {5613} 8.2.29.3	GPRS ciphering key sequence number


[Nm] {5614} The UE shall include this IE if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in EMM-IDLE mode and the TIN indicates "P-TMSI".


[H4] {5615} 8.2.29.4	Old P-TMSI signature


[Nm] {5616} The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI signature, P-TMSI and RAI.


[H4] {5617} 8.2.29.5	Additional GUTI


[Nm] {5618} The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI.


[H4] {5619} 8.2.29.6	NonceUE


[Nm] {5620} This IE is included if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in idle mode and the TIN is set to "P-TMSI".


[H4] {5621} 8.2.29.7	UE network capability


[Nm] {5622} The UE shall include this IE, unless the UE performs a periodic tracking area updating procedure.


[H4] {5623} 8.2.29.8	Last visited registered TAI


[Nm] {5624} This IE shall be included if the UE holds a valid last visited registered TAI.


[H4] {5625} 8.2.29.9	DRX parameter


[Nm] {5626} This IE is included by the UE to indicate a change of UE specific DRX parameters to the network.


[H4] {5627} 8.2.29.10	UE radio capability information update needed


[Nm] {5628} The UE shall include this IE if the UE radio capability information in the network needs to be updated.


[H4] {5629} 8.2.29.11	EPS bearer context status


[Nm] {5630} This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE. 


[H4] {5631} 8.2.29.12	MS network capability


[Nm] {5632} A UE supporting A/Gb mode or Iu mode shall include this IE, unless the UE performs a periodic tracking area updating procedure.


[H4] {5633} 8.2.29.13	Old location area identification


[Nm] {5634} The UE shall include this IE during a combined tracking area updating procedure if it has a valid location area identification.


[H4] {5635} 8.2.29.14	TMSI status


[Nm] {5636} The UE shall include this IE during a combined tracking area updating procedure if it has no valid TMSI available.


[H4] {5637} 8.2.29.15	Mobile station classmark 2


[Nm] {5638} This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined tracking area updating procedure.


[H4] {5639} 8.2.29.16	Mobile station classmark 3


[Nm] {5640} This IE shall be included if the UE supports SRVCC to GERAN.


[H4] {5641} 8.2.29.17	Supported Codecs


[Nm] {5642} This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.


[H4] {5643} 8.2.29.18	Additional update type


[Nm] {5644} The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations, unless the UE performs a periodic tracking area updating procedure.


[H4] {5645} 8.2.29.19	Voice domain preference and UE's usage setting


[Nm] {5646} This IE shall be included in WB-S1 mode if and only if the UE supports:


	[B1] {5647} -	CS fallback and SMS over SGs; or


	[B1] {5648} -	if the UE is configured to support IMS voice, but does not support 1xCS fallback.


[H4] {5649} 8.2.29.20	Old GUTI type


[Nm] {5650} The UE shall include this IE.


[H4] {5651} 8.2.29.21	Device properties


[Nm] {5652} This IE shall be included if the UE is configured for NAS signalling low priority.


[H4] {5653} 8.2.29.22	MS network feature support


[Nm] {5654} This IE shall be included if the UE supports extended periodic timer T3412.


[H4] {5655} 8.2.29.23	TMSI based NRI container


[Nm] {5656} The UE shall include this IE if it has a valid TMSI.


[H4] {5657} 8.2.29.24	T3324 value


[Nm] {5658} The UE may include this IE to request the use of PSM.


[H4] {5659} 8.2.29.25	T3412 extended value


[Nm] {5660} The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.


[H4] {5661} 8.2.29.26	Extended DRX parameters


[Nm] {5662} The UE may include this IE to request the use of eDRX.


[H4] {5663} 8.2.29.27	UE additional security capability


[Nm] {5664} The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.


[H4] {5665} 8.2.29.28	UE status


[Nm] {5666} This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.


[H4] {5667} 8.2.29.29	Additional information requested


[Nm] {5668} The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.


[H4] {5669} 8.2.29.30	N1 UE network capability


[Nm] {5670} The UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN, unless the UE performs a periodic tracking area updating procedure.


[H4] {5671} 8.2.29.31	UE radio capability ID availability IE


[Nm] {5672} The UE may include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.


[H4] {5673} 8.2.29.32	DRX parameter in NB-S1 mode


[Nm] {5674} This IE is included if the UE intends to use or change the UE specific DRX parameter in NB-S1 mode, except when the UE performs a periodic tracking area updating procedure.


[H4] {5675} 8.2.29.33	Requested WUS assistance information


[Nm] {5676} The UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.


[H3] {5677} 8.2.30	Uplink NAS Transport


[Nm] {5678} This message is sent by the UE to the network in order to carry an SMS message in encapsulated format. See table 8.2.30.1.


	[B1] {5679} Message type:	UPLINK NAS TRANSPORT


	[B1] {5680} Significance:	dual


	[B1] {5681} Direction:	UE to network


[H3] {5682} 8.2.31	Downlink generic NAS transport


[H4] {5683} 8.2.31.1	Message definition


[Nm] {5684} This message is sent by the network to the UE in order to carry an application message in encapsulated format. See table 8.2.31.1.


	[B1] {5685} Message type:	DOWNLINK GENERIC NAS TRANSPORT


	[B1] {5686} Significance:	dual


	[B1] {5687} Direction:	network to UE


[H4] {5688} 8.2.31.2	Additional information


[Nm] {5689} The MME may include this information element if the application wants to send any additional information.


[H3] {5690} 8.2.32	Uplink generic NAS transport


[H4] {5691} 8.2.32.1	Message definition


[Nm] {5692} This message is sent by the UE to the network in order to carry an application protocol message in encapsulated format. See table 8.2.32.1.


	[B1] {5693} Message type:	UPLINK GENERIC NAS TRANSPORT


	[B1] {5694} Significance:	dual


	[B1] {5695} Direction:	UE to network


[H4] {5696} 8.2.32.2	Additional information


[Nm] {5697} The UE may include this information element if the application wants to send any additional information.


[H3] {5698} 8.2.33	CONTROL PLANE SERVICE REQUEST


[H4] {5699} 8.2.33.1	Message definition


[Nm] {5700} This message is sent by the UE to the network when the UE is using EPS services with control plane CIoT EPS optimization. See table 8.2.33.1.


	[B1] {5701} Message type:	CONTROL PLANE SERVICE REQUEST


	[B1] {5702} Significance:	dual


	[B1] {5703} Direction:	UE to network


[H4] {5704} 8.2.33.2	ESM message container


[Nm] {5705} The UE shall include this IE, if it wants to send an ESM message to the network.


[H4] {5706} 8.2.33.3	NAS message container


[Nm] {5707} The UE shall include this IE, if it is in EMM-IDLE mode and has pending SMS messages to be sent.


[H4] {5708} 8.2.33.4	EPS bearer context status


[Nm] {5709} The UE shall include this IE, if it wants to indicate the EPS bearer contexts that are active within the UE.


[H4] {5710} 8.2.33.5	Device properties


[Nm] {5711} The UE shall include this IE if the UE is configured for NAS signalling low priority.


[H3] {5712} 8.2.34	Service Accept


[H4] {5713} 8.2.34.1	Message definition


[Nm] {5714} This message is sent by the network in response to the SERVICE REQUEST message, the EXTENDED SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message. See table 8.2.34.1.


	[B1] {5715} Message type:	SERVICE ACCEPT


	[B1] {5716} Significance:	dual


	[B1] {5717} Direction:	network to UE


[H4] {5718} 8.2.34.2	EPS bearer context status


[Nm] {5719} This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.


[H4] {5720} 8.2.34.3	T3448 value


[Nm] {5721} The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


[H2] {5722} 8.3	EPS session management messages


[H3] {5723} 8.3.1	Activate dedicated EPS bearer context accept


[H4] {5724} 8.3.1.1	Message definition


[Nm] {5725} This message is sent by the UE to the network to acknowledge activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active EPS bearer context. See table 8.3.1.1.


	[B1] {5726} Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT


	[B1] {5727} Significance:	dual


	[B1] {5728} Direction:	UE to network


[H4] {5729} 8.3.1.2	Protocol configuration options


[Nm] {5730} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5731} 8.3.1.3	NBIFOM container


[Nm] {5732} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5733} 8.3.1.4	Extended protocol configuration options


[Nm] {5734} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5735} 8.3.2	Activate dedicated EPS bearer context reject


[H4] {5736} 8.3.2.1	Message definition


[Nm] {5737} This message is sent by UE to the network to reject activation of a dedicated EPS bearer context. See table 8.3.2.1.


	[B1] {5738} Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT


	[B1] {5739} Significance:	dual


	[B1] {5740} Direction:	UE to network


[H4] {5741} 8.3.2.2	Protocol configuration options


[Nm] {5742} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5743} 8.3.2.3	NBIFOM container


[Nm] {5744} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5745} 8.3.2.4	Extended protocol configuration options


[Nm] {5746} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5747} 8.3.3	Activate dedicated EPS bearer context request


[H4] {5748} 8.3.3.1	Message definition


[Nm] {5749} This message is sent by the network to the UE to request activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active default EPS bearer context. See table 8.3.3.1.


	[B1] {5750} Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST


	[B1] {5751} Significance:	dual


	[B1] {5752} Direction:	network to UE


[H4] {5753} 8.3.3.2	Transaction identifier


[Nm] {5754} If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE


[H4] {5755} 8.3.3.3	Negotiated QoS


[Nm] {5756} If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


[H4] {5757} 8.3.3.4	Negotiated LLC SAPI


[Nm] {5758} If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5759} 8.3.3.5	Radio priority


[Nm] {5760} If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5761} 8.3.3.6	Packet flow identifier


[Nm] {5762} If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5763} 8.3.3.7	Protocol configuration options


[Nm] {5764} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5765} 8.3.3.8	WLAN offload indication


[Nm] {5766} This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


[H4] {5767} 8.3.3.9	NBIFOM container


[Nm] {5768} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5769} 8.3.3.10	Extended protocol configuration options


[Nm] {5770} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5771} 8.3.3.11	Extended EPS QoS


[Nm] {5772} This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


[H3] {5773} 8.3.4	Activate default EPS bearer context accept


[H4] {5774} 8.3.4.1	Message definition


[Nm] {5775} This message is sent by the UE to the network to acknowledge activation of a default EPS bearer context. See table 8.3.4.1.


	[B1] {5776} Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT


	[B1] {5777} Significance:	dual


	[B1] {5778} Direction:	UE to network


[H4] {5779} 8.3.4.2	Protocol configuration options


[Nm] {5780} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5781} 8.3.4.3	Extended protocol configuration options


[Nm] {5782} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5783} 8.3.5	Activate default EPS bearer context reject


[H4] {5784} 8.3.5.1	Message definition


[Nm] {5785} This message is sent by UE to the network to reject activation of a default EPS bearer context. See table 8.3.5.1.


	[B1] {5786} Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT


	[B1] {5787} Significance:	dual


	[B1] {5788} Direction:	UE to network


[H4] {5789} 8.3.5.2	Protocol configuration options


[Nm] {5790} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5791} 8.3.5.3	Extended protocol configuration options


[Nm] {5792} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5793} 8.3.6	Activate default EPS bearer context request


[H4] {5794} 8.3.6.1	Message definition


[Nm] {5795} This message is sent by the network to the UE to request activation of a default EPS bearer context. See table 8.3.6.1.


	[B1] {5796} Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST


	[B1] {5797} Significance:	dual


	[B1] {5798} Direction:	network to UE


[H4] {5799} 8.3.6.2	Transaction identifier


[Nm] {5800} If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE.


[H4] {5801} 8.3.6.3	Negotiated QoS


[Nm] {5802} If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


[H4] {5803} 8.3.6.4	Negotiated LLC SAPI


[Nm] {5804} If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5805} 8.3.6.5	Radio priority


[Nm] {5806} If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5807} 8.3.6.6	Packet flow identifier


[Nm] {5808} If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {5809} 8.3.6.7	APN-AMBR


[Nm] {5810} This IE is included in the message when the network wishes to transmit the APN-AMBR to the UE for possible uplink policy enforcement.


[H4] {5811} 8.3.6.8	ESM cause


[Nm] {5812} The network shall include this IE, if the network allocated a PDN address of a PDN type which is different from the PDN type requested by the UE.


[H4] {5813} 8.3.6.9	Protocol configuration options


[Nm] {5814} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[Nm] {5815} This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5816} 8.3.6.10	Connectivity type


[Nm] {5817} The network shall include the Connectivity type IE if:


	[B1] {5818} -	the network is configured to indicate when a PDN connection is a LIPA PDN connection; and


	[B1] {5819} -	the present PDN connection is a LIPA PDN connection.


[H4] {5820} 8.3.6.11	WLAN offload indication


[Nm] {5821} This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


[H4] {5822} 8.3.6.12	NBIFOM container 


[Nm] {5823} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5824} 8.3.6.13	Header compression configuration


[Nm] {5825} The network may include the Header compression configuration IE if:


	[B1] {5826} -	the network accepts an IP PDN type; and


	[B1] {5827} -	control plane CIoT EPS optimization is selected.


[H4] {5828} 8.3.6.14	Control plane only indication


[Nm] {5829} The network shall include the Control plane only indication IE if the associated PDN connection is only for control plane CIoT EPS optimization.


[H4] {5830} 8.3.6.15	Extended protocol configuration options


[Nm] {5831} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[Nm] {5832} This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5833} 8.3.6.16	Serving PLMN rate control


[Nm] {5834} This IE shall be included when the network wishes to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval.


[H4] {5835} 8.3.6.17	Extended APN aggregate maximum bit rate


[Nm] {5836} This IE shall be included in the message only if the network wishes to transmit the APN-AMBR values to the UE for possible uplink policy enforcement and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2.


[H3] {5837} 8.3.7	Bearer resource allocation reject


[H4] {5838} 8.3.7.1	Message definition


[Nm] {5839} This message is sent by the network to the UE to reject the allocation of a dedicated bearer resource. See table 8.3.7.1.


	[B1] {5840} Message type:	BEARER RESOURCE ALLOCATION REJECT


	[B1] {5841} Significance:	dual


	[B1] {5842} Direction:	network to UE


[H4] {5843} 8.3.7.2	Protocol configuration options


[Nm] {5844} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5845} 8.3.7.3	Back-off timer value


[Nm] {5846} The network may include this IE if the ESM cause is not #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.


[H4] {5847} 8.3.7.4	Re-attempt indicator


[Nm] {5848} The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


[H4] {5849} 8.3.7.5	NBIFOM container


[Nm] {5850} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5851} 8.3.7.6	Extended protocol configuration options


[Nm] {5852} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5853} 8.3.8	Bearer resource allocation request


[H4] {5854} 8.3.8.1	Message definition


[Nm] {5855} This message is sent by the UE to the network to request the allocation of a dedicated bearer resource. See table 8.3.8.1.


	[B1] {5856} Message type:	BEARER RESOURCE ALLOCATION REQUEST


	[B1] {5857} Significance:	dual


	[B1] {5858} Direction:	UE to network


[H4] {5859} 8.3.8.2	Protocol configuration options


[Nm] {5860} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5861} 8.3.8.3	Device properties


[Nm] {5862} The UE shall include this IE if the UE is configured for NAS signalling low priority.


[H4] {5863} 8.3.8.4	NBIFOM container


[Nm] {5864} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5865} 8.3.8.5	Extended protocol configuration options


[Nm] {5866} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5867} 8.3.8.6	Extended EPS QoS


[Nm] {5868} This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


[H3] {5869} 8.3.9	Bearer resource modification reject


[H4] {5870} 8.3.9.1	Message definition


[Nm] {5871} This message is sent by the network to the UE to reject the modification of a dedicated bearer resource. See table 8.3.9.1.


	[B1] {5872} Message type:	BEARER RESOURCE MODIFICATION REJECT


	[B1] {5873} Significance:	dual


	[B1] {5874} Direction:	network to UE


[H4] {5875} 8.3.9.2	Protocol configuration options


[Nm] {5876} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5877} 8.3.9.3	Back-off timer value


[Nm] {5878} The network may include this IE to request a minimum time interval before procedure retry is allowed.


[H4] {5879} 8.3.9.4	Re-attempt indicator


[Nm] {5880} The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


[H4] {5881} 8.3.9.5	NBIFOM container


[Nm] {5882} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5883} 8.3.9.6	Extended protocol configuration options


[Nm] {5884} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5885} 8.3.10	Bearer resource modification request


[H4] {5886} 8.3.10.1	Message definition


[Nm] {5887} This message is sent by the UE to the network to request the modification of a dedicated bearer resource, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the network has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.10.1.


	[B1] {5888} Message type:	BEARER RESOURCE MODIFICATION REQUEST


	[B1] {5889} Significance:	dual


	[B1] {5890} Direction:	UE to network


[H4] {5891} 8.3.10.2	Required traffic flow QoS


[Nm] {5892} This IE is included in the message when the UE requests a change of QoS for the indicated traffic flows and does not request to release all bearer resources for the EPS bearer context.


[H4] {5893} 8.3.10.3	ESM cause


[Nm] {5894} This IE is included in the message when the UE requests the release of a dedicated bearer resource.


[H4] {5895} 8.3.10.4	Protocol configuration options


[Nm] {5896} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5897} 8.3.10.5	Device properties


[Nm] {5898} The UE shall include this IE if the UE is configured for NAS signalling low priority.


[H4] {5899} 8.3.10.6	NBIFOM container


[Nm] {5900} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5901} 8.3.10.7	Header compression configuration


[Nm] {5902} This IE is included in the message if:


	[B1] {5903} a)	the UE wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network supports Control plane CIoT EPS optimization and header compression; or


	[B1] {5904} b)	to negotiate header compression configuration associated to an EPS bearer context after an inter-system change from N1 mode to S1 mode when both the UE and the network support control plane CIoT EPS optimization and header compression, and the UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network.


[H4] {5905} 8.3.10.8	Extended protocol configuration options


[Nm] {5906} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5907} 8.3.10.9	Extended EPS QoS


[Nm] {5908} This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


[H3] {5909} 8.3.11	Deactivate EPS bearer context accept


[H4] {5910} 8.3.11.1	Message definition


[Nm] {5911} This message is sent by the UE to acknowledge deactivation of the EPS bearer context requested in the corresponding Deactivate EPS bearer context request message. See table 8.3.11.1.


	[B1] {5912} Message type:	DEACTIVATE EPS BEARER CONTEXT ACCEPT


	[B1] {5913} Significance:	dual


	[B1] {5914} Direction:	UE to network


[H4] {5915} 8.3.11.2	Protocol configuration options


[Nm] {5916} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5917} 8.3.11.3	Void


[H4] {5918} 8.3.11.4	Extended protocol configuration options


[Nm] {5919} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5920} 8.3.12	Deactivate EPS bearer context request


[H4] {5921} 8.3.12.1	Message definition


[Nm] {5922} This message is sent by the network to request deactivation of an active EPS bearer context. See table 8.3.12.1.


	[B1] {5923} Message type:	DEACTIVATE EPS BEARER CONTEXT REQUEST


	[B1] {5924} Significance:	dual


	[B1] {5925} Direction:	network to UE


[H4] {5926} 8.3.12.2	Protocol configuration options


[Nm] {5927} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5928} 8.3.12.3	T3396 value


[Nm] {5929} The network may include this IE if the ESM cause is #26 "insufficient resources".


[H4] {5930} 8.3.12.4	WLAN offload indication


[Nm] {5931} This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. If the MME wishes to deactivate all EPS bearer contexts of a PDN connection, MME shall not include this IE.


[H4] {5932} 8.3.12.5	NBIFOM container


[Nm] {5933} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5934} 8.3.12.6	Extended protocol configuration options


[Nm] {5935} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5936} 8.3.12A	ESM dummy message


[Nm] {5937} This message is sent by the UE or the network included in an ESM message container information element during an attach procedure, if the UE does not request for PDN connection. See table 8.3.12A.1.


	[B1] {5938} Message type:	ESM DUMMY MESSAGE


	[B1] {5939} Significance:	dual


	[B1] {5940} Direction:	both


[H3] {5941} 8.3.13	ESM information request


[Nm] {5942} This message is sent by the network to the UE to request the UE to provide ESM information, i.e. protocol configuration options or APN or both. See table 8.3.13.1.


	[B1] {5943} Message type:	ESM INFORMATION REQUEST


	[B1] {5944} Significance:	dual


	[B1] {5945} Direction:	network to UE


[H3] {5946} 8.3.14	ESM information response


[H4] {5947} 8.3.14.1	Message definition


[Nm] {5948} This message is sent by the UE to the network in response to an ESM INFORMATION REQUEST message and provides the requested ESM information. See table 8.3.14.1.


	[B1] {5949} Message type:	ESM INFORMATION RESPONSE


	[B1] {5950} Significance:	dual


	[B1] {5951} Direction:	UE to network


[H4] {5952} 8.3.14.2	Access point name


[Nm] {5953} This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name during the attach procedure.


[H4] {5954} 8.3.14.3	Protocol configuration options


[Nm] {5955} This IE is included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet.


[Nm] {5956} This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet.


[Nm] {5957} This IE shall not be included if the Extended protocol configuration options IE is included in the message.


[H4] {5958} 8.3.14.4	Extended protocol configuration options


[Nm] {5959} This IE is included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and the UE is in NB-S1 mode or Non-IP or Ethernet PDN Type is requested.


[Nm] {5960} This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet.


[Nm] {5961} This IE shall not be included if the Protocol configuration options IE is included in the message.


[H3] {5962} 8.3.15	ESM status


[Nm] {5963} This message is sent by the network or the UE to pass information on the status of the indicated EPS bearer context and report certain error conditions (e.g. as listed in clause 7). See table 8.3.15.1.


	[B1] {5964} Message type:	ESM STATUS


	[B1] {5965} Significance:	dual


	[B1] {5966} Direction:	both


[H3] {5967} 8.3.16	Modify EPS bearer context accept


[H4] {5968} 8.3.16.1	Message definition


[Nm] {5969} This message is sent by the UE to the network to acknowledge the modification of an active EPS bearer context. See table 8.3.16.1.


	[B1] {5970} Message type:	MODIFY EPS BEARER CONTEXT ACCEPT


	[B1] {5971} Significance:	dual


	[B1] {5972} Direction:	UE to network


[H4] {5973} 8.3.16.2	Protocol configuration options


[Nm] {5974} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5975} 8.3.16.3	NBIFOM container


[Nm] {5976} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5977} 8.3.16.4	Extended protocol configuration options


[Nm] {5978} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5979} 8.3.17	Modify EPS bearer context reject


[H4] {5980} 8.3.17.1	Message definition


[Nm] {5981} This message is sent by the UE or the network to reject a modification of an active EPS bearer context. See table 8.3.17.1.


	[B1] {5982} Message type:	MODIFY EPS BEARER CONTEXT REJECT


	[B1] {5983} Significance:	dual


	[B1] {5984} Direction:	UE to network


[H4] {5985} 8.3.17.2	Protocol configuration options


[Nm] {5986} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {5987} 8.3.17.3	NBIFOM container


[Nm] {5988} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {5989} 8.3.17.4	Extended protocol configuration options


[Nm] {5990} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {5991} 8.3.18	Modify EPS bearer context request


[H4] {5992} 8.3.18.1	Message definition


[Nm] {5993} This message is sent by the network to the UE to request modification of an active EPS bearer context, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the UE has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.18.1.


	[B1] {5994} Message type:	MODIFY EPS BEARER CONTEXT REQUEST


	[B1] {5995} Significance:	dual


	[B1] {5996} Direction:	network to UE


[H4] {5997} 8.3.18.2	New EPS QoS


[Nm] {5998} When the EPS QoS of the EPS bearer context is modified, the network shall include the modified EPS QoS assigned to the EPS bearer context.


[H4] {5999} 8.3.18.3	TFT


[Nm] {6000} This IE provides the UE with packet filters.


[H4] {6001} 8.3.18.4	New QoS


[Nm] {6002} If the UE supports A/Gb mode or Iu mode or both and when the corresponding R99 QoS of the EPS bearer context is modified, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


[H4] {6003} 8.3.18.5	Negotiated LLC SAPI


[Nm] {6004} If the UE supports A/Gb mode and when the negotiated LLC SAPI is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {6005} 8.3.18.6	Radio priority


[Nm] {6006} If the UE supports A/Gb mode and when the radio priority is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {6007} 8.3.18.7	Packet flow identifier


[Nm] {6008} If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


[H4] {6009} 8.3.18.8	APN-AMBR


[Nm] {6010} This IE is included when the APN-AMBR has been changed by the network.


[H4] {6011} 8.3.18.9	Protocol configuration options


[Nm] {6012} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {6013} 8.3.18.10	WLAN offload indication


[Nm] {6014} This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


[H4] {6015} 8.3.18.11	NBIFOM container


[Nm] {6016} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {6017} 8.3.18.12	Header compression configuration


	[B1] {6018} This IE is included in the message if the network wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network support Control plane CIoT EPS optimization and header compression.


[H4] {6019} 8.3.18.13	Extended protocol configuration options


[Nm] {6020} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {6021} 8.3.18.14	Extended APN-AMBR


[Nm] {6022} This IE shall be included in the message only if at least one of the APN-AMBR values has been changed by the network and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2.


[H4] {6023} 8.3.18.15	Extended EPS QoS


[Nm] {6024} This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


[H3] {6025} 8.3.18A	Notification


[Nm] {6026} This message is sent by the network to inform the UE about events which are relevant for the upper layer using an EPS bearer context or having requested a procedure transaction. See table 8.3.18A.1.


	[B1] {6027} Message type:	NOTIFICATION


	[B1] {6028} Significance:	local


	[B1] {6029} Direction:	network to UE


[H3] {6030} 8.3.19	PDN connectivity reject


[H4] {6031} 8.3.19.1	Message definition


[Nm] {6032} This message is sent by the network to the UE to reject establishment of a PDN connection. See table 8.3.19.1.


	[B1] {6033} Message type:	PDN CONNECTIVITY REJECT


	[B1] {6034} Significance:	dual


	[B1] {6035} Direction:	network to UE


[H4] {6036} 8.3.19.2	Protocol configuration options


[Nm] {6037} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {6038} 8.3.19.3	Back-off timer value


[Nm] {6039} The network may include this IE if the ESM cause is not #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.


[H4] {6040} 8.3.19.4	Re-attempt indicator


[Nm] {6041} The network may include this IE only if the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #66 "requested APN not supported in current RAT and PLMN combination", or if the network includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


[H4] {6042} 8.3.19.5	Extended protocol configuration options


[Nm] {6043} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {6044} 8.3.20	PDN connectivity request


[H4] {6045} 8.3.20.1	Message definition


[Nm] {6046} This message is sent by the UE to the network to initiate establishment of a PDN connection. See table 8.3.20.1.


	[B1] {6047} Message type:	PDN CONNECTIVITY REQUEST


	[B1] {6048} Significance:	dual


	[B1] {6049} Direction:	UE to network


[H4] {6050} 8.3.20.2	ESM information transfer flag


[Nm] {6051} The UE shall include this IE in the PDN CONNECTIVITY REQUEST message sent during the attach procedure if the UE has protocol configuration options that need to be transferred security protected or wishes to provide an access point name for the PDN connection to be established during the attach procedure.


[H4] {6052} 8.3.20.3	Access point name


[Nm] {6053} This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name. This IE shall not be included when the PDN CONNECTIVITY REQUEST message is included in an ATTACH REQUEST message or if the request type indicates "emergency" or "handover of emergency bearer services" or "RLOS".


[H4] {6054} 8.3.20.4	Protocol configuration options


[Nm] {6055} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet.


[Nm] {6056} This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet.


[Nm] {6057} This IE shall not be included if the Extended protocol configuration options IE is included in the message.


[H4] {6058} 8.3.20.5	Device properties


[Nm] {6059} The UE shall include this IE if the UE is configured for NAS signalling low priority.


[H4] {6060} 8.3.20.6	NBIFOM container


[Nm] {6061} This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


[H4] {6062} 8.3.20.7	Header compression configuration


[Nm] {6063} The UE shall include the Header compression configuration IE if:


	[B1] {6064} -	the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6;


	[B1] {6065} -	the UE indicates "Control Plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message; and


	[B1] {6066} -	the UE supports header compression.


[H4] {6067} 8.3.20.8	Extended protocol configuration options


[Nm] {6068} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and the UE is in NB-S1 mode or Non-IP or Ethernet PDN Type is requested.


[Nm] {6069} This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the PDN Type requested is different from Non-IP and Ethernet. 


[Nm] {6070} This IE shall not be included if the Protocol configuration options IE is included in the message.


[H3] {6071} 8.3.21	PDN disconnect reject


[H4] {6072} 8.3.21.1	Message definition


[Nm] {6073} This message is sent by the network to the UE to reject release of a PDN connection. See table 8.3.21.1.


	[B1] {6074} Message type:	PDN DISCONNECT REJECT


	[B1] {6075} Significance:	dual


	[B1] {6076} Direction:	network to UE


[H4] {6077} 8.3.21.2	Protocol configuration options


[Nm] {6078} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {6079} 8.3.21.3	Extended protocol configuration options


[Nm] {6080} This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {6081} 8.3.22	PDN disconnect request


[H4] {6082} 8.3.22.1	Message definition


[Nm] {6083} This message is sent by the UE to the network to initiate release of a PDN connection. See table 8.3.22.1.


	[B1] {6084} Message type:	PDN DISCONNECT REQUEST


	[B1] {6085} Significance:	dual


	[B1] {6086} Direction:	UE to network


[H4] {6087} 8.3.22.2	Protocol configuration options


[Nm] {6088} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H4] {6089} 8.3.22.3	Extended protocol configuration options


[Nm] {6090} This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


[H3] {6091} 8.3.23	Remote UE report


[H4] {6092} 8.3.23.1	Message definition


[Nm] {6093} This message is sent by the UE to the network to report connection or disconnection of remote UE(s). See table 8.3.23.1.


	[B1] {6094} Message type:	REMOTE UE REPORT


	[B1] {6095} Significance:	dual


	[B1] {6096} Direction:	UE to network


[H4] {6097} 8.3.23.2	Remote UE Context Connected


[Nm] {6098} This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with newly connected remote UE information as specified in 3GPP TS 23.303 [31].


[H4] {6099} 8.3.23.3	Remote UE Context Disconnected


[Nm] {6100} This IE is included in the message by the UE acting as ProSe UE-to-Network Relay to provide the network with disconnected remote UE information as specified in 3GPP TS 23.303 [31].


[H4] {6101} 8.3.23.4	ProSe Key Management Function Address


[Nm] {6102} This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with the address of the ProSe Key Management Function associated with the remote UEs connected to or disconnected from the ProSe UE-to-network relay.


[H3] {6103} 8.3.24	Remote UE report response


[H4] {6104} 8.3.24.1	Message definition


[Nm] {6105} This message is sent by the network to the UE to acknowledge receipt of a Remote UE report message. See table 8.3.24.1.


	[B1] {6106} Message type:	REMOTE UE REPORT RESPONSE


	[B1] {6107} Significance:	dual


	[B1] {6108} Direction:	network to UE


[H3] {6109} 8.3.25	ESM DATA TRANSPORT


[H4] {6110} 8.3.25.1	Message definition


[Nm] {6111} This message is sent by the UE or the network in order to carry user data in an encapsulated format. See table 8.3.25.1. 


	[B1] {6112} Message type:	ESM DATA TRANSPORT


	[B1] {6113} Significance:	dual


	[B1] {6114} Direction:	both


[H4] {6115} 8.3.25.2	Release assistance indication


[Nm] {6116} The UE may include this IE to inform the network whether


	[B1] {6117} -	no further uplink and no further downlink data transmission is expected; or


	[B1] {6118} -	only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.


[H1] {6119} 9	General message format and information elements coding


[H2] {6120} 9.1	Overview


[Nm] {6121} Within the protocols defined in the present document, every message, except the SERVICE REQUEST message, is a standard L3 message as defined in 3GPP TS 24.007 [12]. This means that the message consists of the following parts:


	[B1] {6122} 1)	if the message is a plain NAS message:


		[B2] {6123} a)	protocol discriminator;


		[B2] {6124} b)	EPS bearer identity or security header type;


		[B2] {6125} c)	procedure transaction identity;


		[B2] {6126} d)	message type;


		[B2] {6127} e)	other information elements, as required.


	[B1] {6128} 2)	if the message is a security protected NAS message:


		[B2] {6129} a)	protocol discriminator;


		[B2] {6130} b)	security header type;


		[B2] {6131} c)	message authentication code;


		[B2] {6132} d)	sequence number;


		[B2] {6133} e)	plain NAS message, as defined in item 1.


[Nm] {6134} The organization of a plain NAS message is illustrated in the example shown in figure 9.1.1.


[Nm] {6135} The organization of a security protected NAS message is illustrated in the example shown in figure 9.1.2.


[Nm] {6136} The EPS bearer identity and the procedure transaction identity are only used in messages with protocol discriminator EPS session management. Octet 1a with the procedure transaction identity shall only be included in these messages.


[Nm] {6137} Unless specified otherwise in the message descriptions of clause 8, a particular information element shall not be present more than once in a given message.


[Nm] {6138} When a field extends over more than one octet, the order of bit values progressively decreases as the octet number increases. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field.


[H2] {6139} 9.2	Protocol discriminator


[Nm] {6140} The Protocol Discriminator (PD) and its use are defined in 3GPP TS 24.007 [12]. The protocol discriminator in the header (see 3GPP TS 24.007 [12]) of a security protected NAS message is encoded as "EPS mobility management messages".


[H2] {6141} 9.3	Security header type and EPS bearer identity


[H3] {6142} 9.3.1	Security header type


[Nm] {6143} Bits 5 to 8 of the first octet of every EPS Mobility Management (EMM) message contain the Security header type IE. This IE includes control information related to the security protection of a NAS message. The total size of the Security header type IE is 4 bits.


[Nm] {6144} The Security header type IE can take the values shown in table 9.3.1.


[Nm] {6145} An EMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain NAS message. A protocol entity sending a not security protected EMM message shall send the message as plain NAS message and encode the security header type as 0000.


[H3] {6146} 9.3.2	EPS bearer identity


[Nm] {6147} Bits 5 to 8 of the first octet of every EPS Session Management (ESM) message contain the EPS bearer identity. The EPS bearer identity and its use to identify a message flow are defined in 3GPP TS 24.007 [12].


[Nm] {6148} If the UE or the MME or both do not support signalling for a maximum number of 15 EPS bearer contexts, the MME shall select the EPS bearer identity from the value range 5 to 15, or select the value 0 when it needs to indicate that no EPS bearer identity is assigned.


[H2] {6149} 9.4	Procedure transaction identity


[Nm] {6150} Bits 1 to 8 of the second octet (octet 1a) of every EPS Session Management (ESM) message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP TS 24.007 [12].


[H2] {6151} 9.5	Message authentication code


[Nm] {6152} The Message authentication code (MAC) information element contains the integrity protection information for the message. The MAC IE shall be included in the security protected NAS message if a valid EPS security context exists and security functions are started. The usage of MAC is specified in subclause 4.4.3.3.


[H2] {6153} 9.6	Sequence number


[Nm] {6154} This IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a security protected NAS message The usage of SN is specified in subclause 4.4.3.


[H2] {6155} 9.7	NAS message


[Nm] {6156} This IE includes a complete plain NAS message as specified in subclause 8.2 and 8.3. The SECURITY PROTECTED NAS MESSAGE and the SERVICE REQUEST message are not plain NAS messages and shall not be included in this IE.


[H2] {6157} 9.8	Message type


[Nm] {6158} The message type IE and its use are defined in 3GPP TS 24.007 [12]. Tables 9.8.1 and 9.8.2 define the value part of the message type IE used in the EPS mobility management protocol and EPS session management protocol.


[H2] {6159} 9.9	Other information elements


[H3] {6160} 9.9.1	General


[Nm] {6161} The different formats (V, LV, T, TV, TLV, LV-E, TLV-E) and the five categories of information elements (type 1, 2, 3, 4 and 6) are defined in 3GPP TS 24.007 [12].


[Nm] {6162} The first octet of an information element in the non-imperative part contains the IEI of the information element. If this octet does not correspond to an IEI known in the message, the receiver shall determine whether this IE is of type 1 or 2 (i.e. it is an information element of one octet length) or an IE of type 4 (i.e. that the next octet is the length indicator indicating the length of the remaining of the information element) (see 3GPP TS 24.007 [12]).


[Nm] {6163} This allows the receiver to jump over unknown information elements and to analyse any following information elements.


[Nm] {6164} The definitions of information elements which are common for the EMM and ESM protocols or which are used by access stratum protocols are described in subclause 9.9.2.


[Nm] {6165} The information elements of the EMM or ESM protocols can be defined by reference to an appropriate specification, e.g., "see subclause 10.5.6.3 in 3GPP TS 24.008 [13]".


[H3] {6166} 9.9.2	Common information elements


[H4] {6167} 9.9.2.0	Additional information


[Nm] {6168} The purpose of the Additional information information element is to provide additional information to upper layers in relation to the generic NAS message transport mechanism.


[Nm] {6169} The Additional information information element is coded as shown in figure 9.9.2.0.1 and table 9.9.2.0.1.


[Nm] {6170} The Additional information is a type 4 information element with a minimum length of 3 octets.


[H4] {6171} 9.9.2.0A	Device properties


[Nm] {6172} See subclause 10.5.7.8 in 3GPP TS 24.008 [13].


[H4] {6173} 9.9.2.1	EPS bearer context status


[Nm] {6174} The purpose of the EPS bearer context status information element is to indicate the state of each EPS bearer context that can be identified by an EPS bearer identity.


[Nm] {6175} The EPS bearer context status information element is coded as shown in figure 9.9.2.1.1 and table 9.9.2.1.1.


[Nm] {6176} The EPS bearer context status information element is a type 4 information element with 4 octets length.


[H4] {6177} 9.9.2.2	Location area identification


[Nm] {6178} See subclause 10.5.1.3 in 3GPP TS 24.008 [13].


[H4] {6179} 9.9.2.3	Mobile identity


[Nm] {6180} See subclause 10.5.1.4 in 3GPP TS 24.008 [13].


[H4] {6181} 9.9.2.4	Mobile station classmark 2


[Nm] {6182} See subclause 10.5.1.6 in 3GPP TS 24.008 [13].


[H4] {6183} 9.9.2.5	Mobile station classmark 3


[Nm] {6184} See subclause 10.5.1.7 in 3GPP TS 24.008 [13].


[H4] {6185} 9.9.2.6	NAS security parameters from E-UTRA


[Nm] {6186} The purpose of the NAS security parameters from E-UTRA information element is to provide the UE with information that enables the UE to create a mapped UMTS security context.


[Nm] {6187} The NAS security parameters from E-UTRA information element is coded as shown in figure 9.9.2.6.1 and table 9.9.2.6.1.


[Nm] {6188} The NAS security parameters from E-UTRA is a type 3 information element with a length of 2 octets.


[Nm] {6189} The value part of the NAS security parameters from E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].


[H4] {6190} 9.9.2.7	NAS security parameters to E-UTRA


[Nm] {6191} The purpose of the NAS security parameters to E-UTRA information element is to provide the UE with parameters that enable the UE to create a mapped EPS security context and take this context into use after inter-system handover to S1 mode.


[Nm] {6192} The NAS security parameters to E-UTRA information element is coded as shown in figure 9.9.2.7.1 and table 9.9.2.7.1.


[Nm] {6193} The NAS security parameters to E-UTRA is a type 3 information element with a length of 7 octets.


[Nm] {6194} The value part of the NAS security parameters to E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].


[H4] {6195} 9.9.2.8	PLMN list


[Nm] {6196} See subclause 10.5.1.13 in 3GPP TS 24.008 [13].


[H4] {6197} 9.9.2.9	Spare half octet


[Nm] {6198} This element is used in the description of EMM and ESM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.


[H4] {6199} 9.9.2.10	Supported codec list


[Nm] {6200} See subclause 10.5.4.32 in 3GPP TS 24.008 [13].


[H3] {6201} 9.9.3	EPS Mobility Management (EMM) information elements


[H4] {6202} 9.9.3.0A	Additional update result


[Nm] {6203} The purpose of the Additional update result information element is to provide additional information about the result of a combined attach procedure or a combined tracking area updating procedure.


[Nm] {6204} The Additional update result information element is coded as shown in figure 9.9.3.0A.1 and table 9.9.3.0A.1.


[Nm] {6205} The Additional update result is a type 1 information element.


[H4] {6206} 9.9.3.0B	Additional update type


[Nm] {6207} The purpose of the Additional update type information element is to provide additional information about the type of request for an attach or a tracking area updating procedure.


[Nm] {6208} The Additional update type information element is coded as shown in figure 9.9.3.0B.1 and table 9.9.3.0B.1.


[Nm] {6209} The Additional update type is a type 1 information element.


[H4] {6210} 9.9.3.1	Authentication failure parameter


[Nm] {6211} See subclause 10.5.3.2.2 in 3GPP TS 24.008 [13].


[H4] {6212} 9.9.3.2	Authentication parameter AUTN


[Nm] {6213} See subclause 10.5.3.1.1 in 3GPP TS 24.008 [13].


[H4] {6214} 9.9.3.3	Authentication parameter RAND


[Nm] {6215} See subclause 10.5.3.1 in 3GPP TS 24.008 [13].


[H4] {6216} 9.9.3.4	Authentication response parameter


[Nm] {6217} The purpose of the Authentication response parameter information element is to provide the network with the authentication response calculated in the USIM.


[Nm] {6218} The Authentication response parameter information element is coded as shown in figure 9.9.3.4.1 and table 9.9.3.4.1.


[Nm] {6219} The Authentication response parameter is a type 4 information element with a minimum length of 6 octets and a maximum length of 18 octets.


[Nm] {6220} In an EPS authentication challenge, the response calculated in the USIM (RES) is minimum 4 octets and may be up to 16 octets in length.


[Nm] {6221} In a 5G AKA authentication challenge, the response calculated in the ME (RES*) is 16 octets in length.


[H4] {6222} 9.9.3.4A	Ciphering key sequence number


[Nm] {6223} See subclause 10.5.1.2 in 3GPP TS 24.008 [13].


[H4] {6224} 9.9.3.4B	SMS services status


[Nm] {6225} The purpose of the SMS services status information element is to indicate the status of availability for SMS services requested by the UE during the normal attach procedure or tracking area updating procedure.


[Nm] {6226} The SMS services status information element is coded as shown in figure 9.9.3.4B.1 and table 9.9.3.4B.1.


[Nm] {6227} The SMS services status is a type 1 information element.


[H4] {6228} 9.9.3.5	CSFB response


[Nm] {6229} The purpose of the CSFB response information element is to indicate whether the UE accepts or rejects a paging for CS fallback.


[Nm] {6230} The CSFB response information element is coded as shown in figure 9.9.3.5.1 and table 9.9.3.5.1.


[Nm] {6231} The CSFB response is a type 1 information element.


[H4] {6232} 9.9.3.6	Daylight saving time


[Nm] {6233} See subclause 10.5.3.12 in 3GPP TS 24.008 [13].


[H4] {6234} 9.9.3.7	Detach type


[Nm] {6235} The purpose of the Detach type information element is to indicate the type of detach.


[Nm] {6236} The Detach type information element is coded as shown in figure 9.9.3.7.1 and table 9.9.3.7.1.


[Nm] {6237} The Detach type is a type 1 information element.


[H4] {6238} 9.9.3.8	DRX parameter


[Nm] {6239} See subclause 10.5.5.6 in 3GPP TS 24.008 [13].


[H4] {6240} 9.9.3.9	EMM cause


[Nm] {6241} The purpose of the EMM cause information element is to indicate the reason why an EMM request from the UE is rejected by the network.


[Nm] {6242} The EMM cause information element is coded as shown in figure 9.9.3.9.1 and table 9.9.3.9.1.


[Nm] {6243} The EMM cause is a type 3 information element with 2 octets length.


[H4] {6244} 9.9.3.10	EPS attach result


[Nm] {6245} The purpose of the EPS attach result information element is to specify the result of an attach procedure.


[Nm] {6246} The EPS attach result information element is coded as shown in figure 9.9.3.10.1 and table 9.9.3.10.1.


[Nm] {6247} The EPS attach result is a type 1 information element.


[H4] {6248} 9.9.3.11	EPS attach type


[Nm] {6249} The purpose of the EPS attach type information element is to indicate the type of the requested attach.


[Nm] {6250} The EPS attach type information element is coded as shown in figure 9.9.3.11.1 and table 9.9.3.11.1.


[Nm] {6251} The EPS attach type is a type 1 information element.


[H4] {6252} 9.9.3.12	EPS mobile identity


[Nm] {6253} The purpose of the EPS mobile identity information element is to provide either the IMSI, the GUTI or the IMEI.


[Nm] {6254} The EPS mobile identity information element is coded as shown in figures 9.9.3.12.1 and 9.9.3.12.2 and table 9.9.3.12.1.


[Nm] {6255} The EPS mobile identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 13 octets.


[H4] {6256} 9.9.3.12A	EPS network feature support


[Nm] {6257} The purpose of the EPS network feature support information element is to indicate whether certain features are supported by the network.


[Nm] {6258} The EPS network feature support information element is coded as shown in figure 9.9.3.12A.1 and table 9.9.3.12A.1.


[Nm] {6259} The EPS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 4 octets.


[Nm] {6260} If the network does not include octet 4 as defined below in the present version of the protocol, then the UE shall interpret this as a receipt of an information element with all bits of octet 4 coded as zero.


[H4] {6261} 9.9.3.13	EPS update result


[Nm] {6262} The purpose of the EPS update result information element is to specify the result of the associated updating procedure.


[Nm] {6263} The EPS update result information element is coded as shown in figure 9.9.3.13.1 and table 9.9.3.13.1.


[Nm] {6264} The EPS update result is a type 1 information element.


[H4] {6265} 9.9.3.14	EPS update type


[Nm] {6266} The purpose of the EPS update type information element is to specify the area the updating procedure is associated with.


[Nm] {6267} The EPS update type information element is coded as shown in figure 9.9.3.14.1 and table 9.9.3.14.1.


[Nm] {6268} The EPS update type is a type 1 information element.


[H4] {6269} 9.9.3.15	ESM message container


[Nm] {6270} The purpose of the ESM message container information element is to enable piggybacked transfer of a single ESM message within an EMM message. The ESM message included in this IE shall be coded as specified in subclause 8.3, i.e. without NAS security header.


[Nm] {6271} The ESM message container information element is coded as shown in figure 9.9.3.15.1 and table 9.9.3.15.1.


[Nm] {6272} The ESM message container is a type 6 information element.


[H4] {6273} 9.9.3.16	GPRS timer


[Nm] {6274} See subclause 10.5.7.3 in 3GPP TS 24.008 [13].


[H4] {6275} 9.9.3.16A	GPRS timer 2


[Nm] {6276} See subclause 10.5.7.4 in 3GPP TS 24.008 [13].


[H4] {6277} 9.9.3.16B	GPRS timer 3


[Nm] {6278} See subclause 10.5.7.4a in 3GPP TS 24.008 [13].


[H4] {6279} 9.9.3.17	Identity type 2


[Nm] {6280} See subclause 10.5.5.9 in 3GPP TS 24.008 [13].


[H4] {6281} 9.9.3.18	IMEISV request


[Nm] {6282} See subclause 10.5.5.10 in 3GPP TS 24.008 [13].


[H4] {6283} 9.9.3.19	KSI and sequence number


[Nm] {6284} The purpose of the KSI and sequence number information element is to provide the network with the key set identifier (KSI) value of the current EPS security context and the 5 least significant bits of the NAS COUNT value applicable for the message including this information element. 


[Nm] {6285} The KSI and sequence number information element is coded as shown in figure 9.9.3.19.1 and table 9.9.3.19.1.


[Nm] {6286} The KSI and sequence number is a type 3 information element with a length of 2 octets.


[H4] {6287} 9.9.3.20	MS network capability


[Nm] {6288} See subclause 10.5.5.12 in 3GPP TS 24.008 [13].


[H4] {6289} 9.9.3.20A	MS network feature support


[Nm] {6290} See subclause 10.5.1.15 in 3GPP TS 24.008 [13].


[H4] {6291} 9.9.3.21	NAS key set identifier


[Nm] {6292} The NAS key set identifier is allocated by the network.


[Nm] {6293} The NAS key set identifier information element is coded as shown in figure 9.9.3.21.1 and table 9.9.3.21.1.


[Nm] {6294} The NAS key set identifier is a type 1 information element.


[H4] {6295} 9.9.3.22	NAS message container


[Nm] {6296} This information element is used to encapsulate the SMS messages transferred between the UE and the network.The NAS message container information element is coded as shown in figure 9.9.3.22.1 and table 9.9.3.22.1.


[Nm] {6297} The NAS message container is a type 4 information element with a minimum length of 4 octets and a maximum length of 253 octets.


[H4] {6298} 9.9.3.23	NAS security algorithms


[Nm] {6299} The purpose of the NAS security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.


[Nm] {6300} The NAS security algorithms information element is coded as shown in figure 9.9.3.23.1 and table 9.9.3.23.1.


[Nm] {6301} The NAS security algorithms is a type 3 information element with a length of 2 octets.


[H4] {6302} 9.9.3.24	Network name


[Nm] {6303} See subclause 10.5.3.5a in 3GPP TS 24.008 [13].


[H4] {6304} 9.9.3.24A	Network resource identifier container


[Nm] {6305} See subclause 10.5.5.31 in 3GPP TS 24.008 [13].


[H4] {6306} 9.9.3.25	Nonce


[Nm] {6307} The purpose of the Nonce information element is to transfer a 32-bit nonce value to support deriving a new mapped EPS security context.


[Nm] {6308} The Nonce information element is coded as shown in figure 9.9.3.25.1 and table 9.9.3.25.1.


[Nm] {6309} The Nonce is a type 3 information element with a length of 5 octets.


[H4] {6310} 9.9.3.25A	Paging identity


[Nm] {6311} The purpose of the Paging identity information element is to indicate the identity used for paging for non-EPS services.


[Nm] {6312} The Paging identity information element is coded as shown in figure 9.9.3.25A.1 and table 9.9.3.25A.1.


[Nm] {6313} The Paging identity is a type 3 information element with 2 octets length.


[H4] {6314} 9.9.3.26	P-TMSI signature


[Nm] {6315} See subclause 10.5.5.8 in 3GPP TS 24.008 [13].


[H4] {6316} 9.9.3.26A	Extended EMM cause


[Nm] {6317} The purpose of the extended EMM cause information element is to indicate additional information associated with the EMM cause. 


[Nm] {6318} The Extended EMM cause information element is coded as shown in figure 9.9.3.26A.1 and table 9.9.3.26A.1.


[Nm] {6319} The Extended EMM cause is a type 1 information element.


[H4] {6320} 9.9.3.27	Service type


[Nm] {6321} The purpose of the Service type information element is to specify the purpose of the service request procedure.


[Nm] {6322} The Service type information element is coded as shown in figure 9.9.3.27.1 and table 9.9.3.27.1.


[Nm] {6323} The Service type is a type 1 information element.


[H4] {6324} 9.9.3.28	Short MAC


[Nm] {6325} The purpose of the Short MAC information element is to protect the integrity of a SERVICE REQUEST message.


[Nm] {6326} The integrity protection shall include octet 1 and 2 of the SERVICE REQUEST message. For the used algorithm and other input parameters to the algorithm see subclause 9.5. Only the 2 least significant octets of the resulting message authentication code are included in the information element.


[Nm] {6327} The Short MAC information element is coded as shown in figure 9.9.3.28.1 and table 9.9.3.28.1.


[Nm] {6328} The Short MAC is a type 3 information element with a length of 3 octets.


[H4] {6329} 9.9.3.29	Time zone


[Nm] {6330} See subclause 10.5.3.8 in 3GPP TS 24.008 [13].


[H4] {6331} 9.9.3.30	Time zone and time


[Nm] {6332} See subclause 10.5.3.9 in 3GPP TS 24.008 [13].


[H4] {6333} 9.9.3.31	TMSI status


[Nm] {6334} See subclause 10.5.5.4 in 3GPP TS 24.008 [13].


[H4] {6335} 9.9.3.32	Tracking area identity


[Nm] {6336} The purpose of the Tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 3GPP system.


[Nm] {6337} The Tracking area identity information element is coded as shown in figure 9.9.3.32.1 and table 9.9.3.32.1.


[Nm] {6338} The Tracking area identity is a type 3 information element with a length of 6 octets.


[H4] {6339} 9.9.3.33	Tracking area identity list


[Nm] {6340} The purpose of the Tracking area identity list information element is to transfer a list of tracking areas from the network to the UE.


[Nm] {6341} The coding of the information element allows combining different types of lists. The lists of type "00" and "01" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.


[Nm] {6342} The Tracking area identity list information element is coded as shown in figure 9.9.3.33.1, figure 9.9.3.33.2, figure 9.9.3.33.3, figure 9.9.3.33.4 and table 9.9.3.33.1.


[Nm] {6343} The Tracking area identity list is a type 4 information element, with a minimum length of 8 octets and a maximum length of 98 octets. The list can contain a maximum of 16 different tracking area identities.


[H4] {6344} 9.9.3.34	UE network capability


[Nm] {6345} The purpose of the UE network capability information element is to provide the network with information concerning aspects of the UE related to EPS or interworking with GPRS and 5GS. The contents might affect the manner in which the network handles the operation of the UE. The UE network capability information indicates general UE characteristics and it shall therefore, except for fields explicitly indicated, be independent of the frequency band of the channel it is sent on.


[Nm] {6346} The UE network capability information element is coded as shown in figure 9.9.3.34.1 and table 9.9.3.34.1.


[Nm] {6347} The UE network capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 15 octets.


[H4] {6348} 9.9.3.35	UE radio capability information update needed


[Nm] {6349} The purpose of the UE radio capability information update needed information element is to indicate whether the MME shall delete the stored UE radio capability information, if any.


[Nm] {6350} The UE radio capability information update needed information element is coded as shown in figure 9.9.3.35.1and table 9.9.3.35.1.


[Nm] {6351} The UE radio capability information update needed is a type 1 information element.


[H4] {6352} 9.9.3.36	UE security capability


[Nm] {6353} The UE security capability information element is used by the network to indicate which security algorithms are supported by the UE in S1 mode, Iu mode and Gb mode. Security algorithms supported in S1 mode are supported both for NAS and for AS security. If the UE supports S101 mode, then these security algorithms are also supported for NAS security in S101 mode.


[Nm] {6354} The UE security capability information element is coded as shown in figure 9.9.3.36.1 and table 9.9.3.36.1.


[Nm] {6355} The UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 7 octets.


[Nm] {6356} Octets 5, 6, and 7 are optional. If octet 5 is included, then also octet 6 shall be included and octet 7 may be included.


[Nm] {6357} If a UE did not indicate support of any security algorithm for Gb mode, octet 7 shall not be included. If the UE did not indicate support of any security algorithm for Iu mode and Gb mode, octets 5, 6, and 7 shall not be included.


[Nm] {6358} If the UE did not indicate support of any security algorithm for Iu mode but indicated support of a security algorithm for Gb mode, octets 5, 6, and 7 shall be included. In this case octets 5 and 6 are filled with the value of zeroes.


[H4] {6359} 9.9.3.37	Emergency Number List


[Nm] {6360} See subclause 10.5.3.13 in 3GPP TS 24.008 [13].


[H4] {6361} 9.9.3.37A	Extended emergency number list


[Nm] {6362} The purpose of this information element is to encode one or more local emergency number(s) together with a sub-services field containing zero or more sub-services of the associated emergency service URN and a validity indication. An emergency service URN is a service URN with top level service type of "sos" as specified in IETF RFC 5031 [55].


[Nm] {6363} The Extended emergency number list information element is coded as shown in figure 9.9.3.37A.1 and table 9.9.3.37A.1.


[Nm] {6364} The Extended emergency number list IE is a type 6 information element with a minimum length of 7 octets and a maximum length of 65538 octets.


[H4] {6365} 9.9.3.38	CLI


[Nm] {6366} The purpose of the CLI information element is to convey information about the calling line for a terminated call to a CS fallback capable UE.


[Nm] {6367} The CLI information element is coded as shown in figure 9.9.3.38.1 and table 9.9.3.38.1.


[Nm] {6368} The CLI is a type 4 information element with a minimum length of 3 octets and a maximum length of 14 octets.


[H4] {6369} 9.9.3.39	SS Code


[Nm] {6370} The purpose of the SS code information element is to convey information related to a network initiated supplementary service request to a CS fallback capable UE.


[Nm] {6371} The SS Code information element is coded as shown in figure 9.9.3.39.1 and table 9.9.3.39.1.


[Nm] {6372} The SS Code is a type 3 information element with 2 octets length.


[H4] {6373} 9.9.3.40	LCS indicator


[Nm] {6374} The purpose of the LCS indicator information element is to indicate that the origin of the message is due to a LCS request and the type of this request to a CS fallback capable UE.


[Nm] {6375} The LCS indicator information element is coded as shown in figure 9.9.3.40.1 and table 9.9.3.40.1.


[Nm] {6376} The LCS indicator is a type 3 information element with 2 octets length.


[H4] {6377} 9.9.3.41	LCS client identity


[Nm] {6378} The purpose of the LCS client identity information element is to convey information related to the client of a LCS request for a CS fallback capable UE.


[Nm] {6379} The LCS client identity information element is coded as shown in figure 9.9.3.41.1 and table 9.9.3.41.1.


[Nm] {6380} The LCI client identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 257 octets.


[H4] {6381} 9.9.3.42	Generic message container type


[Nm] {6382} The purpose of the generic message container type information element is to specify the type of message contained in the generic message container IE.


[Nm] {6383} The generic message container type information element is coded as shown in table 9.9.3.42.1.


[H4] {6384} 9.9.3.43	Generic message container


[Nm] {6385} This information element is used to encapsulate the application message transferred between the UE and the network.The generic message container information element is coded as shown in figure 9.9.3.43.1 and table 9.9.3.43.1.


[Nm] {6386} The generic message container is a type 6 information element.


[H4] {6387} 9.9.3.44	Voice domain preference and UE's usage setting


[Nm] {6388} See subclause 10.5.5.28 in 3GPP TS 24.008 [13].


[H4] {6389} 9.9.3.45	GUTI type


[Nm] {6390} The purpose of the GUTI type information element is to indicate whether the GUTI included in the same message in an information element of type EPS mobile identity represents a native GUTI or a mapped GUTI.


[Nm] {6391} The GUTI type information element information element is coded as shown in figure 9.9.3.45.1 and table 9.9.3.45.1.


[Nm] {6392} The GUTI type is a type 1 information element.


[H4] {6393} 9.9.3.46	Extended DRX parameters


[Nm] {6394} See subclause 10.5.5.32 in 3GPP TS 24.008 [13].


[H4] {6395} 9.9.3.47	Control plane service type


[Nm] {6396} The purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.


[Nm] {6397} The Control plane service type information element is coded as shown in figure 9.9.3.47.1 and table 9.9.3.47.1.


[Nm] {6398} The Control plane service type is a type 1 information element.


[H4] {6399} 9.9.3.48	DCN-ID


[Nm] {6400} See subclause 10.5.5.35 in 3GPP TS 24.008 [13].


[H4] {6401} 9.9.3.49	Non-3GPP NW provided policies


[Nm] {6402} See subclause 10.5.5.37 in 3GPP TS 24.008 [13].


[H4] {6403} 9.9.3.50	HashMME


[Nm] {6404} The purpose of the HashMME information element is to transfer a 64-bit hash value to the UE so the UE can check the MME calculated value against the value locally calculated by the UE to determine whether the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message sent by the UE has been modified.


[Nm] {6405} The HashMME information element is coded as shown in figure 9.9.3.50.1 and table 9.9.3.50.1.


[Nm] {6406} The HashMME is a type 4 information element with a length of 10 octets.


[H4] {6407} 9.9.3.51	Replayed NAS message container


[Nm] {6408} The purpose of the Replayed NAS message containerIE is to, during an ongoing attach or tracking area updating procedure, re-send the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message with which the UE had initiated the procedure, if the MME has included a HASHMME in the SECURITY MODE COMMAND message and the HASHMME is different from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19]. If an ATTACH REQUEST message is included in this IE, the ATTACH REQUEST message shall be coded as specified in subclause 8.2.4, i.e. without NAS security header. If a TRACKING AREA UPDATE REQUEST message is included in this IE, the TRACKING AREA UPDATE REQUEST message shall be coded as specified in subclause 8.2.29, i.e. without NAS security header


[Nm] {6409} The Replayed NAS message container information element is coded as shown in figure 9.9.3.51.1 and table 9.9.3.51.1.


[Nm] {6410} The Replayed NAS message container is a type 6 information element.


[H4] {6411} 9.9.3.52	Network policy 


[Nm] {6412} The purpose of the Network policy information element is to provide network policy information to the UE during attach or tracking area updating procedure via the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.


[Nm] {6413} The Network policy information element is coded as shown in figure 9.9.3.52.1 and table 9.9.3.52.1.


[Nm] {6414} The Network policy is a type 1 information element.


[H4] {6415} 9.9.3.53	UE additional security capability


[Nm] {6416} The UE additional security capability information element is used by the UE to indicate which additional security algorithms are supported by the UE for S1 mode in dual connectivity with NR or for N1 mode or both.


[Nm] {6417} The UE additional security capability information element is coded as shown in figure 9.9.3.53.1 and table 9.9.3.53.1.


[Nm] {6418} The UE additional security capability is a type 4 information element with a length of 6 octets.


[H4] {6419} 9.9.3.54	UE status


[Nm] {6420} See subclause 9.11.3.56 in 3GPP TS 24.501 [54].


[H4] {6421} 9.9.3.55	Additional information requested


[Nm] {6422} The purpose of the Additional information requested information element is to enable the UE to request ciphering keys for deciphering of ciphered broadcast assistance data.


[Nm] {6423} The Additional information requested information element is coded as shown in figure 9.9.3.55.1 and table 9.9.3.55.1.


[Nm] {6424} The Additional information requested is a type 3 information element with a length of 2 octets.


[H4] {6425} 9.9.3.56	Ciphering key data


[Nm] {6426} The purpose of the Ciphering key data information element is to transfer a list of ciphering data sets from the network to the UE for deciphering of ciphered assistance data.


[Nm] {6427} The Ciphering key data information element is coded as shown in figure 9.9.3.56.1, figure 9.9.3.56.2 and table 9.9.3.56.1.


[Nm] {6428} The Ciphering key data is a type 6 information element, with a minimum length of 35 octets and a maximum length of 2291 octets. The list can contain a maximum of 16 ciphering data sets.


[H4] {6429} 9.9.3.57	N1 UE network capability


[Nm] {6430} The purpose of the N1 UE network capability IE is to allow the UE that supports N1 mode, to provide the network with information related to the UE’s capabilities for 5GS.


[Nm] {6431} The N1 UE network capability information element is coded as shown in figure 9.9.3.57.1 and table 9.9.3.57.1.


[Nm] {6432} The N1 UE network capability is a type 4 information element.


[H4] {6433} 9.9.3.58	UE radio capability ID availability


[Nm] {6434} The purpose of the UE radio capability ID availability information element is to indicate that the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.


[Nm] {6435} The UE radio capability ID availability is a type 4 information element with a length of 3 octets.


[Nm] {6436} The UE radio capability ID availability information element is coded as shown in figure 9.9.3.58.1 and table 9.9.3.58.1.


[H4] {6437} 9.9.3.59	UE radio capability ID request


[Nm] {6438} The purpose of the UE radio capability ID request information element is to indicate that the UE radio capability ID shall be included by the UE in the SECURITY MODE COMPLETE message.


[Nm] {6439} The UE radio capability ID request is a type 4 information element with a length of 3 octets.


[Nm] {6440} The UE radio capability ID request information element is coded as shown in figure 9.9.3.59.1 and table 9.9.3.59.1.


[H4] {6441} 9.9.3.60	UE radio capability ID


[Nm] {6442} See subclause 9.11.3.68 in 3GPP TS 24.501 [54].


[H4] {6443} 9.9.3.61	UE radio capability ID deletion indication


[Nm] {6444} See subclause 9.11.3.zz in 3GPP TS 24.501 [54].


[H4] {6445} 9.9.3.62	WUS assistance information


[Nm] {6446} The purpose of the WUS assistance information information element is to transfer the required assistance information to determine the WUS group used when paging the UE.


[Nm] {6447} The coding of the information element allows combining different types of WUS assistance information.


[Nm] {6448} The WUS assistance information information element is coded as shown in figure 9.9.3.62.1, figure 9.9.3.62.2 and table 9.9.3.62.1.


[Nm] {6449} The WUS assistance information is a type 4 information element, with a minimum length of 3 octets.


[H4] {6450}  9.9.3.63	NB-S1 DRX parameter


[Nm] {6451} The purpose of the NB-S1 DRX parameter information element is to indicate that the UE intends to use the UE specific DRX parameter in NB-S1 mode and for the network to indicate the negotiated UE specific DRX parameter to be used at paging in NB-S1 mode.


[Nm] {6452} The NB-S1 DRX parameters information element is coded as shown in figure 9.9.3.63.1 and table 9.9.3.63.1.


[Nm] {6453} The NB-S1 DRX parameters is a type 4 information element with a length of 3 octets.


[H3] {6454} 9.9.4	EPS Session Management (ESM) information elements


[H4] {6455} 9.9.4.1	Access point name


[Nm] {6456} See subclause 10.5.6.1 in 3GPP TS 24.008 [13].


[H4] {6457} 9.9.4.2	APN aggregate maximum bit rate


[Nm] {6458} The purpose of the APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR when the UE establishes a PDN connection or to indicate the new APN-AMBR if it is changed by the network.


[Nm] {6459} The APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.2.1 and table 9.9.4.2.1.


[Nm] {6460} The APN aggregate maximum bit rate is a type 4 information element with a minimum length of 4 octets and a maximum length of 8 octets. Octets 5-8 are optional. If octet 5 is included, then octet 6 shall also be included, and octets 7-8 may be included. If octet 7 is included, then octet 8 shall also be included. The length of the APN-AMBR IE can be either 4 octets, 6 octets or 8 octets.


[H4] {6461} 9.9.4.2A	Connectivity type


[Nm] {6462} See subclause 10.5.6.19 in 3GPP TS 24.008 [13].


[H4] {6463} 9.9.4.3	EPS quality of service


[Nm] {6464} The purpose of the EPS quality of service information element is to specify the QoS parameters for an EPS bearer context.


[Nm] {6465} The EPS quality of service information element is coded as shown in figure 9.9.4.3.1 and table 9.9.4.3.1.


[Nm] {6466} The EPS quality of service is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets. Octets 4-15 are optional. If octet 4 is included, then octets 5-7 shall also be included, and octets 8-15 may be included. If octet 8 is included, then octets 4-11 shall also be included, and octets 12-15 may be included. If octet 12 is included, then octets 4-15 shall also be included. The length of the EPS QoS IE can be either 3 octets, 7 octets, 11 octets or 15 octets.


[Nm] {6467} Refer to 3GPP TS 23.203 [7] for a detailed description of the QoS Class Identifier (QCI).


[H4] {6468} 9.9.4.4	ESM cause


[Nm] {6469} The purpose of the ESM cause information element is to indicate the reason why a session management request is rejected.


[Nm] {6470} The ESM cause information element is coded as shown in figure 9.9.4.4.1 and table 9.9.4.4.1.


[Nm] {6471} The ESM cause is a type 3 information element with 2 octets length.


[H4] {6472} 9.9.4.5	ESM information transfer flag


[Nm] {6473} The purpose of the ESM information transfer flag information element is to indicate whether ESM information, i.e. protocol configuration options or APN or both, is to be transferred security protected.


[Nm] {6474} The ESM information transfer flag information element is coded as shown in figure 9.9.4.5.1 and table 9.9.4.5.1.


[Nm] {6475} The ESM information transfer flag is a type 1 information element.


[H4] {6476} 9.9.4.6	Linked EPS bearer identity


[Nm] {6477} The purpose of the Linked EPS bearer identity IE is to identify the default bearer that is associated with a dedicated EPS bearer or to identify the EPS bearer (default or dedicated) with which one or more packet filters specified in a traffic flow aggregate are associated.


[Nm] {6478} The Linked EPS bearer identity information element is coded as shown in figure 9.9.4.6.1 and table 9.9.4.6.1.


[Nm] {6479} The Linked EPS bearer identity is a type 1 information element.


[H4] {6480} 9.9.4.7	LLC service access point identifier


[Nm] {6481} See subclause 10.5.6.9 in 3GPP TS 24.008 [13].


[H4] {6482} 9.9.4.7A	Notification indicator


[Nm] {6483} The purpose of the Notification indicator information element is to inform the UE about an event which is relevant for the upper layer using an EPS bearer context or having requested a procedure transaction.


[Nm] {6484} The Notification indicator information element is coded as shown in figure 9.9.4.7A.1 and table 9.9.4.7A.1.


[Nm] {6485} The Notification indicator is a type 4 information element with 3 octets length.


[H4] {6486} 9.9.4.8	Packet flow identifier


[Nm] {6487} See subclause 10.5.6.11 in 3GPP TS 24.008 [13].


[H4] {6488} 9.9.4.9	PDN address


[Nm] {6489} The PDN address information element can assign an IPv4 address to the UE associated with a packet data network and provide the UE with an interface identifier to be used to build the IPv6 link local address.


[Nm] {6490} The PDN address information element is coded as shown in figure 9.9.4.9.1 and table 9.9.4.9.1.


[Nm] {6491} The PDN address is a type 4 information element with minimum length of 7 octets and a maximum length of 15 octets.


[H4] {6492} 9.9.4.10	PDN type


[Nm] {6493} The purpose of the PDN type information element is to indicate:


	[B1] {6494} -	the IP version capability of the IP stack associated with the UE;


	[B1] {6495} -	non IP; or


	[B1] {6496} -	Ethernet.


[Nm] {6497} The PDN type information element is coded as shown in figure 9.9.4.10.1 and table 9.9.4.10.1.


[Nm] {6498} The PDN type is a type 1 information element.


[H4] {6499} 9.9.4.11	Protocol configuration options


[Nm] {6500} See subclause 10.5.6.3 in 3GPP TS 24.008 [13].


[H4] {6501} 9.9.4.12	Quality of service


[Nm] {6502} See subclause 10.5.6.5 in 3GPP TS 24.008 [13].


[H4] {6503} 9.9.4.13	Radio priority


[Nm] {6504} See subclause 10.5.7.2 in 3GPP TS 24.008 [13].


[H4] {6505} 9.9.4.13A	Re-attempt indicator


[Nm] {6506} The purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed, in the current PLMN for the same APN, to re-attempt a session management procedure (see 3GPP TS 24.008 [13]) corresponding to the EPS session management procedure which was rejected by the network.


[Nm] {6507} The Re-attempt indicator information element is coded as shown in figure 9.9.4.13A/3GPP TS 24.301 and table 9.9.4.13A/3GPP TS 24.301.


[Nm] {6508} The Re-attempt indicator is a type 4 information element with a length of 3 octets.


[H4] {6509} 9.9.4.14	Request type


[Nm] {6510} See subclause 10.5.6.17 in 3GPP TS 24.008 [13].


[H4] {6511} 9.9.4.15	Traffic flow aggregate description


[Nm] {6512} The purpose of the Traffic flow aggregate description information element is to specify the aggregate of one of more packet filters and their related parameters and operations. The traffic flow aggregate description may contain the aggregate of packet filters for the downlink direction, the uplink direction or packet filters that apply for both directions. The packet filters determine the traffic mapping to EPS bearer contexts. The downlink packet filters shall be applied by the network, and the uplink packet filters shall be applied by the UE. A packet filter that applies for both directions shall be applied by the network as a downlink packet filter and by the UE as an uplink packet filter.


[Nm] {6513} When the traffic flow aggregate description is used in the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure, it is associated to a particular procedure identified by a procedure transaction identity (PTI). Therefore, the UE shall release the traffic flow aggregate description when the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure is completed. The UE shall not include the packet filters of a particular traffic flow aggregate description in any other traffic flow aggregate description when multiple UE requested bearer resource allocation procedures and/or UE requested bearer resource modification procedures are ongoing in parallel.


[Nm] {6514} The Traffic flow aggregate description information element is encoded using the same format as the Traffic flow template (TFT) information element (see subclause 10.5.6.12 in 3GPP TS 24.008 [13]). When sending this IE in the BEARER RESOURCE ALLOCATION REQUEST message or the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall set the packet filter identifier values to 0 if the packet filters are newly created; otherwise, the UE shall set the packet filter identifier values from those of already assigned packet filter identifiers of the existing EPS bearer, so that they are unique across all packet filters for the EPS bearer context indicated by the EPS bearer identity IE.


[H4] {6515} 9.9.4.16	Traffic flow template


[Nm] {6516} See subclause 10.5.6.12 in 3GPP TS 24.008 [13].


[H4] {6517} 9.9.4.17	Transaction identifier


[Nm] {6518} The purpose of the Transaction identifier information element is to represent the corresponding PDP context in A/Gb mode or Iu mode which is mapped from the EPS bearer context.


[Nm] {6519} The Transaction identifier information element is coded as the Linked TI information element in 3GPP TS 24.008 [13], subclause 10.5.6.7.


[H4] {6520} 9.9.4.18	WLAN offload acceptability


[Nm] {6521} See subclause 10.5.6.20 in 3GPP TS 24.008 [13].


[H4] {6522} 9.9.4.19	NBIFOM container


[Nm] {6523} See subclause 10.5.6.21 in 3GPP TS 24.008 [4].


[H4] {6524} 9.9.4.20	Remote UE context list


[Nm] {6525} The purpose of the Remote UE context list information element is to provide identity and optionally IP address of a remote UE connected to, or disconnected from, a UE acting as a ProSe UE-to-network relay.


[Nm] {6526} The Remote UE context list information element is coded as shown in figure 9.9.4.20.1 and table 9.9.4.20.1.


[Nm] {6527} The Remote UE context list is a type 6 information element with a minimum length of 5 octets and a maximum length of 65538 octets.


[Nm] {6528} If Address type indicates IPv4, the Address information in octet j+1 to octet j+6 contains the IPv4 address and port number. Bit 8 of octet j+1 represents the most significant bit of the IP address and bit 1 of octet j+4 the least significant bit. Bit 8 of octet j+5 represents the most significant bit of the port number and bit 1 of octet j+6 the least significant bit.


[Nm] {6529} If Address type indicates IPv6, the Address information in octet j+1 to octet j+8 contains the /64 IPv6 prefix of a remote UE. Bit 8 of octet j+1 represents the most significant bit of the /64 IPv6 prefix and bit 1 of octet j+8 the least significant bit.


[Nm] {6530} If Address type indicates No IP info, the Address information octets are not included.


[H4] {6531} 9.9.4.21	PKMF address


[Nm] {6532} The purpose of the PKMF address information element is to provide IP address of a ProSe Key Management Function associated with remote UEs connected to or disconnected from a UE acting as a ProSe UE-to-network relay.


[Nm] {6533} The PKMF address information element is coded as shown in figure 9.9.4.21.1 and table 9.9.4.21.1.


[Nm] {6534} The PKMF address is a type 4 information element with a minimum length of 3 octets and a maximum length of 19 octets.


[Nm] {6535} If Address type indicates IPv4, the Address information in octet 4 to octet 7 contains the IPv4 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 7 the least significant bit.


[Nm] {6536} If Address type indicates IPv6, the Address information in octet 4 to octet 19 contains the IPv6 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 19 the least significant bit.


[H4] {6537} 9.9.4.22	Header compression configuration


[Nm] {6538} The purpose of the Header compression configuration information element is to negotiate ROHC channel setup parameters specified in IETF RFC 5795 [37] and, optionally, provide additional header compression context setup parameters.


[Nm] {6539} The Header compression configuration information element is coded as shown in figure 9.9.4.22.1 and table 9.9.4.22.1.


[Nm] {6540} The Header compression configuration is a type 4 information element with a minimum length of 5 octets and a maximum length of 257 octets.


[Nm] {6541} The optional Additional header compression parameters container field conveys the additional header compression context setup parameters as specified in 3GPP TS 23.401 [10] in a generic container. This field corresponds to the profile-specific information in the header of the ROHC IR packet type in IETF RFC 5795 [37].


[H4] {6542} 9.9.4.23	Control plane only indication


[Nm] {6543} The purpose of the Control plane only indication information element is to indicate that a PDN connection is only for control plane CIoT EPS optimization, e.g. the PDN connection is with an SCEF (see 3GPP TS 23.401 [10]).


[Nm] {6544} The Control plane only indication information element is coded as shown in figure 9.9.4.23.1.


[Nm] {6545} The Control plane only indication is a type 1 information element.


[H4] {6546} 9.9.4.24	User data container


[Nm] {6547} This information element is used to encapsulate the user data transferred between the UE and the MME. The User data container information element is coded as shown in figure 9.9.4.24.1 and table 9.9.4.24.1.


[Nm] {6548} The User data container is a type 6 information element.


[H4] {6549} 9.9.4.25	Release assistance indication


[Nm] {6550} The purpose of the Release assistance indication IE is to inform the network whether


	[B1] {6551} -	no further uplink and no further downlink data transmission is expected; or


	[B1] {6552} -	only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.


[Nm] {6553} The Release assistance indication information element is coded as shown in figure 9.9.4.25.1 and table 9.9.4.25.1.


[Nm] {6554} The Release assistance indication is a type 1 information element.


[H4] {6555} 9.9.4.26	Extended protocol configuration options


[Nm] {6556} See subclause 10.5.6.3A in 3GPP TS 24.008 [13].


[H4] {6557} 9.9.4.27	Header compression configuration status


[Nm] {6558} The purpose of the Header compression configuration status information element is to indicate the status of the Header compression configuration for each EPS bearer using Control plane CIoT EPS optimisation that can be identified by an EPS bearer identity. 


[Nm] {6559} The Header compression confguration status information element is a type 4 information element with 4 the length of 4 octets.


[H4] {6560} 9.9.4.28	Serving PLMN rate control


[Nm] {6561} The purpose of the Serving PLMN rate control information element is to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send via a PDN connection per 6 minute interval (see 3GPP TS 23.401 [10]).


[Nm] {6562} The Serving PLMN rate control information element is coded as shown in figure 9.9.4.28.1.


[Nm] {6563} The Serving PLMN rate control is a type 4 information element with 4 octets length.


[Nm] {6564} Serving PLMN rate control value (octet 3 to octet 4) is a binary encoded integer indicating the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval. The Serving PLMN rate control value is an integer equal to or higher than 10. The Serving PLMN rate control value FFFFH indicates that the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval is not restricted.


[H4] {6565} 9.9.4.29	Extended APN aggregate maximum bit rate


[Nm] {6566} The purpose of the extended APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR with a value higher than 65280 Mbps when the UE establishes a PDN connection or to indicate the new APN-AMBR with a value higher than 65280 Mbps if it is changed by the network.


[Nm] {6567} The receiving entityshall ignore the bit rate values which are included in the extended APN aggregate maximum bit rate information element and not higher than 65280 Mbps.


[Nm] {6568} The extended APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.29.1 and table 9.9.4.29.1.


[Nm] {6569} The extended APN aggregate maximum bit rate is a type 4 information element with a length of 8 octets.


[H4] {6570} 9.9.4.30	Extended quality of service


[Nm] {6571} The purpose of the Extended quality of service information element is to indicate for an EPS bearer context the maximum bit rates for uplink and downlink and the guaranteed bit rates for uplink and downlink, if at least one of the bit rates has a value higher than 10 Gbps.


[Nm] {6572} The Extended quality of service information element is coded as shown in figure 9.9.4.30.1 and table 9.9.4.30.1. For uplink and downlink, if the sending entity only has to indicate one bit rate (i.e, with a value higher than 10 Gbps), it shall encode the other bit rate (i.e., with a value smaller or equal to 10 Gbps) as "00000000". The receiving entity shall ignore a bit rate which is included in the extended quality of service information element and has a value smaller or equal to 10 Gbps.


[Nm] {6573} The Extended quality of service is a type 4 information element with a length of 12 octets.


[H1] {6574} 10	List of system parameters


[H2] {6575} 10.1	General


[Nm] {6576} The description of timers in the following tables should be considered a brief summary.


[H2] {6577} 10.2	Timers of EPS mobility management


[H2] {6578} 10.3	Timers of EPS session management


[H8] {6579} 
Annex A (informative):
Cause values for EPS mobility management


[H1] {6580} A.1	Causes related to UE identification


[Nm] {6581} Cause #2 – IMSI unknown in HSS


	[B1] {6582} 	This EMM cause is sent to the UE if the UE is not known (registered) in the HSS or if the UE has packet only subscription. This EMM cause does not affect operation of the EPS service, although is may be used by an EMM procedure. 


[Nm] {6583} Cause #3 – Illegal UE


	[B1] {6584} 	This EMM cause is sent to the UE when the network refuses service to the UE either because an identity of the UE is not acceptable to the network or because the UE does not pass the authentication check, i.e. the RES received from the UE is different from that generated by the network.


[Nm] {6585} Cause #6 – Illegal ME 


	[B1] {6586} 	This EMM cause is sent to the UE if the ME used is not acceptable to the network, e.g. blacklisted.


[Nm] {6587} Cause #9 – UE identity cannot be derived by the network.


	[B1] {6588} 	This EMM cause is sent to the UE when the network cannot derive the UE's identity from the GUTI/S-TMSI/P-TMSI and RAI e.g. no matching identity/context in the network or failure to validate the UE's identity due to integrity check failure of the received message.


[Nm] {6589} Cause #10 – Implicitly detached


	[B1] {6590} 	This EMM cause is sent to the UE either if the network has implicitly detached the UE, e.g. after the implicit detach timer has expired, or if the EMM context data related to the subscription does not exist in the MME e.g. because of a MME restart, or because of a periodic tracking area update request routed to a new MME.


[H1] {6591} A.2	Cause related to subscription options


[Nm] {6592} Cause #5 – IMEI not accepted


	[B1] {6593} 	This cause is sent to the UE if the network does not accept an attach procedure for emergency bearer services using an IMEI.


[Nm] {6594} Cause #7 – EPS services not allowed


	[B1] {6595} 	This EMM cause is sent to the UE when it is not allowed to operate EPS services.


[Nm] {6596} Cause #8 – EPS services and non-EPS services not allowed


	[B1] {6597} 	This EMM cause is sent to the UE when it is not allowed to operate either EPS or non-EPS services.


[Nm] {6598} Cause #11 – PLMN not allowed


	[B1] {6599} 	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate.


[Nm] {6600} Cause #12 – Tracking area not allowed


	[B1] {6601} 	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the HPLMN determines that the UE, by subscription, is not allowed to operate.


[Nm] {6602} Cause #13 – Roaming not allowed in this tracking area


	[B1] {6603} 	This EMM cause is sent to an UE which requests service, or if the network initiates a detach request, in a tracking area of a PLMN which by subscription offers roaming to that UE but not in that tracking area.


[Nm] {6604} Cause #14 – EPS services not allowed in this PLMN


	[B1] {6605} 	This EMM cause is sent to the UE which requests service, or if the network initiates a detach request, in a PLMN which does not offer roaming for EPS services to that UE.


[Nm] {6606} Cause #15 – No suitable cells in tracking area


	[B1] {6607} 	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the UE, by subscription, is not allowed to operate, but when it should find another allowed tracking area or location area in the same PLMN or an equivalent PLMN.


[Nm] {6608} Cause #25 – Not authorized for this CSG


	[B1] {6609} 	This EMM cause is sent to the UE if it requests access, or if the network initiates a detach request, in a CSG cell with CSG ID where the UE either has no subscription to operate or the UE's subscription has expired and it should find another cell in the same PLMN or an equivalent PLMN.


[Nm] {6610} Cause #35 – Requested service option not authorized in this PLMN


	[B1] {6611} 	This EMM cause is sent to the UE if it requests in a PLMN a service option for which it is not authorized, e.g. if it attempts to attach for relay node operation in a PLMN with a USIM which does not belong to a relay node-specific subscription.


[Nm] {6612} Cause #40 – No EPS bearer context activated


	[B1] {6613} 	This EMM cause is sent to the UE, if during a tracking area updating procedure or a service request, the MME detects that there is no active EPS bearer context in the network. 


[Nm] {6614} Cause #31 – Redirection to 5GCN required


	[B1] {6615} 	This EMM cause is sent to the UE if it requests service in a PLMN where the UE by operator policy, is not allowed in EPC and redirection to 5GCN is required.


[H1] {6616} A.3	Causes related to PLMN specific network failures and congestion/authentication failures


[Nm] {6617} Cause #16 – MSC temporarily not reachable


	[B1] {6618} 	This EMM cause is sent to the UE if it requests a combined EPS attach or tracking area updating in a PLMN where the MSC is temporarily not reachable via the EPS part of the network.


[Nm] {6619} Cause #17 – Network failure


	[B1] {6620} 	This EMM cause is sent to the UE if the MME cannot service an UE generated request because of PLMN failures.


[Nm] {6621} Cause #18 – CS domain not available


	[B1] {6622} 	This EMM cause is sent to the UE if the MME cannot service an UE generated request because CS domain is not available and SMS in MME is not supported.


[Nm] {6623} Cause #19 – ESM failure


	[B1] {6624} 	This EMM cause is sent to the UE when there is a failure in the ESM message contained in the EMM message.


[Nm] {6625} Cause #20 – MAC failure


	[B1] {6626} 	This EMM cause is sent to the network if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh (see 3GPP TS 33.401 [19]).


[Nm] {6627} Cause #21 – Synch failure


	[B1] {6628} 	This EMM cause is sent to the network if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range (see 3GPP TS 33.401 [19]).


[Nm] {6629} Cause #22 – Congestion


	[B1] {6630} 	This EMM cause is sent to the UE because of congestion in the network (e.g. no channel, facility busy/congested etc.).


[Nm] {6631} Cause #23 – UE security capabilities mismatch


	[B1] {6632} 	This EMM cause is sent to the network if the UE detects that the UE security capability does not match the one sent back by the network.


[Nm] {6633} Cause #24 – Security mode rejected, unspecified


	[B1] {6634} 	This EMM cause is sent to the network if the security mode command is rejected by the UE if the UE detects that the nonceUE does not match the one sent back by the network or for unspecified reasons.


[Nm] {6635} Cause #26 – Non-EPS authentication unacceptable


	[B1] {6636} 	This EMM cause is sent to the network in S1 mode if the "separation bit" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP TS 33.401 [19]).


[Nm] {6637} Cause #39 – CS service temporarily not available


	[B1] {6638} 	This EMM cause is sent to the UE when the CS fallback or 1xCS fallback request cannot be served temporarily due to O&M reasons or a mobile terminating CS fallback call is aborted by the network during call establishment (see 3GPP TS 29.118 [16A]).


[Nm] {6639} Cause #42 – Severe network failure


	[B1] {6640} 	This EMM cause is sent to the UE when the network has determined that the requested procedure cannot be completed successfully due to network failure. The failure is not expected to be temporary and repeated request is not likely to succeed in near future.


[H1] {6641} A.4	Causes related to nature of request


[H1] {6642} A.5	Causes related to invalid messages


[Nm] {6643} Cause value #95 – Semantically incorrect message.


	[B1] {6644} 	See 3GPP TS 24.008 [13], annex H, subclause H.5.5.


[Nm] {6645} Cause value #96 – Invalid mandatory information.


	[B1] {6646} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.1.


[Nm] {6647} Cause value #97 – Message type non-existent or not implemented.


	[B1] {6648} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.2.


[Nm] {6649} Cause value #98 – Message type not compatible with protocol state.


	[B1] {6650} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.3.


[Nm] {6651} Cause value #99 – Information element non-existent or not implemented.


	[B1] {6652} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.4.


[Nm] {6653} Cause value #100 – Conditional IE error.


	[B1] {6654} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.5.


[Nm] {6655} Cause value #101 – Message not compatible with protocol state.


	[B1] {6656} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.6.


[Nm] {6657} Cause value #111 – Protocol error, unspecified.


	[B1] {6658} 	See 3GPP TS 24.008 [13], annex H, subclause H.6.8.


[H8] {6659} 
Annex B (informative):
Cause values for EPS session management


[H1] {6660} B.1	Causes related to nature of request


[Nm] {6661} Cause #8 – Operator Determined Barring


	[B1] {6662} 	This ESM cause is used by the network to indicate that the requested service was rejected by the MME due to Operator Determined Barring.


[Nm] {6663} Cause #26 – Insufficient resources


	[B1] {6664} 	This ESM cause is used by the UE or by the network to indicate that the requested service cannot be provided due to insufficient resources. 


[Nm] {6665} Cause #27 – Missing or unknown APN


	[B1] {6666} 	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the access point name was not included although required or if the access point name could not be resolved.


[Nm] {6667} Cause #28 – Unknown PDN type


	[B1] {6668} 	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the PDN type could not be recognised.


[Nm] {6669} Cause #29 – User authentication or authorization failed


	[B1] {6670} 	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication or revoked by the external packet data network.


[Nm] {6671} Cause #30 – Request rejected by Serving GW or PDN GW


	[B1] {6672} 	This ESM cause is used by the network to indicate that the requested service or operation or the request for a resource was rejected by the Serving GW or PDN GW.


[Nm] {6673} Cause #31 – Request rejected, unspecified


	[B1] {6674} 	This ESM cause is used by the network or by the UE to indicate that the requested service or operation or the request for a resource was rejected due to unspecified reasons.


[Nm] {6675} Cause #32 – Service option not supported


	[B1] {6676} 	This ESM cause is used by the network when the UE requests a service which is not supported by the PLMN.


[Nm] {6677} Cause #33 – Requested service option not subscribed


	[B1] {6678} 	This ESM cause is sent when the UE requests a service option for which it has no subscription.


[Nm] {6679} Cause #34 – Service option temporarily out of order


	[B1] {6680} 	This ESM cause is sent when the network cannot service the request because of temporary outage of one or more functions required for supporting the service.


[Nm] {6681} Cause #35 – PTI already in use


	[B1] {6682} 	This ESM cause is used by the network to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE.


[Nm] {6683} Cause #36 – Regular deactivation


	[B1] {6684} 	This ESM cause is used to indicate a regular UE or network initiated release of EPS bearer resources. 


[Nm] {6685} Cause #37 – EPS QoS not accepted


	[B1] {6686} 	This ESM cause is used by the network if the new EPS QoS cannot be accepted that was indicated in the UE request. 


[Nm] {6687} Cause #38 – Network failure


	[B1] {6688} 	This ESM cause is used by the network to indicate that the requested service was rejected due to an error situation in the network.


[Nm] {6689} Cause #39 – Reactivation requested


	[B1] {6690} 	This ESM cause is used by the network to request a PDN connection reactivation.


[Nm] {6691} Cause #41 – Semantic error in the TFT operation.


	[B1] {6692} 	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a semantic error in the TFT operation included in the request.


[Nm] {6693} Cause #42 – Syntactical error in the TFT operation.


	[B1] {6694} 	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a syntactical error in the TFT operation included in the request.


[Nm] {6695} Cause #43 – Invalid EPS bearer identity


	[B1] {6696} 	This ESM cause is used by the network or the UE to indicate that the EPS bearer identity value provided to it is not a valid value for the received message or the EPS bearer context identified by the linked EPS bearer identity IE in the request is not active.


[Nm] {6697} Cause #44 – Semantic errors in packet filter(s)


	[B1] {6698} 	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more semantic errors in packet filter(s) of the TFT included in the request.


[Nm] {6699} Cause #45 – Syntactical error in packet filter(s)


	[B1] {6700} 	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more syntactical errors in packet filter(s) of the TFT included in the request.


[Nm] {6701} Cause #47 – PTI mismatch


	[B1] {6702} 	This ESM cause is used by the UE to indicate that the PTI value which is included in the ESM message that the UE receives does not match a PTI in use.


[Nm] {6703} Cause #49 – Last PDN disconnection not allowed


	[B1] {6704} 	This ESM cause is used by the network, in case of EMM-REGISTERED without PDN connection is not supported by the UE or the MME, to indicate that the UE requested PDN disconnection procedure on the last remaining PDN connection is not allowed.


[Nm] {6705} Cause #50 – PDN type IPv4 only allowed


	[B1] {6706} 	This ESM cause is used by the network to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity.


[Nm] {6707} Cause #51 – PDN type IPv6 only allowed


	[B1] {6708} 	This ESM cause is used by the network to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity.


[Nm] {6709} Cause #52 – single address bearers only allowed


	[B1] {6710} 	This ESM cause is used by the network to indicate that the requested PDN connectivity is accepted with the restriction that only single IP version bearers are allowed.


[Nm] {6711} Cause #53 – ESM information not received


	[B1] {6712} 	This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to the ESM information was not received.


[Nm] {6713} Cause #54 – PDN connection does not exist


	[B1] {6714} 	This ESM cause is used by the network at handover from a non-3GPP access network to indicate that the MME does not have any information about the requested PDN connection.


[Nm] {6715} Cause #55 – Multiple PDN connections for a given APN not allowed


	[B1] {6716} 	This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to multiple PDN connections for a given APN are not allowed.


[Nm] {6717} Cause #56 – Collision with network initiated request


	[B1] {6718} 	This ESM cause is used by the network to indicate that the network has already initiated the activation, modification or deactivation of bearer resources which was requested by the UE.


[Nm] {6719} Cause #57 – PDN type IPv4v6 only allowed


	[B1] {6720} 	This ESM cause is used by the network to indicate that only PDN types IPv4, IPv6 or IPv4v6 are allowed for the requested PDN connectivity.


[Nm] {6721} Cause #58 – PDN type non IP only allowed


	[B1] {6722} 	This ESM cause is used by the network to indicate that only PDN type non IP is allowed for the requested PDN connectivity.


[Nm] {6723} Cause #59 – Unsupported QCI value


	[B1] {6724} 	This ESM cause is used by the network if the QCI indicated in the UE request cannot be supported.


[Nm] {6725} Cause #60 – Bearer handling not supported


	[B1] {6726} 	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected because the bearer handling is not supported.


[Nm] {6727} Cause #61 – PDN type Ethernet only allowed


	[B1] {6728} 	This ESM cause is used by the network to indicate that only PDN type Ethernet is allowed for the requested PDN connectivity.


[Nm] {6729} Cause #65 – Maximum number of EPS bearers reached


	[B1] {6730} 	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the network has reached the maximum number of simultaneously active EPS bearer contexts for the UE.


[Nm] {6731} Cause #66 – Requested APN not supported in current RAT and PLMN combination


	[B1] {6732} 	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the requested APN is not supported in the current RAT and PLMN.


[Nm] {6733} Cause #81 – Invalid PTI value


	[B1] {6734} 	This ESM cause is used by the network or UE to indicate that the PTI provided to it is unassigned or reserved.


[Nm] {6735} Cause #112 – APN restriction value incompatible with active EPS bearer context.


	[B1] {6736} 	This ESM cause is used by the network to indicate that the EPS bearer context(s) have an APN restriction value that is not allowed in combination with a currently active EPS bearer context. Restriction values are defined in 3GPP TS 23.060 [4].


[Nm] {6737} Cause #113 –Multiple accesses to a PDN connection not allowed


	[B1] {6738} 	This ESM cause is used by the network to indicate that multiple accesses to a PDN connection for NBIFOM is not allowed.


[H1] {6739} B.2	Protocol errors (e.g., unknown message) class


[Nm] {6740} Cause #95 – Semantically incorrect message


	[B1] {6741} 	This ESM cause is used to report receipt of a message with semantically incorrect contents.


[Nm] {6742} Cause #96 – Invalid mandatory information


	[B1] {6743} 	This ESM cause indicates that the equipment sending this ESM cause has received a message with a non-semantical mandatory IE error.


[Nm] {6744} Cause #97 – Message type non-existent or not implemented


	[B1] {6745} 	This ESM cause indicates that the equipment sending this ESM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this ESM cause.


[Nm] {6746} Cause #98 – Message type not compatible with protocol state


	[B1] {6747} 	This ESM cause indicates that the equipment sending this ESM cause has received a message not compatible with the protocol state.


[Nm] {6748} Cause #99 – Information element non-existent or not implemented


	[B1] {6749} 	This ESM cause indicates that the equipment sending this ESM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the ESM cause. However, the information element is not required to be present in the message in order for the equipment sending the ESM cause to process the message.


[Nm] {6750} Cause #100 – Conditional IE error


	[B1] {6751} 	This ESM cause indicates that the equipment sending this cause has received a message with conditional IE errors.


[Nm] {6752} Cause #101 – Message not compatible with protocol state


	[B1] {6753} 	This ESM cause indicates that a message has been received which is incompatible with the protocol state.


[Nm] {6754} Cause #111 – Protocol error, unspecified


	[B1] {6755} 	This ESM cause is used to report a protocol error event only when no other ESM cause in the protocol error class applies.


[H8] {6756} 
Annex C (normative):
Storage of EMM information


[Nm] {6757} The following EMM parameters shall be stored on the USIM if the corresponding file is present:


	[B1] {6758} -	GUTI;


	[B1] {6759} -	last visited registered TAI;


	[B1] {6760} -	EPS update status;


	[B1] {6761} -	Allowed CSG list;


	[B1] {6762} -	Operator CSG list; and


	[B1] {6763} -	EPS security context parameters from a full native EPS security context (see 3GPP TS 33.401 [19]).


	[B1] {6764} The presence and format of corresponding files on the USIM is specified in 3GPP TS 31.102 [17].


[Nm] {6765} If the corresponding file is not present on the USIM, these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. The allowed CSG list is stored in a non-volatile memory in the ME if the UE supports CSG selection. These EMM parameters can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; else the UE shall delete the EMM parameters.


[Nm] {6766} The following EMM parameters shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM:


	[B1] {6767} -	TIN;


	[B1] {6768} -	DCN-ID list; and


	[B1] {6769} -	network-assigned UE radio capability IDs.


[Nm] {6770} The TIN parameter can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the TIN parameter.


[Nm] {6771} The DCN-ID list consists of DCN-IDs stored together with a PLMN identity. The list can have zero or more entries and the maximum length shall be at least 32 entries. When the maximum length is reached any new entry shall replace the oldest entry in the list. There shall be no duplicated PLMN identities in the list and any existing DCN-ID shall be deleted when a new DCN-ID is added for the same PLMN.


[Nm] {6772} The DCN-ID list can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the DCN-ID list. The UE shall delete the stored DCN-ID list if the default standardized DCN-ID in the UE is changed.


[Nm] {6773} Each network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).


[Nm] {6774} If the UE is attached for emergency bearer services, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is detached.


[Nm] {6775} If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters EMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.


[Nm] {6776} If the UE is attached for access to RLOS, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead, the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters after detach.


[H8] {6777} Annex D (normative):
Establishment cause (S1 mode only)


[H1] {6778} D.1	Mapping of NAS procedure to RRC establishment cause (S1 mode only)


[Nm] {6779} When EMM requests the establishment of a NAS-signalling connection, or when EMM requests the lower layers to resume a NAS signalling connection, the RRC establishment cause used by the UE shall be selected according to the NAS procedure as specified in table D.1.1. The EMM shall also indicate to the lower layer for the purpose of access control, the call type associated with the RRC establishment cause as specified in table D.1.1. If the UE is configured for EAB (see the "ExtendedAccessBarring" leaf of NAS configuration MO in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]), the EMM shall indicate to the lower layer for the purpose of access control that EAB applies for this request except for the following cases:


	[B1] {6780} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


	[B1] {6781} -	the UE is answering to paging;


	[B1] {6782} -	the RRC Establishment cause is set to "Emergency call";


	[B1] {6783} -	the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an indication from the upper layers to override EAB; or


	[B1] {6784} -	the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and already has a PDN connection that was established with EAB override.


[H8] {6785} 
Annex E (informative):
Guidelines for enhancements to MS network capability IE and UE network capability IE


[Nm] {6786} The UE uses the information elements MS network capability and UE network capability to inform the core network about its network related capabilities. Both information elements can be signalled in any of the modes: A/Gb mode, Iu mode and S1 mode.


[Nm] {6787} The purpose of the present annex is to give some guidelines how to select the information element(s) to be enhanced if new capabilities need to be added.


	[B1] {6788} 1)	If a capability is related to a feature that can be used in a network supporting A/Gb mode only or Iu mode only or both, the capability will be signalled in the MS network capability IE.


	[B1] {6789} 2)	If a capability is related to a feature that can be used in network supporting S1 mode only, the capability will be signalled in the UE network capability IE.


	[B1] {6790} 3)	If a capability is related to a feature that can be used only in a network supporting both S1 mode and at least one of the two modes A/Gb mode and Iu mode, the capability is added only to one of the two information elements:


		[B2] {6791} a)	If the information is used by the MME only, the capability will be signalled in the UE network capability IE.


		[B2] {6792} b)	If the information is used by the SGSN only or both by the SGSN and by the MME, the capability will be signalled in the MS network capability IE.


[H8] {6793} 
Annex F (normative):
Application specific Congestion control for Data Communication (ACDC)


[Nm] {6794} The UE may support the procedures in this annex.


[Nm] {6795} If the UE supports ACDC, the EMM layer shall determine the ACDC category applicable to the request based on the application identifier received from the upper layers and the configuration information in the "ACDCConf" leaf of ACDC MO as specified in 3GPP TS 24.105 [35] or in the USIM EFACDC as specified in 3GPP TS 31.102 [17]. 


[Nm] {6796} The EMM sublayer shall indicate to the lower layers, for the purpose of access control:


	[B1] {6797} -	the ACDC category that applies to this request if only one ACDC category is applicable;


	[B1] {6798} -	the highest ranked ACDC category among the ACDC categories that applies to this request if multiple ACDC categories are applicable; or


	[B1] {6799} -	this request is for an uncategorized application if an application identifier received from the upper layers is not mapped to any ACDC category,


[Nm] {6800} except for the following cases:


	[B1] {6801} -	the UE is a UE configured to use AC11 – 15 in selected PLMN;


	[B1] {6802} -	the UE is answering to paging;


	[B1] {6803} -	the RRC Establishment cause is set to "Emergency call"; or


	[B1] {6804} -	if conditions MO MMTEL voice call is started or MO MMTEL video call is started or MO SMSoIP is started, is satisfied.


[Nm] {6805} If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall keep track of the ACDC category for which access is barred and it shall not send a request for the same ACDC category or a lower ACDC category until access is granted.


[Nm] {6806} If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall not send a request for any uncategorized application until access is granted.


[H8] {6807} 
Annex G (informative):
Change history


